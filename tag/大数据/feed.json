{
    "version": "https://jsonfeed.org/version/1",
    "title": "千里稻花应秀色 • All posts by \"大数据\" tag",
    "description": "blogs by SSR",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2021/12/12/Hive%E5%AD%A6%E4%B9%A0/hive5/",
            "url": "http://example.com/2021/12/12/Hive%E5%AD%A6%E4%B9%A0/hive5/",
            "title": "Hive查询进阶",
            "date_published": "2021-12-12T11:17:39.970Z",
            "content_html": "<h1 id=\"hiveql数据查询进阶\"><a class=\"markdownIt-Anchor\" href=\"#hiveql数据查询进阶\">#</a> HiveQL 数据查询进阶</h1>\n<p>本章要点</p>\n<ul>\n<li>Hive 内置函数</li>\n<li>Hive 构建搜索日志分析系统</li>\n<li>Sqoop 应用与开发</li>\n</ul>\n<h2 id=\"hive-内置函数\"><a class=\"markdownIt-Anchor\" href=\"#hive-内置函数\">#</a> Hive 内置函数</h2>\n<p>Hive 内置函数就是 Hive 中可以直接使用的函数，首先查看一下有哪些函数</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">show</span> functions;</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------------------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span>           tab_name           <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------------------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">!</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">!=</span>                           <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> $sum0                        <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">%</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">&amp;</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">*</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">+</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">-</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">/</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">&lt;</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">&lt;=</span>                           <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">&lt;=&gt;</span>                          <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">&lt;&gt;</span>                           <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">=</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">=</span><span class=\"operator\">=</span>                           <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">&gt;</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">&gt;=</span>                           <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">^</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> abs                          <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> acos                         <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> add_months                   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> aes_decrypt                  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> aes_encrypt                  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"keyword\">and</span>                          <span class=\"operator\">|</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------------------------------+</span></span><br><span class=\"line\"><span class=\"number\">289</span> <span class=\"keyword\">rows</span> selected (<span class=\"number\">0.494</span> seconds)</span><br></pre></td></tr></table></figure>\n<p>其中常用的如 avg 求平均，concat 连接函数，count 统计等。内置函数可以被分成：数学函数、字符函数、收集函数、转换函数、日期函数、条件函数、聚合函数以及表生成函数。</p>\n<h3 id=\"数学函数\"><a class=\"markdownIt-Anchor\" href=\"#数学函数\">#</a> 数学函数</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#加法</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"number\">10</span><span class=\"operator\">+</span><span class=\"number\">10</span>;</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">20</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> selected (<span class=\"number\">1.324</span> seconds)</span><br><span class=\"line\"></span><br><span class=\"line\">#减法</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"number\">15</span><span class=\"number\">-3</span>;</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">12</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> selected (<span class=\"number\">0.564</span> seconds)</span><br><span class=\"line\"></span><br><span class=\"line\">#乘除<span class=\"operator\">*</span><span class=\"operator\">/</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"number\">6</span><span class=\"operator\">*</span><span class=\"number\">6</span>;</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">36</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> selected (<span class=\"number\">0.867</span> seconds)</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"number\">36</span><span class=\"operator\">/</span><span class=\"number\">6</span>;</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">6.0</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> selected (<span class=\"number\">0.734</span> seconds)</span><br><span class=\"line\"></span><br><span class=\"line\">#round四舍五入</span><br><span class=\"line\"><span class=\"keyword\">select</span> round(<span class=\"number\">88.999</span>,<span class=\"number\">2</span>),round(<span class=\"number\">78.600</span>,<span class=\"number\">1</span>), round(<span class=\"number\">55.776</span>,<span class=\"number\">2</span>);</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+-------+--------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">89.00</span>  <span class=\"operator\">|</span> <span class=\"number\">78.6</span>  <span class=\"operator\">|</span> <span class=\"number\">55.78</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+-------+--------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> selected (<span class=\"number\">0.505</span> seconds)</span><br><span class=\"line\"></span><br><span class=\"line\">#ceil向上取整</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">ceil</span>(<span class=\"number\">84.5</span>);</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">85</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> selected (<span class=\"number\">0.542</span> seconds)</span><br><span class=\"line\"></span><br><span class=\"line\">#floor向下取整</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">floor</span>(<span class=\"number\">45.9</span>);</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">45</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> selected (<span class=\"number\">0.535</span> seconds)</span><br><span class=\"line\"></span><br><span class=\"line\">#pow 平方函数</span><br><span class=\"line\"><span class=\"keyword\">select</span> pow(<span class=\"number\">2</span>,<span class=\"number\">3</span>);</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">8.0</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> selected (<span class=\"number\">0.357</span> seconds)</span><br><span class=\"line\"></span><br><span class=\"line\">#pmod 取模函数</span><br><span class=\"line\"><span class=\"keyword\">select</span> pmod(<span class=\"number\">9</span>,<span class=\"number\">8</span>);</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">1</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> selected (<span class=\"number\">0.242</span> seconds)</span><br></pre></td></tr></table></figure>\n<h3 id=\"字符函数\"><a class=\"markdownIt-Anchor\" href=\"#字符函数\">#</a> 字符函数</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#lower转小写</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">lower</span>(&quot;FJKNXCYT&quot;);</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> fjknxcyt  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------+</span></span><br><span class=\"line\">#upper转大写</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">upper</span>(&quot;asdjnkgbasd&quot;);</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> ASDJNKGBASD  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------------+</span></span><br><span class=\"line\">#length字符串长度</span><br><span class=\"line\"><span class=\"keyword\">select</span> length(&quot;hadoop&quot;);</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">6</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\">#concat字符拼接</span><br><span class=\"line\"><span class=\"keyword\">select</span> concat(&quot;hadoop&quot;, &quot;&amp;hive&quot;);</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> hadoop<span class=\"operator\">&amp;</span>hive  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------------+</span></span><br><span class=\"line\">#substr取子串(从<span class=\"number\">8</span>开始取<span class=\"number\">5</span>个)</span><br><span class=\"line\"><span class=\"keyword\">select</span> substr(&quot;hadoop spark hive&quot;, <span class=\"number\">8</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> spark  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+</span></span><br><span class=\"line\">#trim去除前后空格</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">trim</span>(&quot;   hadoop   &quot;);</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">---------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> hadoop  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">---------+</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"转换函数\"><a class=\"markdownIt-Anchor\" href=\"#转换函数\">#</a> 转换函数</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#cast类型转换函数</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">cast</span> (<span class=\"number\">88</span> <span class=\"keyword\">as</span> <span class=\"keyword\">double</span>);</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">88.0</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"日期函数\"><a class=\"markdownIt-Anchor\" href=\"#日期函数\">#</a> 日期函数</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#<span class=\"keyword\">year</span> <span class=\"keyword\">month</span> <span class=\"keyword\">day</span> 分别获取年月日</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">year</span>(&quot;2021-10-08 18:40:24&quot;), <span class=\"keyword\">month</span>(&quot;2021-10-08 18:40:24&quot;), <span class=\"keyword\">day</span>(&quot;2021-10-08 18:40:24&quot;);</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+------+------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">2021</span>  <span class=\"operator\">|</span> <span class=\"number\">10</span>   <span class=\"operator\">|</span> <span class=\"number\">8</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+------+------+</span></span><br><span class=\"line\">#to_date返回字段中日期部分</span><br><span class=\"line\"><span class=\"keyword\">select</span> to_date(&quot;2021-10-08 18:40:24&quot;);</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">2021</span><span class=\"number\">-10</span><span class=\"number\">-08</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------------+</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"条件函数\"><a class=\"markdownIt-Anchor\" href=\"#条件函数\">#</a> 条件函数</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#<span class=\"keyword\">case</span> A <span class=\"keyword\">when</span> B <span class=\"keyword\">then</span> C <span class=\"keyword\">when</span> D <span class=\"keyword\">then</span> E <span class=\"keyword\">else</span> F <span class=\"keyword\">end</span>;</span><br><span class=\"line\"><span class=\"keyword\">select</span> ts, uid, rank, <span class=\"keyword\">case</span> rank <span class=\"keyword\">when</span> &quot;2&quot; <span class=\"keyword\">then</span> rank<span class=\"operator\">+</span><span class=\"number\">1</span> <span class=\"keyword\">else</span> rank<span class=\"number\">-1</span> <span class=\"keyword\">end</span> <span class=\"keyword\">from</span> sogou.sogou_liangjian;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------------+-----------------------------------+-------+------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span>       ts        <span class=\"operator\">|</span>                uid                <span class=\"operator\">|</span> rank  <span class=\"operator\">|</span> _c3  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------------+-----------------------------------+-------+------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">20111230104333</span>  <span class=\"operator\">|</span> <span class=\"number\">53</span>a3b5132bd6af7d324f3fd55d7153ba  <span class=\"operator\">|</span> <span class=\"number\">3</span>     <span class=\"operator\">|</span> <span class=\"number\">2</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">20111230104334</span>  <span class=\"operator\">|</span> <span class=\"number\">966</span>a6bf4c4ec1cc693b6e40702984235  <span class=\"operator\">|</span> <span class=\"number\">4</span>     <span class=\"operator\">|</span> <span class=\"number\">3</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">20111230104334</span>  <span class=\"operator\">|</span> ae55d5e4b4f29a1221816a121e087567  <span class=\"operator\">|</span> <span class=\"number\">2</span>     <span class=\"operator\">|</span> <span class=\"number\">3</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------------+-----------------------------------+-------+------+</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"聚合函数\"><a class=\"markdownIt-Anchor\" href=\"#聚合函数\">#</a> 聚合函数</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#count返回行数</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> sogou.sogou_xj;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">1330</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+</span></span><br><span class=\"line\">#sum求和</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">sum</span>(orders) <span class=\"keyword\">as</span> ordersum <span class=\"keyword\">from</span> sogou.sogou_xj;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> ordersum  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">2043</span>      <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------+</span></span><br><span class=\"line\">#min列最小值</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">min</span>(orders) <span class=\"keyword\">from</span> sogou.sogou_xj;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">1</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\">#max列最大值</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">max</span>(rank) <span class=\"keyword\">from</span> sogou.sogou_xj;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">10</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\">#avg列平均值</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">avg</span>(rank) <span class=\"keyword\">from</span> sogou.sogou_xj;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">---------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">2.9225563909774435</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">---------------------+</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"hive-构建搜索日志分析系统\"><a class=\"markdownIt-Anchor\" href=\"#hive-构建搜索日志分析系统\">#</a> Hive 构建搜索日志分析系统</h2>\n<h3 id=\"数据预处理linux环境\"><a class=\"markdownIt-Anchor\" href=\"#数据预处理linux环境\">#</a> 数据预处理 (Linux 环境)</h3>\n<ol>\n<li>查看数据</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@hdp-1 hive]# wc -l sogou.500w.utf8 </span><br><span class=\"line\">5000000 sogou.500w.utf8</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>数据拓展<br>\n将用户访问的时间拆分成，年月日小时字段，为后面创建分区表做准备，编写一个 shell 脚本实现此功能。</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi pre.sh </span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">!/bin/bash</span></span><br><span class=\"line\">infile=$1</span><br><span class=\"line\">outfile=$2</span><br><span class=\"line\">awk -F &#x27;\\t&#x27; &#x27;&#123;print $0&quot;\\t&quot;substr($1,1,4)&quot;\\t&quot;substr($1,5,2)&quot;\\t&quot;substr($1,7,2)&quot;\\t&quot;substr($1,9,2)&#125;&#x27; $infile &gt; $outfile</span><br><span class=\"line\"></span><br><span class=\"line\">chmod +x pre.sh</span><br><span class=\"line\">sh pre.sh ./sogou.500w.utf8 ./sogou.500w.utf8.ext</span><br><span class=\"line\">less sogou.500w.utf8.ext</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>数据加载<br>\n将数据放到 HDFS 上</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hdfs dfs -mkdir -p /usr/local/hive/</span><br><span class=\"line\">hdfs dfs -put ./sogou.500w.utf8.ext /usr/local/hive/</span><br></pre></td></tr></table></figure>\n<h3 id=\"基于hive-构建日志的数据仓库\"><a class=\"markdownIt-Anchor\" href=\"#基于hive-构建日志的数据仓库\">#</a> 基于 Hive 构建日志的数据仓库</h3>\n<p>启动 Hadoop 集群，打开 Hive 客户端</p>\n<ol>\n<li>基本操作</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">show</span> databases;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">---------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span>    database_name    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">---------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"keyword\">default</span>             <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> information_schema  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou               <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sys                 <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">---------------------+</span></span><br><span class=\"line\"><span class=\"keyword\">create</span> database if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> sogou;</span><br><span class=\"line\">use sogou;</span><br><span class=\"line\"><span class=\"keyword\">show</span> tables;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span>     tab_name     <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_500w       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_liangjian  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_xj         <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_xj_backup  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------------------+</span></span><br><span class=\"line\">#创建外部表sogou_0936加载sogou<span class=\"number\">.500</span>w.utf8的数据</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">external</span> <span class=\"keyword\">table</span>  if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> sogou.sogou_0936(ts string,uid string,keyword string, rank <span class=\"type\">int</span>, orders <span class=\"type\">int</span>, url string) <span class=\"type\">row</span> format delimited fields terminated <span class=\"keyword\">by</span> <span class=\"string\">&#x27;\\t&#x27;</span> stored <span class=\"keyword\">as</span> textfile location <span class=\"string\">&#x27;/usr/local/hive/raw/&#x27;</span>;</span><br><span class=\"line\">#创建外部表sogou_ext加载sogou<span class=\"number\">.500</span>w.utf8.ext的数据</span><br><span class=\"line\"> <span class=\"keyword\">create</span> <span class=\"keyword\">external</span> <span class=\"keyword\">table</span>  if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> sogou.sogou_ext(ts string,uid string,keyword string, rank <span class=\"type\">int</span>, orders <span class=\"type\">int</span>, url string) <span class=\"type\">row</span> format delimited fields terminated <span class=\"keyword\">by</span> <span class=\"string\">&#x27;\\t&#x27;</span> stored <span class=\"keyword\">as</span> textfile location <span class=\"string\">&#x27;/usr/local/hive/ext/&#x27;</span></span><br><span class=\"line\">#查看数据没问题</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> sogou_0936 limit <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> sogou_ext limit <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"keyword\">desc</span> sogou_0936;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------+------------+----------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> col_name  <span class=\"operator\">|</span> data_type  <span class=\"operator\">|</span> comment  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------+------------+----------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> ts        <span class=\"operator\">|</span> string     <span class=\"operator\">|</span>          <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> uid       <span class=\"operator\">|</span> string     <span class=\"operator\">|</span>          <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> keyword   <span class=\"operator\">|</span> string     <span class=\"operator\">|</span>          <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> rank      <span class=\"operator\">|</span> <span class=\"type\">int</span>        <span class=\"operator\">|</span>          <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> orders    <span class=\"operator\">|</span> <span class=\"type\">int</span>        <span class=\"operator\">|</span>          <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> url       <span class=\"operator\">|</span> string     <span class=\"operator\">|</span>          <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------+------------+----------+</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>创建分区表</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#创建分区表</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">external</span> <span class=\"keyword\">table</span>  if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> sogou.sogou_partition(ts string,uid string,keyword string, rank <span class=\"type\">int</span>, orders <span class=\"type\">int</span>, url string) partitioned <span class=\"keyword\">by</span> (<span class=\"keyword\">year</span> <span class=\"type\">int</span>, <span class=\"keyword\">month</span> <span class=\"type\">int</span>, <span class=\"keyword\">day</span> <span class=\"type\">int</span>, <span class=\"keyword\">hour</span> <span class=\"type\">int</span> ) <span class=\"type\">row</span> format delimited fields terminated <span class=\"keyword\">by</span> <span class=\"string\">&#x27;\\t&#x27;</span> stored <span class=\"keyword\">as</span> textfile;</span><br><span class=\"line\">#查看表</span><br><span class=\"line\"><span class=\"keyword\">show</span> tables;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span>     tab_name     <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_0936       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_500w       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_ext        <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_liangjian  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_partition  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_xj         <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_xj_backup  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------------------+</span></span><br><span class=\"line\">#最后向分区表中导入数据</span><br><span class=\"line\">#开启动态分区非严格模式</span><br><span class=\"line\"><span class=\"keyword\">set</span> hive.exec.dynamic.partition.mode<span class=\"operator\">=</span>nonstrict;</span><br><span class=\"line\">#禁用矢量运行</span><br><span class=\"line\"><span class=\"keyword\">set</span> hive.vectorized.execution.enabled<span class=\"operator\">=</span><span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">insert</span> overwrite <span class=\"keyword\">table</span> sogou.sogou_partition <span class=\"keyword\">partition</span>(<span class=\"keyword\">year</span>, <span class=\"keyword\">month</span>, <span class=\"keyword\">day</span>, <span class=\"keyword\">hour</span>) <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> sogou.sogou_ext;</span><br><span class=\"line\">#查看数据</span><br></pre></td></tr></table></figure>\n<p><img src=\"image-20211008220145786.png\" class=\"lazyload placeholder\" data-srcset=\"image-20211008220145786.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211008220145786\"></p>\n<p><img src=\"image-20211008220222053.png\" class=\"lazyload placeholder\" data-srcset=\"image-20211008220222053.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211008220222053\"></p>\n<p><img src=\"image-20211008220457507.png\" class=\"lazyload placeholder\" data-srcset=\"image-20211008220457507.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211008220457507\"></p>\n<h3 id=\"数据分析需求1条数统计\"><a class=\"markdownIt-Anchor\" href=\"#数据分析需求1条数统计\">#</a> 数据分析需求（1）：条数统计</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#查询总数据条数</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> sogou.sogou_ext;</span><br></pre></td></tr></table></figure>\n<p><img src=\"image-20211008221558788.png\" class=\"lazyload placeholder\" data-srcset=\"image-20211008221558788.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211008221558788\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#查询关键词非空数据</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">where</span> keyword <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> <span class=\"keyword\">and</span> keyword <span class=\"operator\">!=</span> <span class=\"string\">&#x27;&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<p><img src=\"image-20211009083441029.png\" class=\"lazyload placeholder\" data-srcset=\"image-20211009083441029.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211009083441029\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#无重复总条数（根据ts, uid, keyword, url）</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> uid,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> ts,uid,keyword,url <span class=\"keyword\">having</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"operator\">=</span> <span class=\"number\">1</span> ) t;</span><br><span class=\"line\">#需要给子表起个名</span><br></pre></td></tr></table></figure>\n<p><img src=\"image-20211009114925786.png\" class=\"lazyload placeholder\" data-srcset=\"image-20211009114925786.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211009114925786\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#统计独立uid条数</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"keyword\">distinct</span>(uid)) <span class=\"keyword\">from</span> sogou.sogou_ext;</span><br></pre></td></tr></table></figure>\n<p><img src=\"image-20211009115150331.png\" class=\"lazyload placeholder\" data-srcset=\"image-20211009115150331.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211009115150331\"></p>\n<h3 id=\"数据分析需求2关键词分析\"><a class=\"markdownIt-Anchor\" href=\"#数据分析需求2关键词分析\">#</a> 数据分析需求（2）：关键词分析</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#查询关键词平均长度</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">avg</span>(a.cnt) <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> size(split(keyword,<span class=\"string\">&#x27; s+&#x27;</span>)) <span class=\"keyword\">as</span> cnt <span class=\"keyword\">from</span> sogou.sogou_ext) a;</span><br><span class=\"line\">#由于split函数不支持矢量计算，需要先关闭该功能</span><br><span class=\"line\"><span class=\"keyword\">set</span> hive.vectorized.execution.enabled<span class=\"operator\">=</span><span class=\"literal\">false</span>;</span><br></pre></td></tr></table></figure>\n<p><img src=\"image-20211009122646106.png\" class=\"lazyload placeholder\" data-srcset=\"image-20211009122646106.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211009122646106\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#查询频度排名前<span class=\"number\">50</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> keyword,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">as</span> cnt <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> keyword <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> cnt <span class=\"keyword\">desc</span> limit <span class=\"number\">50</span>;</span><br></pre></td></tr></table></figure>\n<p><img src=\"image-20211009122909785.png\" class=\"lazyload placeholder\" data-srcset=\"image-20211009122909785.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211009122909785\"></p>\n<h3 id=\"数据分析需求3uid分析\"><a class=\"markdownIt-Anchor\" href=\"#数据分析需求3uid分析\">#</a> 数据分析需求（3）：UID 分析</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#为了统计UID的查询次数分布（查询<span class=\"number\">1</span>次的UID个数…查询n次的UID个数），这里我们列出查询<span class=\"number\">1</span>次、<span class=\"number\">2</span>次、<span class=\"number\">3</span>次和大于<span class=\"number\">3</span>次的UID个数</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">sum</span>(if(uids.cnt<span class=\"operator\">=</span><span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">0</span>)),<span class=\"built_in\">sum</span>(if(uids.cnt<span class=\"operator\">=</span><span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">0</span>)), <span class=\"built_in\">sum</span>(if(uids.cnt<span class=\"operator\">=</span><span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">0</span>)), <span class=\"built_in\">sum</span>(if(uids.cnt<span class=\"operator\">&gt;</span><span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">0</span>)) <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> uid, <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">as</span> cnt <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> uid) uids;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img src=\"image-20211009123459384.png\" class=\"lazyload placeholder\" data-srcset=\"image-20211009123459384.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211009123459384\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#统计UID平均查询次数</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">sum</span>(a.cnt)<span class=\"operator\">/</span><span class=\"built_in\">count</span>(a.uid)<span class=\"keyword\">from</span>(<span class=\"keyword\">select</span> uid,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>)<span class=\"keyword\">as</span> cnt <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> uid) a;</span><br></pre></td></tr></table></figure>\n<p><img src=\"image-20211009124613760.png\" class=\"lazyload placeholder\" data-srcset=\"image-20211009124613760.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211009124613760\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#统计查询次数大于<span class=\"number\">2</span>次的用户占比：</span><br><span class=\"line\">#先统计B:UID总数</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"keyword\">distinct</span>(uid)) <span class=\"keyword\">as</span> A <span class=\"keyword\">from</span> sogou.sogou_ext;</span><br><span class=\"line\">#统计查询A:次数大于<span class=\"number\">2</span>的UID个数</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(a.uid) <span class=\"keyword\">as</span> B <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> uid,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">as</span> cnt <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> uid <span class=\"keyword\">having</span> cnt<span class=\"operator\">&gt;</span><span class=\"number\">2</span>)a;</span><br><span class=\"line\">#占比结果是C<span class=\"operator\">=</span>B<span class=\"operator\">/</span>A</span><br><span class=\"line\">#查询次数大于<span class=\"number\">2</span>次的数据如下</span><br><span class=\"line\"><span class=\"keyword\">select</span> b.<span class=\"operator\">*</span> <span class=\"keyword\">from</span>(<span class=\"keyword\">select</span> uid,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">as</span> cnt <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> uid <span class=\"keyword\">having</span> cnt <span class=\"operator\">&gt;</span><span class=\"number\">2</span>) a <span class=\"keyword\">join</span> sogou.sogou_ext b <span class=\"keyword\">on</span> a.uid<span class=\"operator\">=</span>b.uid limit <span class=\"number\">50</span>;</span><br></pre></td></tr></table></figure>\n<p><img src=\"image-20211009124722432.png\" class=\"lazyload placeholder\" data-srcset=\"image-20211009124722432.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211009124722432\"></p>\n<p><img src=\"image-20211009124814645.png\" class=\"lazyload placeholder\" data-srcset=\"image-20211009124814645.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211009124814645\"></p>\n<p><img src=\"image-20211009125148463.png\" class=\"lazyload placeholder\" data-srcset=\"image-20211009125148463.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211009125148463\"></p>\n<h3 id=\"数据分析需求4用户行为分析\"><a class=\"markdownIt-Anchor\" href=\"#数据分析需求4用户行为分析\">#</a> 数据分析需求（4）：用户行为分析</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#点击次数与rank之间的关系</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">where</span> rank <span class=\"operator\">&lt;</span> <span class=\"number\">11</span>;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">4999869</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----------+</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#直接输入url进行查询的比例</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">where</span> keyword <span class=\"keyword\">like</span><span class=\"string\">&#x27;%www%&#x27;</span>;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">73979</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#用户访问的网站包含用户输入的url类型关键词</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">sum</span>(if(instr(url，keyword)<span class=\"operator\">&gt;</span><span class=\"number\">0</span>,<span class=\"number\">1</span>,<span class=\"number\">0</span>)) <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">where</span> keyword <span class=\"keyword\">like</span> <span class=\"string\">&#x27;%www%&#x27;</span>)a;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">27561</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#查询独立用户行为</span><br><span class=\"line\"><span class=\"keyword\">select</span> uid, <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>)<span class=\"keyword\">as</span> cnt <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">where</span> keyword <span class=\"keyword\">like</span><span class=\"string\">&#x27;%仙剑奇侠传%&#x27;</span> <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> uid <span class=\"keyword\">having</span> cnt <span class=\"operator\">&gt;</span> <span class=\"number\">3</span>;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------------------------------+------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span>                uid                <span class=\"operator\">|</span> cnt  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------------------------------+------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">265</span>f1fa26029c058c695ecc7ee4bad01  <span class=\"operator\">|</span> <span class=\"number\">4</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">2</span>b136abffd8f0dd38d97a52a7e50f7fb  <span class=\"operator\">|</span> <span class=\"number\">4</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">40</span>aa046859609c25b3914ac9f2735c5c  <span class=\"operator\">|</span> <span class=\"number\">5</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">653</span>d48aa356d5111ac0e59f9fe736429  <span class=\"operator\">|</span> <span class=\"number\">9</span>    <span class=\"operator\">|</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"sqoop-应用与开发\"><a class=\"markdownIt-Anchor\" href=\"#sqoop-应用与开发\">#</a> Sqoop 应用与开发</h2>\n<p>在实际开发中我们经常会碰到这样一种需求，即大数据平台处理完的数据需要导入关系型数据库，反之关系型数据库中的数据也需要导入大数据平台，为此大数据平台为我们提供了 Sqoop 工具来解决这一需求。</p>\n<h3 id=\"sqoop简介\"><a class=\"markdownIt-Anchor\" href=\"#sqoop简介\">#</a> Sqoop 简介</h3>\n<p>Sqoop 是 Apache 开源的顶级项目之一，用于在 ApacheHadoop 和关系型数据库等结构化数据存储之间高效传输大容量数据的工具。也就是说，Sqoop 是一款类 ETL 工具，主要负责将大数据平台处理完的数据导入关系型数据库中，或者将关系型数据库中的数据带入大数据平台。</p>\n<h3 id=\"sqoop安装部署\"><a class=\"markdownIt-Anchor\" href=\"#sqoop安装部署\">#</a> Sqoop 安装部署</h3>\n<p>安装环境<br>\n在安装 Sqoop 之前确保 hadoop 正确启动，运行，mysql 正常运行。<br>\n解压安装</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf sqoop-1.4.7.bin__hadoop-2.6.0.tar.gz</span><br><span class=\"line\">mv sqoop-1.4.7.bin__hadoop-2.6.0 /usr/local/sqoop</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">更改目录权限</span></span><br><span class=\"line\">chown hadoop:hadoop -R /usr/local/sqoop/</span><br></pre></td></tr></table></figure>\n<p>配置 Sqoop</p>\n<ol>\n<li>配置 MySQL 连接器<br>\n Sqoop 底层通过 JDBC 的方式访问 MySQL 数据库，所以需要把 MySQL 数据库的驱动程序复制到 Sqoop 的依赖包，这里可以使用 hive 的 mysql 驱动（如果有）</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp /usr/local/hive/lib/mysql-connector-java-5.1.32.jar  /usr/local/sqoop/lib/</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>配置环境变量<br>\n进入到 Sqoop 的 conf 目录下，找到 sqoop-env-template.sh 文件，<a href=\"http://xn--sqoop-env-fp6nq62cnhb6779b.sh\">重命名为 sqoop-env.sh</a>，打开进行环境变量的配置</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp /usr/local/sqoop/conf/sqoop-env-template.sh  /usr/local/sqoop/conf/sqoop-env.sh</span><br><span class=\"line\">vi /usr/local/sqoop/conf/sqoop-env.sh</span><br></pre></td></tr></table></figure>\n<p><img src=\"image-20211102175209476.png\" class=\"lazyload placeholder\" data-srcset=\"image-20211102175209476.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211102175209476\"><br>\n3. 将 commons-log.jar 包放在 lib 下。<br>\n<a href=\"https://mirrors.tuna.tsinghua.edu.cn/apache//commons/lang/binaries/commons-lang-2.6-bin.zip\">https://mirrors.tuna.tsinghua.edu.cn/apache//commons/lang/binaries/commons-lang-2.6-bin.zip</a></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv commons-lang-2.6.jar /usr/local/sqoop/lib/</span><br><span class=\"line\">chown hadoop:hadoop /usr/local/sqoop/lib/commons-lang-2.6.jar</span><br></pre></td></tr></table></figure>\n<h3 id=\"sqoop将hive表中的数据导入mysql\"><a class=\"markdownIt-Anchor\" href=\"#sqoop将hive表中的数据导入mysql\">#</a> Sqoop 将 Hive 表中的数据导入 MySQL</h3>\n<p><strong>实验条件</strong><br>\n MySQL 正常启动<br>\n<strong>构建 MySQL 数据库中的表</strong></p>\n<ol>\n<li>登录 MySQL<br>\n 登录 MySQL 的命令</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql <span class=\"operator\">-</span>u root <span class=\"operator\">-</span>p</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>创建数据库</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> database if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> test;</span><br><span class=\"line\">Query OK, <span class=\"number\">1</span> <span class=\"type\">row</span> affected (<span class=\"number\">0.00</span> sec)</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>创建表</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span>  test.uid_cnt (uid <span class=\"type\">varchar</span>(<span class=\"number\">255</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span>,cnt <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span>);</span><br><span class=\"line\">Query OK, <span class=\"number\">0</span> <span class=\"keyword\">rows</span> affected (<span class=\"number\">0.05</span> sec)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">desc</span> test.uid_cnt;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+--------------+------+-----+---------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> Field <span class=\"operator\">|</span> Type         <span class=\"operator\">|</span> <span class=\"keyword\">Null</span> <span class=\"operator\">|</span> Key <span class=\"operator\">|</span> <span class=\"keyword\">Default</span> <span class=\"operator\">|</span> Extra <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+--------------+------+-----+---------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> uid   <span class=\"operator\">|</span> <span class=\"type\">varchar</span>(<span class=\"number\">255</span>) <span class=\"operator\">|</span> YES  <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> cnt   <span class=\"operator\">|</span> <span class=\"type\">int</span>(<span class=\"number\">11</span>)      <span class=\"operator\">|</span> YES  <span class=\"operator\">|</span>     <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span>       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+--------------+------+-----+---------+-------+</span></span><br><span class=\"line\"><span class=\"number\">2</span> <span class=\"keyword\">rows</span> <span class=\"keyword\">in</span> <span class=\"keyword\">set</span> (<span class=\"number\">0.15</span> sec)</span><br></pre></td></tr></table></figure>\n<p><strong>构建 Hive 数据仓库中的表</strong></p>\n<ol>\n<li>进入 Hive</li>\n<li>创建 Hive 中的表 sogou.sogou_uid_cnt</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> sogou.sogou_uid_cnt(uid string,cnt <span class=\"type\">int</span>) <span class=\"type\">row</span> format delimited fields terminated <span class=\"keyword\">by</span> <span class=\"string\">&#x27;\\t&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>向表中写入数据</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> <span class=\"keyword\">table</span> sogou.sogou_uid_cnt <span class=\"keyword\">select</span> uid,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> sogou_500w <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> uid;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> sogou.sogou_uid_cnt limit <span class=\"number\">10</span>;</span><br></pre></td></tr></table></figure>\n<p><strong>使用 Sqoop 工具将 Hive 的数据导入 MySQL</strong></p>\n<ol>\n<li>导入命令</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\">/</span>usr<span class=\"operator\">/</span><span class=\"keyword\">local</span><span class=\"operator\">/</span>sqoop<span class=\"operator\">/</span>bin<span class=\"operator\">/</span>sqoop export <span class=\"comment\">--connect jdbc:mysql://master:3306/test --username root --password 123456 --table uid_cnt --export-dir &#x27;hdfs://master:9000/user/hive/warehouse/sogou.db/sogou_uid_cnt&#x27; --fields-terminated-by &#x27;\\t&#x27;</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>\n<p>以上命令的解释如下<br>\n sqoop export 表示数据从 Hive 复制到 MySQL 数据库中；–connect jdbc:mysql://master:3306/test 表示连接 MySQL 数据库 test；–username root 表示连接 MySQL 数据库的用户名；–password 12345 表示连接 MySQL 数据库的密码；–table uid_cnt 表示 MySQL 中的表即将被导入的表名称；–export-dir '/user/hive/warehouse/sogou.db/uid_cnt’表示 Hive 中被导出的文件路径；–fields-terminated-by '\\t’表示 Hive 中被导出的文件字段的分隔符。</p>\n</li>\n<li>\n<p>以上命令成功运行之后会在控制台打印输出如下结果</p>\n</li>\n<li>\n<p>最后，验证结果数据。<br>\n登录 MySQL 数据库，查询库 test 的表 uid_cnt 中是已经有了数据，如果有数据说明 Sqoop 工具将 Hive 中的数据成功导入了 MySQL。</p>\n</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> test.uid_cnt limit <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> test.uid_cnt;</span><br></pre></td></tr></table></figure>\n<p><strong>使用 Sqoop 工具将 MySQL 中的数据导入 Hive 表</strong><br>\n前面我们成功地将 Hive 表 sogou_uid_cnt 中的数据导入 MySQL 数据库的 uid_cnt 表，反之，我们再利用 Sqoop 工具将表 uid_cnt 中的数据导入表 sogou_uid_cnt2 中</p>\n<ol>\n<li>首先，在 Hive 中创建表 sogou_uid_cnt2</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> sogou.sogou_uid_cnt2(uid string,cnt <span class=\"type\">int</span>) <span class=\"type\">row</span> format delimited fields terminated <span class=\"keyword\">by</span> <span class=\"string\">&#x27;\\t&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">describe</span> sogou.sogou_uid_cnt2;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>然后，我们就可以使用 Sqoop 工具将 MySQL 中表 uid_cnt 的数据导入 Hive 的表 sogou_uid_cnt<br>\n 在导入数据之前，/user/hive/warehouse/sogou.db/sogou_uid_cnt2 已经存在，我们将其删除。</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hdfs dfs -rmdir /user/hive/warehouse/sogou.db/sogou_uid_cnt2</span><br><span class=\"line\"></span><br><span class=\"line\">/usr/local/sqoop/bin/sqoop import --connect jdbc:mysql://master:3306/test --username root --password 123456 --table uid_cnt --target-dir /user/hive/warehouse/sogou.db/sogou_uid_cnt2 --fields-terminated-by &#x27;\\t&#x27; -m 1</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>进入 Hive 进行验证</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> sogou.sogou_uid_cnt2 limit <span class=\"number\">10</span>;</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "大数据"
            ]
        },
        {
            "id": "http://example.com/2021/12/04/Hive%E5%AD%A6%E4%B9%A0/Hive9/",
            "url": "http://example.com/2021/12/04/Hive%E5%AD%A6%E4%B9%A0/Hive9/",
            "title": "(Hive)汽车销售数据分析系统实战开发",
            "date_published": "2021-12-04T09:47:09.000Z",
            "content_html": "<p>本章围绕乘用车辆和商用车辆销售数据展开，通过 Hive 构建数据仓库，实现对汽车销售数据各项指标进行立体化分析。</p>\n<h2 id=\"数据概况\"><a class=\"markdownIt-Anchor\" href=\"#数据概况\">#</a> 数据概况</h2>\n<p>项目的数据来源于一个真实项目，数据项包括<br>\n “省，月，市，区县，年，车辆型号，制造商，品牌，车辆类型，所有权，使用性质，数量，发动机型号，排量，功率，燃料种类，车长，车宽，车高，厢长，厢宽，厢高，轴数，轴距，前轮距，轮胎规格，轮胎数，总质量，整备质量，核定载质量，核定载客，准牵引质量，底盘企业，底盘品牌，底盘型号，发动机企业，车辆名称，年龄，性别”。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">山西省,3,朔州市,朔城区,2013,LZW6450PF,上汽通用五菱汽车股份有限公司,五菱,小型普通客车,个人,非营运,1,L3C,8424,79,汽油,4490,1615,1900,10,45,26,2,3050,1386,175/70R14LT,4,2110,1275,,7,,,,,上汽通用五菱汽车股份有限公司,客车,1913,男性</span><br></pre></td></tr></table></figure>\n<h2 id=\"项目实战\"><a class=\"markdownIt-Anchor\" href=\"#项目实战\">#</a> 项目实战</h2>\n<p>本节内容包括构建数据仓库、创建原始数据表、加载数据到数据仓库、验证数据结果以及具体的项目需求、设计思路、HiveSQL 设计以及 HiveSQL 运行结果等内容。</p>\n<h3 id=\"构建数据仓库\"><a class=\"markdownIt-Anchor\" href=\"#构建数据仓库\">#</a> 构建数据仓库</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hive (<span class=\"keyword\">default</span>)<span class=\"operator\">&gt;</span> <span class=\"keyword\">create</span> database if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> cars;</span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"type\">Time</span> taken: <span class=\"number\">7.501</span> seconds</span><br><span class=\"line\"></span><br><span class=\"line\">hive (<span class=\"keyword\">default</span>)<span class=\"operator\">&gt;</span> use cars;</span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"type\">Time</span> taken: <span class=\"number\">0.082</span> seconds</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"创建原始数据表\"><a class=\"markdownIt-Anchor\" href=\"#创建原始数据表\">#</a> 创建原始数据表</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hive (cars)<span class=\"operator\">&gt;</span> <span class=\"keyword\">create</span> <span class=\"keyword\">external</span> <span class=\"keyword\">table</span> car_2019712(province string comment <span class=\"string\">&#x27;省&#x27;</span>, <span class=\"keyword\">month</span> <span class=\"type\">int</span> commet <span class=\"string\">&#x27;月&#x27;</span>, city string comment <span class=\"string\">&#x27;市&#x27;</span>, district string comment <span class=\"string\">&#x27;区县&#x27;</span>, <span class=\"keyword\">year</span> <span class=\"type\">int</span> comment <span class=\"string\">&#x27;年&#x27;</span>, modring comment <span class=\"string\">&#x27;车辆型号&#x27;</span>, manufacturer string comment <span class=\"string\">&#x27;制造商&#x27;</span>, brand string comment <span class=\"string\">&#x27;品牌&#x27;</span>, pe string comment <span class=\"string\">&#x27;车辆类型&#x27;</span>, ownership string comment <span class=\"string\">&#x27;所有权&#x27;</span>,nature string comment <span class=\"string\">&#x27;使用ity int comment &#x27;</span>数量<span class=\"string\">&#x27;, enginemodel string comment &#x27;</span>发动</span><br><span class=\"line\">           <span class=\"operator\">&gt;</span> 机型号<span class=\"string\">&#x27;, displacement int comment &#x27;</span>排量<span class=\"string\">&#x27;, power int comment &#x27;</span>功率<span class=\"string\">&#x27;, fuel stringt &#x27;</span>燃料种类<span class=\"string\">&#x27;, length1 int comment &#x27;</span>车长<span class=\"string\">&#x27;, width1 int comment &#x27;</span>车宽<span class=\"string\">&#x27;, height1 int comment &#x27;</span>车h2 <span class=\"type\">int</span> comment <span class=\"string\">&#x27;厢长&#x27;</span>, width2 <span class=\"type\">int</span> comment <span class=\"string\">&#x27;厢宽&#x27;</span>, height2 <span class=\"type\">int</span> comment <span class=\"string\">&#x27;厢高&#x27;</span>, numberofaxles mment <span class=\"string\">&#x27;轴数&#x27;</span>, wheelbase <span class=\"type\">int</span> comment <span class=\"string\">&#x27;轴距&#x27;</span>, frontwheelbase <span class=\"type\">int</span> comment <span class=\"string\">&#x27;前轮距&#x27;</span>, tirespecifistring comment <span class=\"string\">&#x27;轮胎规格&#x27;</span>, tirenumber <span class=\"type\">int</span> comment <span class=\"string\">&#x27;轮胎数&#x27;</span>, totalquality <span class=\"type\">int</span> comment <span class=\"string\">&#x27;总质量equality int comment &#x27;</span>整备质量<span class=\"string\">&#x27;, approvedquality int comment &#x27;</span>核定载质量<span class=\"string\">&#x27;, approvedpassengeromment &#x27;</span>核定载客<span class=\"string\">&#x27;, tractionquality int comment &#x27;</span>准牵引质量<span class=\"string\">&#x27;, chassisenterprise string commen chassisbrand string comment &#x27;</span>底盘品牌<span class=\"string\">&#x27;, chassismodel string comment &#x27;</span>底盘型号<span class=\"string\">&#x27;, engineenterring comment &#x27;</span>发动机企业<span class=\"string\">&#x27;, vehiclename string comment &#x27;</span>车辆名称<span class=\"string\">&#x27;, age int comment &#x27;</span>年龄<span class=\"string\">&#x27;, ge comment &#x27;</span>性别<span class=\"string\">&#x27;) comment &#x27;</span>this <span class=\"keyword\">is</span> the raw data<span class=\"string\">&#x27; row format delimited fields terminated by &#x27;</span>,location <span class=\"string\">&#x27;/cars&#x27;</span>;</span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"type\">Time</span> taken: <span class=\"number\">0.766</span> seconds</span><br><span class=\"line\"></span><br><span class=\"line\">hive (cars)<span class=\"operator\">&gt;</span> <span class=\"keyword\">desc</span> car_2019712;</span><br><span class=\"line\">OK</span><br><span class=\"line\">col_name\tdata_type\tcomment</span><br><span class=\"line\">province            \tstring              \t?                   </span><br><span class=\"line\"><span class=\"keyword\">month</span>               \t<span class=\"type\">int</span>                 \t?                   </span><br><span class=\"line\">city                \tstring              \t?                   </span><br><span class=\"line\">district            \tstring              \t??                  </span><br><span class=\"line\"><span class=\"keyword\">year</span>                \t<span class=\"type\">int</span>                 \t?   </span><br><span class=\"line\">···</span><br></pre></td></tr></table></figure>\n<h3 id=\"加载数据到数据仓库\"><a class=\"markdownIt-Anchor\" href=\"#加载数据到数据仓库\">#</a> 加载数据到数据仓库</h3>\n<ol>\n<li>在 HDFS 上创建存放数据的目录 /cars，如果 /cars 已存在，则无需创建</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@master ~]# hadoop fs -ls /</span><br><span class=\"line\">Found 6 items</span><br><span class=\"line\">drwxr-xr-x   - root   supergroup          0 2021-12-04 17:54 /cars</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>将数据文档 cars.csv 利用 Xshell 上传到 master 的 /root 中</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@master ~]# ll</span><br><span class=\"line\">总用量 171488</span><br><span class=\"line\">-rw-r--r--. 1 root root  20702466 12月  4 18:02 cars.csv</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>用 Hadoop 命令行方式将数据加载到 Hive 数据仓库监控的目录中</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@master ~]# hadoop fs -put /root/cars.csv /cars</span><br></pre></td></tr></table></figure>\n<h3 id=\"验证数据结果\"><a class=\"markdownIt-Anchor\" href=\"#验证数据结果\">#</a> 验证数据结果</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hive (cars)<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> cars.car_2019712 limit <span class=\"number\">3</span>;</span><br><span class=\"line\">OK</span><br><span class=\"line\">car_2019712.province\tcar_2019712.month\tcar_2019712.city\tcar_2019712.districcar_2019712.year\tcar_2019712.model\tcar_2019712.manufacturer\tcar_2019712.brand  car_2019712.vehicletype\tcar_2019712.ownership\tcar_2019712.nature\tcar_2019712.quantitcar_2019712.enginemodel\tcar_2019712.displacement\tcar_2019712.power\tcar_2019712.fuel\tcar_2019712.length1\tcar_2019712.width1\tcar_2019712.height1\tcar_2019712.length2\tcar_2019712.width2\tcar_2019712.height2\tcar_2019712.numberofaxles\tcar_2019712.wheelbase\tcar_2019712.frontwheelbase\tcar_2019712.tirespecification\tcar_2019712.tirenumber\tcar_2019712.totalquality\tcar_2019712.completequality\tcar_2019712.approvedquality\tcar_2019712.approvedpassenger\tcar_2019712.tractionquality\tcar_2019712.chassisenterprise\tcar_2019712.chassisbrand\tcar_2019712.chassismodel   car_2019712.engineenterprise\tcar_2019712.vehiclename\tcar_2019712.age\tcar_2019712.gender</span><br><span class=\"line\">山西省\t<span class=\"number\">3</span>\t朔州市\t朔城区\t<span class=\"number\">2013</span>\tLZW6450PF\t上汽通用五菱汽车股份有限公司\t五菱小型普通客车\t个人\t非营运\t<span class=\"number\">1</span>\tL3C\t<span class=\"number\">8424</span>\t<span class=\"number\">79</span>\t汽油\t<span class=\"number\">4490</span>\t<span class=\"number\">1615</span>\t<span class=\"number\">19010</span>\t<span class=\"number\">45</span>\t<span class=\"number\">26</span>\t<span class=\"number\">2</span>\t<span class=\"number\">3050</span>\t<span class=\"number\">1386</span>\t<span class=\"number\">175</span><span class=\"operator\">/</span><span class=\"number\">70</span>R14LT\t<span class=\"number\">4</span>\t<span class=\"number\">2110</span>\t<span class=\"number\">1275</span>\tNULNULL\t\t\t\t上汽通用五菱汽车股份有限公司\t客车\t<span class=\"number\">1913</span>\t男性</span><br><span class=\"line\">山西省\t<span class=\"number\">3</span>\t晋城市\t城区\t<span class=\"number\">2013</span>\tEQ6450PF1\t东风小康汽车有限公司\t东风\t小型普通客车\t个人\t非营运\t<span class=\"number\">1</span>\tDK13<span class=\"number\">-06</span>\t<span class=\"number\">1587</span>\t<span class=\"number\">74</span>\t汽油\t<span class=\"number\">4500</span>\t<span class=\"number\">1680</span>\t<span class=\"number\">19610</span>\t<span class=\"number\">45</span>\t<span class=\"number\">26</span>\t<span class=\"number\">2</span>\t<span class=\"number\">3050</span>\t<span class=\"number\">1435</span>\t<span class=\"number\">185</span>R14LT <span class=\"number\">6</span>PR\t<span class=\"number\">4</span>\t<span class=\"number\">1970</span>\t<span class=\"number\">1290</span>\tNULNULL\t东风小康汽车有限公司\t\tEQ6440KMF\t重庆渝安淮海动力有限公司\t客<span class=\"number\">.1929</span>\t男性</span><br><span class=\"line\">山西省\t<span class=\"number\">12</span>\t长治市\t长治城区\t<span class=\"number\">2013</span>\tBJ6440BKV1A\t北汽银翔汽车有限公司\t北京小型普通客车\t个人\t非营运\t<span class=\"number\">1</span>\tBJ415A\t<span class=\"number\">1500</span>\t<span class=\"number\">75</span>\t\t<span class=\"number\">4440</span>\t<span class=\"keyword\">NULL</span>\tNUL10\t<span class=\"number\">45</span>\t<span class=\"number\">26</span>\t<span class=\"keyword\">NULL</span>\t<span class=\"keyword\">NULL</span>\t<span class=\"keyword\">NULL</span>\t\t<span class=\"keyword\">NULL</span>\t<span class=\"keyword\">NULL</span>\t<span class=\"keyword\">NULL</span>\t<span class=\"keyword\">NULL</span>\t   <span class=\"keyword\">NULL</span>\t北汽银翔汽车有限公司\t北京\tBJ6440BKV1A\t北汽银翔汽车有限公司\t\t<span class=\"number\">1938</span>男性</span><br><span class=\"line\"><span class=\"type\">Time</span> taken: <span class=\"number\">2.895</span> seconds, Fetched: <span class=\"number\">3</span> <span class=\"type\">row</span>(s)</span><br></pre></td></tr></table></figure>\n<h3 id=\"统计乘用车辆和商用车辆的销售数量和销售数量占比\"><a class=\"markdownIt-Anchor\" href=\"#统计乘用车辆和商用车辆的销售数量和销售数量占比\">#</a> 统计乘用车辆和商用车辆的销售数量和销售数量占比</h3>\n<ol>\n<li>根据字段 “nature” 即 “使用性质” 来分组统计乘用车辆和商用车辆的总数量，乘用车辆的使用性质为 “非营运”，商用车辆的使用性质为 “营运”</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hive (cars)<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"string\">&#x27;非营运&#x27;</span>, <span class=\"built_in\">sum</span>(if(a.nature<span class=\"operator\">=</span><span class=\"string\">&#x27;非营运&#x27;</span>,a.cnt,<span class=\"number\">0</span>)),<span class=\"string\">&#x27;营运&#x27;</span>,<span class=\"built_in\">sum</span>(if(a.nature<span class=\"operator\">!=</span><span class=\"string\">&#x27;非t,0)) from (select nature, count(*) as cnt from cars.car_2019712 group by nature having nature is not null and nature!=&#x27;&#x27;) a;</span></span><br><span class=\"line\"><span class=\"string\">Job running in-process (local Hadoop)</span></span><br><span class=\"line\"><span class=\"string\">2021-12-04 18:06:17,810 Stage-1 map = 100%,  reduce = 0%</span></span><br><span class=\"line\"><span class=\"string\">2021-12-04 18:06:18,832 Stage-1 map = 100%,  reduce = 100%</span></span><br><span class=\"line\"><span class=\"string\">Ended Job = job_local1330125293_0001</span></span><br><span class=\"line\"><span class=\"string\">OK</span></span><br><span class=\"line\"><span class=\"string\">_c0\t_c1\t_c2\t_c3</span></span><br><span class=\"line\"><span class=\"string\">非营运\t66478\t营运\t3884</span></span><br><span class=\"line\"><span class=\"string\">Time taken: 6.564 seconds, Fetched: 1 row(s)</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>统计出汽车销售总数量</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hive (cars)<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> cars.car_2019712;</span><br><span class=\"line\">Job <span class=\"keyword\">running</span> <span class=\"keyword\">in</span><span class=\"operator\">-</span>process (<span class=\"keyword\">local</span> Hadoop)</span><br><span class=\"line\"><span class=\"number\">2021</span><span class=\"number\">-12</span><span class=\"number\">-04</span> <span class=\"number\">18</span>:<span class=\"number\">07</span>:<span class=\"number\">45</span>,<span class=\"number\">241</span> Stage<span class=\"number\">-1</span> map <span class=\"operator\">=</span> <span class=\"number\">100</span><span class=\"operator\">%</span>,  reduce <span class=\"operator\">=</span> <span class=\"number\">100</span><span class=\"operator\">%</span></span><br><span class=\"line\">Ended Job <span class=\"operator\">=</span> job_local445756713_0003</span><br><span class=\"line\">OK</span><br><span class=\"line\">_c0</span><br><span class=\"line\"><span class=\"number\">70640</span></span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>计算乘用车辆的销售数量占比<br>\n（66478/70640)*100%=94.1%</li>\n<li>计算商用车辆的销售数量占比<br>\n（3884/70640)*100%=5.5%<br>\n 还有 0.4% 属于其他类型的车辆</li>\n</ol>\n<h3 id=\"统计山西省2013年每个月的汽车销售数量的比例\"><a class=\"markdownIt-Anchor\" href=\"#统计山西省2013年每个月的汽车销售数量的比例\">#</a> 统计山西省 2013 年每个月的汽车销售数量的比例</h3>\n<p>分别统计出山西省 2013 年每个月的汽车销售数量和山西省 2013 年年度汽车销售总数量，再用 2013 年每个月的汽车销售数量除以年度汽车销售总数量。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hive (cars)<span class=\"operator\">&gt;</span> <span class=\"keyword\">set</span> hive.strict.checks.cartesian.product<span class=\"operator\">=</span><span class=\"literal\">false</span>;</span><br><span class=\"line\">hive (cars)<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"keyword\">month</span>,c1.ss<span class=\"operator\">/</span>c2.sumshu <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> <span class=\"keyword\">month</span>, <span class=\"built_in\">sum</span>(quantity) <span class=\"keyword\">as</span> ss <span class=\"keyword\">from</span> cars.car_2019712 <span class=\"keyword\">where</span> province<span class=\"operator\">=</span><span class=\"string\">&#x27;山西省&#x27;</span> <span class=\"keyword\">and</span> <span class=\"keyword\">year</span><span class=\"operator\">=</span><span class=\"string\">&#x27;2013&#x27;</span> <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> <span class=\"keyword\">month</span>) c1, (<span class=\"keyword\">select</span> <span class=\"built_in\">sum</span>(quantity) <span class=\"keyword\">as</span> sumshu <span class=\"keyword\">from</span> cars.car_2019712 <span class=\"keyword\">where</span> province<span class=\"operator\">=</span><span class=\"string\">&#x27;山西省&#x27;</span> <span class=\"keyword\">and</span> <span class=\"keyword\">year</span><span class=\"operator\">=</span><span class=\"string\">&#x27;2013&#x27;</span>) c2;</span><br><span class=\"line\">MapReduce Jobs Launched: </span><br><span class=\"line\">Stage<span class=\"operator\">-</span>Stage<span class=\"number\">-1</span>:  HDFS Read: <span class=\"number\">124235252</span> HDFS Write: <span class=\"number\">12420</span> SUCCESS</span><br><span class=\"line\">Stage<span class=\"operator\">-</span>Stage<span class=\"number\">-3</span>:  HDFS Read: <span class=\"number\">165660827</span> HDFS Write: <span class=\"number\">39149</span> SUCCESS</span><br><span class=\"line\">Stage<span class=\"operator\">-</span>Stage<span class=\"number\">-4</span>:  HDFS Read: <span class=\"number\">82838654</span> HDFS Write: <span class=\"number\">25114</span> SUCCESS</span><br><span class=\"line\">Total MapReduce CPU <span class=\"type\">Time</span> Spent: <span class=\"number\">0</span> msec</span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"keyword\">month</span>\t_c1</span><br><span class=\"line\"><span class=\"number\">1</span>\t<span class=\"number\">0.14799181376311077</span></span><br><span class=\"line\"><span class=\"number\">2</span>\t<span class=\"number\">0.05831272561894204</span></span><br><span class=\"line\"><span class=\"number\">3</span>\t<span class=\"number\">0.09306159574770473</span></span><br><span class=\"line\"><span class=\"number\">4</span>\t<span class=\"number\">0.06587362496802251</span></span><br><span class=\"line\"><span class=\"number\">5</span>\t<span class=\"number\">0.0732071288479577</span></span><br><span class=\"line\"><span class=\"number\">6</span>\t<span class=\"number\">0.05547028225462608</span></span><br><span class=\"line\"><span class=\"number\">7</span>\t<span class=\"number\">0.06323015263920867</span></span><br><span class=\"line\"><span class=\"number\">8</span>\t<span class=\"number\">0.06378442909525028</span></span><br><span class=\"line\"><span class=\"number\">9</span>\t<span class=\"number\">0.06948352804070379</span></span><br><span class=\"line\"><span class=\"number\">10</span>\t<span class=\"number\">0.1044882180722549</span></span><br><span class=\"line\"><span class=\"number\">11</span>\t<span class=\"number\">0.10053722179585571</span></span><br><span class=\"line\"><span class=\"number\">12</span>\t<span class=\"number\">0.1045592791563628</span></span><br><span class=\"line\"><span class=\"type\">Time</span> taken: <span class=\"number\">24.092</span> seconds, Fetched: <span class=\"number\">12</span> <span class=\"type\">row</span>(s)</span><br></pre></td></tr></table></figure>\n<h3 id=\"统计买车的男女比例及男女对车的品牌的选择\"><a class=\"markdownIt-Anchor\" href=\"#统计买车的男女比例及男女对车的品牌的选择\">#</a> 统计买车的男女比例及男女对车的品牌的选择</h3>\n<p>分别统计出买车的男性人数、女性人数和总人数，再分别用男性人数和女性人数除以购车总人数。</p>\n<ol>\n<li>统计买车的男性占比和女性占比</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hive (cars)<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"string\">&#x27;男性&#x27;</span>, a.nan<span class=\"operator\">*</span><span class=\"number\">1.0</span><span class=\"operator\">/</span>(a.nan<span class=\"operator\">+</span>a.nv),<span class=\"string\">&#x27;女性&#x27;</span>, a.nv<span class=\"operator\">*</span><span class=\"number\">1.0</span><span class=\"operator\">/</span>(a.nan<span class=\"operator\">+</span>a.nv) <span class=\"keyword\">from</span> (selec性<span class=\"string\">&#x27;, sum(if(b.gender=&#x27;</span>男性<span class=\"string\">&#x27;,b.cnt,0)) as nan, &#x27;</span>女性<span class=\"string\">&#x27;, sum(if(b.gender=&#x27;</span>女性<span class=\"string\">&#x27;,b.cnt,0)) as nvselect gender, count(*) as cnt from cars.car_2019712 group by gender having gender is not null and gender!= &#x27;&#x27;) b)a;</span></span><br><span class=\"line\"><span class=\"string\">MapReduce Jobs Launched: </span></span><br><span class=\"line\"><span class=\"string\">Stage-Stage-1:  HDFS Read: 207083230 HDFS Write: 50347 SUCCESS</span></span><br><span class=\"line\"><span class=\"string\">Stage-Stage-2:  HDFS Read: 207092711 HDFS Write: 64901 SUCCESS</span></span><br><span class=\"line\"><span class=\"string\">Total MapReduce CPU Time Spent: 0 msec</span></span><br><span class=\"line\"><span class=\"string\">OK</span></span><br><span class=\"line\"><span class=\"string\">_c0\t_c1\t_c2\t_c3</span></span><br><span class=\"line\"><span class=\"string\">男性\t0.70106593239522273\t女性\t0.29893406760477727</span></span><br><span class=\"line\"><span class=\"string\">Time taken: 4.188 seconds, Fetched: 1 row(s)</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>分析男性和女性对车的品牌的选择情况</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hive (cars)<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> gender,brand,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> cars.car_2019712 <span class=\"keyword\">where</span> gender <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> <span class=\"keyword\">and</span> gender<span class=\"operator\">!=</span><span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">and</span> age <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> gender,brand <span class=\"keyword\">having</span> brand <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> <span class=\"keyword\">and</span> brand<span class=\"operator\">!=</span><span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">MapReduce Jobs Launched: </span><br><span class=\"line\">Stage<span class=\"operator\">-</span>Stage<span class=\"number\">-1</span>:  HDFS Read: <span class=\"number\">248503192</span> HDFS Write: <span class=\"number\">68889</span> SUCCESS</span><br><span class=\"line\">Total MapReduce CPU <span class=\"type\">Time</span> Spent: <span class=\"number\">0</span> msec</span><br><span class=\"line\">OK</span><br><span class=\"line\">gender\tbrand\t_c2</span><br><span class=\"line\">女性\t一汽佳星\t<span class=\"number\">1</span></span><br><span class=\"line\">男性\t一汽佳星\t<span class=\"number\">2</span></span><br><span class=\"line\">女性\t东南\t<span class=\"number\">1</span></span><br><span class=\"line\">男性\t东南\t<span class=\"number\">12</span></span><br><span class=\"line\">女性\t东风\t<span class=\"number\">1367</span></span><br><span class=\"line\">男性\t东风\t<span class=\"number\">3214</span></span><br><span class=\"line\">女性\t中誉\t<span class=\"number\">4</span></span><br><span class=\"line\">男性\t中誉\t<span class=\"number\">2</span></span><br><span class=\"line\">男性\t中通\t<span class=\"number\">1</span></span><br><span class=\"line\">女性\t五菱\t<span class=\"number\">12004</span></span><br><span class=\"line\">男性\t五菱\t<span class=\"number\">28208</span></span><br><span class=\"line\">女性\t五菱宏光\t<span class=\"number\">1057</span></span><br><span class=\"line\">男性\t五菱宏光\t<span class=\"number\">2331</span></span><br><span class=\"line\">女性\t众泰\t<span class=\"number\">2</span></span><br><span class=\"line\">男性\t众泰\t<span class=\"number\">6</span></span><br><span class=\"line\">女性\t依维柯\t<span class=\"number\">32</span></span><br><span class=\"line\">男性\t依维柯\t<span class=\"number\">64</span></span><br><span class=\"line\">女性\t俊风\t<span class=\"number\">1</span></span><br><span class=\"line\">男性\t俊风\t<span class=\"number\">4</span></span><br><span class=\"line\">女性\t力帆\t<span class=\"number\">27</span></span><br><span class=\"line\">男性\t力帆\t<span class=\"number\">84</span></span><br><span class=\"line\">女性\t北京\t<span class=\"number\">741</span></span><br><span class=\"line\">男性\t北京\t<span class=\"number\">1836</span></span><br><span class=\"line\">男性\t合客\t<span class=\"number\">2</span></span><br><span class=\"line\">女性\t吉奥\t<span class=\"number\">12</span></span><br><span class=\"line\">男性\t吉奥\t<span class=\"number\">30</span></span><br><span class=\"line\">男性\t同心\t<span class=\"number\">1</span></span><br><span class=\"line\">女性\t哈飞\t<span class=\"number\">4</span></span><br><span class=\"line\">男性\t哈飞\t<span class=\"number\">7</span></span><br><span class=\"line\">女性\t大通\t<span class=\"number\">7</span></span><br><span class=\"line\">男性\t大通\t<span class=\"number\">31</span></span><br><span class=\"line\">女性\t大马\t<span class=\"number\">3</span></span><br><span class=\"line\">男性\t大马\t<span class=\"number\">7</span></span><br><span class=\"line\">女性\t奥路卡\t<span class=\"number\">125</span></span><br><span class=\"line\">男性\t奥路卡\t<span class=\"number\">277</span></span><br><span class=\"line\">女性\t宇通\t<span class=\"number\">6</span></span><br><span class=\"line\">男性\t宇通\t<span class=\"number\">7</span></span><br><span class=\"line\">女性\t少林\t<span class=\"number\">28</span></span><br><span class=\"line\">男性\t少林\t<span class=\"number\">72</span></span><br><span class=\"line\">女性\t尼桑\t<span class=\"number\">2</span></span><br><span class=\"line\">男性\t尼桑\t<span class=\"number\">2</span></span><br><span class=\"line\">女性\t开瑞\t<span class=\"number\">89</span></span><br><span class=\"line\">男性\t开瑞\t<span class=\"number\">231</span></span><br><span class=\"line\">女性\t恒通客车\t<span class=\"number\">2</span></span><br><span class=\"line\">男性\t恒通客车\t<span class=\"number\">2</span></span><br><span class=\"line\">女性\t昌河\t<span class=\"number\">20</span></span><br><span class=\"line\">男性\t昌河\t<span class=\"number\">75</span></span><br><span class=\"line\">女性\t昌河铃木\t<span class=\"number\">3</span></span><br><span class=\"line\">男性\t昌河铃木\t<span class=\"number\">1</span></span><br><span class=\"line\">女性\t松花江\t<span class=\"number\">25</span></span><br><span class=\"line\">男性\t松花江\t<span class=\"number\">86</span></span><br><span class=\"line\">男性\t柯斯达\t<span class=\"number\">6</span></span><br><span class=\"line\">男性\t梅赛德斯<span class=\"operator\">-</span>奔驰\t<span class=\"number\">1</span></span><br><span class=\"line\">女性\t欧诺\t<span class=\"number\">121</span></span><br><span class=\"line\">男性\t欧诺\t<span class=\"number\">239</span></span><br><span class=\"line\">男性\t汇众\t<span class=\"number\">3</span></span><br><span class=\"line\">女性\t江淮\t<span class=\"number\">7</span></span><br><span class=\"line\">男性\t江淮\t<span class=\"number\">13</span></span><br><span class=\"line\">女性\t江铃全顺\t<span class=\"number\">84</span></span><br><span class=\"line\">男性\t江铃全顺\t<span class=\"number\">200</span></span><br><span class=\"line\">女性\t海格\t<span class=\"number\">1</span></span><br><span class=\"line\">男性\t海格\t<span class=\"number\">1</span></span><br><span class=\"line\">女性\t神剑\t<span class=\"number\">6</span></span><br><span class=\"line\">男性\t神剑\t<span class=\"number\">16</span></span><br><span class=\"line\">女性\t福田\t<span class=\"number\">17</span></span><br><span class=\"line\">男性\t福田\t<span class=\"number\">49</span></span><br><span class=\"line\">女性\t航天\t<span class=\"number\">31</span></span><br><span class=\"line\">男性\t航天\t<span class=\"number\">93</span></span><br><span class=\"line\">女性\t解放\t<span class=\"number\">96</span></span><br><span class=\"line\">男性\t解放\t<span class=\"number\">242</span></span><br><span class=\"line\">女性\t通家福\t<span class=\"number\">5</span></span><br><span class=\"line\">男性\t通家福\t<span class=\"number\">19</span></span><br><span class=\"line\">女性\t野马\t<span class=\"number\">8</span></span><br><span class=\"line\">男性\t野马\t<span class=\"number\">20</span></span><br><span class=\"line\">女性\t金旅\t<span class=\"number\">7</span></span><br><span class=\"line\">男性\t金旅\t<span class=\"number\">6</span></span><br><span class=\"line\">女性\t金杯\t<span class=\"number\">102</span></span><br><span class=\"line\">男性\t金杯\t<span class=\"number\">265</span></span><br><span class=\"line\">女性\t金龙\t<span class=\"number\">16</span></span><br><span class=\"line\">男性\t金龙\t<span class=\"number\">26</span></span><br><span class=\"line\">女性\t长城\t<span class=\"number\">2</span></span><br><span class=\"line\">男性\t长城\t<span class=\"number\">18</span></span><br><span class=\"line\">女性\t长安\t<span class=\"number\">1628</span></span><br><span class=\"line\">男性\t长安\t<span class=\"number\">3679</span></span><br><span class=\"line\">男性\t飞碟\t<span class=\"number\">3</span></span><br><span class=\"line\">男性\t黄海\t<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"type\">Time</span> taken: <span class=\"number\">3.112</span> seconds, Fetched: <span class=\"number\">86</span> <span class=\"type\">row</span>(s)</span><br></pre></td></tr></table></figure>\n<h3 id=\"统计车的所有权-车辆型号和车辆类型\"><a class=\"markdownIt-Anchor\" href=\"#统计车的所有权-车辆型号和车辆类型\">#</a> 统计车的所有权、车辆型号和车辆类型</h3>\n<ol>\n<li>统计买车的所有权</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hive (cars)<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> ownership,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">as</span> cnt <span class=\"keyword\">from</span> cars.car_2019712 <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> ownership <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> cnt <span class=\"keyword\">desc</span>;</span><br><span class=\"line\">MapReduce Jobs Launched: </span><br><span class=\"line\">Stage<span class=\"operator\">-</span>Stage<span class=\"number\">-1</span>:  HDFS Read: <span class=\"number\">289915770</span> HDFS Write: <span class=\"number\">72901</span> SUCCESS</span><br><span class=\"line\">Stage<span class=\"operator\">-</span>Stage<span class=\"number\">-2</span>:  HDFS Read: <span class=\"number\">289923419</span> HDFS Write: <span class=\"number\">83320</span> SUCCESS</span><br><span class=\"line\">Total MapReduce CPU <span class=\"type\">Time</span> Spent: <span class=\"number\">0</span> msec</span><br><span class=\"line\">OK</span><br><span class=\"line\">ownership\tcnt</span><br><span class=\"line\">个人\t<span class=\"number\">60745</span></span><br><span class=\"line\">单位\t<span class=\"number\">9617</span></span><br><span class=\"line\"><span class=\"keyword\">NULL</span>\t<span class=\"number\">273</span></span><br><span class=\"line\">\t<span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"type\">Time</span> taken: <span class=\"number\">4.611</span> seconds, Fetched: <span class=\"number\">4</span> <span class=\"type\">row</span>(s)</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>统计车辆型号</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hive (cars)<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> model,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">as</span> cnt <span class=\"keyword\">from</span> cars.car_2019712 <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> model <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> cnt <span class=\"keyword\">desc</span> limit <span class=\"number\">10</span>;</span><br><span class=\"line\">MapReduce Jobs Launched: </span><br><span class=\"line\">Stage<span class=\"operator\">-</span>Stage<span class=\"number\">-1</span>:  HDFS Read: <span class=\"number\">331331684</span> HDFS Write: <span class=\"number\">114251</span> SUCCESS</span><br><span class=\"line\">Stage<span class=\"operator\">-</span>Stage<span class=\"number\">-2</span>:  HDFS Read: <span class=\"number\">331400570</span> HDFS Write: <span class=\"number\">155657</span> SUCCESS</span><br><span class=\"line\">Total MapReduce CPU <span class=\"type\">Time</span> Spent: <span class=\"number\">0</span> msec</span><br><span class=\"line\">OK</span><br><span class=\"line\">model\tcnt</span><br><span class=\"line\">LZW6376NF\t<span class=\"number\">13727</span></span><br><span class=\"line\">LZW6407BAF\t<span class=\"number\">6357</span></span><br><span class=\"line\">LZW6390QF\t<span class=\"number\">5967</span></span><br><span class=\"line\">LZW6388NF\t<span class=\"number\">5120</span></span><br><span class=\"line\">LZW6432KF\t<span class=\"number\">4097</span></span><br><span class=\"line\">LZW6431MF\t<span class=\"number\">3622</span></span><br><span class=\"line\">EQ6361PF6\t<span class=\"number\">2509</span></span><br><span class=\"line\">SC6363B4S\t<span class=\"number\">2234</span></span><br><span class=\"line\">LZW6430KF\t<span class=\"number\">1484</span></span><br><span class=\"line\">LZW6390NF\t<span class=\"number\">1396</span></span><br><span class=\"line\"><span class=\"type\">Time</span> taken: <span class=\"number\">4.495</span> seconds, Fetched: <span class=\"number\">10</span> <span class=\"type\">row</span>(s)</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>统计车辆类型<br>\n根据车辆类型字段 vehicletype 进行分组统计</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hive (cars)<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> vehicletype,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">as</span> cnt <span class=\"keyword\">from</span> cars.car_2019712 <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> vehicletype <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> cnt <span class=\"keyword\">desc</span> limit <span class=\"number\">10</span>; </span><br><span class=\"line\">MapReduce Jobs Launched: </span><br><span class=\"line\">Stage<span class=\"operator\">-</span>Stage<span class=\"number\">-1</span>:  HDFS Read: <span class=\"number\">372809322</span> HDFS Write: <span class=\"number\">156530</span> SUCCESS</span><br><span class=\"line\">Stage<span class=\"operator\">-</span>Stage<span class=\"number\">-2</span>:  HDFS Read: <span class=\"number\">372817774</span> HDFS Write: <span class=\"number\">167935</span> SUCCESS</span><br><span class=\"line\">Total MapReduce CPU <span class=\"type\">Time</span> Spent: <span class=\"number\">0</span> msec</span><br><span class=\"line\">OK</span><br><span class=\"line\">vehicletype\tcnt</span><br><span class=\"line\">小型普通客车\t<span class=\"number\">62156</span></span><br><span class=\"line\">\t<span class=\"number\">3276</span></span><br><span class=\"line\">大型普通客车\t<span class=\"number\">3275</span></span><br><span class=\"line\">中型普通客车\t<span class=\"number\">1398</span></span><br><span class=\"line\"><span class=\"keyword\">NULL</span>\t<span class=\"number\">273</span></span><br><span class=\"line\">大型专用校车\t<span class=\"number\">221</span></span><br><span class=\"line\">中型专用校车\t<span class=\"number\">29</span></span><br><span class=\"line\">小型专用客车\t<span class=\"number\">5</span></span><br><span class=\"line\">大型铰接客车\t<span class=\"number\">3</span></span><br><span class=\"line\">微型普通客车\t<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"type\">Time</span> taken: <span class=\"number\">4.15</span> seconds, Fetched: <span class=\"number\">10</span> <span class=\"type\">row</span>(s)</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>统计所有权、车辆型号和车辆类型<br>\n统计车辆的 3 个维度：所有权、车辆型号和车辆类型。</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hive (cars)<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> a.cnt,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> concat(model,ownership,vehicletype) <span class=\"keyword\">as</span> cnt <span class=\"keyword\">from</span> cars.car_2019712) a <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> a.cnt;</span><br><span class=\"line\">Stage<span class=\"operator\">-</span>Stage<span class=\"number\">-1</span>:  HDFS Read: <span class=\"number\">455821028</span> HDFS Write: <span class=\"number\">358380</span> SUCCESS</span><br><span class=\"line\">Total MapReduce CPU <span class=\"type\">Time</span> Spent: <span class=\"number\">0</span> msec</span><br><span class=\"line\">OK</span><br><span class=\"line\">a.cnt\t_c1</span><br><span class=\"line\"><span class=\"keyword\">NULL</span>\t<span class=\"number\">273</span></span><br><span class=\"line\">\t<span class=\"number\">5</span></span><br><span class=\"line\">BFC6120B<span class=\"number\">-1</span>单位大型普通客车\t<span class=\"number\">7</span></span><br><span class=\"line\">BFC6120B2单位大型普通客车\t<span class=\"number\">1</span></span><br><span class=\"line\">BFC6900<span class=\"number\">-2</span>单位大型普通客车\t<span class=\"number\">8</span></span><br><span class=\"line\">BJ6102U8LHB单位大型普通客车\t<span class=\"number\">1</span></span><br><span class=\"line\">BJ6103U7MHB单位大型普通客车\t<span class=\"number\">1</span></span><br><span class=\"line\">BJ6103U8LHB<span class=\"number\">-4</span>单位大型普通客车\t<span class=\"number\">3</span></span><br><span class=\"line\">BJ6110U7LCB<span class=\"number\">-1</span>单位大型普通客车\t<span class=\"number\">6</span></span><br><span class=\"line\">BJ6115U7AJB<span class=\"number\">-1</span>单位大型普通客车\t<span class=\"number\">1</span></span><br><span class=\"line\">...</span><br><span class=\"line\">ZQ6420A73F个人小型普通客车\t<span class=\"number\">63</span></span><br><span class=\"line\">ZQ6420A73F单位小型普通客车\t<span class=\"number\">8</span></span><br><span class=\"line\">ZQ6421A73AF个人小型普通客车\t<span class=\"number\">17</span></span><br><span class=\"line\">ZQ6421A73AF单位小型普通客车\t<span class=\"number\">3</span></span><br><span class=\"line\">ZZY6530A个人小型普通客车\t<span class=\"number\">6</span></span><br><span class=\"line\">ZZY6530A单位小型普通客车\t<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"type\">Time</span> taken: <span class=\"number\">1.686</span> seconds, Fetched: <span class=\"number\">1290</span> <span class=\"type\">row</span>(s)</span><br></pre></td></tr></table></figure>\n<h3 id=\"统计不同类型车在一个月对应一段时间如每月或每年的总销售\"><a class=\"markdownIt-Anchor\" href=\"#统计不同类型车在一个月对应一段时间如每月或每年的总销售\">#</a> 统计不同类型车在一个月（对应一段时间，如每月或每年) 的总销售</h3>\n<p>统计不同类型车在一个月的总销量。也就是统计某一年某一个月某一类型的车，如大型普通客车、小型普通客车等，销售了多少辆。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hive (cars)<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"keyword\">month</span>,vehicletype,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> cars.car_2019712 <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> vehicletype, <span class=\"keyword\">month</span> <span class=\"keyword\">having</span> <span class=\"keyword\">month</span> <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> <span class=\"keyword\">and</span> vehicletype <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> <span class=\"keyword\">and</span> vehicletype<span class=\"operator\">!=</span><span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">MapReduce Jobs Launched: </span><br><span class=\"line\">Stage<span class=\"operator\">-</span>Stage<span class=\"number\">-1</span>:  HDFS Read: <span class=\"number\">497227388</span> HDFS Write: <span class=\"number\">362693</span> SUCCESS</span><br><span class=\"line\">Total MapReduce CPU <span class=\"type\">Time</span> Spent: <span class=\"number\">0</span> msec</span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"keyword\">month</span>\tvehicletype\t_c2</span><br><span class=\"line\"><span class=\"number\">1</span>\t中型普通客车\t<span class=\"number\">157</span></span><br><span class=\"line\"><span class=\"number\">1</span>\t大型专用校车\t<span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">1</span>\t大型普通客车\t<span class=\"number\">529</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"number\">12</span>\t大型专用校车\t<span class=\"number\">8</span></span><br><span class=\"line\"><span class=\"number\">12</span>\t大型普通客车\t<span class=\"number\">482</span></span><br><span class=\"line\"><span class=\"number\">12</span>\t小型普通客车\t<span class=\"number\">6701</span></span><br><span class=\"line\"><span class=\"type\">Time</span> taken: <span class=\"number\">2.054</span> seconds, Fetched: <span class=\"number\">64</span> <span class=\"type\">row</span>(s)</span><br></pre></td></tr></table></figure>\n<h3 id=\"通过不同类型品牌车销售情况来统计发动机型号和燃料种类\"><a class=\"markdownIt-Anchor\" href=\"#通过不同类型品牌车销售情况来统计发动机型号和燃料种类\">#</a> 通过不同类型 (品牌) 车销售情况，来统计发动机型号和燃料种类</h3>\n<p>通过不同类型（品牌）车销售情况，统计发动机型号和燃料种类。也就是按车辆的品牌字段 brand、发动机型号字段 enginemodel 和燃油种类字段 fuel 进行分组统计。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hive (cars)<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> brand,enginemodel,fuel,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> cars.car_2019712 <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> brand,enginemodel,fuel;</span><br><span class=\"line\">MapReduce Jobs Launched: </span><br><span class=\"line\">Stage<span class=\"operator\">-</span>Stage<span class=\"number\">-1</span>:  HDFS Read: <span class=\"number\">580122636</span> HDFS Write: <span class=\"number\">444919</span> SUCCESS</span><br><span class=\"line\">Total MapReduce CPU <span class=\"type\">Time</span> Spent: <span class=\"number\">0</span> msec</span><br><span class=\"line\">OK</span><br><span class=\"line\">brand\tenginemodel\tfuel\t_c3</span><br><span class=\"line\">...</span><br><span class=\"line\">黄海\tYC6J245<span class=\"number\">-30</span>\t柴油\t<span class=\"number\">17</span></span><br><span class=\"line\">黄海\tYC6J245<span class=\"number\">-42</span>\t柴油\t<span class=\"number\">2</span></span><br><span class=\"line\">黄海\tYC6L330<span class=\"number\">-30</span>\t柴油\t<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"type\">Time</span> taken: <span class=\"number\">1.765</span> seconds, Fetched: <span class=\"number\">757</span> <span class=\"type\">row</span>(s)</span><br></pre></td></tr></table></figure>\n<h3 id=\"统计五菱某一年每月的销售量\"><a class=\"markdownIt-Anchor\" href=\"#统计五菱某一年每月的销售量\">#</a> 统计五菱某一年每月的销售量</h3>\n<p>统计五菱汽车某一年每月的销售量，可以按汽车的品牌 brand 和月 month 两个字段进行分组统计，并从结果中将品牌名为 “五菱” 的数据过滤出来即可。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hive (cars)<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> brand,<span class=\"keyword\">month</span>,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> cars.car_2019712 <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> brand,<span class=\"keyword\">month</span> <span class=\"keyword\">having</span> brand<span class=\"operator\">=</span><span class=\"string\">&#x27;五菱&#x27;</span>;</span><br><span class=\"line\">MapReduce Jobs Launched: </span><br><span class=\"line\">Stage<span class=\"operator\">-</span>Stage<span class=\"number\">-1</span>:  HDFS Read: <span class=\"number\">621528450</span> HDFS Write: <span class=\"number\">445834</span> SUCCESS</span><br><span class=\"line\">Total MapReduce CPU <span class=\"type\">Time</span> Spent: <span class=\"number\">0</span> msec</span><br><span class=\"line\">OK</span><br><span class=\"line\">brand\t<span class=\"keyword\">month</span>\t_c2</span><br><span class=\"line\">五菱\t<span class=\"number\">1</span>\t<span class=\"number\">5589</span></span><br><span class=\"line\">五菱\t<span class=\"number\">2</span>\t<span class=\"number\">2226</span></span><br><span class=\"line\">五菱\t<span class=\"number\">3</span>\t<span class=\"number\">3557</span></span><br><span class=\"line\">五菱\t<span class=\"number\">4</span>\t<span class=\"number\">2389</span></span><br><span class=\"line\">五菱\t<span class=\"number\">5</span>\t<span class=\"number\">3351</span></span><br><span class=\"line\">五菱\t<span class=\"number\">6</span>\t<span class=\"number\">2302</span></span><br><span class=\"line\">五菱\t<span class=\"number\">7</span>\t<span class=\"number\">2893</span></span><br><span class=\"line\">五菱\t<span class=\"number\">8</span>\t<span class=\"number\">2980</span></span><br><span class=\"line\">五菱\t<span class=\"number\">9</span>\t<span class=\"number\">3422</span></span><br><span class=\"line\">五菱\t<span class=\"number\">10</span>\t<span class=\"number\">5278</span></span><br><span class=\"line\">五菱\t<span class=\"number\">11</span>\t<span class=\"number\">4809</span></span><br><span class=\"line\">五菱\t<span class=\"number\">12</span>\t<span class=\"number\">4963</span></span><br><span class=\"line\"><span class=\"type\">Time</span> taken: <span class=\"number\">1.863</span> seconds, Fetched: <span class=\"number\">12</span> <span class=\"type\">row</span>(s)</span><br></pre></td></tr></table></figure>\n<h2 id=\"本章小结\"><a class=\"markdownIt-Anchor\" href=\"#本章小结\">#</a> 本章小结</h2>\n<p>本章通过汽车销售数据项目让大家感受了企业大数据项目的开发流程。</p>\n",
            "tags": [
                "大数据"
            ]
        },
        {
            "id": "http://example.com/2021/11/07/Hive%E5%AD%A6%E4%B9%A0/Mahout/",
            "url": "http://example.com/2021/11/07/Hive%E5%AD%A6%E4%B9%A0/Mahout/",
            "title": "Mahout简介",
            "date_published": "2021-11-07T07:47:06.000Z",
            "content_html": "<h1 id=\"mahout安装部署\"><a class=\"markdownIt-Anchor\" href=\"#mahout安装部署\">#</a> Mahout 安装部署</h1>\n<h2 id=\"mahout是什么\"><a class=\"markdownIt-Anchor\" href=\"#mahout是什么\">#</a> Mahout 是什么</h2>\n<p>Apache Mahout 是 Apache Software Foundation （ASF）旗下的一个开源项目，提供了一些经典的机器学习的算法，皆在帮助开发人员更加方便快捷地创建智能应用程序。目前已经有了三个公共发型版本，通过 ApacheMahout 库，Mahout 可以有效地扩展到云中。Mahout 包括许多实现，包括聚类、分类、推荐引擎、频繁子项挖掘。<br>\n　　Apache Mahout 的主要目标是建立可伸缩的机器学习算法。这种可伸缩性是针对大规模的数据集而言的。Apache Mahout 的算法运行在 ApacheHadoop 平台下，它通过 Mapreduce 模式实现。但是，Apache Mahout 并非严格要求算法的实现基于 Hadoop 平台，单个节点或非 Hadoop 平台也可以。Apache Mahout 核心库的非分布式算法也具有良好的性能。<br>\n　　Mahout 是一个机器学习 Java 类库的集合，用于完成各种各样的任务，如分类、评价性的聚类和模式挖掘等。<br>\n　　Mahout 开源项目就是一个 Hadoop 云平台的算法库，已经实现了多种经典算法，并一直在扩充中，其目标就是致力于创建一个可扩容的云平台算法库。<br>\n　　在 Hadoop 云平台下编程不仅要求用户对 Hadoop 云平台框架比较熟悉，还要对 Hadoop 云平台下底层数据流、Map 和 Reduce 原理非常熟悉，这是基本的编程要求。此外，用户要编写某一个算法还需要对该算法的原理比较熟悉，即需要对算法原理理解透彻。总体来看，编写云平台下的算法程序是属于高难度的开发工作了。但是，如果使用 Mahout，情况就会有很大的不同，用户再也不用自己编写复杂的算法，不需要掌握太高深的云平台的框架和数据流程的理论知识。用户所需要了解的只是算法的大概原理、算法实际应用环境和如何调用 Mahout 相关算法的程序接口。当然，在具体的项目中，用户还应该根据实际需求在 Mahout 源代码基础上进行二次开发以满足具体的实际应用情况。</p>\n<h2 id=\"安装方法\"><a class=\"markdownIt-Anchor\" href=\"#安装方法\">#</a> 安装方法</h2>\n<p>下载安装包并解压，安装前确保 Hadoop 能正常使用</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf apache-mahout-distribution-0.10.1.tar.gz</span><br><span class=\"line\">mv apache-mahout-distribution-0.10.1 /usr/local/mahout</span><br></pre></td></tr></table></figure>\n<p>编辑环境变量</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/profile</span><br><span class=\"line\"></span><br><span class=\"line\">export MAHOUT_HOME=/usr/local/mahout</span><br><span class=\"line\">export PATH=$&#123;MAHOUT_HOME&#125;/bin:$PATH</span><br><span class=\"line\"></span><br><span class=\"line\">source /etc/profile</span><br></pre></td></tr></table></figure>\n<h2 id=\"测试运行\"><a class=\"markdownIt-Anchor\" href=\"#测试运行\">#</a> 测试运行</h2>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">将测试数据集上传hdfs并改名为testdata</span></span><br><span class=\"line\">hdfs dfs -put synthetic_control.data testdata</span><br><span class=\"line\">hdfs dfs -lsr</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">默认上传到<span class=\"string\">&quot;/user/用户名/&quot;</span>目录下</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">运行mahout</span></span><br><span class=\"line\">mahout -core org.apache.mahout.clustering.syntheticcontrol.kmeans.Job</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">可以在yarn UI界面看到两个任务</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"Mahout/image-20211107162124666.png\" class=\"lazyload placeholder\" data-srcset=\"Mahout/image-20211107162124666.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211107162124666\"></p>\n<p><img src=\"Mahout/image-20211107162200626.png\" class=\"lazyload placeholder\" data-srcset=\"Mahout/image-20211107162200626.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211107162200626\"></p>\n<h2 id=\"mahoutapi\"><a class=\"markdownIt-Anchor\" href=\"#mahoutapi\">#</a> MahoutAPI</h2>\n<p><strong>Mahout 学习（主要学习内容是 Mahout 中推荐部分的 ItemCF、UserCF、Hadoop 集群部署运行）</strong></p>\n<p>1、Mahout 是什么？</p>\n<ul>\n<li>\n<p>Mahout 是一个<strong>算法库</strong>，集成了很多算法。</p>\n</li>\n<li>\n<p>Apache Mahout 是 Apache Software Foundation（ASF）旗下的一个开源项目，提供一些可扩展的<strong>机器学习领域经典算法的实现</strong>，旨在帮助开发人员更加方便快捷地创建智能应用程序。</p>\n</li>\n<li>\n<p>Mahout 项目目前已经有了多个公共发行版本。Mahout 包含许多实现，包括聚类、分类、推荐过滤、频繁子项挖掘。</p>\n</li>\n<li>\n<p>通过使用 Apache Hadoop 库，Mahout 可以有效地扩展到 Hadoop 集群。</p>\n</li>\n<li>\n<p>Mahout 的创始人 Grant Ingersoll 介绍了机器学习的基本概念，并演示了如何使用 Mahout 来实现文档集群、提出建议和组织内容。</p>\n</li>\n</ul>\n<p>2、Mahout 是用来干嘛的？</p>\n<p>2.1 推荐引擎</p>\n<p>服务商或网站会根据你过去的行为为你推荐书籍、电影或文章。</p>\n<p>2.2 聚类</p>\n<p>Google news 使用聚类技术通过标题把新闻文章进行分组，从而按照逻辑线索来显示新闻，而并非给出所有新闻的原始列表。</p>\n<p>2.3 分类</p>\n<p>雅虎邮箱基于用户以前对正常邮件和垃圾邮件的报告，以及电子邮件自身的特征，来判别到来的消息是否是垃圾邮件。</p>\n<p>3、Mahout 协同过滤算法</p>\n<p>Mahout 使用了 Taste 来提高协同过滤算法的实现，它是一个基于 Java 实现的可扩展的，高效的推荐引擎。Taste 既实现了最基本的基于用户的和基于内容的推荐算法，同时也提供了扩展接口，使用户可以方便的定义和实现自己的推荐算法。同时，Taste 不仅仅只适用于 Java 应用程序，它可以作为内部服务器的一个组件以 HTTP 和 Web Service 的形式向外界提供推荐的逻辑。Taste 的设计使它能满足企业对推荐引擎在性能、灵活性和可扩展性等方面的要求。</p>\n<p>Taste 主要包括以下几个接口：</p>\n<ul>\n<li>DataModel 是用户喜好信息的抽象接口，它的具体实现支持从任意类型的数据源抽取用户喜好信息。Taste 默认提供 JDBCDataModel 和 FileDataModel，分别支持从数据库和文件中读取用户的喜好信息。</li>\n<li>UserSimilarity 和 ItemSimilarity 。UserSimilarity 用于定义两个用户间的相似度，它是基于协同过滤的推荐引擎的核心部分，可以用来计算用户的 “邻居”，这里我们将与当前用户口味相似的用户称为他的邻居。ItemSimilarity 类似的，计算 Item 之间的相似度。</li>\n<li>UserNeighborhood 用于基于用户相似度的推荐方法中，推荐的内容是基于找到与当前用户喜好相似的邻居用户的方式产生的。UserNeighborhood 定义了确定邻居用户的方法，具体实现一般是基于 UserSimilarity 计算得到的。</li>\n<li>Recommender 是推荐引擎的抽象接口，Taste 中的核心组件。程序中，为它提供一个 DataModel，它可以计算出对不同用户的推荐内容。实际应用中，主要使用它的实现类 GenericUserBasedRecommender 或者 GenericItemBasedRecommender，分别实现基于用户相似度的推荐引擎或者基于内容的推荐引擎。</li>\n<li>RecommenderEvaluator ：评分器。</li>\n<li>RecommenderIRStatsEvaluator ：搜集推荐性能相关的指标，包括准确率、召回率等等。</li>\n</ul>\n<p><img src=\"Mahout/1110462-20170623221329257-557838148.png\" class=\"lazyload placeholder\" data-srcset=\"Mahout/1110462-20170623221329257-557838148.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\"></p>\n<p>4、Mahout 协同过滤算法编程</p>\n<p>1、创建 maven 项目</p>\n<p>2、导入 mahout 依赖</p>\n<p>[<img src=\"Mahout/copycode.gif\" class=\"lazyload placeholder\" data-srcset=\"Mahout/copycode.gif\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"复制代码\">](javascript:void (0)😉</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependencies&gt;</span><br><span class=\"line\">    &lt;dependency&gt;</span><br><span class=\"line\">        &lt;groupId&gt;org.apache.mahout&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;mahout&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;version&gt;0.11.1&lt;/version&gt;</span><br><span class=\"line\">    &lt;/dependency&gt;</span><br><span class=\"line\">    &lt;dependency&gt;</span><br><span class=\"line\">        &lt;groupId&gt;org.apache.mahout&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;mahout-examples&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;version&gt;0.11.1&lt;/version&gt;</span><br><span class=\"line\">        &lt;exclusions&gt;</span><br><span class=\"line\">            &lt;exclusion&gt;</span><br><span class=\"line\">                &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class=\"line\">                &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;</span><br><span class=\"line\">            &lt;/exclusion&gt;</span><br><span class=\"line\">        &lt;/exclusions&gt;</span><br><span class=\"line\">    &lt;/dependency&gt;</span><br><span class=\"line\">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>\n<p>[<img src=\"Mahout/copycode.gif\" class=\"lazyload placeholder\" data-srcset=\"Mahout/copycode.gif\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"复制代码\">](javascript:void (0)😉</p>\n<p>3、下载电影评分数据</p>\n<p>下载地址：<a href=\"http://grouplens.org/datasets/movielens/\">http://grouplens.org/datasets/movielens/</a></p>\n<p>数据类别：7.2 万用户对 1 万部电影的百万级评价和 10 万个标签数据</p>\n<p><img src=\"Mahout/1110462-20170623233121648-907850964.png\" class=\"lazyload placeholder\" data-srcset=\"Mahout/1110462-20170623233121648-907850964.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\"></p>\n<p><img src=\"Mahout/1110462-20170623233155726-1891613913.png\" class=\"lazyload placeholder\" data-srcset=\"Mahout/1110462-20170623233155726-1891613913.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\"></p>\n<p>4、基于用户的推荐</p>\n<p>[<img src=\"Mahout/copycode.gif\" class=\"lazyload placeholder\" data-srcset=\"Mahout/copycode.gif\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"复制代码\">](javascript:void (0)😉</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> 1 package com.ahu.learnmahout;</span><br><span class=\"line\"> 2 </span><br><span class=\"line\"> 3 import org.apache.mahout.cf.taste.impl.neighborhood.NearestNUserNeighborhood;</span><br><span class=\"line\"> 4 import org.apache.mahout.cf.taste.impl.recommender.GenericUserBasedRecommender;</span><br><span class=\"line\"> 5 import org.apache.mahout.cf.taste.impl.similarity.PearsonCorrelationSimilarity;</span><br><span class=\"line\"> 6 import org.apache.mahout.cf.taste.model.DataModel;</span><br><span class=\"line\"> 7 import org.apache.mahout.cf.taste.neighborhood.UserNeighborhood;</span><br><span class=\"line\"> 8 import org.apache.mahout.cf.taste.recommender.RecommendedItem;</span><br><span class=\"line\"> 9 import org.apache.mahout.cf.taste.recommender.Recommender;</span><br><span class=\"line\">10 import org.apache.mahout.cf.taste.similarity.UserSimilarity;</span><br><span class=\"line\">11 import org.apache.mahout.cf.taste.similarity.precompute.example.GroupLensDataModel;</span><br><span class=\"line\">12 </span><br><span class=\"line\">13 import java.io.File;</span><br><span class=\"line\">14 import java.util.List;</span><br><span class=\"line\">15 </span><br><span class=\"line\">16 /**</span><br><span class=\"line\">17  * Created by ahu_lichang on 2017/6/23.</span><br><span class=\"line\">18  */</span><br><span class=\"line\">19 public class BaseUserRecommender &#123;</span><br><span class=\"line\">20     public static void main(String[] args) throws Exception &#123;</span><br><span class=\"line\">21         //准备数据 这里是电影评分数据</span><br><span class=\"line\">22         File file = new File(&quot;E:\\\\ml-10M100K\\\\ratings.dat&quot;);</span><br><span class=\"line\">23         //将数据加载到内存中，GroupLensDataModel是针对开放电影评论数据的</span><br><span class=\"line\">24         DataModel dataModel = new GroupLensDataModel(file);</span><br><span class=\"line\">25         //计算相似度，相似度算法有很多种，欧几里得、皮尔逊等等。</span><br><span class=\"line\">26         UserSimilarity similarity = new PearsonCorrelationSimilarity(dataModel);</span><br><span class=\"line\">27         //计算最近邻域，邻居有两种算法，基于固定数量的邻居和基于相似度的邻居，这里使用基于固定数量的邻居</span><br><span class=\"line\">28         UserNeighborhood userNeighborhood = new NearestNUserNeighborhood(100, similarity, dataModel);</span><br><span class=\"line\">29         //构建推荐器，协同过滤推荐有两种，分别是基于用户的和基于物品的，这里使用基于用户的协同过滤推荐</span><br><span class=\"line\">30         Recommender recommender = new GenericUserBasedRecommender(dataModel, userNeighborhood, similarity);</span><br><span class=\"line\">31         //给用户ID等于5的用户推荐10部电影</span><br><span class=\"line\">32         List&lt;RecommendedItem&gt; recommendedItemList = recommender.recommend(5, 10);</span><br><span class=\"line\">33         //打印推荐的结果</span><br><span class=\"line\">34         System.out.println(&quot;使用基于用户的协同过滤算法&quot;);</span><br><span class=\"line\">35         System.out.println(&quot;为用户5推荐10个商品&quot;);</span><br><span class=\"line\">36         for (RecommendedItem recommendedItem : recommendedItemList) &#123;</span><br><span class=\"line\">37             System.out.println(recommendedItem);</span><br><span class=\"line\">38         &#125;</span><br><span class=\"line\">39     &#125;</span><br><span class=\"line\">40 &#125;</span><br></pre></td></tr></table></figure>\n<p>[<img src=\"Mahout/copycode.gif\" class=\"lazyload placeholder\" data-srcset=\"Mahout/copycode.gif\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"复制代码\">](javascript:void (0)😉</p>\n<p>运行结果：</p>\n<p><img src=\"Mahout/1110462-20170623233313413-1189848861.png\" class=\"lazyload placeholder\" data-srcset=\"Mahout/1110462-20170623233313413-1189848861.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\"></p>\n<p>5、基于物品的推荐</p>\n<p>[<img src=\"Mahout/copycode.gif\" class=\"lazyload placeholder\" data-srcset=\"Mahout/copycode.gif\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"复制代码\">](javascript:void (0)😉</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.ahu.learnmahout;</span><br><span class=\"line\"></span><br><span class=\"line\">import org.apache.mahout.cf.taste.impl.recommender.GenericItemBasedRecommender;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.impl.similarity.PearsonCorrelationSimilarity;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.model.DataModel;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.recommender.RecommendedItem;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.similarity.ItemSimilarity;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.similarity.precompute.example.GroupLensDataModel;</span><br><span class=\"line\"></span><br><span class=\"line\">import java.io.File;</span><br><span class=\"line\">import java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * Created by ahu_lichang on 2017/6/24.</span><br><span class=\"line\"> */</span><br><span class=\"line\">public class BaseItemRecommender &#123;</span><br><span class=\"line\">    public static void main(String[] args) throws Exception &#123;</span><br><span class=\"line\">        //准备数据 这里是电影评分数据</span><br><span class=\"line\">        File file = new File(&quot;E:\\\\ml-10M100K\\\\ratings.dat&quot;);</span><br><span class=\"line\">        //将数据加载到内存中，GroupLensDataModel是针对开放电影评论数据的</span><br><span class=\"line\">        DataModel dataModel = new GroupLensDataModel(file);</span><br><span class=\"line\">        //计算相似度，相似度算法有很多种，欧几里得、皮尔逊等等。</span><br><span class=\"line\">        ItemSimilarity itemSimilarity = new PearsonCorrelationSimilarity(dataModel);</span><br><span class=\"line\">        //构建推荐器，协同过滤推荐有两种，分别是基于用户的和基于物品的，这里使用基于物品的协同过滤推荐</span><br><span class=\"line\">        GenericItemBasedRecommender recommender = new GenericItemBasedRecommender(dataModel, itemSimilarity);</span><br><span class=\"line\">        //给用户ID等于5的用户推荐10个与2398相似的商品</span><br><span class=\"line\">        List&lt;RecommendedItem&gt; recommendedItemList = recommender.recommendedBecause(5, 2398, 10);</span><br><span class=\"line\">        //打印推荐的结果</span><br><span class=\"line\">        System.out.println(&quot;使用基于物品的协同过滤算法&quot;);</span><br><span class=\"line\">        System.out.println(&quot;根据用户5当前浏览的商品2398，推荐10个相似的商品&quot;);</span><br><span class=\"line\">        for (RecommendedItem recommendedItem : recommendedItemList) &#123;</span><br><span class=\"line\">            System.out.println(recommendedItem);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        long start = System.currentTimeMillis();</span><br><span class=\"line\">        recommendedItemList = recommender.recommendedBecause(5, 34, 10);</span><br><span class=\"line\">        //打印推荐的结果</span><br><span class=\"line\">        System.out.println(&quot;使用基于物品的协同过滤算法&quot;);</span><br><span class=\"line\">        System.out.println(&quot;根据用户5当前浏览的商品34，推荐10个相似的商品&quot;);</span><br><span class=\"line\">        for (RecommendedItem recommendedItem : recommendedItemList) &#123;</span><br><span class=\"line\">            System.out.println(recommendedItem);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(System.currentTimeMillis() -start);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>[<img src=\"Mahout/copycode.gif\" class=\"lazyload placeholder\" data-srcset=\"Mahout/copycode.gif\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"复制代码\">](javascript:void (0)😉</p>\n<p>运行结果：</p>\n<p><img src=\"Mahout/1110462-20170624111836710-1685609646.png\" class=\"lazyload placeholder\" data-srcset=\"Mahout/1110462-20170624111836710-1685609646.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\"></p>\n<p>6、评估推荐模型</p>\n<p>[<img src=\"Mahout/copycode.gif\" class=\"lazyload placeholder\" data-srcset=\"Mahout/copycode.gif\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"复制代码\">](javascript:void (0)😉</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.ahu.learnmahout;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">import org.apache.mahout.cf.taste.common.TasteException;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.eval.RecommenderBuilder;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.eval.RecommenderEvaluator;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.impl.eval.AverageAbsoluteDifferenceRecommenderEvaluator;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.impl.neighborhood.NearestNUserNeighborhood;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.impl.recommender.GenericUserBasedRecommender;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.impl.similarity.PearsonCorrelationSimilarity;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.model.DataModel;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.neighborhood.UserNeighborhood;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.recommender.Recommender;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.similarity.UserSimilarity;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.similarity.precompute.example.GroupLensDataModel;</span><br><span class=\"line\"></span><br><span class=\"line\">import java.io.File;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * Created by ahu_lichang on 2017/6/24.</span><br><span class=\"line\"> */</span><br><span class=\"line\">public class MyEvaluator &#123;</span><br><span class=\"line\">    public static void main(String[] args) throws Exception &#123;</span><br><span class=\"line\">        //准备数据 这里是电影评分数据</span><br><span class=\"line\">        File file = new File(&quot;E:\\\\ml-10M100K\\\\ratings.dat&quot;);</span><br><span class=\"line\">        //将数据加载到内存中，GroupLensDataModel是针对开放电影评论数据的</span><br><span class=\"line\">        DataModel dataModel = new GroupLensDataModel(file);</span><br><span class=\"line\">        //推荐评估，使用均方根</span><br><span class=\"line\">        //RecommenderEvaluator evaluator = new RMSRecommenderEvaluator();</span><br><span class=\"line\">        //推荐评估，使用平均差值</span><br><span class=\"line\">        RecommenderEvaluator evaluator = new AverageAbsoluteDifferenceRecommenderEvaluator();</span><br><span class=\"line\">        RecommenderBuilder builder = new RecommenderBuilder() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            public Recommender buildRecommender(DataModel dataModel) throws TasteException &#123;</span><br><span class=\"line\">                UserSimilarity similarity = new PearsonCorrelationSimilarity(dataModel);</span><br><span class=\"line\">                UserNeighborhood neighborhood = new NearestNUserNeighborhood(2, similarity, dataModel);</span><br><span class=\"line\">                return new GenericUserBasedRecommender(dataModel, neighborhood, similarity);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        // 用70%的数据用作训练，剩下的30%用来测试</span><br><span class=\"line\">        double score = evaluator.evaluate(builder, null, dataModel, 0.7, 1.0);</span><br><span class=\"line\">        //最后得出的评估值越小，说明推荐结果越好</span><br><span class=\"line\">        System.out.println(score);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>[<img src=\"Mahout/copycode.gif\" class=\"lazyload placeholder\" data-srcset=\"Mahout/copycode.gif\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"复制代码\">](javascript:void (0)😉</p>\n<p>7、获取推荐的准确率和召回率</p>\n<p>[<img src=\"Mahout/copycode.gif\" class=\"lazyload placeholder\" data-srcset=\"Mahout/copycode.gif\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"复制代码\">](javascript:void (0)😉</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.ahu.learnmahout;</span><br><span class=\"line\"></span><br><span class=\"line\">import org.apache.mahout.cf.taste.common.TasteException;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.eval.IRStatistics;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.eval.RecommenderBuilder;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.eval.RecommenderIRStatsEvaluator;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.impl.eval.GenericRecommenderIRStatsEvaluator;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.impl.neighborhood.NearestNUserNeighborhood;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.impl.recommender.GenericUserBasedRecommender;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.impl.similarity.PearsonCorrelationSimilarity;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.model.DataModel;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.neighborhood.UserNeighborhood;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.recommender.Recommender;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.similarity.UserSimilarity;</span><br><span class=\"line\">import org.apache.mahout.cf.taste.similarity.precompute.example.GroupLensDataModel;</span><br><span class=\"line\"></span><br><span class=\"line\">import java.io.File;</span><br><span class=\"line\"></span><br><span class=\"line\">/**</span><br><span class=\"line\"> * Created by ahu_lichang on 2017/6/24.</span><br><span class=\"line\"> */</span><br><span class=\"line\">public class MyIRStatistics &#123;</span><br><span class=\"line\">    public static void main(String[] args) throws Exception &#123;</span><br><span class=\"line\">        //准备数据 这里是电影评分数据</span><br><span class=\"line\">        File file = new File(&quot;E:\\\\ml-10M100K\\\\ratings.dat&quot;);</span><br><span class=\"line\">        //将数据加载到内存中，GroupLensDataModel是针对开放电影评论数据的</span><br><span class=\"line\">        DataModel dataModel = new GroupLensDataModel(file);</span><br><span class=\"line\">        RecommenderIRStatsEvaluator statsEvaluator = new GenericRecommenderIRStatsEvaluator();</span><br><span class=\"line\">        RecommenderBuilder recommenderBuilder = new RecommenderBuilder() &#123;</span><br><span class=\"line\">            public Recommender buildRecommender(DataModel model) throws TasteException &#123;</span><br><span class=\"line\">                UserSimilarity similarity = new PearsonCorrelationSimilarity(model);</span><br><span class=\"line\">                UserNeighborhood neighborhood = new NearestNUserNeighborhood(4, similarity, model);</span><br><span class=\"line\">                return new GenericUserBasedRecommender(model, neighborhood, similarity);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        // 计算推荐4个结果时的查准率和召回率</span><br><span class=\"line\">        //使用评估器，并设定评估期的参数</span><br><span class=\"line\">        //4表示&quot;precision and recall at 4&quot;即相当于推荐top4，然后在top-4的推荐上计算准确率和召回率</span><br><span class=\"line\">        IRStatistics stats = statsEvaluator.evaluate(recommenderBuilder, null, dataModel, null, 4, GenericRecommenderIRStatsEvaluator.CHOOSE_THRESHOLD, 1.0);</span><br><span class=\"line\">        System.out.println(stats.getPrecision());</span><br><span class=\"line\">        System.out.println(stats.getRecall());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>[<img src=\"Mahout/copycode.gif\" class=\"lazyload placeholder\" data-srcset=\"Mahout/copycode.gif\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"复制代码\">](javascript:void (0)😉</p>\n<p><img src=\"Mahout/1110462-20170624171117320-1871811297.png\" class=\"lazyload placeholder\" data-srcset=\"Mahout/1110462-20170624171117320-1871811297.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\"></p>\n<p>5、Mahout 运行在 Hadoop 集群</p>\n<p>**1、**<strong>Hadoop 执行脚本</strong></p>\n<p>hadoop jar mahout-examples-0.9-job.jar org.apache.mahout.cf.taste.hadoop.item.RecommenderJob --input /sanbox/movie/10M.txt --output /sanbox/movie/r -s SIMILARITY_LOGLIKELIHOOD</p>\n<p>参数说明</p>\n<ul>\n<li>–input (path) : 存储用户偏好数据的目录，该目录下可以包含一个或多个存储用户偏好数据的文本文件；</li>\n<li>–output (path) : 结算结果的输出目录</li>\n<li>–numRecommendations (integer) : 为每个用户推荐的 item 数量，默认为 10</li>\n<li>–usersFile (path) : 指定一个包含了一个或多个存储 userID 的文件路径，仅为该路径下所有文件包含的 userID 做推荐计算 (该选项可选)</li>\n<li>–itemsFile (path) : 指定一个包含了一个或多个存储 itemID 的文件路径，仅为该路径下所有文件包含的 itemID 做推荐计算 (该选项可选)</li>\n<li>–filterFile (path) : 指定一个路径，该路径下的文件包含了 [userID,itemID] 值对，userID 和 itemID 用逗号分隔。计算结果将不会为 user 推荐 [userID,itemID] 值对中包含的 item (该选项可选)</li>\n<li>–booleanData (boolean) : 如果输入数据不包含偏好数值，则将该参数设置为 true，默认为 false</li>\n<li>–maxPrefsPerUser (integer) : 在最后计算推荐结果的阶段，针对每一个 user 使用的偏好数据的最大数量，默认为 10</li>\n<li>–minPrefsPerUser (integer) : 在相似度计算中，忽略所有偏好数据量少于该值的用户，默认为 1</li>\n<li>–maxSimilaritiesPerItem (integer) : 针对每个 item 的相似度最大值，默认为 100</li>\n<li>–maxPrefsPerUserInItemSimilarity (integer) : 在 item 相似度计算阶段，针对每个用户考虑的偏好数据最大数量，默认为 1000</li>\n<li>–similarityClassname (classname) : 向量相似度计算类</li>\n<li>outputPathForSimilarityMatrix ：SimilarityMatrix 输出目录</li>\n<li>–randomSeed ：随机种子 – sequencefileOutput ：序列文件输出路径</li>\n<li>–tempDir (path) : 存储临时文件的目录，默认为当前用户的 home 目录下的 temp 目录</li>\n<li>–threshold (double) : 忽略相似度低于该阀值的 item 对</li>\n</ul>\n<p>2、 <strong>执行结果</strong></p>\n<p>上面命令运行完成之后，会在当前用户的 hdfs 主目录生成 temp 目录，该目录可由 --tempDir (path) 参数设置.</p>\n<p><strong>后期学习补充：</strong></p>\n<p><strong>Mahout 是基于 Hadoop 的机器学习和数据挖掘的一个分布式框架。Mahout 用 MapReduce 实现了部分数据挖掘算法，解决了并行挖掘的问题。</strong></p>\n<p><strong>Mahout 应用场景：</strong></p>\n<p><img src=\"Mahout/1110462-20170819160931068-666710630.png\" class=\"lazyload placeholder\" data-srcset=\"Mahout/1110462-20170819160931068-666710630.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\"></p>\n",
            "tags": [
                "大数据"
            ]
        },
        {
            "id": "http://example.com/2021/11/05/Hive%E5%AD%A6%E4%B9%A0/Azkaban/",
            "url": "http://example.com/2021/11/05/Hive%E5%AD%A6%E4%B9%A0/Azkaban/",
            "title": "Azkaban",
            "date_published": "2021-11-05T09:23:59.000Z",
            "content_html": "<h1 id=\"azkaban任务调度\"><a class=\"markdownIt-Anchor\" href=\"#azkaban任务调度\">#</a> Azkaban 任务调度</h1>\n<h2 id=\"安装azkaban\"><a class=\"markdownIt-Anchor\" href=\"#安装azkaban\">#</a> 安装 Azkaban</h2>\n<p><strong>准备安装包</strong></p>\n<p><img src=\"Azkaban/image-20211105174045501.png\" class=\"lazyload placeholder\" data-srcset=\"Azkaban/image-20211105174045501.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211105174045501\"></p>\n<p><strong>将安装包解压</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf azkaban-web-server-2.5.0.tar.gz</span><br><span class=\"line\">tar -zxvf azkaban-sql-script-2.5.0.tar.gz </span><br><span class=\"line\">tar -zxvf azkaban-executor-server-2.5.0.tar.gz</span><br><span class=\"line\">mv azkaban-web-2.5.0/ /usr/local/azkaban-web</span><br><span class=\"line\">mv azkaban-executor-2.5.0/ /usr/local/azkaban-executor</span><br></pre></td></tr></table></figure>\n<p><strong>创建 mysql 用户</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql <span class=\"operator\">-</span>u root <span class=\"operator\">-</span>p</span><br><span class=\"line\"><span class=\"keyword\">create</span> database azkaban;</span><br><span class=\"line\"><span class=\"keyword\">grant</span> <span class=\"keyword\">all</span> <span class=\"keyword\">on</span> azkaban.<span class=\"operator\">*</span> <span class=\"keyword\">to</span> azkaban@<span class=\"string\">&#x27;localhost&#x27;</span> identified <span class=\"keyword\">by</span> <span class=\"string\">&#x27;azkaban&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">grant</span> <span class=\"keyword\">all</span> <span class=\"keyword\">on</span> azkaban.<span class=\"operator\">*</span> <span class=\"keyword\">to</span> azkaban@<span class=\"string\">&#x27;%&#x27;</span> identified <span class=\"keyword\">by</span> <span class=\"string\">&#x27;azkaban&#x27;</span>;</span><br><span class=\"line\">flush privileges;</span><br><span class=\"line\">use azkaban</span><br><span class=\"line\">source <span class=\"operator\">/</span>root<span class=\"operator\">/</span>azkaban<span class=\"number\">-2.5</span><span class=\"number\">.0</span><span class=\"operator\">/</span><span class=\"keyword\">create</span><span class=\"operator\">-</span><span class=\"keyword\">all</span><span class=\"operator\">-</span><span class=\"keyword\">sql</span><span class=\"number\">-2.5</span><span class=\"number\">.0</span>.<span class=\"keyword\">sql</span>;</span><br></pre></td></tr></table></figure>\n<p><strong>创建证书</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">keytool -keystore keystore -alias jetty -genkey -keyalg RSA</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">都默认吧，记住自己的密码</span></span><br><span class=\"line\">mv keystore /usr/local/azkaban-web/</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">放到web应用里</span></span><br><span class=\"line\">vi conf/azkaban.properties</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">修改以下数据</span></span><br><span class=\"line\">database.type=mysql</span><br><span class=\"line\">mysql.port=3306</span><br><span class=\"line\">mysql.host=localhost</span><br><span class=\"line\">mysql.database=azkaban</span><br><span class=\"line\">mysql.user=azkaban</span><br><span class=\"line\">mysql.password=azkaban</span><br><span class=\"line\">mysql.numconnections=100</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Azkaban Jetty server properties.</span></span><br><span class=\"line\">jetty.maxThreads=25</span><br><span class=\"line\">jetty.ssl.port=8443</span><br><span class=\"line\">jetty.port=8081</span><br><span class=\"line\">jetty.keystore=keystore</span><br><span class=\"line\">jetty.password=azkaban</span><br><span class=\"line\">jetty.keypassword=azkaban</span><br><span class=\"line\">jetty.truststore=keystore</span><br><span class=\"line\">jetty.trustpassword=azkaban</span><br></pre></td></tr></table></figure>\n<p><strong>编辑 executor 配置</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd azkaban-executor/</span><br><span class=\"line\">vi conf/azkaban.properties</span><br><span class=\"line\"></span><br><span class=\"line\">database.type=mysql</span><br><span class=\"line\">mysql.port=3306</span><br><span class=\"line\">mysql.host=localhost</span><br><span class=\"line\">mysql.database=azkaban</span><br><span class=\"line\">mysql.user=azkaban</span><br><span class=\"line\">mysql.password=azkaban</span><br><span class=\"line\">mysql.numconnections=100</span><br><span class=\"line\"></span><br><span class=\"line\">cd /usr/local/azkaban-web/</span><br><span class=\"line\">vi conf/azkaban-users.xml </span><br><span class=\"line\"></span><br><span class=\"line\">&lt;azkaban-users&gt;</span><br><span class=\"line\">        &lt;user username=&quot;azkaban&quot; password=&quot;azkaban&quot; roles=&quot;admin&quot; groups=&quot;azkaban&quot; /&gt;</span><br><span class=\"line\">        &lt;user username=&quot;metrics&quot; password=&quot;metrics&quot; roles=&quot;metrics&quot;/&gt;</span><br><span class=\"line\">        &lt;user username=&quot;admin&quot; password=&quot;admin&quot; roles=&quot;admin,metrics&quot;/&gt;</span><br><span class=\"line\">        &lt;role name=&quot;admin&quot; permissions=&quot;ADMIN&quot; /&gt;</span><br><span class=\"line\">        &lt;role name=&quot;metrics&quot; permissions=&quot;METRICS&quot;/&gt;</span><br><span class=\"line\">&lt;/azkaban-users&gt;</span><br></pre></td></tr></table></figure>\n<p><strong>启动应用</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /usr/local/azkaban-executor/</span><br><span class=\"line\">bin/azkaban-executor-start.sh</span><br><span class=\"line\">cd /usr/local/azkaban-web/</span><br><span class=\"line\">bin/azkaban-web-start.sh </span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">注意先启动executor，再启动webserver，避免出错</span></span><br></pre></td></tr></table></figure>\n<p><strong>访问网页</strong><br>\n<a href=\"https://yourhost:8443\"> https://yourhost:8443</a></p>\n<p><img src=\"Azkaban/image-20211107123423587.png\" class=\"lazyload placeholder\" data-srcset=\"Azkaban/image-20211107123423587.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211107123423587\"></p>\n<p>admin 登陆</p>\n<h2 id=\"azkaban使用方法\"><a class=\"markdownIt-Anchor\" href=\"#azkaban使用方法\">#</a> Azkaban 使用方法</h2>\n<p><strong>编写 Hive 作业并使用 azkaban 运行</strong><br>\n为了让 azkaban 支持 Hive 作业，需要使用 jobtype 插件，将下载好的压缩包解压至 azkaban-executor/plugins/ 目录下</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /usr/local/azkaban-executor/plugins/</span><br><span class=\"line\">tar -zxvf azkaban-jobtype-2.5.0.tar.gz</span><br><span class=\"line\">cd azkaban-jobtype-2.5.0</span><br><span class=\"line\">vi common.properties</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">添加hadoop和hive家目录</span></span><br></pre></td></tr></table></figure>\n<p><strong>编写 hiveCount 脚本以及 job 文件</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi hiveCount.sh</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">!/bin/bash</span></span><br><span class=\"line\">hive -e &quot;select count(distinct uid) from sogou.sogou_500w&quot;</span><br><span class=\"line\">vi hiveCount.job</span><br><span class=\"line\">type=command</span><br><span class=\"line\">command=bash hiveCount.sh</span><br></pre></td></tr></table></figure>\n<p><strong>将编写好的两个文件打包成 zip 并上传 web 界面</strong></p>\n<p><img src=\"Azkaban/image-20211107144929701.png\" class=\"lazyload placeholder\" data-srcset=\"Azkaban/image-20211107144929701.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211107144929701\"></p>\n<img src=\"Azkaban/image-20211107145005251.png\" class=\"lazyload placeholder\" data-srcset=\"Azkaban/image-20211107145005251.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211107145005251\" style=\"zoom:80%;\" />\n<p><img src=\"Azkaban/image-20211107150726252.png\" class=\"lazyload placeholder\" data-srcset=\"Azkaban/image-20211107150726252.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211107150726252\"></p>\n<p><strong>运行结束</strong></p>\n<p><img src=\"Azkaban/image-20211107151454918.png\" class=\"lazyload placeholder\" data-srcset=\"Azkaban/image-20211107151454918.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211107151454918\"></p>\n<p><img src=\"Azkaban/image-20211107151559417.png\" class=\"lazyload placeholder\" data-srcset=\"Azkaban/image-20211107151559417.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20211107151559417\"></p>\n",
            "tags": [
                "大数据"
            ]
        },
        {
            "id": "http://example.com/2021/10/13/Spark%E5%AD%A6%E4%B9%A0/Spark-RDD/",
            "url": "http://example.com/2021/10/13/Spark%E5%AD%A6%E4%B9%A0/Spark-RDD/",
            "title": "Spark+RDD",
            "date_published": "2021-10-13T00:40:00.000Z",
            "content_html": "<h1 id=\"spark-rdd编程案例\"><a class=\"markdownIt-Anchor\" href=\"#spark-rdd编程案例\">#</a> Spark RDD 编程案例</h1>\n<h2 id=\"wordcount\"><a class=\"markdownIt-Anchor\" href=\"#wordcount\">#</a> WordCount</h2>\n<p>WordCount 编程是我们最熟悉不过的了，使用 Spark 进行编写程序会比 MapReduce 编程简便许多。<br>\n代码示例如下：</p>\n<figure class=\"highlight scala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.apache.spark.&#123;<span class=\"type\">SparkConf</span>, <span class=\"type\">SparkContext</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">object</span> <span class=\"title\">WordCount</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span></span>(args: <span class=\"type\">Array</span>[<span class=\"type\">String</span>]): <span class=\"type\">Unit</span> = &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> config: <span class=\"type\">SparkConf</span> = <span class=\"keyword\">new</span> <span class=\"type\">SparkConf</span>().setMaster(<span class=\"string\">&quot;local[*]&quot;</span>).setAppName(<span class=\"string\">&quot;WordCount&quot;</span>)</span><br><span class=\"line\">\t<span class=\"comment\">//设置内核个数以及程序名称</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> sc: <span class=\"type\">SparkContext</span> = <span class=\"keyword\">new</span> <span class=\"type\">SparkContext</span>(config)</span><br><span class=\"line\">    <span class=\"comment\">//创建Spark上下文</span></span><br><span class=\"line\">    sc.setLogLevel(<span class=\"string\">&quot;WARN&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">val</span> result: <span class=\"type\">Array</span>[(<span class=\"type\">String</span>,<span class=\"type\">Int</span>)] = sc.textFile(<span class=\"string\">&quot;in&quot;</span>).</span><br><span class=\"line\">    <span class=\"comment\">//逐行读入数据，路径是项目根目录下in文件夹</span></span><br><span class=\"line\">      flatMap(_.split(<span class=\"string\">&quot; &quot;</span>)).</span><br><span class=\"line\">      <span class=\"comment\">//拆分单词</span></span><br><span class=\"line\">      map((_,<span class=\"number\">1</span>)).</span><br><span class=\"line\">      <span class=\"comment\">//将每个单词变成键值对</span></span><br><span class=\"line\">      reduceByKey(_+_).</span><br><span class=\"line\">      <span class=\"comment\">//对每个键值对进行处理，对于相同的键进行相加</span></span><br><span class=\"line\">      collect()</span><br><span class=\"line\">    result.foreach(x =&gt; println(x))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这里选择从本地文件导入数据，存放在 Idea 项目根目录下 in 文件夹，数据内容以及运行结果如下：</p>\n<figure class=\"highlight scala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//输入数据</span></span><br><span class=\"line\">hadoop hello</span><br><span class=\"line\">spark hello</span><br><span class=\"line\">ambari yes</span><br><span class=\"line\">scala java</span><br><span class=\"line\">hive hbase</span><br><span class=\"line\">hadoop hello</span><br><span class=\"line\">spark hello</span><br><span class=\"line\">ambari yes</span><br><span class=\"line\">scala java</span><br><span class=\"line\">hive hbase</span><br><span class=\"line\">hive hbase</span><br><span class=\"line\">hadoop hello</span><br><span class=\"line\">spark hello</span><br><span class=\"line\">ambari yes</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//输出结果</span></span><br><span class=\"line\">(scala,<span class=\"number\">2</span>)</span><br><span class=\"line\">(hive,<span class=\"number\">3</span>)</span><br><span class=\"line\">(ambari,<span class=\"number\">3</span>)</span><br><span class=\"line\">(hello,<span class=\"number\">6</span>)</span><br><span class=\"line\">(java,<span class=\"number\">2</span>)</span><br><span class=\"line\">(spark,<span class=\"number\">3</span>)</span><br><span class=\"line\">(yes,<span class=\"number\">3</span>)</span><br><span class=\"line\">(hadoop,<span class=\"number\">3</span>)</span><br><span class=\"line\">(hbase,<span class=\"number\">3</span>)</span><br></pre></td></tr></table></figure>\n<h2 id=\"topn\"><a class=\"markdownIt-Anchor\" href=\"#topn\">#</a> TopN</h2>\n<p>TopN 功能是实现对一个较大数据量的数据进行排序，之后输出前 N 条数据，一般来说有 3 种类型的 TopN 写法，这里使用的是键不相同的写法。</p>\n<figure class=\"highlight scala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.apache.spark.&#123;<span class=\"type\">SparkConf</span>, <span class=\"type\">SparkContext</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">object</span> <span class=\"title\">TopN</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span></span>(args: <span class=\"type\">Array</span>[<span class=\"type\">String</span>]): <span class=\"type\">Unit</span> = &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> config: <span class=\"type\">SparkConf</span> = <span class=\"keyword\">new</span> <span class=\"type\">SparkConf</span>().setMaster(<span class=\"string\">&quot;local[*]&quot;</span>).setAppName(<span class=\"string\">&quot;TopN&quot;</span>) </span><br><span class=\"line\">    <span class=\"comment\">//设置内核个数以及程序名称</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> sc: <span class=\"type\">SparkContext</span> = <span class=\"keyword\">new</span> <span class=\"type\">SparkContext</span>(config) </span><br><span class=\"line\">    <span class=\"comment\">//创建Spark上下文</span></span><br><span class=\"line\">    sc.setLogLevel(<span class=\"string\">&quot;WARN&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">val</span> result: <span class=\"type\">Array</span>[(<span class=\"type\">String</span>,<span class=\"type\">String</span> )] = sc.textFile(<span class=\"string\">&quot;in/top/&quot;</span>) </span><br><span class=\"line\">    <span class=\"comment\">//逐行读入数据，路径是项目根目录下in/top文件夹</span></span><br><span class=\"line\">      .map(_.split(<span class=\"string\">&quot; &quot;</span>))</span><br><span class=\"line\">      <span class=\"comment\">//按空格分开</span></span><br><span class=\"line\">      .map(line =&gt; (line(<span class=\"number\">0</span>), line(<span class=\"number\">1</span>)))</span><br><span class=\"line\">      <span class=\"comment\">//映射键值对</span></span><br><span class=\"line\">      .sortByKey(<span class=\"literal\">false</span>)</span><br><span class=\"line\">      <span class=\"comment\">//按键进行排序，默认升序，false降序</span></span><br><span class=\"line\">      .take(<span class=\"number\">5</span>)</span><br><span class=\"line\">      <span class=\"comment\">//取结果前N个</span></span><br><span class=\"line\">    result.foreach(println)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>输入数据以及输出结果：</p>\n<figure class=\"highlight scala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//输入数据</span></span><br><span class=\"line\"><span class=\"number\">56</span> test1</span><br><span class=\"line\"><span class=\"number\">73</span> test2</span><br><span class=\"line\"><span class=\"number\">84</span> test3</span><br><span class=\"line\"><span class=\"number\">74</span> test4</span><br><span class=\"line\"><span class=\"number\">83</span> test5</span><br><span class=\"line\"><span class=\"number\">93</span> test6</span><br><span class=\"line\"><span class=\"number\">88</span> test7</span><br><span class=\"line\"><span class=\"number\">81</span> test8</span><br><span class=\"line\"><span class=\"number\">92</span> test9</span><br><span class=\"line\"><span class=\"number\">34</span> test10</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//输出</span></span><br><span class=\"line\">(<span class=\"number\">93</span>,test6)</span><br><span class=\"line\">(<span class=\"number\">92</span>,test9)</span><br><span class=\"line\">(<span class=\"number\">88</span>,test7)</span><br><span class=\"line\">(<span class=\"number\">84</span>,test3)</span><br><span class=\"line\">(<span class=\"number\">83</span>,test5)</span><br></pre></td></tr></table></figure>\n<h2 id=\"avg\"><a class=\"markdownIt-Anchor\" href=\"#avg\">#</a> Avg</h2>\n<p>题目：给定一组键值对 (“spark”,2),(“hadoop”,6),(“hadoop”,4),(“spark”,6)，键值对的 key 表示图书名称，value 表示某天图书销量，请计算每个键对应的平均值，也就是计算每种图书的每天平均销量。<br>\n代码示例如下：</p>\n<figure class=\"highlight scala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.apache.spark.&#123;<span class=\"type\">SparkConf</span>, <span class=\"type\">SparkContext</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">object</span> <span class=\"title\">Avg</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span></span>(args: <span class=\"type\">Array</span>[<span class=\"type\">String</span>]): <span class=\"type\">Unit</span> = &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> config: <span class=\"type\">SparkConf</span> = <span class=\"keyword\">new</span> <span class=\"type\">SparkConf</span>().setMaster(<span class=\"string\">&quot;local[*]&quot;</span>).setAppName(<span class=\"string\">&quot;Avg&quot;</span>)</span><br><span class=\"line\">    <span class=\"comment\">//设置内核个数以及程序名称</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> sc: <span class=\"type\">SparkContext</span> = <span class=\"keyword\">new</span> <span class=\"type\">SparkContext</span>(config)</span><br><span class=\"line\">    <span class=\"comment\">//创建Spark上下文</span></span><br><span class=\"line\">    sc.setLogLevel(<span class=\"string\">&quot;WARN&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">val</span> data = <span class=\"type\">Array</span>((<span class=\"string\">&quot;spark&quot;</span>,<span class=\"number\">2</span>),(<span class=\"string\">&quot;hadoop&quot;</span>,<span class=\"number\">6</span>),(<span class=\"string\">&quot;hadoop&quot;</span>,<span class=\"number\">4</span>),(<span class=\"string\">&quot;spark&quot;</span>,<span class=\"number\">6</span>))</span><br><span class=\"line\">    <span class=\"keyword\">val</span> res = sc.parallelize(data)</span><br><span class=\"line\">    <span class=\"comment\">//读入数据</span></span><br><span class=\"line\">      .mapValues(a =&gt; (a,<span class=\"number\">1</span>))</span><br><span class=\"line\">      <span class=\"comment\">//将值映射成为（值，次数）的形式</span></span><br><span class=\"line\">      .reduceByKey((a,b) =&gt; (a._1+b._1,a._2+b._2))</span><br><span class=\"line\">      <span class=\"comment\">//相同键进行Reduce，累加次数以及销量</span></span><br><span class=\"line\">      .map(t =&gt; (t._1,t._2._1/t._2._2))</span><br><span class=\"line\">      <span class=\"comment\">//计算平均值</span></span><br><span class=\"line\">    res.foreach(println)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这里使用简易的数组导入数据，使用 parallelize () 方法，输出如下：</p>\n<figure class=\"highlight scala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//output</span></span><br><span class=\"line\">(spark,<span class=\"number\">4</span>)</span><br><span class=\"line\">(hadoop,<span class=\"number\">5</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">进程已结束，退出代码 <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"secondarysort\"><a class=\"markdownIt-Anchor\" href=\"#secondarysort\">#</a> SecondarySort</h2>\n<p>二次排序也是一个经典案例，实现按键排序的同时按值排序，代码如下：</p>\n<figure class=\"highlight scala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.apache.spark.&#123;<span class=\"type\">SparkConf</span>, <span class=\"type\">SparkContext</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//定义一个比较类，重写比较方法，记得加上序列化</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SecondarySortKey</span>(<span class=\"params\">val first: <span class=\"type\">Int</span>, val second: <span class=\"type\">Int</span></span>) <span class=\"keyword\">extends</span> <span class=\"title\">Ordered</span>[<span class=\"type\">SecondarySortKey</span>] <span class=\"keyword\">with</span> <span class=\"title\">Serializable</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">compare</span></span>(other: <span class=\"type\">SecondarySortKey</span>): <span class=\"type\">Int</span> =</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.first - other.first != <span class=\"number\">0</span>)</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.first - other.first</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.second - other.second</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">object</span> <span class=\"title\">SecondarySort</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span></span>(args: <span class=\"type\">Array</span>[<span class=\"type\">String</span>]): <span class=\"type\">Unit</span> = &#123;</span><br><span class=\"line\">    <span class=\"keyword\">val</span> config: <span class=\"type\">SparkConf</span> = <span class=\"keyword\">new</span> <span class=\"type\">SparkConf</span>().setMaster(<span class=\"string\">&quot;local[*]&quot;</span>).setAppName(<span class=\"string\">&quot;SecondarySort&quot;</span>)</span><br><span class=\"line\">      <span class=\"comment\">//设置内核个数以及程序名称</span></span><br><span class=\"line\">    <span class=\"keyword\">val</span> sc: <span class=\"type\">SparkContext</span> = <span class=\"keyword\">new</span> <span class=\"type\">SparkContext</span>(config)</span><br><span class=\"line\">      <span class=\"comment\">//创建Spark上下文</span></span><br><span class=\"line\">    sc.setLogLevel(<span class=\"string\">&quot;WARN&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">val</span> result: <span class=\"type\">Array</span>[(<span class=\"type\">Int</span>,<span class=\"type\">Int</span>)] = sc.textFile(<span class=\"string\">&quot;in/second&quot;</span>)</span><br><span class=\"line\">      <span class=\"comment\">//逐行读入数据，路径是项目根目录下in/second文件夹</span></span><br><span class=\"line\">      .map(_.split(<span class=\"string\">&quot; &quot;</span>))</span><br><span class=\"line\">      <span class=\"comment\">//按空格分开</span></span><br><span class=\"line\">      .map(line =&gt; (line(<span class=\"number\">0</span>).toInt, line(<span class=\"number\">1</span>).toInt)) </span><br><span class=\"line\">      <span class=\"comment\">//映射键值对</span></span><br><span class=\"line\">      .map(line =&gt; (<span class=\"keyword\">new</span> <span class=\"type\">SecondarySortKey</span>(line._1,line._2), line))</span><br><span class=\"line\">      <span class=\"comment\">//映射成为（可比较类，原数据）的形式</span></span><br><span class=\"line\">      .sortByKey(<span class=\"literal\">false</span>)</span><br><span class=\"line\">      <span class=\"comment\">//按键降序</span></span><br><span class=\"line\">      .map(x =&gt; x._2).collect()</span><br><span class=\"line\">      <span class=\"comment\">//排序完只保留原数据</span></span><br><span class=\"line\">    result.foreach(println)</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>输入数据以及输出结果：</p>\n<figure class=\"highlight scala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//input</span></span><br><span class=\"line\"><span class=\"number\">32</span> <span class=\"number\">35</span></span><br><span class=\"line\"><span class=\"number\">25</span> <span class=\"number\">46</span></span><br><span class=\"line\"><span class=\"number\">52</span> <span class=\"number\">65</span></span><br><span class=\"line\"><span class=\"number\">29</span> <span class=\"number\">85</span></span><br><span class=\"line\"><span class=\"number\">85</span> <span class=\"number\">42</span></span><br><span class=\"line\"><span class=\"number\">25</span> <span class=\"number\">45</span></span><br><span class=\"line\"><span class=\"number\">95</span> <span class=\"number\">96</span></span><br><span class=\"line\"><span class=\"number\">75</span> <span class=\"number\">96</span></span><br><span class=\"line\"><span class=\"number\">75</span> <span class=\"number\">62</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//output</span></span><br><span class=\"line\">(<span class=\"number\">95</span>,<span class=\"number\">96</span>)</span><br><span class=\"line\">(<span class=\"number\">85</span>,<span class=\"number\">42</span>)</span><br><span class=\"line\">(<span class=\"number\">75</span>,<span class=\"number\">96</span>)</span><br><span class=\"line\">(<span class=\"number\">75</span>,<span class=\"number\">62</span>)</span><br><span class=\"line\">(<span class=\"number\">52</span>,<span class=\"number\">65</span>)</span><br><span class=\"line\">(<span class=\"number\">32</span>,<span class=\"number\">35</span>)</span><br><span class=\"line\">(<span class=\"number\">29</span>,<span class=\"number\">85</span>)</span><br><span class=\"line\">(<span class=\"number\">25</span>,<span class=\"number\">46</span>)</span><br><span class=\"line\">(<span class=\"number\">25</span>,<span class=\"number\">45</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>",
            "tags": [
                "大数据"
            ]
        }
    ]
}