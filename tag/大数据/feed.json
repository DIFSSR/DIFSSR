{
    "version": "https://jsonfeed.org/version/1",
    "title": "千里稻花应秀色 • All posts by \"大数据\" tag",
    "description": "blogs by SSR",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2021/10/08/hive5/",
            "url": "http://example.com/2021/10/08/hive5/",
            "title": "Hive查询进阶",
            "date_published": "2021-10-08T09:57:10.000Z",
            "content_html": "<h1 id=\"hiveql数据查询进阶\"><a class=\"markdownIt-Anchor\" href=\"#hiveql数据查询进阶\">#</a> HiveQL 数据查询进阶</h1>\n<p>本章要点</p>\n<ul>\n<li>Hive 内置函数</li>\n<li>Hive 构建搜索日志分析系统</li>\n<li>Sqoop 应用与开发</li>\n</ul>\n<h2 id=\"hive-内置函数\"><a class=\"markdownIt-Anchor\" href=\"#hive-内置函数\">#</a> Hive 内置函数</h2>\n<p>Hive 内置函数就是 Hive 中可以直接使用的函数，首先查看一下有哪些函数</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">show</span> functions;</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------------------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span>           tab_name           <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------------------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">!</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">!=</span>                           <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> $sum0                        <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">%</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">&amp;</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">*</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">+</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">-</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">/</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">&lt;</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">&lt;=</span>                           <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">&lt;=&gt;</span>                          <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">&lt;&gt;</span>                           <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">=</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">=</span><span class=\"operator\">=</span>                           <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">&gt;</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">&gt;=</span>                           <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"operator\">^</span>                            <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> abs                          <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> acos                         <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> add_months                   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> aes_decrypt                  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> aes_encrypt                  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"keyword\">and</span>                          <span class=\"operator\">|</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------------------------------+</span></span><br><span class=\"line\"><span class=\"number\">289</span> <span class=\"keyword\">rows</span> selected (<span class=\"number\">0.494</span> seconds)</span><br></pre></td></tr></table></figure>\n<p>其中常用的如 avg 求平均，concat 连接函数，count 统计等。内置函数可以被分成：数学函数、字符函数、收集函数、转换函数、日期函数、条件函数、聚合函数以及表生成函数。</p>\n<h3 id=\"数学函数\"><a class=\"markdownIt-Anchor\" href=\"#数学函数\">#</a> 数学函数</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#加法</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"number\">10</span><span class=\"operator\">+</span><span class=\"number\">10</span>;</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">20</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> selected (<span class=\"number\">1.324</span> seconds)</span><br><span class=\"line\"></span><br><span class=\"line\">#减法</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"number\">15</span><span class=\"number\">-3</span>;</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">12</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> selected (<span class=\"number\">0.564</span> seconds)</span><br><span class=\"line\"></span><br><span class=\"line\">#乘除<span class=\"operator\">*</span><span class=\"operator\">/</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"number\">6</span><span class=\"operator\">*</span><span class=\"number\">6</span>;</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">36</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> selected (<span class=\"number\">0.867</span> seconds)</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"number\">36</span><span class=\"operator\">/</span><span class=\"number\">6</span>;</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">6.0</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> selected (<span class=\"number\">0.734</span> seconds)</span><br><span class=\"line\"></span><br><span class=\"line\">#round四舍五入</span><br><span class=\"line\"><span class=\"keyword\">select</span> round(<span class=\"number\">88.999</span>,<span class=\"number\">2</span>),round(<span class=\"number\">78.600</span>,<span class=\"number\">1</span>), round(<span class=\"number\">55.776</span>,<span class=\"number\">2</span>);</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+-------+--------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">89.00</span>  <span class=\"operator\">|</span> <span class=\"number\">78.6</span>  <span class=\"operator\">|</span> <span class=\"number\">55.78</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+-------+--------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> selected (<span class=\"number\">0.505</span> seconds)</span><br><span class=\"line\"></span><br><span class=\"line\">#ceil向上取整</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">ceil</span>(<span class=\"number\">84.5</span>);</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">85</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> selected (<span class=\"number\">0.542</span> seconds)</span><br><span class=\"line\"></span><br><span class=\"line\">#floor向下取整</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">floor</span>(<span class=\"number\">45.9</span>);</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">45</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> selected (<span class=\"number\">0.535</span> seconds)</span><br><span class=\"line\"></span><br><span class=\"line\">#pow 平方函数</span><br><span class=\"line\"><span class=\"keyword\">select</span> pow(<span class=\"number\">2</span>,<span class=\"number\">3</span>);</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">8.0</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> selected (<span class=\"number\">0.357</span> seconds)</span><br><span class=\"line\"></span><br><span class=\"line\">#pmod 取模函数</span><br><span class=\"line\"><span class=\"keyword\">select</span> pmod(<span class=\"number\">9</span>,<span class=\"number\">8</span>);</span><br><span class=\"line\">INFO  : OK</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">1</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"type\">row</span> selected (<span class=\"number\">0.242</span> seconds)</span><br></pre></td></tr></table></figure>\n<h3 id=\"字符函数\"><a class=\"markdownIt-Anchor\" href=\"#字符函数\">#</a> 字符函数</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#lower转小写</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">lower</span>(&quot;FJKNXCYT&quot;);</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> fjknxcyt  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------+</span></span><br><span class=\"line\">#upper转大写</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">upper</span>(&quot;asdjnkgbasd&quot;);</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> ASDJNKGBASD  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------------+</span></span><br><span class=\"line\">#length字符串长度</span><br><span class=\"line\"><span class=\"keyword\">select</span> length(&quot;hadoop&quot;);</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">6</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\">#concat字符拼接</span><br><span class=\"line\"><span class=\"keyword\">select</span> concat(&quot;hadoop&quot;, &quot;&amp;hive&quot;);</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> hadoop<span class=\"operator\">&amp;</span>hive  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------------+</span></span><br><span class=\"line\">#substr取子串(从<span class=\"number\">8</span>开始取<span class=\"number\">5</span>个)</span><br><span class=\"line\"><span class=\"keyword\">select</span> substr(&quot;hadoop spark hive&quot;, <span class=\"number\">8</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> spark  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+</span></span><br><span class=\"line\">#trim去除前后空格</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">trim</span>(&quot;   hadoop   &quot;);</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">---------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> hadoop  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">---------+</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"转换函数\"><a class=\"markdownIt-Anchor\" href=\"#转换函数\">#</a> 转换函数</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#cast类型转换函数</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">cast</span> (<span class=\"number\">88</span> <span class=\"keyword\">as</span> <span class=\"keyword\">double</span>);</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">88.0</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"日期函数\"><a class=\"markdownIt-Anchor\" href=\"#日期函数\">#</a> 日期函数</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#<span class=\"keyword\">year</span> <span class=\"keyword\">month</span> <span class=\"keyword\">day</span> 分别获取年月日</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">year</span>(&quot;2021-10-08 18:40:24&quot;), <span class=\"keyword\">month</span>(&quot;2021-10-08 18:40:24&quot;), <span class=\"keyword\">day</span>(&quot;2021-10-08 18:40:24&quot;);</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+------+------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">2021</span>  <span class=\"operator\">|</span> <span class=\"number\">10</span>   <span class=\"operator\">|</span> <span class=\"number\">8</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+------+------+</span></span><br><span class=\"line\">#to_date返回字段中日期部分</span><br><span class=\"line\"><span class=\"keyword\">select</span> to_date(&quot;2021-10-08 18:40:24&quot;);</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">2021</span><span class=\"number\">-10</span><span class=\"number\">-08</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------------+</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"条件函数\"><a class=\"markdownIt-Anchor\" href=\"#条件函数\">#</a> 条件函数</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#<span class=\"keyword\">case</span> A <span class=\"keyword\">when</span> B <span class=\"keyword\">then</span> C <span class=\"keyword\">when</span> D <span class=\"keyword\">then</span> E <span class=\"keyword\">else</span> F <span class=\"keyword\">end</span>;</span><br><span class=\"line\"><span class=\"keyword\">select</span> ts, uid, rank, <span class=\"keyword\">case</span> rank <span class=\"keyword\">when</span> &quot;2&quot; <span class=\"keyword\">then</span> rank<span class=\"operator\">+</span><span class=\"number\">1</span> <span class=\"keyword\">else</span> rank<span class=\"number\">-1</span> <span class=\"keyword\">end</span> <span class=\"keyword\">from</span> sogou.sogou_liangjian;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------------+-----------------------------------+-------+------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span>       ts        <span class=\"operator\">|</span>                uid                <span class=\"operator\">|</span> rank  <span class=\"operator\">|</span> _c3  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------------+-----------------------------------+-------+------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">20111230104333</span>  <span class=\"operator\">|</span> <span class=\"number\">53</span>a3b5132bd6af7d324f3fd55d7153ba  <span class=\"operator\">|</span> <span class=\"number\">3</span>     <span class=\"operator\">|</span> <span class=\"number\">2</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">20111230104334</span>  <span class=\"operator\">|</span> <span class=\"number\">966</span>a6bf4c4ec1cc693b6e40702984235  <span class=\"operator\">|</span> <span class=\"number\">4</span>     <span class=\"operator\">|</span> <span class=\"number\">3</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">20111230104334</span>  <span class=\"operator\">|</span> ae55d5e4b4f29a1221816a121e087567  <span class=\"operator\">|</span> <span class=\"number\">2</span>     <span class=\"operator\">|</span> <span class=\"number\">3</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------------+-----------------------------------+-------+------+</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"聚合函数\"><a class=\"markdownIt-Anchor\" href=\"#聚合函数\">#</a> 聚合函数</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#count返回行数</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> sogou.sogou_xj;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">1330</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-------+</span></span><br><span class=\"line\">#sum求和</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">sum</span>(orders) <span class=\"keyword\">as</span> ordersum <span class=\"keyword\">from</span> sogou.sogou_xj;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> ordersum  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">2043</span>      <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------+</span></span><br><span class=\"line\">#min列最小值</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">min</span>(orders) <span class=\"keyword\">from</span> sogou.sogou_xj;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">1</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\">#max列最大值</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">max</span>(rank) <span class=\"keyword\">from</span> sogou.sogou_xj;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">10</span>   <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------+</span></span><br><span class=\"line\">#avg列平均值</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">avg</span>(rank) <span class=\"keyword\">from</span> sogou.sogou_xj;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">---------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">2.9225563909774435</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">---------------------+</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"hive-构建搜索日志分析系统\"><a class=\"markdownIt-Anchor\" href=\"#hive-构建搜索日志分析系统\">#</a> Hive 构建搜索日志分析系统</h2>\n<h3 id=\"数据预处理linux环境\"><a class=\"markdownIt-Anchor\" href=\"#数据预处理linux环境\">#</a> 数据预处理 (Linux 环境)</h3>\n<ol>\n<li>查看数据</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@hdp-1 hive]# wc -l sogou.500w.utf8 </span><br><span class=\"line\">5000000 sogou.500w.utf8</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>数据拓展<br>\n将用户访问的时间拆分成，年月日小时字段，为后面创建分区表做准备，编写一个 shell 脚本实现此功能。</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi pre.sh </span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">!/bin/bash</span></span><br><span class=\"line\">infile=$1</span><br><span class=\"line\">outfile=$2</span><br><span class=\"line\">awk -F &#x27;\\t&#x27; &#x27;&#123;print $0&quot;\\t&quot;substr($1,1,4)&quot;\\t&quot;substr($1,5,2)&quot;\\t&quot;substr($1,7,2)&quot;\\t&quot;substr($1,9,2)&#125;&#x27; $infile &gt; $outfile</span><br><span class=\"line\"></span><br><span class=\"line\">chmod +x pre.sh</span><br><span class=\"line\">sh pre.sh ./sogou.500w.utf8 ./sogou.500w.utf8.ext</span><br><span class=\"line\">less sogou.500w.utf8.ext</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>数据加载<br>\n将数据放到 HDFS 上</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hdfs dfs -mkdir -p /usr/local/hive/</span><br><span class=\"line\">hdfs dfs -put ./sogou.500w.utf8.ext /usr/local/hive/</span><br></pre></td></tr></table></figure>\n<h3 id=\"基于hive-构建日志的数据仓库\"><a class=\"markdownIt-Anchor\" href=\"#基于hive-构建日志的数据仓库\">#</a> 基于 Hive 构建日志的数据仓库</h3>\n<p>启动 Hadoop 集群，打开 Hive 客户端</p>\n<ol>\n<li>基本操作</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">show</span> databases;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">---------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span>    database_name    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">---------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"keyword\">default</span>             <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> information_schema  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou               <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sys                 <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">---------------------+</span></span><br><span class=\"line\"><span class=\"keyword\">create</span> database if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> sogou;</span><br><span class=\"line\">use sogou;</span><br><span class=\"line\"><span class=\"keyword\">show</span> tables;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span>     tab_name     <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_500w       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_liangjian  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_xj         <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_xj_backup  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------------------+</span></span><br><span class=\"line\">#创建外部表sogou_0936加载sogou<span class=\"number\">.500</span>w.utf8的数据</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">external</span> <span class=\"keyword\">table</span>  if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> sogou.sogou_0936(ts string,uid string,keyword string, rank <span class=\"type\">int</span>, orders <span class=\"type\">int</span>, url string) <span class=\"type\">row</span> format delimited fields terminated <span class=\"keyword\">by</span> <span class=\"string\">&#x27;\\t&#x27;</span> stored <span class=\"keyword\">as</span> textfile location <span class=\"string\">&#x27;/usr/local/hive/raw/&#x27;</span>;</span><br><span class=\"line\">#创建外部表sogou_ext加载sogou<span class=\"number\">.500</span>w.utf8.ext的数据</span><br><span class=\"line\"> <span class=\"keyword\">create</span> <span class=\"keyword\">external</span> <span class=\"keyword\">table</span>  if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> sogou.sogou_ext(ts string,uid string,keyword string, rank <span class=\"type\">int</span>, orders <span class=\"type\">int</span>, url string) <span class=\"type\">row</span> format delimited fields terminated <span class=\"keyword\">by</span> <span class=\"string\">&#x27;\\t&#x27;</span> stored <span class=\"keyword\">as</span> textfile location <span class=\"string\">&#x27;/usr/local/hive/ext/&#x27;</span></span><br><span class=\"line\">#查看数据没问题</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> sogou_0936 limit <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> sogou_ext limit <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"keyword\">desc</span> sogou_0936;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------+------------+----------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> col_name  <span class=\"operator\">|</span> data_type  <span class=\"operator\">|</span> comment  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------+------------+----------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> ts        <span class=\"operator\">|</span> string     <span class=\"operator\">|</span>          <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> uid       <span class=\"operator\">|</span> string     <span class=\"operator\">|</span>          <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> keyword   <span class=\"operator\">|</span> string     <span class=\"operator\">|</span>          <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> rank      <span class=\"operator\">|</span> <span class=\"type\">int</span>        <span class=\"operator\">|</span>          <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> orders    <span class=\"operator\">|</span> <span class=\"type\">int</span>        <span class=\"operator\">|</span>          <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> url       <span class=\"operator\">|</span> string     <span class=\"operator\">|</span>          <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------+------------+----------+</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>创建分区表</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#创建分区表</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">external</span> <span class=\"keyword\">table</span>  if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> sogou.sogou_partition(ts string,uid string,keyword string, rank <span class=\"type\">int</span>, orders <span class=\"type\">int</span>, url string) partitioned <span class=\"keyword\">by</span> (<span class=\"keyword\">year</span> <span class=\"type\">int</span>, <span class=\"keyword\">month</span> <span class=\"type\">int</span>, <span class=\"keyword\">day</span> <span class=\"type\">int</span>, <span class=\"keyword\">hour</span> <span class=\"type\">int</span> ) <span class=\"type\">row</span> format delimited fields terminated <span class=\"keyword\">by</span> <span class=\"string\">&#x27;\\t&#x27;</span> stored <span class=\"keyword\">as</span> textfile;</span><br><span class=\"line\">#查看表</span><br><span class=\"line\"><span class=\"keyword\">show</span> tables;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span>     tab_name     <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------------------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_0936       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_500w       <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_ext        <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_liangjian  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_partition  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_xj         <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> sogou_xj_backup  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">------------------+</span></span><br><span class=\"line\">#最后向分区表中导入数据</span><br><span class=\"line\">#开启动态分区非严格模式</span><br><span class=\"line\"><span class=\"keyword\">set</span> hive.exec.dynamic.partition.mode<span class=\"operator\">=</span>nonstrict;</span><br><span class=\"line\">#禁用矢量运行</span><br><span class=\"line\"><span class=\"keyword\">set</span> hive.vectorized.execution.enabled<span class=\"operator\">=</span><span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">insert</span> overwrite <span class=\"keyword\">table</span> sogou.sogou_partition <span class=\"keyword\">partition</span>(<span class=\"keyword\">year</span>, <span class=\"keyword\">month</span>, <span class=\"keyword\">day</span>, <span class=\"keyword\">hour</span>) <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> sogou.sogou_ext;</span><br><span class=\"line\">#查看数据</span><br></pre></td></tr></table></figure>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"image-20211008220145786.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20211008220145786\"></p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"image-20211008220222053.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20211008220222053\"></p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"image-20211008220457507.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20211008220457507\"></p>\n<h3 id=\"数据分析需求1条数统计\"><a class=\"markdownIt-Anchor\" href=\"#数据分析需求1条数统计\">#</a> 数据分析需求（1）：条数统计</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#查询总数据条数</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> sogou.sogou_ext;</span><br></pre></td></tr></table></figure>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"image-20211008221558788.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20211008221558788\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#查询关键词非空数据</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">where</span> keyword <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"keyword\">null</span> <span class=\"keyword\">and</span> keyword <span class=\"operator\">!=</span> <span class=\"string\">&#x27;&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"image-20211009083441029.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20211009083441029\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#无重复总条数（根据ts, uid, keyword, url）</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> uid,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> ts,uid,keyword,url <span class=\"keyword\">having</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"operator\">=</span> <span class=\"number\">1</span> ) t;</span><br><span class=\"line\">#需要给子表起个名</span><br></pre></td></tr></table></figure>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"image-20211009114925786.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20211009114925786\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#统计独立uid条数</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"keyword\">distinct</span>(uid)) <span class=\"keyword\">from</span> sogou.sogou_ext;</span><br></pre></td></tr></table></figure>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"image-20211009115150331.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20211009115150331\"></p>\n<h3 id=\"数据分析需求2关键词分析\"><a class=\"markdownIt-Anchor\" href=\"#数据分析需求2关键词分析\">#</a> 数据分析需求（2）：关键词分析</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#查询关键词平均长度</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">avg</span>(a.cnt) <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> size(split(keyword,<span class=\"string\">&#x27; s+&#x27;</span>)) <span class=\"keyword\">as</span> cnt <span class=\"keyword\">from</span> sogou.sogou_ext) a;</span><br><span class=\"line\">#由于split函数不支持矢量计算，需要先关闭该功能</span><br><span class=\"line\"><span class=\"keyword\">set</span> hive.vectorized.execution.enabled<span class=\"operator\">=</span><span class=\"literal\">false</span>;</span><br></pre></td></tr></table></figure>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"image-20211009122646106.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20211009122646106\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#查询频度排名前<span class=\"number\">50</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> keyword,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">as</span> cnt <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> keyword <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> cnt <span class=\"keyword\">desc</span> limit <span class=\"number\">50</span>;</span><br></pre></td></tr></table></figure>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"image-20211009122909785.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20211009122909785\"></p>\n<h3 id=\"数据分析需求3uid分析\"><a class=\"markdownIt-Anchor\" href=\"#数据分析需求3uid分析\">#</a> 数据分析需求（3）：UID 分析</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#为了统计UID的查询次数分布（查询<span class=\"number\">1</span>次的UID个数…查询n次的UID个数），这里我们列出查询<span class=\"number\">1</span>次、<span class=\"number\">2</span>次、<span class=\"number\">3</span>次和大于<span class=\"number\">3</span>次的UID个数</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">sum</span>(if(uids.cnt<span class=\"operator\">=</span><span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">0</span>)),<span class=\"built_in\">sum</span>(if(uids.cnt<span class=\"operator\">=</span><span class=\"number\">2</span>,<span class=\"number\">1</span>,<span class=\"number\">0</span>)), <span class=\"built_in\">sum</span>(if(uids.cnt<span class=\"operator\">=</span><span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">0</span>)), <span class=\"built_in\">sum</span>(if(uids.cnt<span class=\"operator\">&gt;</span><span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">0</span>)) <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> uid, <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">as</span> cnt <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> uid) uids;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"image-20211009123459384.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20211009123459384\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#统计UID平均查询次数</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">sum</span>(a.cnt)<span class=\"operator\">/</span><span class=\"built_in\">count</span>(a.uid)<span class=\"keyword\">from</span>(<span class=\"keyword\">select</span> uid,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>)<span class=\"keyword\">as</span> cnt <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> uid) a;</span><br></pre></td></tr></table></figure>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"image-20211009124613760.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20211009124613760\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#统计查询次数大于<span class=\"number\">2</span>次的用户占比：</span><br><span class=\"line\">#先统计B:UID总数</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"keyword\">distinct</span>(uid)) <span class=\"keyword\">as</span> A <span class=\"keyword\">from</span> sogou.sogou_ext;</span><br><span class=\"line\">#统计查询A:次数大于<span class=\"number\">2</span>的UID个数</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(a.uid) <span class=\"keyword\">as</span> B <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> uid,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">as</span> cnt <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> uid <span class=\"keyword\">having</span> cnt<span class=\"operator\">&gt;</span><span class=\"number\">2</span>)a;</span><br><span class=\"line\">#占比结果是C<span class=\"operator\">=</span>B<span class=\"operator\">/</span>A</span><br><span class=\"line\">#查询次数大于<span class=\"number\">2</span>次的数据如下</span><br><span class=\"line\"><span class=\"keyword\">select</span> b.<span class=\"operator\">*</span> <span class=\"keyword\">from</span>(<span class=\"keyword\">select</span> uid,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">as</span> cnt <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> uid <span class=\"keyword\">having</span> cnt <span class=\"operator\">&gt;</span><span class=\"number\">2</span>) a <span class=\"keyword\">join</span> sogou.sogou_ext b <span class=\"keyword\">on</span> a.uid<span class=\"operator\">=</span>b.uid limit <span class=\"number\">50</span>;</span><br></pre></td></tr></table></figure>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"image-20211009124722432.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20211009124722432\"></p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"image-20211009124814645.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20211009124814645\"></p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"image-20211009125148463.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20211009125148463\"></p>\n<h3 id=\"数据分析需求4用户行为分析\"><a class=\"markdownIt-Anchor\" href=\"#数据分析需求4用户行为分析\">#</a> 数据分析需求（4）：用户行为分析</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#点击次数与rank之间的关系</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">where</span> rank <span class=\"operator\">&lt;</span> <span class=\"number\">11</span>;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">4999869</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----------+</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#直接输入url进行查询的比例</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">where</span> keyword <span class=\"keyword\">like</span><span class=\"string\">&#x27;%www%&#x27;</span>;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">73979</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#用户访问的网站包含用户输入的url类型关键词</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">sum</span>(if(instr(url，keyword)<span class=\"operator\">&gt;</span><span class=\"number\">0</span>,<span class=\"number\">1</span>,<span class=\"number\">0</span>)) <span class=\"keyword\">from</span> (<span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">where</span> keyword <span class=\"keyword\">like</span> <span class=\"string\">&#x27;%www%&#x27;</span>)a;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">27561</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">--------+</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#查询独立用户行为</span><br><span class=\"line\"><span class=\"keyword\">select</span> uid, <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>)<span class=\"keyword\">as</span> cnt <span class=\"keyword\">from</span> sogou.sogou_ext <span class=\"keyword\">where</span> keyword <span class=\"keyword\">like</span><span class=\"string\">&#x27;%仙剑奇侠传%&#x27;</span> <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> uid <span class=\"keyword\">having</span> cnt <span class=\"operator\">&gt;</span> <span class=\"number\">3</span>;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------------------------------+------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span>                uid                <span class=\"operator\">|</span> cnt  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">-----------------------------------+------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">265</span>f1fa26029c058c695ecc7ee4bad01  <span class=\"operator\">|</span> <span class=\"number\">4</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">2</span>b136abffd8f0dd38d97a52a7e50f7fb  <span class=\"operator\">|</span> <span class=\"number\">4</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">40</span>aa046859609c25b3914ac9f2735c5c  <span class=\"operator\">|</span> <span class=\"number\">5</span>    <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">|</span> <span class=\"number\">653</span>d48aa356d5111ac0e59f9fe736429  <span class=\"operator\">|</span> <span class=\"number\">9</span>    <span class=\"operator\">|</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"sqoop-应用与开发\"><a class=\"markdownIt-Anchor\" href=\"#sqoop-应用与开发\">#</a> Sqoop 应用与开发</h2>\n<p>在实际开发中我们经常会碰到这样一种需求，即大数据平台处理完的数据需要导入关系型数据库，反之关系型数据库中的数据也需要导入大数据平台，为此大数据平台为我们提供了 Sqoop 工具来解决这一需求。</p>\n<h3 id=\"sqoop简介\"><a class=\"markdownIt-Anchor\" href=\"#sqoop简介\">#</a> Sqoop 简介</h3>\n<p>Sqoop 是 Apache 开源的顶级项目之一，用于在 ApacheHadoop 和关系型数据库等结构化数据存储之间高效传输大容量数据的工具。也就是说，Sqoop 是一款类 ETL 工具，主要负责将大数据平台处理完的数据导入关系型数据库中，或者将关系型数据库中的数据带入大数据平台。</p>\n<h3 id=\"sqoop安装部署\"><a class=\"markdownIt-Anchor\" href=\"#sqoop安装部署\">#</a> Sqoop 安装部署</h3>\n<p>安装环境<br>\n在安装 Sqoop 之前确保 hadoop 正确启动，运行，mysql 正常运行。<br>\n解压安装</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf sqoop-1.4.7.bin__hadoop-2.6.0.tar.gz</span><br><span class=\"line\">mv sqoop-1.4.7.bin__hadoop-2.6.0 /usr/local/sqoopmv sqoop-1.4.7.bin__hadoop-2.6.0 /usr/local/sqoop</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">更改目录权限</span></span><br><span class=\"line\">chown hadoop:hadoop -R /usr/local/sqoop/</span><br></pre></td></tr></table></figure>\n<p>配置 Sqoop</p>\n<ol>\n<li>配置 MySQL 连接器<br>\n Sqoop 底层通过 JDBC 的方式访问 MySQL 数据库，所以需要把 MySQL 数据库的驱动程序复制到 Sqoop 的依赖包，这里可以使用 hive 的 mysql 驱动（如果有）</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp /usr/local/hive/lib/mysql-connector-java-5.1.32.jar  /usr/local/sqoop/lib/</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>配置环境变量<br>\n进入到 Sqoop 的 conf 目录下，找到 sqoop-env-template.sh 文件，<a href=\"http://xn--sqoop-env-fp6nq62cnhb6779b.sh\">重命名为 sqoop-env.sh</a>，打开进行环境变量的配置</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp /usr/local/sqoop/conf/sqoop-env-template.sh  /usr/local/sqoop/conf/sqoop-env.sh</span><br><span class=\"line\">vi /usr/local/sqoop/conf/sqoop-env.sh</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>将 commons-log.jar 包放在 lib 下。<br>\n<a href=\"https://mirrors.tuna.tsinghua.edu.cn/apache//commons/lang/binaries/commons-lang-2.6-bin.zip\">https://mirrors.tuna.tsinghua.edu.cn/apache//commons/lang/binaries/commons-lang-2.6-bin.zip</a></li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv commons-lang-2.6.jar /usr/local/sqoop/lib/</span><br><span class=\"line\">chown hadoop:hadoop /usr/local/sqoop/lib/commons-lang-2.6.jar</span><br></pre></td></tr></table></figure>\n<h3 id=\"sqoop将hive表中的数据导入mysql\"><a class=\"markdownIt-Anchor\" href=\"#sqoop将hive表中的数据导入mysql\">#</a> Sqoop 将 Hive 表中的数据导入 MySQL</h3>\n<p><strong>实验条件</strong><br>\n MySQL 正常启动<br>\n<strong>构建 MySQL 数据库中的表</strong></p>\n<ol>\n<li>登录 MySQL<br>\n 登录 MySQL 的命令</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql <span class=\"operator\">-</span>u root <span class=\"operator\">-</span>p</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>创建数据库</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> database if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> test;</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>创建表</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span>  test.uid_cnt (uid <span class=\"type\">varchar</span>(<span class=\"number\">255</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span>,cnt <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">default</span> <span class=\"keyword\">null</span>);</span><br></pre></td></tr></table></figure>\n<p><strong>构建 Hive 数据仓库中的表</strong></p>\n<ol>\n<li>进入 Hive</li>\n<li>创建 Hive 中的表 sogou.sogou_uid_cnt</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> sogou.sogou_uid_cnt(uid string,cnt <span class=\"type\">int</span>) <span class=\"type\">row</span> format delimited fields terminated <span class=\"keyword\">by</span> <span class=\"string\">&#x27;\\t&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>向表中写入数据</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> <span class=\"keyword\">table</span> sogou.sogou_uid_cnt <span class=\"keyword\">select</span> uid,<span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> sogou_500w <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> uid;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> sogou.sogou_uid_cnt limit <span class=\"number\">10</span>;</span><br></pre></td></tr></table></figure>\n<p><strong>使用 Sqoop 工具将 Hive 的数据导入 MySQL</strong></p>\n<ol>\n<li>导入命令</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\">/</span>usr<span class=\"operator\">/</span><span class=\"keyword\">local</span><span class=\"operator\">/</span>sqoop<span class=\"operator\">/</span>bin<span class=\"operator\">/</span>sqoop export <span class=\"comment\">--connect jdbc:mysql://master:3306/test --username root --password 123456 --table uid_cnt --export-dir &#x27;hdfs://master:9000/user/hive/warehouse/sogou.db/sogou_uid_cnt&#x27; --fields-terminated-by &#x27;\\t&#x27;</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>\n<p>以上命令的解释如下<br>\n sqoop export 表示数据从 Hive 复制到 MySQL 数据库中；–connect jdbc:mysql://master:3306/test 表示连接 MySQL 数据库 test；–username root 表示连接 MySQL 数据库的用户名；–password 12345 表示连接 MySQL 数据库的密码；–table uid_cnt 表示 MySQL 中的表即将被导入的表名称；–export-dir '/user/hive/warehouse/sogou.db/uid_cnt’表示 Hive 中被导出的文件路径；–fields-terminated-by '\\t’表示 Hive 中被导出的文件字段的分隔符。</p>\n</li>\n<li>\n<p>以上命令成功运行之后会在控制台打印输出如下结果</p>\n</li>\n<li>\n<p>最后，验证结果数据。<br>\n登录 MySQL 数据库，查询库 test 的表 uid_cnt 中是已经有了数据，如果有数据说明 Sqoop 工具将 Hive 中的数据成功导入了 MySQL。</p>\n</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> test.uid_cnt limit <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> test.uid_cnt;</span><br></pre></td></tr></table></figure>\n<p><strong>使用 Sqoop 工具将 MySQL 中的数据导入 Hive 表</strong><br>\n前面我们成功地将 Hive 表 sogou_uid_cnt 中的数据导入 MySQL 数据库的 uid_cnt 表，反之，我们再利用 Sqoop 工具将表 uid_cnt 中的数据导入表 sogou_uid_cnt2 中</p>\n<ol>\n<li>首先，在 Hive 中创建表 sogou_uid_cnt2</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> sogou.sogou_uid_cnt2(uid string,cnt <span class=\"type\">int</span>) <span class=\"type\">row</span> format delimited fields terminated <span class=\"keyword\">by</span> <span class=\"string\">&#x27;\\t&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">describe</span> sogou.sogou_uid_cnt2;</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>然后，我们就可以使用 Sqoop 工具将 MySQL 中表 uid_cnt 的数据导入 Hive 的表 sogou_uid_cnt<br>\n 在导入数据之前，/user/hive/warehouse/sogou.db/sogou_uid_cnt2 已经存在，我们将其删除。</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hdfs dfs -rmdir /user/hive/warehouse/sogou.db/sogou_uid_cnt2</span><br><span class=\"line\"></span><br><span class=\"line\">/usr/local/sqoop/bin/sqoop import --connect jdbc:mysql://master:3306/test --username root --password 123456 --table uid_cnt --target-dir /user/hive/warehouse/sogou.db/sogou_uid_cnt2 --fields-terminated-by &#x27;\\t&#x27; -m 1</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>进入 Hive 进行验证</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> sogou.sogou_uid_cnt2 limit <span class=\"number\">10</span>;</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "大数据"
            ]
        }
    ]
}